var webjpip=function(e){function t(s){if(n[s])return n[s].exports;var i=n[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=2)}([function(e){'use strict';e.exports.j2kMarkers={StartOfCodestream:[255,79],ImageAndTileSize:[255,81],CodingStyleDefault:[255,82],CodingStyleComponent:[255,83],QuantizationDefault:[255,92],ProgressionOrderChange:[255,95],PackedPacketHeadersInMainHeader:[255,96],PackedPacketHeadersInTileHeader:[255,97],StartOfTile:[255,144],StartOfData:[255,147],EndOfCodestream:[255,217],Comment:[255,100]},e.exports.j2kOffsets={MARKER_SIZE:2,LENGTH_FIELD_SIZE:2,NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER:38,REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER:6},e.exports.jpipEndOfResponseReasons={IMAGE_DONE:1,WINDOW_DONE:2,WINDOW_CHANGE:3,BYTE_LIMIT:4,QUALITY_LIMIT:5,SESSION_LIMIT:6,RESPONSE_LIMIT:7,NON_SPECIFIED:8},e.exports.j2kExceptions={UnsupportedFeatureException:function(e,t){return this.description=e+' (specified in section '+t+' of part 1: Core Coding System standard) is not supported yet',this.toString=function(){return'J2k UnsupportedFeatureException: '+this.description},this},ParseException:function(e){return this.description=e,this.toString=function(){return'J2k ParseException: '+this.description},this},IllegalDataException:function(e,t){return this.description=e+' (see section '+t+' of part 9: Interactivity tools, APIs and Protocols)',this.toString=function(){return'J2k IllegalDataException: '+this.description},this}},e.exports.jpipExceptions={UnsupportedFeatureException:function(e,t){return this.description=e+' (specified in section '+t+' of part 9: Interactivity tools, APIs and Protocols) is not supported yet',this.toString=function(){return'Jpip UnsupportedFeatureException: '+this.description},this},ParseException:function(e){return this.description=e,this.toString=function(){return'Jpip ParseException: '+this.description},this},IllegalDataException:function(e,t){return this.description=e+' (see section '+t+' of part 9: Interactivity tools, APIs and Protocols)',this.toString=function(){return'Jpip IllegalDataException: '+this.description},this},IllegalOperationException:function(e){return this.description=e,this.toString=function(){return'Jpip IllegalOperationException: '+this.description},this},ArgumentException:function(e,t,n){return this.description='Argument '+e+' has invalid value '+t+(void 0===n?'':' :'+n),this.toString=function(){return'Jpip ArgumentException: '+this.description},this},WrongStreamException:function(e,t){var n='JPP (JPIP Precinct)',s='JPT (JPIP Tile-part)';if(t){var i=n;n=s,s=i}return this.description='Stream type is '+s+', but '+e+' is allowed only in '+n+' stream',this.toString=function(){return'Jpip WrongStreamException: '+this.description},this},InternalErrorException:function(e){return this.description=e,this.toString=function(){return'Jpip InternalErrorException: '+this.description},this}},e.exports.j2kExceptions.UnsupportedFeatureException.Name='j2kExceptions.UnsupportedFeatureException',e.exports.j2kExceptions.ParseException.Name='j2kExceptions.ParseException',e.exports.j2kExceptions.IllegalDataException.Name='j2kExceptions.IllegalDataException',e.exports.jpipExceptions.UnsupportedFeatureException.Name='jpipExceptions.UnsupportedFeatureException',e.exports.jpipExceptions.ParseException.Name='jpipExceptions.ParseException',e.exports.jpipExceptions.IllegalDataException.Name='jpipExceptions.IllegalDataException',e.exports.jpipExceptions.IllegalOperationException.Name='jpipExceptions.IllegalOperationException',e.exports.jpipExceptions.ArgumentException.Name='jpipExceptions.ArgumentException',e.exports.jpipExceptions.WrongStreamException.Name='jpipExceptions.WrongStreamException',e.exports.jpipExceptions.InternalErrorException.Name='jpipExceptions.InternalErrorException'},function(e,t,n){'use strict';var s=n(4),i=n(5),a=n(6),r=n(7),o=n(8),l=n(9),c=n(10),d=n(11),p=n(12),u=n(13),g=n(14),m=n(15),f=n(16),h=n(17),x=n(18),y=n(19),E=n(20),I=n(21),b=n(22),C=n(23),P=n(24),T=n(25),S=n(26),L=n(27),v=n(28),O=n(29),k=n(30),R=n(31),D=n(32),A=n(33),j=n(34),N=n(35),_=n(36),F={createChannel:function(e,t){return new o(e,t,F)},createCodestreamReconstructor:function(e,t,n,s){return new l(e,t,n,s)},createLevelCalculator:function(e){return new x(e)},createCodestreamStructure:function(e,t){return new c(e,F,t)},createComponentStructure:function(e,t){return new d(e,t)},createCompositeArray:function(e){return new p(e)},createDatabinParts:function(e,t){return new u(e,t,F)},createDatabinsSaver:function(e){return new g(e,F)},createFetcher:function(e,t){return B||(B=n(37)),new B(e,t)},createFetch:function(e,t,n){return new m(e,t,n)},createHeaderModifier:function(e,t,n){return new f(e,t,n)},createImageDataContext:function(e,t,n){return new h(e,t,n)},createMarkersParser:function(e){return new y(e,r,F)},createObjectPoolByDatabin:function(){return new E},createOffsetsCalculator:function(e,t){return new I(e,t)},createPacketsDataCollector:function(e,t,n){return new b(e,t,n,F)},createRequestDatabinsListener:function(e,t,n,s,i){return new C(e,t,n,s,i,F)},createRequestParamsModifier:function(e){return new P(e)},createRequest:function(e,t,n,s,i){return new T(e,r,t,n,s,i)},createSessionHelper:function(e,t,n,i){return new S(e,t,n,i,s)},createSession:function(e,t,n,s,i){return new L(e,t,n,s,i,setInterval,clearInterval,F)},createReconnectableRequester:function(e,t,n,s){return new v(e,t,n,s,F)},createStructureParser:function(e,t,n){return new O(e,t,r,n)},createTileStructure:function(e,t,n){return new k(e,t,F,n)},createBitstreamReader:function(e){return new R(e,i)},createTagTree:function(e,t,n){return new D(e,t,n,i)},createCodeblockLengthParser:function(e){return new A(e,i)},createSubbandLengthInPacketHeaderCalculator:function(e,t,n){return new j(e,t,n,a,i,F)},createPacketLengthCalculator:function(e,t,n,s,i){return new N(e,t,n,s,i,F)},createQualityLayersCache:function(e){return new _(e,F)}},B;e.exports=F},function(e,t,n){'use strict';var s=n(0);e.exports.JpipImage=n(3),e.exports.PdfjsJpxDecoder=n(38),e.exports.j2kExceptions=s.j2kExceptions,e.exports.jpipExceptions=s.jpipExceptions,e.exports.Internals={jpipRuntimeFactory:n(1),jGlobals:s}},function(e,t,n){'use strict';function s(e){var t=e.stack.trim(),n=a.exec(t);if(n&&''!==n[2])return n[2];if(n=r.exec(t),n&&''!==n[1])return n[1];if(n=o.exec(t),n&&''!==n[1])return n[1];if(void 0!==e.fileName)return e.fileName;throw'webjpip.js: Could not get current script URL'}var i=n(1);e.exports=function(e){var t=i.createDatabinsSaver(!1),n=t.getMainHeaderDatabin(),a=i.createMarkersParser(n),r=i.createOffsetsCalculator(n,a),o=i.createStructureParser(t,a,r),l='RPCL',c=i.createCodestreamStructure(o,l),d=i.createQualityLayersCache(c),p=i.createHeaderModifier(c,r,l),u=i.createCodestreamReconstructor(c,t,p,d),g=i.createPacketsDataCollector(c,t,d),m={reconstructor:u,packetsDataCollector:g,qualityLayersCache:d,codestreamStructure:c,databinsSaver:t,jpipFactory:i},f=i.createRequestParamsModifier(c),h=null,x=null,y=i.createFetcher(t,e);this.opened=function(e){h=e.getImageParams()},this.getLevelCalculator=function(){return null==x&&(x=i.createLevelCalculator(h)),x},this.getDecoderWorkersInputRetreiver=function(){return this},this.getFetcher=function(){return y},this.getWorkerTypeOptions=function(){return{ctorName:'webjpip.PdfjsJpxDecoder',ctorArgs:[],scriptsToImport:[s(new Error)],transferables:[[0,'headersCodestream','codestream','buffer'],[0,'codeblocksData','data','buffer']],pathToTransferablesInPromiseResult:[[]]}},this.getKeyAsString=function(e){return JSON.stringify(e)},this.taskStarted=function(e){function t(t){if(s!==t)throw'webjpip error: Unexpected context in data event';var n=s.getFetchedData();e.dataReady(n),s.isDone()&&(e.terminate(),s.dispose())}var n=f.modify(e.key),s=i.createImageDataContext(m,n.codestreamPartParams,n.progressiveness);s.on('data',t),s.hasData()&&t(s)}};var a=/at (|[^ ]+ \()([^ ]+):\d+:\d+/,r=new RegExp(/.+@(.*?):\d+:\d+/),o=new RegExp(/.+\/(.*?):\d+(:\d+)*$/)},function(e,t,n){'use strict';var s=n(0);e.exports={request:function(e,t,n,i){function a(){if(!l){if(4!==r.readyState){if(void 0===i||null===r.response||3>r.readyState)return;var e=r.response.byteLength,s=e-c;if(s<i)return;c=e}else if(l=!0,200!==r.status||null===r.response)return void n(r);o||t(r,l)}}var r=new XMLHttpRequest,o=void 0===t,l=!1,c=0;if(r.open('GET',e,!o),r.onreadystatechange=a,o||(r.mozResponseType=r.responseType='arraybuffer'),void 0!==i&&(r.setRequestHeader('X-Content-Type-Options','nosniff'),r.onprogress=a),r.send(null),o&&!l)throw new s.jpipExceptions.InternalErrorException('synchronous ajax call was not finished synchronously');return r}}},function(e,t,n){'use strict';var s=n(0);e.exports={createTransaction:function(){function e(e){if(!n.isActive)throw new s.jpipExceptions.InternalErrorException('Cannot terminate an already terminated transaction');t=e?2:3}var t=1,n={get isAborted(){return 3==t},get isActive(){return 1==t},commit:function(){e(!0)},abort:function(){e(!1)}};return n},createTransactionalObject:function(e,t){function n(e){if(!e.isActive)throw new s.jpipExceptions.InternalErrorException('Cannot use terminated transaction to access objects');if(e!==r&&r.isActive)throw new s.jpipExceptions.InternalErrorException('Cannot simultanously access transactional object from two active transactions')}var i=null,a=e,r={isActive:!1,isAborted:!0},o=t?function(e){return e}:function(e){var t=JSON.parse(JSON.stringify(e));return t};return{getValue:function(e){return(n(e),r===e)?i:(r.isAborted?i=o(a):a=o(i),r=e,i)},setValue:function(e,t){return n(e),r===e?void(i=t):void(!r.isAborted&&(a=o(i)),r=e,i=t)}}}}},function(e){'use strict';e.exports=function(){var e=function(){var e=Array(17);return e[0]=0,e[1]=0,e[2]=1,e[3]=0,e[4]=4,e[5]=3,e[6]=2,e[7]=1,e[8]=0,e[9]=6,e[10]=5,e[11]=4,e[12]=3,e[13]=2,e[14]=1,e[15]=0,e[16]=0,e}(),t=function(){var e=Array(17);return e[0]=1,e[1]=2,e[2]=3,e[3]=5,e[4]=6,e[5]=22,e[6]=30,e[7]=34,e[8]=36,e[9]=37,e[10]=101,e[11]=133,e[12]=149,e[13]=157,e[14]=161,e[15]=163,e[16]=164,e}();return{parse:function(n){var s=n.countOnesAndShiftUntilFirstZeroBit(16);if(null===s)return null;var i=e[s],a=n.shiftBits(i);if(null===a)return null;var r=t[s];return a+r}}}()},function(e,t,n){'use strict';var s=n(0),i={LSB_MASK:1,BIT_4_MASK:16,BITS_56_MASK:96,MSB_MASK:128,LSB_7_MASK:127,parseNumberInVbas:function(e,t,n){var s=i,a=t,r;if(n){r=e[a]&(1<<n)-1}else r=e[a]&s.LSB_7_MASK;for(;!!(e[a]&s.MSB_MASK);)++a,r<<=7,r|=e[a]&s.LSB_7_MASK;return{endOffset:a+1,number:r}},parseMessageHeader:function(e,t,n){var a=i,r=(e[t]&a.BITS_56_MASK)>>>5;if(0==r)throw new s.jpipExceptions.ParseException('Failed parsing message header (A.2.1): prohibited existance class and csn bits 00');var o=!!(e[t]&a.BIT_4_MASK),l=a.parseNumberInVbas(e,t,4),c=l.number,d=l.endOffset,p=0;if(!!(2&r)){var u=a.parseNumberInVbas(e,d);p=u.number,d=u.endOffset}else n&&(p=n.classId);var g=0;if(3==r){var m=a.parseNumberInVbas(e,d);g=m.number,d=m.endOffset}else n&&(g=n.codestreamIndex);var f=a.parseNumberInVbas(e,d),h=f.number;d=f.endOffset;var x=a.parseNumberInVbas(e,d),y=x.number;d=x.endOffset;var E=!!(p&a.LSB_MASK),I;if(E){var b=a.parseNumberInVbas(e,d);I=b.number,d=b.endOffset}var C={isLastByteInDatabin:o,inClassId:c,bodyStart:d,classId:p,codestreamIndex:g,messageOffsetFromDatabinStart:h,messageBodyLength:y};return E&&(C.aux=I),C},getInt32:function(e,t){var n=16777216*e[t],s=e[t+1]<<16,i=e[t+2]<<8,a=e[t+3];return n+s+i+a},getInt16:function(e,t){var n=e[t]<<8,s=e[t+1];return n+s}};e.exports=i},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n){function i(){var e=p.length+d.length;return e}function a(e){var n=t.getDataRequestUrl(),s=t.getTargetId();'0'!==s&&(n+='&tid='+s);var i=null!==l;if(i){var a=u&&e;n+=a?'&wait=no':'&wait=yes'}return n}function r(e,n){var s=a(!0),i=t.getCodestreamStructure(),r=i.getLevelWidth(e.level),o=i.getLevelHeight(e.level),l=e.maxXExclusive-e.minX,c=e.maxYExclusive-e.minY;return s+='&fsiz='+r+','+o+',closest&rsiz='+l+','+c+'&roff='+e.minX+','+e.minY,'max'!==n&&(s+='&layers='+n),s}var o=this,l=null,c=0,d=[],p=[],u=!1;this.requestData=function(a,c,g,m){if(!u){var f=i();if(f>=e)throw new s.jpipExceptions.InternalErrorException('Channel has too many requests not responded yet')}var h=r(a,m),x=n.createRequest(t,o,h,c,g);return null!=l||0===p.length?(p.push(x),x.startRequest()):u?d=[x]:d.push(x),x},this.sendMinimalRequest=function(e){if(null==l&&0<p.length)throw new s.jpipExceptions.InternalErrorException('Minimal requests should be used for first request or keep alive message. Keep alive requires an already initialized channel, and first request requires to not have any previous request');var i=a(),r=n.createRequest(t,o,i,e);p.push(r),r.startRequest()},this.getIsDedicatedForMovableRequest=function(){return u},this.dedicateForMovableRequest=function(){if(u)throw new s.jpipExceptions.InternalErrorException('Channel already dedicated for movable request');u=!0},this.getChannelId=function(){return l},this.setChannelId=function(e){if(null!==e){l=e;var t=d;d=[];for(var n=0;n<t.length;++n)p.push(t[n]),t[n].startRequest()}},this.nextRequestId=function(){return++c},this.getRequestsWaitingForResponse=function(){return p},this.getAllQueuedRequestCount=i,this.requestEnded=function(e,n){for(var a=p,r=!1,c=0;c<a.length;++c)if(a[c]===n){a[c]=a[a.length-1],a.length-=1,r=!0;break}if(!r)throw new s.jpipExceptions.InternalErrorException('channel.requestsWaitingForResponse inconsistency');if(t.requestEnded(e,o),null===l&&0<d.length){var i=d.shift();p.push(i),i.startRequest()}},this.isAllOldRequestsEnded=function(e){for(var t=0;t<p.length;++t)if(p[t].lastRequestId<=e)return!1;return!0}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n,i){function a(e,t,n,i,a){var r=e(h,t,n,i,a);if(null===r)return null;var o=new Uint8Array(r),l=e(o,t,n,i,a);if(l===r)return o;if(null===l)return null;throw new s.jpipExceptions.InternalErrorException('JpipCodestreamReconstructor: Unmatched actualLength '+l+' and calculatedLength '+r)}function r(t,n){var i=c(t);if(null===i)return null;var a=e.getNumTilesX()*e.getNumTilesY(),r;void 0===n&&(n='max');for(var o=0,l;o<a;++o)if(l=d(t,i,o,o,r,n),i+=l,null===l)return null;var p=m(t,i,s.j2kMarkers.EndOfCodestream);return i+=p,i}function o(t,i,a,r){var o=c(t,i.level);if(null===o)return null;var l=0,p=e.getTilesIterator(i);do{var u=p.tileIndex,g=d(t,o,l++,u,i,a,r);if(o+=g,null===g)return null}while(p.tryAdvance());var f=m(t,o,s.j2kMarkers.EndOfCodestream);return o+=f,n.modifyImageSize(t,i),null===t?null:o}function l(t,i,a,r,o){var l=c(t,a);if(null===l)return null;var p=d(t,l,0,i,{level:a,quality:o},r);if(l+=p,null===p)return null;var u=m(t,l,s.j2kMarkers.EndOfCodestream);l+=u;var g=e.getNumTilesX(),f=i%g,h=Math.floor(i/g);return n.modifyImageSize(t,{level:a,minTileX:f,maxTileXExclusive:f+1,minTileY:h,maxTileYExclusive:h+1}),l}function c(e,i){if(t.getIsJpipTilePartStream())throw new s.jpipExceptions.UnsupportedFeatureException('reconstruction of codestream from JPT (Jpip Tile-part) stream','A.3.4');var a=t.getMainHeaderDatabin(),r=a.copyBytes(e,0,{forceCopyAllRange:!0});if(null===r)return null;var o=n.modifyMainOrTileHeader(e,a,0,i);return r+=o,o=g(e,r),r+=o,r}function d(s,i,a,r,o,l,c){var d=e.getTileStructure(r),g=i,m=t.getTileHeaderDatabin(r),f;void 0!==o&&(f=o.level);var h=p(s,i,m,a,f);if(null===h)return null;if(i=h.endTileHeaderOffset,!c){var x=u(s,i,d,r,o,l);if(i+=x,null===x)return null}var y=i,E=y-h.startOfTileHeaderOffset;n.modifyInt32(s,h.headerAndDataLengthPlaceholderOffset,E);return y-g}function p(e,t,i,a,r){var o=t,l=m(e,t,s.j2kMarkers.StartOfTile);t+=l;l=m(e,t,[0,10]),t+=l;l=m(e,t,[a>>>8,255&a]),t+=l;var c=t;l=m(e,t,[0,0,0,0]),t+=l;l=m(e,t,[0]),t+=l;l=m(e,t,[1]),t+=l;var d=t;if(l=i.copyBytes(e,t,{forceCopyAllRange:!0}),t+=l,null===l)return null;var p=e[t-2]===s.j2kMarkers.StartOfData[0]&&e[t-1]===s.j2kMarkers.StartOfData[1];p||(l=m(e,t,s.j2kMarkers.StartOfData),t+=l);var u=n.modifyMainOrTileHeader(e,i,d,r);t+=u;var g={startOfTileHeaderOffset:o,headerAndDataLengthPlaceholderOffset:c,endTileHeaderOffset:t};return g}function u(e,n,s,a,r,o){var l=s.getNumQualityLayers(),c=s.getPrecinctIterator(a,r,!0),d=0,p;r!==void 0&&(p=r.quality),'max'===o&&(o=l);do{var u=l;if(c.isInCodestreamPart){var g=s.precinctPositionToInClassIndex(c),m=t.getPrecinctDatabin(g),f=i.getQualityLayerOffset(m,p,c),h=f.endOffset;if(u=l-f.numQualityLayers,f.numQualityLayers<o)return null;var x=m.copyBytes(e,n,{forceCopyAllRange:!0,maxLengthToCopy:h});null===x&&(x=0,u=l),d+=x,n+=x}if(!e.dummyBufferForLengthCalculation)for(var y=0;y<u;++y)e[n++]=0;d+=u}while(c.tryAdvance());return d}function g(e,t){var n=t;f(e,t++,255),f(e,t++,100),f(e,t++,0),f(e,t++,9),f(e,t++,77),f(e,t++,97),f(e,t++,109),f(e,t++,97),f(e,t++,122),f(e,t++,97),f(e,t++,118);var s=t-n;return s}function m(e,t,n){if(!e.dummyBufferForLengthCalculation)for(var s=0;s<n.length;++s)e[s+t]=n[s];return n.length}function f(e,t,n){e.dummyBufferForLengthCalculation||(e[t]=n)}var h={dummyBufferForLengthCalculation:!0};this.reconstructCodestream=function(e){return a(r,e)},this.createCodestreamForRegion=function(t,n,s){var i=a(o,t,n,s);if(null===i)return null;var r=e.getTilesIterator(t),l=r.tileIndex,c=e.getTileLeft(l,t.level),d=e.getTileTop(l,t.level),p=t.minX-c,u=t.minY-d;return{codestream:i,offsetX:p,offsetY:u}},this.createCodestreamForTile=function(e,t,n,s){return a(l,e,t,n,s)}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n){function i(e,t){if(e.currentY>=t.maxTileYExclusive)throw new s.jpipExceptions.InternalErrorException('Cannot advance tile iterator after end');if(++e.currentX,e.currentX<t.maxTileXExclusive)return!0;e.currentX=t.minTileX,++e.currentY;var n=e.currentY<t.maxTileYExclusive;return n}function a(e,t,n){if(0>t||t>=n)throw new s.jpipExceptions.ArgumentException(e,t,e+' is expected to be between 0 and '+n-1)}function r(t){if(!g){var n=e.parseDefaultTileParams();g=[,,,];for(var s=0;3>s;++s){g[s]=[,,,];for(var i=0,a;3>i;++i)a={horizontalEdgeType:s,verticalEdgeType:i},g[s][i]=o(n,a)}}var r=g[t.horizontalEdgeType],l=r[t.verticalEdgeType];return l}function o(e,s){l();var a=JSON.parse(JSON.stringify(e));a.tileSize=u.getTileSize(s),a.defaultComponentParams.scaleX=1,a.defaultComponentParams.scaleY=1;for(var r=0;r<a.paramsPerComponent.length;++r)a.paramsPerComponent[r].scaleX=p.componentsScaleX[r],a.paramsPerComponent[r].scaleY=p.componentsScaleY[r];var i=t.createTileStructure(a,c,n);return i}function l(){p||(p=e.parseCodestreamStructure(),u=t.createLevelCalculator(p))}var c=this,d=[],p,u,g;return this.getSizesParams=function(){return l(),p},this.getNumTilesX=function(){l();var e=u.getNumTilesX();return e},this.getNumTilesY=function(){l();var e=u.getNumTilesY();return e},this.getNumComponents=function(){return l(),p.numComponents},this.getImageWidth=function(){l();var e=u.getLevelWidth();return e},this.getImageHeight=function(){l();var e=u.getLevelHeight();return e},this.getLevelWidth=function(e){l();var t=u.getLevelWidth(e);return t},this.getLevelHeight=function(e){l();var t=u.getLevelHeight(e);return t},this.getTileWidth=function(e){l();var t=u.getTileWidth(e);return t},this.getTileHeight=function(e){l();var t=u.getTileHeight(e);return t},this.getFirstTileOffsetX=function(){l();var e=u.getFirstTileOffsetX();return e},this.getFirstTileOffsetY=function(){l();var e=u.getFirstTileOffsetY();return e},this.getTileLeft=function(e,t){l();var n=e%u.getNumTilesX();if(0==n)return 0;var s=(n-1)*u.getTileWidth(t)+u.getFirstTileWidth(t);return s},this.getTileTop=function(e,t){l();var n=Math.floor(e/u.getNumTilesX());if(0===n)return 0;var s=(n-1)*u.getTileHeight(t)+u.getFirstTileHeight(t);return s},this.getDefaultTileStructure=function(){l();var e=r({horizontalEdgeType:u.EDGE_TYPE_NO_EDGE,verticalEdgeType:u.EDGE_TYPE_NO_EDGE});return e},this.getTileStructure=function(t){l();var n=u.getNumTilesX()*u.getNumTilesY()-1;if(0>t||t>n)throw new s.jpipExceptions.ArgumentException('tileId',t,'Expected value between 0 and '+n);var i=u.isEdgeTileId(t);if(void 0===d[t]){var a=e.parseOverridenTileParams(t);d[t]=a?o(a,i):null}if(d[t])return d[t];var c=r(i);return c},this.tilePositionToInClassIndex=function(e){l();var t=u.getNumTilesX(),n=u.getNumTilesY();a('tilePosition.tileX',e.tileX,t),a('tilePosition.tileY',e.tileY,n);var s=e.tileX+e.tileY*t;return s},this.tileInClassIndexToPosition=function(e){l();var t=u.getNumTilesX(),n=u.getNumTilesY();a('inClassIndex',e,t*n);var s=e%t;return{tileX:s,tileY:(e-s)/t}},this.getTilesIterator=function(e){l();var t=u.getTilesFromPixels(e),n={currentX:t.minTileX,currentY:t.minTileY},s={get tileIndex(){var e=n.currentY*u.getNumTilesX(),t=e+n.currentX;return t},tryAdvance:function(){var e=i(n,t);return e}};return s},this.getSizeOfPart=function(e){l();var t=u.getSizeOfPart(e);return t},this}},function(e,t,n){'use strict';var s=Math.ceil,i=Math.floor,a=n(0);e.exports=function(e,t){function n(e,t,n){var i=o(n),a=t[n],r=s(e/i/a);return r}function r(e,t,n,i,a){var r=o(e.resolutionLevel),l=s(a/r),c=t*i[e.resolutionLevel],d=Math.min(i[e.resolutionLevel],l-c),p=0===e.resolutionLevel?1:2,u=s(d/p),g=p*s(u/n);return 1==d%n&&0<e.resolutionLevel&&--g,g}function o(t){var n=e.numResolutionLevels-t-1;return 1<<n}var l,c;(function(){if(1!==e.scaleX||1!==e.scaleY)throw new a.j2kExceptions.UnsupportedFeatureException('Non 1 component scale','A.5.1');l=i(t.getTileWidth()/e.scaleX),c=i(t.getTileHeight()/e.scaleY)})(),this.getComponentScaleX=function(){return e.scaleX},this.getComponentScaleY=function(){return e.scaleY},this.getNumResolutionLevels=function(){return e.numResolutionLevels},this.getPrecinctWidth=function(t){var n=e.precinctWidthPerLevel[t];return n},this.getPrecinctHeight=function(t){var n=e.precinctHeightPerLevel[t];return n},this.getMaxCodeblockWidth=function(){var t=e.maxCodeblockWidth;return t},this.getMaxCodeblockHeight=function(){var t=e.maxCodeblockHeight;return t},this.getNumCodeblocksXInPrecinct=function(t){var n=r(t,t.precinctX,e.maxCodeblockWidth,e.precinctWidthPerLevel,l);return n},this.getNumCodeblocksYInPrecinct=function(t){var n=r(t,t.precinctY,e.maxCodeblockHeight,e.precinctHeightPerLevel,c);return n},this.getNumPrecinctsX=function(t){var s=n(l,e.precinctWidthPerLevel,t);return s},this.getNumPrecinctsY=function(t){var s=n(c,e.precinctHeightPerLevel,t);return s}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e){function t(t,n){if(t===void 0||n===void 0)throw new s.jpipExceptions.InternalErrorException('minOffset or maxOffset is undefined for CompositeArray.copyToArray');if(t<e)throw new s.jpipExceptions.InternalErrorException('minOffset ('+t+') must be smaller than CompositeArray offset ('+e+')');if(n>e+r)throw new s.jpipExceptions.InternalErrorException('maxOffset ('+n+') must be larger than CompositeArray end offset ('+e+r+')')}function n(t,n){var a=Math.max(e,t),o=e+r;if(void 0!==n&&(o=Math.min(o,n)),a>=o){return{internalIteratorData:{isEndOfRange:!0}}}var l={subArray:null,offset:-1,internalIteratorData:{end:o,currentSubArray:null,currentInternalPartOffset:null,nextInternalPartOffset:e,currentInternalPartIndex:-1,isEndOfRange:!1}},c=!1;do{if(c)throw new s.jpipExceptions.InternalErrorException('Iterator reached to the end although no data has been iterated');c=!i(l)}while(a>=l.internalIteratorData.nextInternalPartOffset);var d=a-l.internalIteratorData.currentInternalPartOffset;return l.internalIteratorData.currentSubArray=l.internalIteratorData.currentSubArray.subarray(d),l.internalIteratorData.currentInternalPartOffset=a,l}function i(e){var t=e.internalIteratorData;if(t.isEndOfRange)return!1;if(e.subArray=t.currentSubArray,e.offset=t.currentInternalPartOffset,++t.currentInternalPartIndex,t.nextInternalPartOffset>=t.end)return t.isEndOfRange=!0,!0;a(t.currentInternalPartIndex),t.currentSubArray=o[t.currentInternalPartIndex],t.currentInternalPartOffset=t.nextInternalPartOffset;var n=o[t.currentInternalPartIndex].length;t.nextInternalPartOffset=t.currentInternalPartOffset+n;var s=t.end-t.currentInternalPartOffset,i=s<t.currentSubArray.length;return i&&(t.currentSubArray=t.currentSubArray.subarray(0,s)),!0}function a(e){if(e>=o.length)throw new s.jpipExceptions.InternalErrorException('CompositeArray: end of part has reached. Check end calculation')}var r=0,o=[];this.getLength=function(){return r},this.getOffset=function(){return e},this.pushSubArray=function(e){o.push(e),r+=e.length},this.copyToOtherAtTheEnd=function(e,s,a){t(s,a);for(var r=n(s,a);i(r);)e.pushSubArray(r.subArray)},this.copyToTypedArray=function(e,s,a,r){t(a,r);for(var o=n(a,r);i(o);){var l=o.offset-s;e.set(o.subArray,l)}},this.copyToArray=function(e,s,a,r){t(a,r);for(var o=n(a,r);i(o);)for(var l=o.offset-s,c=0;c<o.subArray.length;++c)e[l++]=o.subArray[c]},this.copyToOther=function(t){if(t.getOffset()>e)throw new s.jpipExceptions.InternalErrorException('CompositeArray: Trying to copy part into a latter part');var a=t.getOffset()+t.getLength(),o=e+r<=a;if(!o){var l=a,c=n(l);if(!i(c))throw new s.jpipExceptions.InternalErrorException('CompositeArray: Could not merge parts');var d=l;do{if(c.offset!==d)throw new s.jpipExceptions.InternalErrorException('CompositeArray: Non-continuous value of rangeToCopy.offset. Expected: '+d+', Actual: '+c.offset);t.pushSubArray(c.subArray),d+=c.subArray.length}while(i(c))}}}},function(e){'use strict';var t=Math.min;e.exports=function(e,n,s){function i(e,t){var n=!1,s=0,i;if(void 0!==t&&(n=!!t.forceCopyAllRange,s=t.databinStartOffset,i=t.maxLengthToCopy,void 0===s&&(s=0)),void 0===e&&(e=0),0===i)return{resultWithoutCopy:0};if(null!==d&&s>=d)return{resultWithoutCopy:!!i&&n?null:0};var r=o(s);if(r===c.length)return{resultWithoutCopy:n?null:0};if(n){var l=a(s,i,r);if(!l)return{resultWithoutCopy:null}}var p={databinStartOffset:s,maxLengthToCopy:i,resultStartOffset:e};return p}function a(e,t,n){if(c[n].getOffset()>e)return!1;if(t){var s=e-c[n].getOffset(),i=c[n].getLength()-s;return i>=t}if(null===d||n<c.length-1)return!1;var a=c[c.length-1],r=a.getOffset()+a.getLength(),o=r===d;return o}function r(e,n,s){var a;if(void 0!==n)a=e+n;else{var r=c[c.length-1];a=r.getOffset()+r.getLength()}for(var o=null,l=0;l<c.length&&!(c[l].getOffset()>=a);++l){var i=Math.max(e,c[l].getOffset()),d=t(a,c[l].getOffset()+c[l].getLength());s(c[l],i,d),o=c[l]}if(null===o)return 0;var p=t(o.getOffset()+o.getLength(),a);return p-e}function o(e){var t;for(t=0;t<c.length&&!(c[t].getOffset()+c[t].getLength()>e);++t);return t}var l=this,c=[],d=null,p=0,u=[];return this.getDatabinLengthIfKnown=function(){return d},this.getLoadedBytes=function(){return p},this.isAllDatabinLoaded=function(){var e;switch(c.length){case 0:e=0===d;break;case 1:e=0===c[0].getOffset()&&c[0].getLength()===d;break;default:e=!1;}return e},this.getCachedData=function(e){var t=u[e];return void 0===t&&(t={},u[e]=t),t},this.getClassId=function(){return e},this.getInClassId=function(){return n},this.copyToCompositeArray=function(e,t){var n=i(0,t);if(void 0!==n.resultWithoutCopy)return n.resultWithoutCopy;var s=r(n.databinStartOffset,n.maxLengthToCopy,function(t,n,s){t.copyToOtherAtTheEnd(e,n,s)});return s},this.copyBytes=function(e,t,n){var s=i(t,n);if(void 0!==s.resultWithoutCopy)return s.resultWithoutCopy;var a=s.databinStartOffset-s.resultStartOffset,o=r(s.databinStartOffset,s.maxLengthToCopy,function(t,n,s){t.copyToArray(e,a,n,s)});return o},this.getExistingRanges=function(){for(var e=Array(c.length),t=0;t<c.length;++t)e[t]={start:c[t].getOffset(),length:c[t].getLength()};return e},this.addData=function(e,t){if(e.isLastByteInDatabin&&(d=e.messageOffsetFromDatabinStart+e.messageBodyLength),0!==e.messageBodyLength){var n=s.createCompositeArray(e.messageOffsetFromDatabinStart),a=e.bodyStart+e.messageBodyLength;n.pushSubArray(t.subarray(e.bodyStart,a));var r=o(e.messageOffsetFromDatabinStart),l=r;if(0<r){var u=c[r-1],g=u.getOffset()+u.getLength();g===e.messageOffsetFromDatabinStart&&--l}if(l>=c.length)return c.push(n),void(p+=e.messageBodyLength);var m=c[l],f=e.messageOffsetFromDatabinStart+e.messageBodyLength;if(m.getOffset()>f){for(var h=c.length;h>l;--h)c[h]=c[h-1];return c[l]=n,void(p+=e.messageBodyLength)}var i=m.getLength(),x=m.getOffset()>e.messageOffsetFromDatabinStart;x&&(c[l]=n,n=m,m=c[l]),n.copyToOther(m);var y=m.getOffset()+m.getLength(),E;for(E=l;E<c.length-1&&!(y<c[E+1].getOffset());++E)i+=c[E+1].getLength();var I=E-l;if(0<I){c[E].copyToOther(m);for(var b=l+1;b<c.length-I;++b)c[b]=c[b+I];c.length-=I}p+=m.getLength()-i}},this}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t){function n(e,t){if(0!==e.inClassId)throw new s.jpipExceptions.IllegalDataException('Main header data-bin with in-class index other than zero is not valid','A.3.5');var n=x.getLoadedBytes();x.addData(e,t);var i=x.getLoadedBytes()-n;f+=i,h+=i}function a(){}function r(n,i,a,r,o){if(r!==e)throw new s.jpipExceptions.WrongStreamException('databin of type '+o,e);var l=n.databins[a];return l||(l=t.createDatabinParts(i,a),n.databins[a]=l),l}function i(){return{databins:[],listeners:[],databinsWithListeners:[]}}var o=0,l=1,c=2,d=4,p=5,u=[],g=[],m=[],f=0,h=0;u[c]=i(),u[o]=i(),u[l]=u[o],m[c]=!0,m[o]=!0,m[l]=!0,u[d]=i(),u[p]=u[d],g[d]=!0,g[p]=!0;var x=t.createDatabinParts(6,0);return this.getIsJpipTilePartStream=function(){return e},this.getLoadedBytes=function(){return f},this.getMainHeaderDatabin=function(){return x},this.getTileHeaderDatabin=function(e){var t=r(u[c],c,e,!1,'tileHeader');return t},this.getPrecinctDatabin=function(e){var t=r(u[o],o,e,!1,'precinct');return t},this.getTileDatabin=function(e){var t=r(u[d],d,e,!0,'tilePart');return t},this.addEventListener=function(e,t,n,i){if('dataArrived'!==t)throw new s.jpipExceptions.InternalErrorException('Unsupported event: '+t);var a=e.getClassId(),r=e.getInClassId(),o=u[a];if(e!==o.databins[r])throw new s.jpipExceptions.InternalErrorException('Unmatched databin with class-ID='+a+' and in-class-ID='+r);void 0===o.listeners[r]&&(o.listeners[r]=[]),0===o.listeners[r].length&&(h+=e.getLoadedBytes()),o.listeners[r].push({listener:n,listenerThis:i,isRegistered:!0}),o.databinsWithListeners[r]=e},this.removeEventListener=function(e,t,n){if('dataArrived'!==t)throw new s.jpipExceptions.InternalErrorException('Unsupported event: '+t);var a=e.getClassId(),r=e.getInClassId(),o=u[a],l=o.listeners[r];if(e!==o.databins[r]||e!==o.databinsWithListeners[r])throw new s.jpipExceptions.InternalErrorException('Unmatched databin with class-ID='+a+' and in-class-ID='+r);for(var c=0;c<l.length;++c)if(l[c].listener===n)return l[c].isRegistered=!0,l[c]=l[l.length-1],l.length-=1,void(0===l.length&&(delete o.databinsWithListeners[r],h-=e.getLoadedBytes()));throw new s.jpipExceptions.InternalErrorException('Could not unregister listener from databin')},this.cleanupUnregisteredDatabins=function(){for(var e=0;e<u.length;++e)if(void 0!==u[e]){var t=u[e].databinsWithListeners;u[e].databins=t.slice()}f=h},this.saveData=function(e,t){if(0!==e.codestreamIndex)throw new s.jpipExceptions.UnsupportedFeatureException('Non zero Csn (Code Stream Index)','A.2.2');switch(e.classId){case 6:n(e,t);break;case 8:a(e,t);break;default:var o=u[e.classId];if(void 0===o)break;var l=!!g[e.classId],c=r(o,e.classId,e.inClassId,l,'<class ID '+e.classId+'>'),d=c.getLoadedBytes();c.addData(e,t);var p=c.getLoadedBytes()-d;f+=p;var m=o.listeners,x=m[e.inClassId];if(void 0!==x&&0<x.length){h+=p;for(var y=x.slice(),E=0,i;E<y.length;++E)i=y[E],i.isRegistered&&i.listener.call(i.listenerThis,c)}}},this}},function(e,t,n){'use strict';e.exports=function(e,t,n){function i(){if(g>=n.length)throw new s.jpipExceptions.IllegalOperationException('Unexpected requestData() after fetch done');if(null!=c&&null===l)throw new s.jpipExceptions.IllegalOperationException('Cannot resume already-active-fetch');if(d)throw new s.jpipExceptions.IllegalOperationException('Cannot resume already-terminated-fetch');setTimeout(function(){g>=n.length||null!=c||d||(u=p?g:n.length-1,c=t.requestData(o,a,r,n[u].minNumQualityLayers,l))})}function a(t,s){c=null;s&&(g=u,g>=n.length&&e.done())}function r(){}var o=null,l=null,c=null,d=!1,p=!1,u=0,g=0;this.setDedicatedChannelHandle=function(e){l=e},this.move=function(e){if(null===l&&null!=o)throw new s.jpipExceptions.IllegalOperationException('Cannot move non movable fetch');o=e,i()},this.resume=function(){i()},this.stop=function(){if(null==c){if(d)throw new s.jpipExceptions.IllegalOperationException('Cannot stop already terminated fetch');throw new s.jpipExceptions.IllegalOperationException('Cannot stop already stopped fetch')}return l||(t.stopRequestAsync(c),c=null),e.stopped()},this.terminate=function(){if(l)throw new s.jpipExceptions.IllegalOperationException('Unexpected terminate event on movable fetch');if(d)throw new s.jpipExceptions.IllegalOperationException('Double terminate event');c=null,d=!0},this.isProgressiveChanged=function(e){p=e,l&&null!=c&&(c=null,i())}};var s=n(0)},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n){function i(e,n,s){var i=t.getCodingStyleOffset(n);if(null!==i){e[s+i+5]=o}}function a(e,t,n){if(0===t.length)return 0;if(!e.dummyBufferForLengthCalculation)for(var s=0;s<t.length;++s){var i=n+t[s].markerSegmentLengthOffset,a=(e[i]<<8)+e[i+1],r=a-t[s].length;e[i]=r>>>8,e[i+1]=255&r}for(var o=n+t[0].start,l=o,c=0;c<t.length;++c){l+=t[c].length;for(var d=c+1<t.length?n+t[c+1].start:e.length;l<d;++l)e[o]=e[l],++o}var p=l-o;return p}function r(e,t,n){e.dummyBufferForLengthCalculation||(e[t++]=n>>>24,e[t++]=255&n>>>16,e[t++]=255&n>>>8,e[t++]=255&n)}var o=function(e){switch(e){case'LRCP':return 0;case'RLCP':return 1;case'RPCL':return 2;case'PCRL':return 3;case'CPRL':return 4;default:throw new s.j2kExceptions.IllegalDataException('Progression order of '+e,'A.6.1, table A.16');}}(n);this.modifyMainOrTileHeader=function(e,n,s,r){if(e.dummyBufferForLengthCalculation||i(e,n,s),void 0===r)return 0;var o=t.getRangesOfBestResolutionLevelsData(n,r);if(null!==o.numDecompositionLevelsOffset&&!e.dummyBufferForLengthCalculation){var l=s+o.numDecompositionLevelsOffset;e[l]-=r}var c=a(e,o.ranges,s);return-c},this.modifyImageSize=function(n,i){if(!n.dummyBufferForLengthCalculation){var a=e.getTileWidth(i.level),o=e.getTileHeight(i.level),l=e.getSizeOfPart(i),c=t.getImageAndTileSizeOffset(),d=c+s.j2kOffsets.REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER,p=d+8,u=d+16,g=d+24;r(n,d,l.width),r(n,d+4,l.height),r(n,u,a),r(n,u+4,o),r(n,p,0),r(n,p+4,0),r(n,g,0),r(n,g+4,0)}},this.modifyInt32=r}},function(e,t,n){'use strict';function s(e,t,n){this._codestreamPartParams=t,this._progressiveness=n,this._reconstructor=e.reconstructor,this._packetsDataCollector=e.packetsDataCollector,this._qualityLayersCache=e.qualityLayersCache,this._codestreamStructure=e.codestreamStructure,this._databinsSaver=e.databinsSaver,this._jpipFactory=e.jpipFactory,this._progressiveStagesFinished=0,this._qualityLayersReached=0,this._dataListeners=[],this._listener=this._jpipFactory.createRequestDatabinsListener(t,this._qualityLayerReachedCallback.bind(this),this._codestreamStructure,this._databinsSaver,this._qualityLayersCache)}var a=n(0);e.exports=s,s.prototype.hasData=function(){return this._ensureNotDisposed(),0<this._progressiveStagesFinished},s.prototype.getFetchedData=function(e){if(this._ensureNotDisposed(),!this.hasData())throw'JpipImageDataContext error: cannot call getFetchedData before hasData = true';var t=this._getParamsForDataWriter(e),n=this._packetsDataCollector.getAllCodeblocksData(t.codestreamPartParams,t.minNumQualityLayers),s=this._reconstructor.createCodestreamForRegion(t.codestreamPartParams,t.minNumQualityLayers,!0);if(null===n.codeblocksData)throw new a.jpipExceptions.InternalErrorException('Could not collect codeblocks although progressiveness stage has been reached');if(null===s)throw new a.jpipExceptions.InternalErrorException('Could not reconstruct codestream although progressiveness stage has been reached');return{headersCodestream:s,codeblocksData:n.codeblocksData,codestreamPartParams:this._codestreamPartParams}},s.prototype.getFetchedDataAsCodestream=function(e){this._ensureNotDisposed();var t=this._getParamsForDataWriter(e),n=this._reconstructor.createCodestreamForRegion(t.codestreamPartParams,t.minNumQualityLayers);if(null===n)throw new a.jpipExceptions.InternalErrorException('Could not reconstruct codestream although progressiveness stage has been reached');return n},s.prototype.on=function(e,t){if(this._ensureNotDisposed(),'data'!==e)throw'JpipImageDataContext error: Unexpected event '+e;this._dataListeners.push(t)},s.prototype.isDone=function(){return this._ensureNotDisposed(),this._isRequestDone},s.prototype.dispose=function(){this._ensureNotDisposed(),this._listener.unregister(),this._listener=null},s.prototype.setIsProgressive=function(e){this._ensureNotDisposed();var t=this._isProgressive;if(this._isProgressive=e,!t&&e&&this.hasData())for(var n=0;n<this._dataListeners.length;++n)this._dataListeners[n](this)},s.prototype.isDisposed=function(){return!this._listener},s.prototype.getCodestreamPartParams=function(){return this._codestreamPartParams},s.prototype.getNextQualityLayer=function(){return this._progressiveness[this._progressiveStagesFinished].minNumQualityLayers},s.prototype._tryAdvanceProgressiveStage=function(){var e=this._progressiveness[this._progressiveStagesFinished].minNumQualityLayers;if(this._qualityLayersReached<e)return!1;for('max'===this._qualityLayersReached&&(this._progressiveStagesFinished=this._progressiveness.length);this._progressiveStagesFinished<this._progressiveness.length;){var t=this._progressiveness[this._progressiveStagesFinished].minNumQualityLayers;if('max'===t||t>this._qualityLayersReached)break;++this._progressiveStagesFinished}return this._isRequestDone=this._progressiveStagesFinished===this._progressiveness.length,!0},s.prototype._qualityLayerReachedCallback=function(e){if(this._qualityLayersReached=e,this._isRequestDone)throw new a.jpipExceptions.InternalErrorException('Request already done but callback is called');if(this._tryAdvanceProgressiveStage()&&(this._isProgressive||this._isRequestDone))for(var t=0;t<this._dataListeners.length;++t)this._dataListeners[t](this)},s.prototype._getParamsForDataWriter=function(e){if(0===this._progressiveStagesFinished)throw new a.jpipExceptions.IllegalOperationException('Cannot create codestream before first progressiveness stage has been reached');var t=this._progressiveness[this._progressiveStagesFinished-1].minNumQualityLayers,n=this._codestreamPartParams;return void 0!==e&&(n=Object.create(this._codestreamPartParams),n.quality=e,'max'!==t&&(t=Math.min(t,e))),{codestreamPartParams:n,minNumQualityLayers:t}},s.prototype._ensureNotDisposed=function(){if(this.isDisposed())throw new a.jpipExceptions.IllegalOperationException('Cannot use ImageDataContext after disposed')}},function(e,t,n){'use strict';var s=Math.max,i=Math.min,a=Math.ceil,r=Math.floor,o=n(0),l=0.6931471805599453;e.exports=function(e){function t(e){var t=e.level,s=h(t),i=x(t),a=n(e),r=a.minTileX+a.minTileY*u(),o=a.maxTileXExclusive-1+(a.maxTileYExclusive-1)*u(),l=p(r),d=p(o),g=c(l,t),m=c(d,t),f=g[0],y=g[1],E=a.maxTileXExclusive-a.minTileX,I=a.maxTileYExclusive-a.minTileY;return 1<E&&(f+=m[0],f+=s*(E-2)),1<I&&(y+=m[1],y+=i*(I-2)),{width:f,height:y}}function n(e){var t=e.level,n=h(t),o=x(t),l=I(t),c=b(t),d=(e.minX-l)/n,p=(e.minY-c)/o,m=(e.maxXExclusive-l)/n,f=(e.maxYExclusive-c)/o,y=s(0,1+d),E=s(0,1+p),C=i(u(),1+m),P=i(g(),1+f),T={minTileX:r(y),minTileY:r(E),maxTileXExclusive:a(C),maxTileYExclusive:a(P)};return T}function c(e,t){var n=d(e.horizontalEdgeType,I,m,h),s=d(e.verticalEdgeType,b,f,x);if(void 0!==t){var i=1<<t;n=a(n/i),s=a(s/i)}return[n,s]}function d(e,t,n,s){var i;switch(e){case P:i=t();break;case T:var a=s(),r=n()-t();i=r%a,0===i&&(i=a);break;case C:i=s();break;default:throw new o.jpipExceptions.InternalErrorException('Unexpected edge type: '+e);}return i}function p(e){var t=u(),n=g(),s=e%t,i=r(e/t);if(i>n||0>s||0>i)throw new o.jpipExceptions.InternalErrorException('Tile index '+e+' is not in range');var a=0==s?P:s==t-1?T:C,l=0===i?P:i===n-1?T:C;return{horizontalEdgeType:a,verticalEdgeType:l}}function u(){var t=a(e.imageWidth/e.tileWidth);return t}function g(){var t=a(e.imageHeight/e.tileHeight);return t}function m(n){if(void 0===n)return e.imageWidth;var s=t({minX:0,maxXExclusive:e.imageWidth,minY:0,maxYExclusive:e.imageHeight,level:n});return s.width}function f(n){if(void 0===n)return e.imageHeight;var s=t({minX:0,maxXExclusive:e.imageWidth,minY:0,maxYExclusive:e.imageHeight,level:n});return s.height}function h(t){if(void 0===t)return e.tileWidth;var n=a(e.tileWidth/(1<<t));return n}function x(t){if(void 0===t)return e.tileHeight;var n=a(e.tileHeight/(1<<t));return n}function y(){return e.firstTileOffsetX}function E(){return e.firstTileOffsetY}function I(e){var t=h()-y(),n=m();t>n&&(t=n);var s=a(t/(1<<e));return s}function b(e){var t=x()-E(),n=f();t>n&&(t=n);var s=a(t/(1<<e));return s}var C=0,P=1,T=2;return this.EDGE_TYPE_NO_EDGE=C,this.EDGE_TYPE_FIRST=P,this.EDGE_TYPE_LAST=T,this.getSizeOfPart=t,this.getTilesFromPixels=n,this.getNumTilesX=u,this.getNumTilesY=g,this.getTileWidth=h,this.getTileHeight=x,this.getFirstTileOffsetX=y,this.getFirstTileOffsetY=E,this.getFirstTileWidth=I,this.getFirstTileHeight=b,this.isEdgeTileId=p,this.getTileSize=c,this.getLevelWidth=m,this.getLevelHeight=f,this.getImageLevel=function(){return 0},this.getLevel=function(t){var n=Math.log;if(void 0===e.numResolutionLevelsForLimittedViewer)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';var r=n((t.maxXExclusive-t.minX)/t.screenWidth)/l,o=n((t.maxYExclusive-t.minY)/t.screenHeight)/l,c=a(s(r,o));return c=s(0,i(e.numResolutionLevelsForLimittedViewer-1,c)),c},this.getNumResolutionLevelsForLimittedViewer=function(){if(void 0===e.numResolutionLevelsForLimittedViewer)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';return e.numResolutionLevelsForLimittedViewer},this.getLowestQuality=function(){return 1},this.getHighestQuality=function(){if(void 0===e.highestQuality)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';return e.highestQuality},this}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t){function n(e,t,n){var s=e[n]===t[0]&&e[n+1]===t[1];return s}function i(e,t){var n=a(e,!0),s=l(t,'Predefined marker in jGlobals.j2kMarkers'),i=n.markerToOffset[s];return void 0===i?null:i}function a(t,i){var a=t.getCachedData(c);if(void 0===a.markerToOffset&&(a.isParsedAllMarkers=!1,a.lastOffsetParsed=0,a.markerToOffset={},a.databin=t),a.isParsedAllMarkers)return a;var l=[],d=!0;if(t===e&&0===a.lastOffsetParsed){var p=t.copyBytes(l,0,{forceCopyAllRange:!0,maxLengthToCopy:s.j2kOffsets.MARKER_SIZE});if(null===p)d=!1;else if(!n(l,s.j2kMarkers.StartOfCodestream,0))throw new s.j2kExceptions.IllegalDataException('SOC (Start Of Codestream) is not found where expected to be','A.4.1');a.lastOffsetParsed=2}return d&&r(a),o(a,i),a}function r(e){for(var n=e.lastOffsetParsed,i=[],a=e.databin.copyBytes(i,0,{forceCopyAllRange:!0,maxLengthToCopy:s.j2kOffsets.MARKER_SIZE+s.j2kOffsets.LENGTH_FIELD_SIZE,databinStartOffset:n});null!==a;){var r=l(i,'offset '+n+' of databin with class ID = '+e.databin.getClassId()+' and in class ID = '+e.databin.getInClassId());e.markerToOffset[r.toString()]=n;var o=t.getInt16(i,s.j2kOffsets.MARKER_SIZE);n+=o+s.j2kOffsets.MARKER_SIZE,a=e.databin.copyBytes(i,0,{forceCopyAllRange:!0,maxLengthToCopy:s.j2kOffsets.MARKER_SIZE+s.j2kOffsets.LENGTH_FIELD_SIZE,databinStartOffset:n})}e.lastOffsetParsed=n}function o(t,i){var a=t.databin.getDatabinLengthIfKnown();if(t.isParsedAllMarkers=t.lastOffsetParsed===a,!t.isParsedAllMarkers&&t.databin!==e){var r=[],o=t.databin.copyBytes(r,0,{forceCopyAllRange:!0,maxLengthToCopy:s.j2kOffsets.MARKER_SIZE,databinStartOffset:t.lastOffsetParsed});null!==o&&n(r,0,s.j2kMarkers.StartOfData)&&(t.lastOffsetParsed+=s.j2kOffsets.MARKER_SIZE,t.isParsedAllMarkers=!0)}if(i&&!t.isParsedAllMarkers)throw new s.jpipExceptions.InternalErrorException('data-bin with class ID = '+t.databin.getClassId()+' and in class ID = '+t.databin.getInClassId()+' was not recieved yet')}function l(e,t){if(255!==e[0])throw new s.j2kExceptions.IllegalDataException('Expected marker in '+t,'A');var n=e[1].toString(16);return n}var c='markers';this.getMandatoryMarkerOffsetInDatabin=function(e,t,n,a){var r=i(e,t);if(null===r)throw new s.j2kExceptions.IllegalDataException(n+' is not found where expected to be',a);return r},this.checkSupportedMarkers=function(e,t,n){n=!!n;for(var r=a(e,!0),o={},c=0,i;c<t.length;++c)i=l(t[c],'jpipMarkersParser.supportedMarkers['+c+']'),o[i]=!0;for(var d in r.markerToOffset){var p=!!o[d];if(p!==n)throw new s.j2kExceptions.UnsupportedFeatureException('Unsupported marker found: '+d,'unknown')}},this.getMarkerOffsetInDatabin=i,this.isMarker=n}},function(e,t,n){'use strict';var s=n(0);e.exports=function(){var e=[];this.getObject=function(t){var n=t.getClassId(),i=e[n];i===void 0&&(i=[],e[n]=i);var a=t.getInClassId(),r=i[a];if(r===void 0)r={},r.databin=t,i[a]=r;else if(r.databin!==t)throw new s.jpipExceptions.InternalErrorException('Databin IDs are not unique');return r}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t){function n(e,t){var n=l(e,t);if(null===n)return null;var i=n+s.j2kOffsets.MARKER_SIZE,a=c(e,8,i),r=a[2],o=!(1&r),d=7,p=a[d],u=o?null:n+14;return{codingStyleDefaultOffset:n,isDefaultPrecinctSize:o,isStartOfPacketMarkerAllowed:!!(2&r),isEndPacketHeaderMarkerAllowed:!!(4&r),numResolutionLevels:p+1,precinctSizesOffset:u,numDecompositionLevelsOffset:i+d}}function i(e,t,n){if(!(null===t||t.isDefaultPrecinctSize)){var i=t.numResolutionLevels-n,a=t.precinctSizesOffset+i,r=t.codingStyleDefaultOffset+s.j2kOffsets.MARKER_SIZE;e.push({markerSegmentLengthOffset:r,start:a,length:n})}}function a(e,t){var n=c(e,1,t+4),i=31&n[0],a;switch(i){case 0:a=1;break;case 1:a=0;break;case 2:a=2;break;default:throw new s.j2kExceptions.IllegalDataException('Quantization style of '+i,'A.6.4');}return a}function r(e,n,i,r){var o=t.getMarkerOffsetInDatabin(n,s.j2kMarkers.QuantizationDefault);if(null!==o){var l=a(n,o);if(0!==l){var c=i.numResolutionLevels-r,d=o+s.j2kOffsets.MARKER_SIZE;e.push({markerSegmentLengthOffset:d,start:o+5+(1+3*(c-1))*l,length:3*r*l})}}}function o(e){var n=t.getMarkerOffsetInDatabin(e,s.j2kMarkers.CodingStyleComponent);if(null!==n)throw new s.j2kExceptions.UnsupportedFeatureException('COC Marker (Coding Style Component)','A.6.2')}function l(e,n){o(e);var i;return i=n?t.getMandatoryMarkerOffsetInDatabin(e,s.j2kMarkers.CodingStyleDefault,'COD (Coding style Default)','A.6.1'):t.getMarkerOffsetInDatabin(e,s.j2kMarkers.CodingStyleDefault),i}function c(e,t,n){var i=[],a=e.copyBytes(i,0,{forceCopyAllRange:!0,maxLengthToCopy:t,databinStartOffset:n});if(null===a)throw new s.jpipExceptions.InternalErrorException('Header data-bin has not yet recieved '+t+' bytes starting from offset '+n);return i}var d=[s.j2kMarkers.ImageAndTileSize,s.j2kMarkers.CodingStyleDefault,s.j2kMarkers.QuantizationDefault,s.j2kMarkers.Comment];this.getCodingStyleOffset=l,this.getCodingStyleBaseParams=n,this.getImageAndTileSizeOffset=function(){var n=t.getMandatoryMarkerOffsetInDatabin(e,s.j2kMarkers.ImageAndTileSize,'Image and Tile Size (SIZ)','A.5.1');return n},this.getRangesOfBestResolutionLevelsData=function(a,o){t.checkSupportedMarkers(a,d,!0);var l=null,c=n(a,!1),p=c;null===c?p=n(e,!0):l=c.numDecompositionLevelsOffset;var u=p.numResolutionLevels;if(u<=o)throw new s.jpipExceptions.InternalErrorException('numResolutionLevels ('+o+') <= COD.numResolutionLevels ('+u+')');var g=[];i(g,c,o),r(g,a,p,o);var m={ranges:g,numDecompositionLevelsOffset:l};return m}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n,i){function a(n,a,o){var l=e.getTilesIterator(n),c=0,d={packetDataOffsets:[],data:i.createCompositeArray(0),allRelevantBytesLoaded:0};do{var p=e.getTileStructure(l.tileIndex),u=p.getPrecinctIterator(l.tileIndex,n),g=p.getNumQualityLayers();if(void 0!==n.quality&&(g=Math.min(g,n.quality)),'max'===a)a=g;else if(a>g)throw new s.jpipExceptions.InternalErrorException('minNumQualityLayers is larger than quality');do{if(!u.isInCodestreamPart)throw new s.jpipExceptions.InternalErrorException('Unexpected precinct not in codestream part');var m=p.precinctPositionToInClassIndex(u),f=t.getPrecinctDatabin(m),h=o.getObject(f);void 0===h.layerPerCodeblock&&(h.layerPerCodeblock=[]);var x=r(d,c,u,f,h,g);if(x<a)return null}while(u.tryAdvance());++c}while(l.tryAdvance());var y=new Uint8Array(d.data.getLength());return d.data.copyToTypedArray(y,0,0,d.data.getLength()),d.data=y,d}function r(e,t,s,a,r,o){var l,c;for(l=0;l<o;++l){var d=n.getPacketOffsetsByCodeblockIndex(a,l,s);if(null===d)break;c=d.headerStartOffset+d.headerLength;for(var p=d.codeblockBodyLengthByIndex.length,u=Array(p),g=!1,m=0,i;m<p;++m){if(i=r.layerPerCodeblock[m],void 0===i)i={layer:-1},r.layerPerCodeblock[m]=i;else if(i.layer>=l)continue;var f=d.codeblockBodyLengthByIndex[m],h=e.data.getLength(),x=a.copyToCompositeArray(e.data,{databinStartOffset:c,maxLengthToCopy:f.codeblockBodyLengthBytes,forceCopyAllRange:!0});if(x!==f.codeblockBodyLengthBytes){u.length=m,g=!0;break}i.layer=l,u[m]={start:h,end:h+f.codeblockBodyLengthBytes,codingpasses:f.codingPasses,zeroBitPlanes:f.zeroBitPlanes},c+=f.codeblockBodyLengthBytes}var y={tileIndex:t,r:s.resolutionLevel,p:s.precinctIndexInComponentResolution,c:s.component,l:l,codeblockOffsets:u};if(e.packetDataOffsets.push(y),g)break}return e.allRelevantBytesLoaded+=c,l}this.getAllCodeblocksData=function(e,t){var n=i.createObjectPoolByDatabin(),s=a(e,t,n);return{codeblocksData:s,alreadyReturnedCodeblocks:n}},this.getNewCodeblocksDataAndUpdateReturnedCodeblocks=a}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n,a,i,r){function o(t){if(t.isAllDatabinLoaded()){var i=h.getObject(t);if(!i.isAlreadyLoaded){i.isAlreadyLoaded=!0,--p;var r=t.getInClassId(),o=n.getTileStructure(r),u=o.getNumQualityLayers(),g=o.getPrecinctIterator(r,e);do{if(!g.isInCodestreamPart)throw new s.jpipExceptions.InternalErrorException('Unexpected precinct not in codestream part');var m=o.precinctPositionToInClassIndex(g),x=a.getPrecinctDatabin(m);f.push(x);var y=h.getObject(x);if(void 0!==y.qualityInTile)throw new s.jpipExceptions.InternalErrorException('Tile was iterated twice in codestream part');y.qualityInTile=u,c(x,y,g),a.addEventListener(x,'dataArrived',l)}while(g.tryAdvance());d()}}}function l(e){var t=h.getObject(e),n=t.numQualityLayersReached,s=t.qualityInTile;n===s||(--x[n],c(e,t),d())}function c(t,n,s){var a=i.getQualityLayerOffset(t,e.quality,s),r=a.numQualityLayers;n.numQualityLayersReached=r;var o=n.qualityInTile;if(r!==o){var l=x[r]||0;x[r]=l+1}}function d(){if(!(0<x[u]||'max'===u||u>=y||0<p)){var e=x.length,n;do{if(++u,u>=e){u='max';break}n=0<x[u]}while(!n);t(u)}}var p=0,u=0,g=!1,m=[],f=[],h=r.createObjectPoolByDatabin(),x=[],y;(function(){++p;var t=n.getTilesIterator(e);do{var s=t.tileIndex,i=a.getTileHeaderDatabin(s);m.push(i),a.addEventListener(i,'dataArrived',o),++p,o(i)}while(t.tryAdvance());--p,d()})(),this.unregister=function(){if(!g){for(var e=0;e<m.length;++e)a.removeEventListener(m[e],'dataArrived',o);for(var t=0;t<f.length;++t)a.removeEventListener(f[t],'dataArrived',l);g=!0}}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e){function t(e,t,n){for(var r=Array(e.length),o=0,i;o<e.length;++o){if(i=e[o].minNumQualityLayers,'max'!==i){if(void 0!==t&&i>t)throw new s.jpipExceptions.ArgumentException('progressiveness['+o+'].minNumQualityLayers',i,'minNumQualityLayers is bigger than fetchParams.quality');i=a(i,n,'progressiveness['+o+'].minNumQualityLayers')}r[o]={minNumQualityLayers:i}}return r}function n(t){var n=[],s=e.getDefaultTileStructure(),a=s.getNumQualityLayers(),r='max';void 0!==t&&(a=Math.min(a,t),r=a);for(var o=4>a?a-1:3,l=1;l<o;++l)n.push({minNumQualityLayers:l});var c=Math.round(a/2);return c>o&&n.push({minNumQualityLayers:c}),n.push({minNumQualityLayers:r}),n}function i(t){var n=a(t.level,'level',void 0,!0),i=a(t.quality,'quality',void 0,!0),r=a(t.minX,'minX'),o=a(t.minY,'minY'),l=a(t.maxXExclusive,'maxXExclusive'),c=a(t.maxYExclusive,'maxYExclusive'),d=e.getLevelWidth(n),p=e.getLevelHeight(n);if(0>r||l>d||0>o||c>p||r>=l||o>=c)throw new s.jpipExceptions.ArgumentException('codestreamPartParams',t);return{minX:r,minY:o,maxXExclusive:l,maxYExclusive:c,level:n,quality:i}}function a(e,t,n,i){if(e===void 0&&(n!==void 0||i))return n;var a=+e;if(isNaN(a)||a!==Math.floor(a))throw new s.jpipExceptions.ArgumentException(t,e);return a}this.modify=function(e,a){var r=i(e);a=a||{};var o=a.useCachedDataOnly,l=a.disableProgressiveness,c;if(a.progressiveness!==void 0){if(o||l)throw new s.jpipExceptions.ArgumentException('options.progressiveness',a.progressiveness,'options contradiction: cannot accept both progressivenessand useCachedDataOnly/disableProgressiveness options');c=t(a.progressiveness,r.quality,'quality')}else if(o)c=[{minNumQualityLayers:0}];else if(l){var d=r.quality,p=d===void 0?'max':d;c=[{minNumQualityLayers:p}]}else c=n(r.quality);return{codestreamPartParams:r,progressiveness:c}}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(t,e,n,i,a,r){function o(e,s){var i=!1;try{var a=c(e,s);if(a===f)return;i=a===m}catch(n){i=!0,t.onException(n)}try{i||t.waitForConcurrentRequestsToEnd(h),n.requestEnded(e,h),i&&!y&&r!==void 0&&r(),t.checkConcurrentRequestsFinished()}catch(n){t.onException(n)}}function l(e){n.requestEnded(e,h),t.checkConcurrentRequestsFinished(),r!==void 0&&r()}function c(e,i){if(!i)throw new s.jpipExceptions.InternalErrorException('AJAX callback called although response is not done yet and chunked encoding is not enabled');var a=t.getCreatedChannelId(e);null===a?null===n.getChannelId()&&t.onException(new s.jpipExceptions.IllegalDataException('Cannot extract cid from cnew response','D.2.3')):null===n.getChannelId()?n.setChannelId(a):t.onException(new s.jpipExceptions.IllegalDataException('Channel created although was not requested','D.2.3'));var r=u(e);if(null===r)return m;var o=p(e,r);return o}function d(){I=n.nextRequestId();var e=i+'&len='+E+'&qid='+I;E*=2;var s=null===n.getChannelId();if(s){e+='&cnew=http';var a=t.getFirstChannel();null!==a&&(e+='&cid='+a.getChannelId())}else e+='&cid='+n.getChannelId();t.sendAjax(e,o,l)}function p(e,n){var i=m,a=new Uint8Array(e.response);if(n>a.length-2||0!==a[n])throw new s.jpipExceptions.IllegalDataException('Could not find End Of Response (EOR) code at the end of response','D.3');switch(a[n+1]){case s.jpipEndOfResponseReasons.IMAGE_DONE:case s.jpipEndOfResponseReasons.WINDOW_DONE:case s.jpipEndOfResponseReasons.QUALITY_LIMIT:i=g;break;case s.jpipEndOfResponseReasons.WINDOW_CHANGE:if(!y)throw new s.jpipExceptions.IllegalOperationException('Server response was terminated due to newer request issued on same channel. That may be an internal webjpip.js error - Check that movable requests are well maintained');break;case s.jpipEndOfResponseReasons.BYTE_LIMIT:case s.jpipEndOfResponseReasons.RESPONSE_LIMIT:y||(d(),i=f);break;case s.jpipEndOfResponseReasons.SESSION_LIMIT:t.onException(new s.jpipExceptions.IllegalOperationException('Server resources associated with the session is limitted, no further requests should be issued to this session'));break;case s.jpipEndOfResponseReasons.NON_SPECIFIED:t.onException(new s.jpipExceptions.IllegalOperationException('Server error terminated response with no reason specified'));break;default:t.onException(new s.jpipExceptions.IllegalDataException('Server responded with illegal End Of Response (EOR) code: '+a[n+1]));}return i}function u(n){try{for(var s=new Uint8Array(n.response),i=0,a;i<s.length&&!(0===s[i]);){var r=e.parseMessageHeader(s,i,a);if(r.bodyStart+r.messageBodyLength>s.length)return i;t.getDatabinsSaver().saveData(r,s),i=r.bodyStart+r.messageBodyLength,a=r}return i}catch(n){return t.onException(n),null}}var g=1,m=2,f=3,h=this,x=!1,y=!1,E=10*1024,I;this.startRequest=function(){if(x)throw new s.jpipExceptions.InternalErrorException('startRequest called twice');else if(y)throw new s.jpipExceptions.InternalErrorException('request was already stopped');x=!0,t.requestStarted(),d()},this.stopRequestAsync=function(){y=!0},this.getLastRequestId=function(){if(!x)throw new s.jpipExceptions.InternalErrorException('Unexpected call to getLastRequestId on inactive request');return I},this.callCallbackAfterConcurrentRequestsFinished=function(){a(h,!0)}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n,i,a){function r(e){var t=new s.jpipExceptions.InternalErrorException('Bad jpip server response (status = '+e.status+')');o(t)}function o(e){e===void 0&&(e=null),null!==l&&l({isReady:m,exception:e})}var l=null,c=null,d=[],p=null,u=0,g=[],m=!1,f=t||'0';this.onException=function(e){o(e)},this.getIsReady=function(){return m},this.setIsReady=function(e){m=e,o()},this.getCodestreamStructure=function(){return n},this.getDatabinsSaver=function(){return i},this.getDataRequestUrl=function(){return e},this.getTargetId=function(){return f},this.getFirstChannel=function(){return p},this.setStatusCallback=function(e){l=e},this.setRequestEndedCallback=function(e){c=e},this.requestStarted=function(){++u},this.requestEnded=function(e,t){--u;var n=e.getResponseHeader('JPIP-tid');if(''!==n&&null!==n)if('0'===f)f=n;else if(f!==n)throw new s.jpipExceptions.IllegalDataException('Server returned unmatched target ID');null==p&&(p=t);var i=t.getIsDedicatedForMovableRequest()?null:t;null!==c&&c(i)},this.getActiveRequestsCount=function(){return u},this.channelCreated=function(e){d.push(e)},this.getCreatedChannelId=function(e){var t=e.getResponseHeader('JPIP-cnew');if(!t)return null;for(var n=t.split(','),s=0,i;s<n.length;++s)if(i=n[s].split('='),'cid'===i[0])return i[1];return null},this.waitForConcurrentRequestsToEnd=function(e){for(var t=[],n=0;n<d.length;++n){var s=d[n].getRequestsWaitingForResponse(),i=s.length;if(0!==i){for(var a=s[0].getLastRequestId(),r=1;r<s.length;++r)a=Math.max(a,s[r].getLastRequestId());t.push({channel:d[n],requestId:a})}}g.push({request:e,concurrentRequests:t})},this.checkConcurrentRequestsFinished=function(){for(var e=g.length-1;0<=e;--e){for(var t=g[e].concurrentRequests,n=t.length-1,s;0<=n;--n)s=t[n],s.channel.isAllOldRequestsEnded(s.requestId)&&(t[n]=t[t.length-1],t.length-=1);if(!(0<t.length)){var i=g[e].request,a=i.callback;g[e]=g[g.length-1],g.length-=1,i.callCallbackAfterConcurrentRequestsFinished()}}},this.sendAjax=function(e,t,n){var s;s=n?function(e){r(e),n(e)}:r,a.request(e,t,s)}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n,i,a,r,o,l){function c(){null!=P&&o(P),y.setIsReady(!1),y.sendAjax(L,x)}function d(e){++C;var n=l.createChannel(t,y);return y.channelCreated(n),e||b.push(n),n}function p(e,t){for(var n=null,s=e+1,a=0,i,r;a<b.length&&(r=b[a].getAllQueuedRequestCount(),r<s&&(n=b[a],i=a,s=r),0!==r);++a);return t&&null!==n?(b[i]=b[b.length-1],b.length-=1,n):n}function u(){var e=a.getMainHeaderDatabin();if(!e.isAllDatabinLoaded())throw new s.jpipExceptions.IllegalDataException('Main header was not loaded on session creation');var t=y.getFirstChannel(),n=t.getChannelId();return L=T+'&cclose=*&cid='+n,h?void c():void(null===n||(P=r(g,f),y.setIsReady(!0)))}function g(){if(!(0<y.getActiveRequestsCount())){var e=y.getFirstChannel();e.sendMinimalRequest(function(){})}}function m(){if(null===y||!y.getIsReady())throw new s.jpipExceptions.InternalErrorException('Cannot perform this operation when the session is not ready')}var f=30*1e3,h=!1,x=null,y=null,E=null,I=null,b=[],C=0,P=null,T,S,L;this.open=function(e){if(null!=y)throw new s.jpipExceptions.InternalErrorException('session.open() should be called only once');var t=0>e.indexOf('?')?'?':'&';T=e+t+'type='+(a.getIsJpipTilePartStream()?'jpt-stream':'jpp-stream'),S=T+'&stream=0',y=l.createSessionHelper(S,n,i,a),null!=E&&y.setStatusCallback(E),null!=I&&y.setRequestEndedCallback(I);var r=d();r.sendMinimalRequest(u)},this.getTargetId=function(){return m(),y.getTargetId()},this.getIsReady=function(){var e=null!==y&&y.getIsReady();return e},this.setStatusCallback=function(e){E=e,null!==y&&y.setStatusCallback(e)},this.setRequestEndedCallback=function(e){I=e,null!==y&&y.setRequestEndedCallback(e)},this.hasActiveRequests=function(){m();var e=0<y.getActiveRequestsCount();return e},this.tryGetChannel=function(n){m();var s=C<e,i=s||n?0:t-1,a=p(i,n);return null===a&&s&&(a=d(n)),n&&null!==a&&a.dedicateForMovableRequest(),a},this.close=function(e){if(0==C)throw new s.jpipExceptions.InternalErrorException('Cannot close session before open');if(h)throw new s.jpipExceptions.InternalErrorException('Cannot close session twice');h=!0,x=e,L!=void 0&&c()}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n,i,a,r){function o(){if(null!==S)throw new s.jpipExceptions.IllegalOperationException('Previous session still not established');return null==y?void(i.cleanupUnregisteredDatabins(),l()):void(null!==P&&P({isReady:!0,exception:'Previous session that should be closed still alive.Maybe old requestContexts have not beed closed. Reconnect will not be done'}))}function l(){var s;null!=x&&(s=x.getTargetId()),S=a.createSession(e,t,s,n,i),S.setStatusCallback(d),S.open(E)}function c(e){var t=x.tryGetChannel(!0);if(null===t)throw new s.jpipExceptions.IllegalOperationException('Too many concurrent requests. Limit the use of dedicated (movable) requests, enlarge maxChannelsInSession or wait for requests to finish and avoid create new ones');if(!t.getIsDedicatedForMovableRequest())throw new s.jpipExceptions.InternalErrorException('getIsDedicatedForMovableRequest inconsistency');e.internalDedicatedChannel=t}function d(e){if(null===S||e.isReady!==S.getIsReady())throw new s.jpipExceptions.InternalErrorException('Unexpected statusCallback when not registered to session or inconsistent isReady');if(e.isReady){if(null!=y)throw new s.jpipExceptions.InternalErrorException('sessionWaitingForDisconnect should be null');y=x,x=S,S=null,null!=y&&(y.setStatusCallback(null),!f()&&y.setRequestEndedCallback(f)),x.setStatusCallback(P),x.setRequestEndedCallback(m);for(var t=0;t<C.length;++t)c(C[t])}null!==P&&P(e)}function p(e){null!==e&&(++I,e.close(u))}function u(){--I,0==I&&T!==void 0&&T()}function g(){if(null===x)throw new s.jpipExceptions.InternalErrorException('This operation is forbidden when session is not ready')}function m(e){var t=null;if(i.getLoadedBytes()>h&&o(),null!==e){if(e.getIsDedicatedForMovableRequest())throw new s.jpipExceptions.InternalErrorException('Expected non-movable channel as channelFreed');do{if(0===b.length){t=null;break}if(t=b.shift(),null!==t.internalRequest)throw new s.jpipExceptions.InternalErrorException('Request was already sent but still in queue')}while(t.isEnded);null!==t&&(t.internalRequest=e.requestData(t.codestreamPartParams,t.callback,t.failureCallback,t.numQualityLayers))}}function f(){var e=!y.hasActiveRequests();return e&&(y.close(),y=null),e}var h=r||10*1048576,x=null,y=null,E=null,I=0,b=[],C=[],P=null,T=null,S;this.getIsReady=function(){return null!=x&&x.getIsReady()},this.open=function(e){if(e===void 0||null===e)throw new s.jpipExceptions.ArgumentException('baseUrl',e);if(null!=E)throw new s.jpipExceptions.IllegalOperationException('Image was already opened');E=e,l()},this.close=function(e){if(null!=T)throw new s.jpipExceptions.IllegalOperationException('closed twice');T=e,I=1,p(x),p(S),p(y),u()},this.setStatusCallback=function(e){P=e,null!=x&&x.setStatusCallback(e)},this.dedicateChannelForMovableRequest=function(){g();var e={internalDedicatedChannel:null};return C.push(e),c(e),e},this.requestData=function(e,t,n,i,a){g();var r={isEnded:!1,internalRequest:null,codestreamPartParams:e,callback:t,failureCallback:n,numQualityLayers:i},o=!!a,l;if(o)l=a.internalDedicatedChannel;else{if(l=x.tryGetChannel(),null===l)return b.push(r),r;if(l.getIsDedicatedForMovableRequest())throw new s.jpipExceptions.InternalErrorException('Expected non-movable channel')}if(l.getIsDedicatedForMovableRequest()!==o)throw new s.jpipExceptions.InternalErrorException('getIsDedicatedForMovableRequest inconsistency');return r.internalRequest=l.requestData(e,t,n,i),r},this.stopRequestAsync=function(e){e.isEnded=!0,null!==e.internalRequest&&e.internalRequest.stopRequestAsync()},this.reconnect=o}},function(e,t,n){'use strict';var s=Math.pow,a=n(0);e.exports=function(e,t,n,r){function i(c,d){var p=r.getCodingStyleBaseParams(c,d);if(null===p)return null;var u=e.getMainHeaderDatabin(),g=r.getImageAndTileSizeOffset(),m=g+a.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER,f=l(u,2,m),h=n.getInt16(f,0),x=t.getMarkerOffsetInDatabin(c,a.j2kMarkers.PackedPacketHeadersInTileHeader),y=t.getMarkerOffsetInDatabin(u,a.j2kMarkers.PackedPacketHeadersInMainHeader),E=p.codingStyleDefaultOffset+6,I=l(c,6,E),b=n.getInt16(I,0),C=o(I,4),P=o(I,5),T=Array(p.numResolutionLevels),S=Array(p.numResolutionLevels),L=null;if(!p.isDefaultPrecinctSize){var v=p.numResolutionLevels;L=l(c,v,p.precinctSizesOffset)}for(var O=32768,k=0;k<p.numResolutionLevels;++k){if(p.isDefaultPrecinctSize){T[k]=O,S[k]=O;continue}var i=k,R=L[i];T[k]=1*s(2,15&R),S[k]=1*s(2,R>>>4)}for(var D=Array(h),A=0;A<h;++A)D[A]={maxCodeblockWidth:C,maxCodeblockHeight:P,numResolutionLevels:p.numResolutionLevels,precinctWidthPerLevel:T,precinctHeightPerLevel:S};var j={maxCodeblockWidth:C,maxCodeblockHeight:P,numResolutionLevels:p.numResolutionLevels,precinctWidthPerLevel:T,precinctHeightPerLevel:S},N={numQualityLayers:b,isPacketHeadersNearData:null===x&&null===y,isStartOfPacketMarkerAllowed:p.isStartOfPacketMarkerAllowed,isEndPacketHeaderMarkerAllowed:p.isEndPacketHeaderMarkerAllowed,paramsPerComponent:D,defaultComponentParams:j};return N}function o(e,t){var n=e[t],s=2+(15&n);if(10<s)throw new a.j2kExceptions.IllegalDataException('Illegal codeblock width exponent '+s,'A.6.1, Table A.18');return 1<<s}function l(e,t,n){var s=[],i=e.copyBytes(s,0,{forceCopyAllRange:!0,maxLengthToCopy:t,databinStartOffset:n});if(null===i)throw new a.jpipExceptions.InternalErrorException('Header data-bin has not yet recieved '+t+' bytes starting from offset '+n);return s}this.parseCodestreamStructure=function(){for(var t=e.getMainHeaderDatabin(),s=r.getImageAndTileSizeOffset(),o=l(t,38,s+a.j2kOffsets.MARKER_SIZE+a.j2kOffsets.LENGTH_FIELD_SIZE),c=a.j2kOffsets.REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER-(a.j2kOffsets.MARKER_SIZE+a.j2kOffsets.LENGTH_FIELD_SIZE),d=a.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER-(a.j2kOffsets.MARKER_SIZE+a.j2kOffsets.LENGTH_FIELD_SIZE),p=n.getInt32(o,c),u=n.getInt32(o,c+4),g=n.getInt32(o,10),m=n.getInt32(o,14),f=n.getInt32(o,18),h=n.getInt32(o,22),x=n.getInt32(o,26),y=n.getInt32(o,30),E=n.getInt16(o,d),I=s+a.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER+2,b=l(t,3*E,I),C=Array(E),P=Array(E),T=0;T<E;++T)C[T]=b[3*T+1],P[T]=b[3*T+2];return{numComponents:E,componentsScaleX:C,componentsScaleY:P,imageWidth:p-x,imageHeight:u-y,tileWidth:f,tileHeight:h,firstTileOffsetX:x,firstTileOffsetY:y}},this.parseDefaultTileParams=function(){var t=e.getMainHeaderDatabin(),n=i(t,!0);return n},this.parseOverridenTileParams=function(t){var n=e.getTileHeaderDatabin(t),s=i(n,!1);return s}}},function(e,t,n){'use strict';var s=Math.max,i=Math.min,a=Math.ceil,r=Math.floor,o=n(0);e.exports=function(e,t,n,l){function c(e,t,n){if(0>t||t>=n)throw new o.jpipExceptions.ArgumentException(e,t,e+' is expected to be between 0 and '+n-1)}function d(e,t,n,s,i){var a=n(e),r=s(e),o=i(e);if(a>=r||o>=r)return!0;return 0==a%o||0==o%a}function p(e,n){if(void 0===n)return null;for(var o=t.getNumComponents(),l=Array(o),c=n.level||0,d=t.getTileLeft(e,c),p=t.getTileTop(e,c),u=n.minX-d,g=n.minY-p,m=n.maxXExclusive-d,h=n.maxYExclusive-p,x=t.getLevelWidth(c),y=t.getLevelHeight(c),E=0;E<o;++E){for(var I=f[E],b=I.getNumResolutionLevels(),C=b-c,P=I.getNumResolutionLevels(),T=Array(b),S=0;S<C;++S){var L=I.getComponentScaleX(),v=I.getComponentScaleY(),O=C-S-1,k=L<<O,R=v<<O,D=4,A=r(u/k)-D,j=r(g/R)-D,N=a(m/k)+D,_=a(h/R)+D,F=I.getPrecinctWidth(S)*L,B=I.getPrecinctHeight(S)*v,M=r(A/F),q=r(j/B),w=a(N/F),X=a(_/B),H=I.getNumPrecinctsX(S),Y=I.getNumPrecinctsY(S);T[S]={minPrecinctX:s(0,M),minPrecinctY:s(0,q),maxPrecinctXExclusive:i(w,H),maxPrecinctYExclusive:i(X,Y)}}l[E]=T}return l}function u(e,t,n,s){for(var a=!0,r=s?null:n,o=!1,c=2,i;0<=c&&(i=g(e,c,t,r),a=0===i,!!a);--c)'P'!==l[c]||s||(o=!0);if(a)return!1;if(null===n)return e.isInCodestreamPart=!0,!0;var d=n[e.component],p=d[e.resolutionLevel];return o&&(e.precinctX=p.minPrecinctX,e.precinctY=p.minPrecinctY),e.isInCodestreamPart=e.precinctX>=p.minPrecinctX&&e.precinctY>=p.minPrecinctY&&e.precinctX<p.maxPrecinctXExclusive&&e.precinctY<p.maxPrecinctYExclusive,!0}function g(e,n,s,i){var a=f[e.component];switch(l[n]){case'R':var r=a.getNumResolutionLevels()-s;return++e.resolutionLevel,e.resolutionLevel%=r,e.resolutionLevel;case'C':return++e.component,e.component%=t.getNumComponents(),e.component;case'P':var c,d,p,u;if(null!==i){var g=i[e.component],m=g[e.resolutionLevel];c=m.minPrecinctX,d=m.minPrecinctY,p=m.maxPrecinctXExclusive,u=m.maxPrecinctYExclusive}else c=0,d=0,p=a.getNumPrecinctsX(e.resolutionLevel),u=a.getNumPrecinctsY(e.resolutionLevel);return(e.precinctX-=c-1,e.precinctX%=p-c,e.precinctX+=c,e.precinctX!=c)?e.precinctX-c:(e.precinctY-=d-1,e.precinctY%=u-d,e.precinctY+=d,e.precinctY-d);case'L':throw new o.jpipExceptions.InternalErrorException('Advancing L is not supported in JPIP');default:throw new o.jpipExceptions.InternalErrorException('Unexpected letter in progression order: '+l[n]);}}var m,f,h,x;this.getProgressionOrder=function(){return l},this.getDefaultComponentStructure=function(){return m},this.getComponentStructure=function(e){return f[e]},this.getTileWidth=function(){return e.tileSize[0]},this.getTileHeight=function(){return e.tileSize[1]},this.getNumQualityLayers=function(){return e.numQualityLayers},this.getIsPacketHeaderNearData=function(){return e.isPacketHeadersNearData},this.getIsStartOfPacketMarkerAllowed=function(){return e.isStartOfPacketMarkerAllowed},this.getIsEndPacketHeaderMarkerAllowed=function(){return e.isEndPacketHeaderMarkerAllowed},this.precinctInClassIndexToPosition=function(e){if(0>e)throw new o.jpipExceptions.ArgumentException('inClassIndex',e,'Invalid negative in-class index of precinct');var n=t.getNumTilesX()*t.getNumTilesY(),s=t.getNumComponents(),i=e%n,a=(e-i)/n,r=a%s,l=f[r],c=l.getNumResolutionLevels(),d=(a-r)/s,p=0,u;for(u=1;u<c;++u){var g=h[r][u];if(g>d)break;p=g}--u;var m=d-p,x=l.getNumPrecinctsX(u),y=l.getNumPrecinctsY(u),E=m%x,I=(m-E)/x;if(I>=y)throw new o.jpipExceptions.ArgumentException('inClassIndex',e,'Invalid in-class index of precinct');var b={tileIndex:i,component:r,precinctX:E,precinctY:I,resolutionLevel:u};return b},this.precinctPositionToInClassIndex=function(e){var n=t.getNumComponents();c('precinctPosition.component',e.component,n);var s=f[e.component],i=s.getNumResolutionLevels();c('precinctPosition.resolutionLevel',e.resolutionLevel,i);var a=t.getNumTilesX()*t.getNumTilesY(),r=s.getNumPrecinctsX(e.resolutionLevel),o=s.getNumPrecinctsY(e.resolutionLevel);c('precinctPosition.precinctX',e.precinctX,r),c('precinctPosition.precinctY',e.precinctY,o),c('precinctPosition.tileIndex',e.tileIndex,a);var l=e.precinctX+e.precinctY*r,d=h[e.component][e.resolutionLevel],p=e.component+(l+d)*t.getNumComponents(),u=e.tileIndex+p*t.getNumTilesX()*t.getNumTilesY();return u},this.getPrecinctIterator=function(e,t,n){var s=0;if(void 0!==t&&void 0!==t.level&&(s=t.level,x<=s))throw new o.jpipExceptions.InternalErrorException('Cannot advance resolution: level='+t.level+' but should be smaller than '+x);var i=p(e,t),a=0,r=0;if(!n&&null!==i){var l=i[0][0];a=l.minPrecinctX,r=l.minPrecinctY}var c={component:0,precinctX:a,precinctY:r,resolutionLevel:0,isInCodestreamPart:!0},d={get tileIndex(){return e},get component(){return c.component},get precinctIndexInComponentResolution(){var e=f[c.component],t=e.getNumPrecinctsX(c.resolutionLevel);return c.precinctIndexInComponentResolution=c.precinctX+c.precinctY*t,c.precinctIndexInComponentResolution},get precinctX(){return c.precinctX},get precinctY(){return c.precinctY},get resolutionLevel(){return c.resolutionLevel},get isInCodestreamPart(){return c.isInCodestreamPart}};return d.tryAdvance=function(){var e=u(c,s,i,n);return e},d},m=n.createComponentStructure(e.defaultComponentParams,this),f=Array(t.getNumComponents());for(var y=0;y<t.getNumComponents();++y)f[y]=n.createComponentStructure(e.paramsPerComponent[y],this);return function(){h=Array(n);var n=t.getNumComponents(),s=e.defaultComponentParams;x=s.numResolutionLevels;for(var a=!0,l=!0,p=0,c;p<n;++p){c=e.paramsPerComponent[p],x=i(x,c.numResolutionLevels),h[p]=Array(c.numResolutionLevels);for(var u=f[p],g=0,m=u.getNumPrecinctsX(p),y=u.getNumPrecinctsY(p),E=0;E<c.numResolutionLevels;++E){h[p][E]=g;var r=u.getNumPrecinctsX(E),I=u.getNumPrecinctsY(E);g+=r*I,(s.precinctWidthPerLevel[E]!==c.precinctWidthPerLevel[E]||s.precinctHeightPerLevel[E]!==c.precinctHeightPerLevel[E])&&(a=!1);var b=d(E,c.numResolutionLevels,u.getPrecinctWidth,t.getLevelWidth,t.getTileWidth),C=d(E,c.numResolutionLevels,u.getPrecinctWidth,t.getLevelWidth,t.getTileWidth);l&=b&&C}}if(!a)throw new o.j2kExceptions.UnsupportedFeatureException('Special Coding Style for Component (COC)','A.6.2');if(!l)throw new o.j2kExceptions.UnsupportedFeatureException('Precinct TopLeft which is not matched to tile TopLeft','B.6')}(),function(e){if(4!==e.length)throw new o.j2kExceptions.IllegalDataException('Illegal progression order '+e+': unexpected length');if('L'!==e[3])throw new o.jpipExceptions.IllegalDataException('Illegal target progression order of '+e,'A.3.2.1');var t=0<=e.indexOf('P'),n=0<=e.indexOf('C'),s=0<=e.indexOf('R');if(!t||!n||!s)throw new o.j2kExceptions.IllegalDataException('Illegal progression order '+e+': missing letter');if('RPCL'!==e)throw new o.j2kExceptions.UnsupportedFeatureException('Progression order of '+e,'A.6.1')}(l),this}},function(e,t,n){'use strict';var s=Math.min,i=n(0);e.exports=function(){function e(e,i,r,o){var l=0,c=o,d;do{if(!n(e,i))return null;var p=r?~i.currentByte:i.currentByte,u=s(a[p],i.validBitsInCurrentByte+1),g=u-1;if(c!==void 0){if(u>c){t(i,c),l+=c;break}c-=g}l+=g,d=u<=i.validBitsInCurrentByte,d?t(i,u):i.validBitsInCurrentByte=0}while(!d);return l}function t(e,t){e.validBitsInCurrentByte-=t,0<e.validBitsInCurrentByte&&(e.currentByte=255&e.currentByte<<t)}function n(e,t){if(0<t.validBitsInCurrentByte)return!0;var n=t.isSkipNextByte?2:1,s=[],a=e.copyBytes(s,0,{forceCopyAllRange:!0,databinStartOffset:t.nextOffsetToParse,maxLengthToCopy:n});if(a!==n)return!1;var r=t.originalByteWithoutShift;if(t.currentByte=s[n-1],t.validBitsInCurrentByte=8,t.originalByteWithoutShift=t.currentByte,255===r){if(0!=(128&s[0]))throw new i.j2kExceptions.IllegalDataException('Expected 0 bit after 0xFF byte','B.10.1');t.isSkipNextByte||(t.currentByte<<=1,t.validBitsInCurrentByte=7)}return t.isSkipNextByte=!1,t.nextOffsetToParse+=n,!0}var a=function(){var e=Array(255);e[0]=9,e[1]=8,e[2]=7,e[3]=7;var t;for(t=4;7>=t;++t)e[t]=6;for(t=8;15>=t;++t)e[t]=5;for(t=16;31>=t;++t)e[t]=4;for(t=32;63>=t;++t)e[t]=3;for(t=64;127>=t;++t)e[t]=2;for(t=128;255>=t;++t)e[t]=1;for(t=0;255>=t;++t)e[t-256]=e[t];return e}();return function(a,r){var o=r.createTransactionalObject({nextOffsetToParse:0,validBitsInCurrentByte:0,originalByteWithoutShift:null,currentByte:null,isSkipNextByte:!1}),l=null;Object.defineProperty(this,'activeTransaction',{get:function(){if(null==l||!l.isActive)throw new i.jpipExceptions.InternalErrorException('No active transaction in bitstreamReader');return l}}),Object.defineProperty(this,'bitsCounter',{get:function(){var e=o.getValue(l);if(n(a,e),e.isSkipNextByte)throw new i.jpipExceptions.InternalErrorException('Unexpected state of bitstreamReader: When 0xFF encountered, tryValidateCurrentByte should skip the whole byte  after shiftRemainingBitsInByte and clear isSkipNextByte. However the flag is still set');var t=8*e.nextOffsetToParse-e.validBitsInCurrentByte;return t}}),Object.defineProperty(this,'databinOffset',{get:function(){var e=o.getValue(l);if(e.isSkipNextByte)return e.nextOffsetToParse+1;if(0!=e.validBitsInCurrentByte%8||255===e.originalByteWithoutShift)throw new i.jpipExceptions.InternalErrorException('Cannot calculate databin offset when bitstreamReader  is in the middle of the byte');return e.nextOffsetToParse-e.validBitsInCurrentByte/8},set:function(e){var t=o.getValue(l);t.validBitsInCurrentByte=0,t.isSkipNextByte=!1,t.originalByteWithoutShift=null,t.nextOffsetToParse=e}}),this.startNewTransaction=function(){if(null!=l&&l.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot start new transaction in bitstreamReader while another transaction is active');l=r.createTransaction()},this.shiftRemainingBitsInByte=function(){var e=o.getValue(l);e.isSkipNextByte=255===e.originalByteWithoutShift,e.validBitsInCurrentByte=Math.floor(e.validBitsInCurrentByte/8)},this.shiftBit=function(){var t=o.getValue(l);if(!n(a,t))return null;var s=e(a,t,!0,1);return s},this.countZerosAndShiftUntilFirstOneBit=function(t){var n=o.getValue(l),s=e(a,n,!1,t);return s},this.countOnesAndShiftUntilFirstZeroBit=function(t){var n=o.getValue(l),s=e(a,n,!0,t);return s},this.shiftBits=function(e){for(var i=0,r=o.getValue(l),c=e;0<c;){if(!n(a,r))return null;var d=s(r.validBitsInCurrentByte,c),p=r.currentByte>>8-d;i=(i<<d)+p,t(r,d),c-=d}return i}}}()},function(e,t,n){'use strict';var s=Math.ceil,i=Math.floor,a=n(0);e.exports=function(e,t,n,r){function o(t,n){var s=0,r=null;return function(){if(null===s)throw new a.jpipExceptions.InternalErrorException('Iterated too deep in tag tree');if(s===u.length)return s=null,null;var o=u.length-s-1,c=i(t>>o),d=i(n>>o),p=u[s].width*d+c,g=u[s].content[p];void 0===g&&(g=l(s,p));var m=g.getValue(e.activeTransaction);return null!=r&&r.minimalPossibleValue>m.minimalPossibleValue&&(m.minimalPossibleValue=r.minimalPossibleValue),r=m,++s,m}}function l(e,t){var n=r.createTransactionalObject({minimalPossibleValue:0,isFinalValue:!1});return u[e].content[t]=n,n}function c(){var t=p.getValue(e.activeTransaction);return t}function d(){p.setValue(e.activeTransaction,!0)}var p=r.createTransactionalObject(!1,!0),u;(function(){u=[];for(var e=t,i=n;1<=e||1<=i;){e=s(e),i=s(i);var a=e*i;u.unshift({width:e,height:i,content:Array(a)}),e/=2,i/=2}l(0,0)})(),this.setMinimalValueIfNotReadBits=function(t){if(!c()){var n=u[0].content[0],s=n.getValue(e.activeTransaction);s.minimalPossibleValue=t}},this.isSmallerThanOrEqualsTo=function(t,n,s){d();for(var i=o(t,n),r=i(),l;null!==r;){if(r.minimalPossibleValue>s)return!1;if(!r.isFinalValue){var c=s-r.minimalPossibleValue+1,p=e.countZerosAndShiftUntilFirstOneBit(c);if(null===p)return null;r.minimalPossibleValue+=p,p<c&&(r.isFinalValue=!0)}l=r,r=i()}var u=l.minimalPossibleValue<=s;if(u&&!l.isFinalValue)throw new a.jpipExceptions.InternalErrorException('Wrong parsing in TagTree.isSmallerThanOrEqualsTo: not sure if value is smaller than asked');return u},this.getValue=function(t,n){var s=o(t,n),i=s(),a;for(d();null!==i;){if(!i.isFinalValue){var r=e.countZerosAndShiftUntilFirstOneBit();if(null===r)return null;i.minimalPossibleValue+=r,i.isFinalValue=!0}a=i,i=s()}return a.minimalPossibleValue}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(){var e=function(){for(var e=164,t=Array(e),n=1,s=2,a=0;n<=e;){for(var r=n;r<s;++r)t[r]=a;n*=2,s*=2,++a}return t}();return function(t,n){var i=n.createTransactionalObject({lBlockValue:3});this.parse=function(n){var a=t.countOnesAndShiftUntilFirstZeroBit();if(null===a)return null;var r=i.getValue(t.activeTransaction);r.lBlockValue+=a;var o=e[n];if(o===void 0)throw new s.jpipExceptions.InternalErrorException('Unexpected value of coding passes '+n+'. Expected positive integer <= 164');var l=r.lBlockValue+o,c=t.shiftBits(l);return c}}}()},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n,i,a,r){function o(t){var n=u.getValue(e.activeTransaction);if(n>=t+1)throw new s.jpipExceptions.InternalErrorException('Unexpected quality layer to parse')}function l(){if(null==d){d=Array(t),p=Array(t);for(var s=0;s<t;++s){d[s]=Array(n),p[s]=Array(n);for(var i=0;i<n;++i)d[s][i]=r.createCodeblockLengthParser(e,a),p[s][i]=a.createTransactionalObject({isIncluded:!1})}}}function c(t,n,s){var a=p[t][n].getValue(e.activeTransaction),r;if(r=a.isIncluded?e.shiftBit():g.isSmallerThanOrEqualsTo(t,n,s),null===r)return null;if(!r)return{codeblockBodyLengthBytes:0,codingPasses:0};var o=null;if(!a.isIncluded&&(o=m.getValue(t,n),null===o))return null;var l=i.parse(e);if(null===l)return null;var c=d[t][n],u=c.parse(l);if(null===u)return null;a.isIncluded=!0;var f={codeblockBodyLengthBytes:u,codingPasses:l};return null!==o&&(f.zeroBitPlanes=o),f}var d=null,p=null,u=a.createTransactionalObject(0,!0),g=r.createTagTree(e,t,n),m=r.createTagTree(e,t,n);this.calculateSubbandLength=function(s){o(s),l(),g.setMinimalValueIfNotReadBits(s);for(var i=0,a=0,r=Array(t*n),d=0;d<n;++d)for(var p=0,m;p<t;++p){if(m=c(p,d,s),null===m)return null;r[a++]=m,i+=m.codeblockBodyLengthBytes}return u.setValue(e.activeTransaction,s+1),{codeblockBodyLengthByIndex:r,overallBodyLengthBytes:i}}}},function(e,t,n){'use strict';var s=Math.ceil,a=Math.floor,i=n(0);e.exports=function(e,t,n,r,o,l){function c(e){for(;f.length<e;){h.startNewTransaction();var t=d(f.length);if(null===t)return void h.activeTransaction.abort();f.push(t),h.activeTransaction.commit()}}function d(e){var t;if(0<e){var n=f[e-1];t=n.headerStartOffset+n.headerLength+n.overallBodyLengthBytes}else t=r;if(h.databinOffset=t,I&&b){var s=g(145);if(null===s)return null;if(s){h.databinOffset+=6}}var i=h.shiftBit();if(null===i)return null;if(!i)return h.shiftRemainingBitsInByte(),{headerStartOffset:t,headerLength:1,codeblockBodyLengthByIndex:[],overallBodyLengthBytes:0};var a=p(e);if(null===a)return null;var o=h.databinOffset;return a.headerLength=o-t,a.headerStartOffset=t,a}function p(e){for(var t=0,n=null,s=0;s<P.length;++s){var i=P[s],a=i.calculateSubbandLength(e);if(null===a)return null;n=null==n?a.codeblockBodyLengthByIndex:n.concat(a.codeblockBodyLengthByIndex),t+=a.overallBodyLengthBytes}if(h.shiftRemainingBitsInByte(),C){var r=g(146);if(null===r)return null;if(r){h.databinOffset+=2}}return{codeblockBodyLengthByIndex:n,overallBodyLengthBytes:t}}function u(e){var t=Math.min(e,f.length);if(0===t)return{endOffset:r,numQualityLayers:0};var n=f[t-1],s=n.headerStartOffset+n.headerLength+n.overallBodyLengthBytes;return{endOffset:s,numQualityLayers:t}}function g(e){var t=[,,],s=n.copyBytes(t,0,{databinStartOffset:h.databinOffset,maxLengthToCopy:2,forceCopyAllRange:!1});switch(s){case 2:var i=255===t[0]&&t[1]===e;return i;case 1:return!(255!==t[0])&&null;default:return null;}}function m(){if(!I)throw new i.jpipExceptions.UnsupportedFeatureException('PPM or PPT','A.7.4 and A.7.5')}var f=[],h=l.createBitstreamReader(n),x=t.getNumCodeblocksXInPrecinct(o),y=t.getNumCodeblocksYInPrecinct(o),E=e.getNumQualityLayers(),I=e.getIsPacketHeaderNearData(),b=e.getIsStartOfPacketMarkerAllowed(),C=e.getIsEndPacketHeaderMarkerAllowed(),P=function(){for(var e=0===o.resolutionLevel?1:3,t=[],n=0;n<e;++n){var i,r;(0===o.resolutionLevel?(i=x,r=y):(i=1===n?s(x/2):a(x/2),r=0===n?s(y/2):a(y/2)),0!==i&&0!==r)&&t.push(l.createSubbandLengthInPacketHeaderCalculator(h,i,r))}return t}();this.calculateEndOffsetOfLastFullPacket=function(e){var t;if(!(e===void 0||e>=E))t=e;else if(!n.isAllDatabinLoaded())t=E;else{var s=n.getDatabinLengthIfKnown();return{endOffset:s,numQualityLayers:E}}m(),c(t);var i=u(t);return i},this.getPacketOffsetsByCodeblockIndex=function(e){return m(),c(e+1),f.length<=e?null:f[e]}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t){function n(n,a){var r=n.getCachedData(i);if(void 0!==r.calculator)return r.calculator;if(void 0===a)throw new s.jpipExceptions.InternalErrorException('precinctPosition should be given on the first time of using QualityLayersCache on this precinct');var o=e.getTileStructure(a.tileIndex),l=o.getComponentStructure(a.component);return r.calculator=t.createPacketLengthCalculator(o,l,n,0,a),r.calculator}var i='packetLengthCalculator';this.getPacketOffsetsByCodeblockIndex=function(e,t,s){var i=n(e,s),a=i.getPacketOffsetsByCodeblockIndex(t);return a},this.getQualityLayerOffset=function(e,t,s){var i=e.getExistingRanges(),a=n(e,s),r;1>i.length||0<i[0].start?(r=0,t=0):r=i[0].start+i[0].length;for(var o=a.calculateEndOffsetOfLastFullPacket(t);r<o.endOffset;){var l=o.numQualityLayers-1;o=a.calculateEndOffsetOfLastFullPacket(l)}return o}}},function(e,t,n){'use strict';var s=n(0),i=n(1);e.exports=function(e,t){function n(e,t){var n=i.createFetch(e,g,t);return e.on('isProgressiveChanged',n.isProgressiveChanged),e.on('terminate',n.terminate),e.on('stop',n.stop),e.on('resume',n.resum),n}t=t||{};var s=null,a=null,r=t.maxChannelsInSession||1,o=t.maxRequestsWaitingForResponseInChannel||1,l=e.getMainHeaderDatabin(),c=i.createMarkersParser(l),d=i.createOffsetsCalculator(l,c),p=i.createStructureParser(e,c,d),u=i.createCodestreamStructure(p,'RPCL'),g=i.createReconnectableRequester(r,o,u,e),m=i.createRequestParamsModifier(u);return g.setStatusCallback(function(e){var t=null;null!==e.exception&&(t=e.exception.toString());var n={isReady:e.isReady,exception:t};if(s&&(n.isReady||n.exception)){var i=s,r=a;if(s=null,a=null,!n.isReady)return void r(n.exception);var o=u.getSizesParams(),l=JSON.parse(JSON.stringify(o)),c=u.getDefaultTileStructure(),d=c.getDefaultComponentStructure();l.imageLevel=0,l.lowestQuality=1,l.highestQuality=c.getNumQualityLayers(),l.numResolutionLevelsForLimittedViewer=d.getNumResolutionLevels(),i(l)}}),this.open=function(e){return new Promise(function(t,n){s=t,a=n,g.open(e)})},this.close=function(){return new Promise(function(e){g.close(e)})},this.on=function(){},this.startFetch=function(e,t){var s=m.modify(t),i=n(e,s.progressiveness);i.move(s.codestreamPartParams)},this.startMovableFetch=function(e,t){var s=m.modify(t),i=n(e,s.progressiveness),a=g.dedicateChannelForMovableRequest();i.setDedicatedChannelHandle(a),e.on('move',i.move),i.move(s.codestreamPartParams)},this.reconnect=function(){g.reconnect()},this}},function(e,t,n){'use strict';function s(){this._image=new i.JpxImage}var a=Math.max,r=Math.min,i=n(39);e.exports=s;n(0);s.prototype.start=function(e){var t=this;return new Promise(function(n){var s={left:e.headersCodestream.offsetX,top:e.headersCodestream.offsetY,right:e.headersCodestream.offsetX+e.codestreamPartParams.maxXExclusive-e.codestreamPartParams.minX,bottom:e.headersCodestream.offsetY+e.codestreamPartParams.maxYExclusive-e.codestreamPartParams.minY},i=t._image.parseCodestream(e.headersCodestream.codestream,0,e.headersCodestream.codestream.length,{isOnlyParseHeaders:!0});t._image.addPacketsData(i,e.codeblocksData),t._image.decode(i,{regionToParse:s});var a=t._copyTilesPixelsToOnePixelsArray(t._image.tiles,s,t._image.componentsCount);n(a)})},s.prototype._copyTilesPixelsToOnePixelsArray=function(e,t,n){for(var s=e[0],o=t.right-t.left,l=t.bottom-t.top,c=new ImageData(o,l),d=4,p=o*d,u=0;u<e.length;++u){var i=e[u].left+e[u].width,g=e[u].top+e[u].height,m=a(t.left,e[u].left),f=a(t.top,e[u].top),h=r(t.right,i),x=r(t.bottom,g);if(m!==e[u].left||f!==e[u].top||h-m!==e[u].width||x-f!==e[u].height)throw'Unsupported tiles to copy';var y=m-t.left,E=f-t.top;this._copyTile(c.data,e[u],y*d+E*p,p,n)}return c},s.prototype._copyTile=function(e,t,n,s,i){var a=1,r=2,o=1,l=t.pixels||t.items;switch(void 0===i&&(i=l.length/(t.width*t.height)),i){case 1:a=0,r=0;break;case 3:o=3;break;case 4:o=4;break;default:throw'Unsupported components count '+i;}for(var c=n,d=0,p=0,u;p<t.height;++p){u=c;for(var g=0;g<t.width;++g)e[c+0]=l[d+0],e[c+1]=l[d+a],e[c+2]=l[d+r],e[c+3]=255,d+=o,c+=4;c=u+s}}},function(e,t,n){'use strict';var s=Math.max,a=Math.min,o=Math.ceil,r=Math.floor;Object.defineProperty(t,'__esModule',{value:!0}),t.JpxImage=void 0;var l=n(40),i=n(42),d=function(){function e(e){this.message='JPX error: '+e}return e.prototype=new Error,e.prototype.name='JpxError',e.constructor=e,e}(),c=function(){function e(){this.failOnCorruptedImage=!1}function t(e,t){e.x0=o(t.XOsiz/e.XRsiz),e.x1=o(t.Xsiz/e.XRsiz),e.y0=o(t.YOsiz/e.YRsiz),e.y1=o(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function n(e,t){for(var n=e.SIZ,r=[],l=o((n.Xsiz-n.XTOsiz)/n.XTsiz),c=o((n.Ysiz-n.YTOsiz)/n.YTsiz),d=0,u;d<c;d++)for(var g=0;g<l;g++)u={},u.tx0=s(n.XTOsiz+g*n.XTsiz,n.XOsiz),u.ty0=s(n.YTOsiz+d*n.YTsiz,n.YOsiz),u.tx1=a(n.XTOsiz+(g+1)*n.XTsiz,n.Xsiz),u.ty1=a(n.YTOsiz+(d+1)*n.YTsiz,n.Ysiz),u.width=u.tx1-u.tx0,u.height=u.ty1-u.ty0,u.components=[],r.push(u);e.tiles=r;for(var p=n.Csiz,m=0,i;m<p;m++){i=t[m];for(var f=0,h=r.length,x;f<h;f++)x={},u=r[f],x.tcx0=o(u.tx0/i.XRsiz),x.tcy0=o(u.ty0/i.YRsiz),x.tcx1=o(u.tx1/i.XRsiz),x.tcy1=o(u.ty1/i.YRsiz),x.width=x.tcx1-x.tcx0,x.height=x.tcy1-x.tcy0,u.components[m]=x}}function c(e,t,n){var s=t.codingStyleParameters,i={};return s.entropyCoderWithCustomPrecincts?(i.PPx=s.precinctsSizes[n].PPx,i.PPy=s.precinctsSizes[n].PPy):(i.PPx=15,i.PPy=15),i.xcb_=0<n?a(s.xcb,i.PPx-1):a(s.xcb,i.PPx),i.ycb_=0<n?a(s.ycb,i.PPy-1):a(s.ycb,i.PPy),i}function p(e,t,n){var s=1<<n.PPx,i=1<<n.PPy,a=0===t.resLevel,l=1<<n.PPx+(a?0:-1),c=1<<n.PPy+(a?0:-1),d=t.trx1>t.trx0?o(t.trx1/s)-r(t.trx0/s):0,p=t.try1>t.try0?o(t.try1/i)-r(t.try0/i):0;t.precinctParameters={precinctWidth:s,precinctHeight:i,numprecinctswide:d,numprecinctshigh:p,numprecincts:d*p,precinctWidthInSubband:l,precinctHeightInSubband:c}}function u(e,t,n){var o=n.xcb_,l=n.ycb_,c=1<<o,d=1<<l,p=t.tbx0>>o,u=t.tby0>>l,g=t.tbx1+c-1>>o,m=t.tby1+d-1>>l,f=t.resolution.precinctParameters,h=[],x=[],y,E,I,b;for(E=u;E<m;E++)for(y=p;y<g;y++){I={cbx:y,cby:E,tbx0:c*y,tby0:d*E,tbx1:c*(y+1),tby1:d*(E+1)},I.tbx0_=s(t.tbx0,I.tbx0),I.tby0_=s(t.tby0,I.tby0),I.tbx1_=a(t.tbx1,I.tbx1),I.tby1_=a(t.tby1,I.tby1);var C=r((I.tbx0_-t.tbx0)/f.precinctWidthInSubband),P=r((I.tby0_-t.tby0)/f.precinctHeightInSubband);if(b=C+P*f.numprecinctswide,I.precinctNumber=b,I.subbandType=t.type,I.Lblock=3,!(I.tbx1_<=I.tbx0_||I.tby1_<=I.tby0_)){h.push(I);var T=x[b];void 0===T?x[b]=T={cbxMin:y,cbyMin:E,cbxMax:y,cbyMax:E}:(y<T.cbxMin?T.cbxMin=y:y>T.cbxMax&&(T.cbxMax=y),E<T.cbyMin?T.cbxMin=E:E>T.cbyMax&&(T.cbyMax=E)),I.precinct=T}}t.codeblockParameters={codeblockWidth:o,codeblockHeight:l,numcodeblockwide:g-p+1,numcodeblockhigh:m-u+1},t.codeblocks=h,t.precincts=x}function g(e,t,n){for(var s=[],a=e.subbands,r=0,i=a.length;r<i;r++)for(var o=a[r],l=o.codeblocks,c=0,d=l.length,p;c<d;c++)(p=l[c],p.precinctNumber===t)&&s.push(p);return{layerNumber:n,codeblocks:s}}function m(e){for(var t=e.SIZ,n=e.currentTile.index,a=e.tiles[n],o=a.codingStyleDefaultParameters.layersCount,c=t.Csiz,p=0,u=0;u<c;u++)p=s(p,a.components[u].codingStyleParameters.decompositionLevelsCount);var m=0,l=0,r=0,i=0;this.nextPacket=function(){for(;m<o;m++){for(;l<=p;l++){for(;r<c;r++){var e=a.components[r];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[l],n=t.precinctParameters.numprecincts,s;i<n;)return s=g(t,i,m),i++,s;i=0}}r=0}l=0}throw new d('Out of packets')}}function f(e){for(var t=e.SIZ,n=e.currentTile.index,a=e.tiles[n],o=a.codingStyleDefaultParameters.layersCount,c=t.Csiz,p=0,u=0;u<c;u++)p=s(p,a.components[u].codingStyleParameters.decompositionLevelsCount);var m=0,r=0,l=0,i=0;this.nextPacket=function(){for(;m<=p;m++){for(;r<o;r++){for(;l<c;l++){var e=a.components[l];if(!(m>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[m],n=t.precinctParameters.numprecincts,s;i<n;)return s=g(t,i,r),i++,s;i=0}}l=0}r=0}throw new d('Out of packets')}}function h(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],a=i.codingStyleDefaultParameters.layersCount,o=t.Csiz,u=0,m,l,r,c;for(r=0;r<o;r++){var p=i.components[r];u=s(u,p.codingStyleParameters.decompositionLevelsCount)}var f=new Int32Array(u+1);for(l=0;l<=u;++l){var h=0;for(r=0;r<o;++r){var x=i.components[r].resolutions;l<x.length&&(h=s(h,x[l].precinctParameters.numprecincts))}f[l]=h}m=0,l=0,r=0,c=0,this.nextPacket=function(){for(;l<=u;l++){for(;c<f[l];c++){for(;r<o;r++){var e=i.components[r];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){var t=e.resolutions[l],n=t.precinctParameters.numprecincts;if(!(c>=n)){for(;m<a;){var s=g(t,c,m);return m++,s}m=0}}}r=0}c=0}throw new d('Out of packets')}}function x(e){var t=e.SIZ,n=e.currentTile.index,s=e.tiles[n],i=s.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=I(s),p=o,u=0,l=0,r=0,c=0,m=0;this.nextPacket=function(){for(;m<p.maxNumHigh;m++){for(;c<p.maxNumWide;c++){for(;r<a;r++){for(var e=s.components[r],t=e.codingStyleParameters.decompositionLevelsCount;l<=t;l++){var n=e.resolutions[l],f=o.components[r].resolutions[l],h=E(c,m,f,p,n);if(null!==h){for(;u<i;){var x=g(n,h,u);return u++,x}u=0}}l=0}r=0}c=0}throw new d('Out of packets')}}function y(e){var t=e.SIZ,n=e.currentTile.index,s=e.tiles[n],i=s.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=I(s),p=0,l=0,r=0,c=0,u=0;this.nextPacket=function(){for(;r<a;++r){for(var e=s.components[r],t=o.components[r],n=e.codingStyleParameters.decompositionLevelsCount;u<t.maxNumHigh;u++){for(;c<t.maxNumWide;c++){for(;l<=n;l++){var m=e.resolutions[l],f=t.resolutions[l],h=E(c,u,f,t,m);if(null!==h){for(;p<i;){var x=g(m,h,p);return p++,x}p=0}}l=0}c=0}u=0}throw new d('Out of packets')}}function E(e,t,n,s,i){var a=e*s.minWidth,r=t*s.minHeight;if(0!=a%n.width||0!=r%n.height)return null;var o=r/n.width*i.precinctParameters.numprecinctswide;return a/n.height+o}function I(e){for(var t=Number.MAX_VALUE,n=e.components.length,i=t,o=t,l=0,d=0,p=Array(n),u=0;u<n;u++){for(var c=e.components[u],g=c.codingStyleParameters.decompositionLevelsCount,m=Array(g+1),f=t,h=t,x=0,y=0,E=1,I=g;0<=I;--I){var r=c.resolutions[I],b=E*r.precinctParameters.precinctWidth,C=E*r.precinctParameters.precinctHeight;f=a(f,b),h=a(h,C),x=s(x,r.precinctParameters.numprecinctswide),y=s(y,r.precinctParameters.numprecinctshigh),m[I]={width:b,height:C},E<<=1}i=a(i,f),o=a(o,h),l=s(l,x),d=s(d,y),p[u]={resolutions:m,minWidth:f,minHeight:h,maxNumWide:x,maxNumHigh:y}}return{components:p,minWidth:i,minHeight:o,maxNumWide:l,maxNumHigh:d}}function b(e){for(var t=e.SIZ,n=e.currentTile.index,s=e.tiles[n],i=t.Csiz,a=0;a<i;a++){for(var l=s.components[a],g=l.codingStyleParameters.decompositionLevelsCount,E=[],I=[],b=0;b<=g;b++){var r=c(e,l,b),C={},P=1<<g-b;C.trx0=o(l.tcx0/P),C.try0=o(l.tcy0/P),C.trx1=o(l.tcx1/P),C.try1=o(l.tcy1/P),C.resLevel=b,p(e,C,r),E.push(C);var T;if(0===b)T={},T.type='LL',T.tbx0=o(l.tcx0/P),T.tby0=o(l.tcy0/P),T.tbx1=o(l.tcx1/P),T.tby1=o(l.tcy1/P),T.resolution=C,u(e,T,r),I.push(T),C.subbands=[T];else{var S=1<<g-b+1,L=[];T={},T.type='HL',T.tbx0=o(l.tcx0/S-0.5),T.tby0=o(l.tcy0/S),T.tbx1=o(l.tcx1/S-0.5),T.tby1=o(l.tcy1/S),T.resolution=C,u(e,T,r),I.push(T),L.push(T),T={},T.type='LH',T.tbx0=o(l.tcx0/S),T.tby0=o(l.tcy0/S-0.5),T.tbx1=o(l.tcx1/S),T.tby1=o(l.tcy1/S-0.5),T.resolution=C,u(e,T,r),I.push(T),L.push(T),T={},T.type='HH',T.tbx0=o(l.tcx0/S-0.5),T.tby0=o(l.tcy0/S-0.5),T.tbx1=o(l.tcx1/S-0.5),T.tby1=o(l.tcy1/S-0.5),T.resolution=C,u(e,T,r),I.push(T),L.push(T),C.subbands=L}}l.resolutions=E,l.subbands=I}var v=s.codingStyleDefaultParameters.progressionOrder;switch(v){case 0:s.packetsIterator=new m(e);break;case 1:s.packetsIterator=new f(e);break;case 2:s.packetsIterator=new h(e);break;case 3:s.packetsIterator=new x(e);break;case 4:s.packetsIterator=new y(e);break;default:throw new d('Unsupported progression order '+v);}}function C(e,t,n,s){function a(e){for(;u<e;){var s=t[n+p];p++,g?(E=E<<7|s,u+=7,g=!1):(E=E<<8|s,u+=8),255===s&&(g=!0)}return u-=e,E>>>u&(1<<e)-1}function r(e){return 255===t[n+p-1]&&t[n+p]===e?(o(1),!0):255===t[n+p]&&t[n+p+1]===e&&(o(2),!0)}function o(e){p+=e}function c(){u=0,g&&(p++,g=!1)}function d(){if(0===a(1))return 1;if(0===a(1))return 2;var e=a(2);return 3>e?e+3:(e=a(5),31>e)?e+6:(e=a(7),e+37)}for(var p=0,u=0,g=!1,m=e.currentTile.index,f=e.tiles[m],h=e.COD.sopMarkerUsed,x=e.COD.ephMarkerUsed,y=f.packetsIterator,E;p<s;){c(),h&&r(145)&&o(4);var I=y.nextPacket();if(a(1)){for(var b=I.layerNumber,C=[],P=0,i=I.codeblocks.length,T;P<i;P++){T=I.codeblocks[P];var S=T.precinct,L=T.cbx-S.cbxMin,v=T.cby-S.cbyMin,R=!1,D=!1,A;if(void 0!==T.included)R=!!a(1);else{S=T.precinct;var j,N;if(void 0!==S.inclusionTree)j=S.inclusionTree;else{var _=S.cbxMax-S.cbxMin+1,F=S.cbyMax-S.cbyMin+1;j=new k(_,F,b),N=new O(_,F),S.inclusionTree=j,S.zeroBitPlanesTree=N}if(j.reset(L,v,b))for(;;)if(!a(1)){j.incrementValue(b);break}else if(A=!j.nextLevel(),A){T.included=!0,R=D=!0;break}}if(R){if(D){for(N=S.zeroBitPlanesTree,N.reset(L,v);;)if(!a(1))N.incrementValue();else if(A=!N.nextLevel(),A)break;T.zeroBitPlanes=N.value}for(var B=d();a(1);)T.Lblock++;var M=(0,l.log2)(B),q=(B<1<<M?M-1:M)+T.Lblock,w=a(q);C.push({codeblock:T,codingpasses:B,dataLength:w})}}for(c(),x&&r(146);0<C.length;){var X=C.shift();T=X.codeblock,void 0===T.data&&(T.data=[]),T.data.push({data:t,start:n+p,end:n+p+X.dataLength,codingpasses:X.codingpasses}),p+=X.dataLength}}}return p}function P(e,t,r,o,l,c,d,p,u){var g=o.tbx0,m=o.tby0,f=o.codeblocks,h='H'===o.type.charAt(0)?1:0,x='H'===o.type.charAt(1)?t:0,y=o.resolution,E='LL'!==o.type,I;I=E?{x0:(u.x0-y.trx0)/2+o.tbx0,y0:(u.y0-y.try0)/2+o.tby0,x1:(u.x1-y.trx0)/2+o.tbx0,y1:(u.y1-y.try0)/2+o.tby0}:u;for(var b=E?2:1,C=0,P=f.length;C<P;++C){var T=f[C],S=T.tbx1_-T.tbx0_,L=T.tby1_-T.tby0_;if(0!=S&&0!=L&&void 0!==T.data){var v={x0:s(T.tbx0_,I.x0),y0:s(T.tby0_,I.y0),x1:a(T.tbx1_,I.x1),y1:a(T.tby1_,I.y1)};if(!(v.x0>=v.x1||v.y0>=v.y1)){var O,D;O=new R(S,L,T.subbandType,T.zeroBitPlanes,c),D=2;var A=T.data,N=0,_=0,F,j,B;for(F=0,j=A.length;F<j;F++)B=A[F],N+=B.end-B.start,_+=B.codingpasses;var M=new Uint8Array(N),q=0;for(F=0,j=A.length;F<j;F++){B=A[F];var w=B.data.subarray(B.start,B.end);M.set(w,q),q+=w.length}var X=new i.ArithmeticDecoder(M,0,N);for(O.setDecoder(X),F=0;F<_;F++)0===D?O.runSignificancePropagationPass():1===D?O.runMagnitudeRefinementPass():2===D?(O.runCleanupPass(),p&&O.checkSegmentationSymbol()):void 0,D=(D+1)%3;for(var H=O.coefficentsSign,Y=O.coefficentsMagnitude,z=O.bitsDecoded,U=d?0:0.5,W=v.x1-v.x0,V=v.y0,Q,k,K;V<v.y1;++V){var Z=v.x0-T.tbx0_+(V-T.tby0_)*S,J=(v.x0-I.x0)*b+(V-I.y0)*t*b+h+x;for(Q=v.x0;Q<v.x1;Q++)k=Y[Z],0!==k&&(k=(k+U)*l,0!==H[Z]&&(k=-k),K=z[Z],e[J]=d&&K>=c?k:k*(1<<c-K)),J+=b,++Z}}}}}function T(e,t,n){var l=t.components[n],c=l.codingStyleParameters,d=l.quantizationParameters,p=c.decompositionLevelsCount,u=d.SPqcds,g=d.scalarExpounded,m=d.guardBits,f=c.segmentationSymbolUsed,h=e.components[n].precision,x;if(void 0!==e.regionToParse){var y=a(l.tcx1,e.regionToParse.right),E=a(l.tcy1,e.regionToParse.bottom);x={x0:s(0,e.regionToParse.left-l.tcx0),y0:s(0,e.regionToParse.top-l.tcy0),x1:y-l.tcx0,y1:E-l.tcy0}}for(var I=c.reversibleTransformation,C=I?new N:new A,T=[],S=0,b=0;b<=p;b++){var i=l.resolutions[b],L=i.trx1-i.trx0,O=i.try1-i.try0,k,R,D;if(void 0===x)R=L,D=O,k={x0:i.trx0,y0:i.try0,x1:i.trx1,y1:i.try1};else{var _=1<<p-b,F=4;k={x0:o(x.x0/_)-F,y0:o(x.y0/_)-F,x1:o(x.x1/_)+F,y1:o(x.y1/_)+F},k.x0=2*r(k.x0/2)+i.trx0,k.y0=2*r(k.y0/2)+i.try0,k.x1=2*r(k.x1/2)+i.trx0,k.y1=2*r(k.y1/2)+i.try0,k.x0=s(k.x0,i.trx0),k.y0=s(k.y0,i.try0),k.x1=a(k.x1,i.trx1),k.y1=a(k.y1,i.try1),R=k.x1-k.x0,D=k.y1-k.y0}for(var B=new Float32Array(R*D),M=0,j=i.subbands.length;M<j;M++){var q,w;g?(q=u[S].mu,w=u[S].epsilon,S++):(q=u[0].mu,w=u[0].epsilon+(0<b?1-b:0));var X=i.subbands[M],H=v[X.type],Y=I?1:Math.pow(2,h+H-w)*(1+q/2048),z=m+w-1;P(B,R,D,X,Y,z,I,f,k)}var U={x0:k.x0-i.trx0,y0:k.y0-i.try0,x1:k.x1-i.trx0,y1:k.y1-i.try0};T.push({width:L,height:O,items:B,relativeRegionInLevel:U})}var W=C.calculate(T,l.tcx0,l.tcy0),V=W.relativeRegionInLevel,Q=V.x1-V.x0,K=!1;if(void 0!==e.regionToParse&&(K=x.x0!==V.x0||x.y0!==V.y0||x.x1!==V.x1||x.y1!==V.y1),!K){var Z=V.y1-V.y0;return{left:l.tcx0,top:l.tcy0,width:Q,height:Z,items:W.items}}for(var L=x.x1-x.x0,O=x.y1-x.y0,J=W.items,G=new Float32Array(L*O),$=x.y0-V.y0,ee=x.x0-V.x0,te=0,ne=ee+Q*$,b=0,se;b<O;++b)se=ne+L,G.set(J.subarray(ne,se),te),ne+=Q,te+=L;return{left:l.tcx0+x.x0,top:l.tcy0+x.y0,width:L,height:O,items:G}}function S(e){for(var t=e.SIZ,n=e.components,s=t.Csiz,a=[],r=0,i=e.tiles.length,o;r<i;r++)if(o=e.tiles[r],!(void 0!==e.regionToParse&&(e.regionToParse.left>=o.tx1||e.regionToParse.top>=o.ty1||e.regionToParse.right<=o.tx0||e.regionToParse.bottom<=o.ty0))){var l=[],d;for(d=0;d<s;d++)l[d]=T(e,o,d);var c=l[0],p=new Uint8ClampedArray(c.items.length*s),u={left:c.left,top:c.top,width:c.width,height:c.height,items:p},m=0,f,h,x,y,E,I,b;if(o.codingStyleDefaultParameters.multipleComponentTransform){var C=4===s,P=l[0].items,S=l[1].items,L=l[2].items,v=C?l[3].items:null;f=n[0].precision-8,h=(128<<f)+0.5;var O=o.components[0],k=s-3;if(y=P.length,!O.codingStyleParameters.reversibleTransformation)for(x=0;x<y;x++,m+=k)E=P[x]+h,I=S[x],b=L[x],p[m++]=E+1.402*b>>f,p[m++]=E-0.34413*I-0.71414*b>>f,p[m++]=E+1.772*I>>f;else for(x=0;x<y;x++,m+=k){E=P[x]+h,I=S[x],b=L[x];var R=E-(b+I>>2);p[m++]=R+b>>f,p[m++]=R>>f,p[m++]=R+I>>f}if(C)for(x=0,m=3;x<y;x++,m+=4)p[m]=v[x]+h>>f}else for(d=0;d<s;d++){var g=l[d].items;for(f=n[d].precision-8,h=(128<<f)+0.5,(m=d,x=0,y=g.length);x<y;x++)p[m]=g[x]+h>>f,m+=s}a.push(u)}return a}function L(e,t){for(var n=e.SIZ,s=n.Csiz,i=e.tiles[t],a=0;a<s;a++){var r=i.components[a],o=e.currentTile.QCC[a]===void 0?e.currentTile.QCD:e.currentTile.QCC[a];r.quantizationParameters=o;var l=e.currentTile.COC[a]===void 0?e.currentTile.COD:e.currentTile.COC[a];r.codingStyleParameters=l}i.codingStyleDefaultParameters=e.currentTile.COD}var v={LL:0,LH:1,HL:1,HH:2};e.prototype={parse:function(e){var t=(0,l.readUint16)(e,0);if(65359===t)return void this.parseCodestream(e,0,e.length);for(var n=0,s=e.length;n<s;){var i=8,a=(0,l.readUint32)(e,n),r=(0,l.readUint32)(e,n+4);if(n+=i,1===a&&(a=4294967296*(0,l.readUint32)(e,n)+(0,l.readUint32)(e,n+4),n+=8,i+=8),0===a&&(a=s-n+i),a<i)throw new d('Invalid box field size');var o=a-i,c=!0;switch(r){case 1785737832:c=!1;break;case 1668246642:var p=e[n];if(1===p){var u=(0,l.readUint32)(e,n+3);switch(u){case 16:case 17:case 18:break;default:(0,l.warn)('Unknown colorspace '+u);}}else 2===p&&(0,l.info)('ICC profile not supported');break;case 1785737827:this.parseCodestream(e,n,n+o);break;case 1783636000:218793738!==(0,l.readUint32)(e,n)&&(0,l.warn)('Invalid JP2 signature');break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:var g=String.fromCharCode(255&r>>24,255&r>>16,255&r>>8,255&r);(0,l.warn)('Unsupported header type '+r+' ('+g+')');}c&&(n+=o)}},parseImageProperties:function(e){for(var t=e.getByte();0<=t;){var n=t;t=e.getByte();var s=n<<8|t;if(65361==s){e.skip(4);var i=e.getInt32()>>>0,a=e.getInt32()>>>0,r=e.getInt32()>>>0,o=e.getInt32()>>>0;e.skip(16);var l=e.getUint16();return this.width=i-r,this.height=a-o,this.componentsCount=l,void(this.bitsPerComponent=8)}}throw new d('No size marker found in JPX stream')},parseCodestream:function(e,s,a,r){var o={};r=r||{};var c=!!r.isOnlyParseHeaders,p=r.regionToParse;if(void 0!==p&&c)throw'JPX Error: options.regionToParse is uneffective if options.isOnlyParseHeaders = true';var u=!1;try{for(var g=s,m;g+1<a;){m=(0,l.readUint16)(e,g),g+=2;var f=0,h,x,y,E,I,P;switch(m){case 65359:o.mainHeader=!0;break;case 65497:break;case 65361:f=(0,l.readUint16)(e,g);var T={};T.Xsiz=(0,l.readUint32)(e,g+4),T.Ysiz=(0,l.readUint32)(e,g+8),T.XOsiz=(0,l.readUint32)(e,g+12),T.YOsiz=(0,l.readUint32)(e,g+16),T.XTsiz=(0,l.readUint32)(e,g+20),T.YTsiz=(0,l.readUint32)(e,g+24),T.XTOsiz=(0,l.readUint32)(e,g+28),T.YTOsiz=(0,l.readUint32)(e,g+32);var S=(0,l.readUint16)(e,g+36);T.Csiz=S;var v=[],O=!0;h=g+38;for(var k=0,i;k<S;k++)i={precision:(127&e[h])+1,isSigned:!!(128&e[h]),XRsiz:e[h+1],YRsiz:e[h+2]},h+=3,t(i,T),v.push(i),void 0!==p&&(O&=1===i.XRsiz&&1===i.YRsiz);if(o.SIZ=T,o.components=v,n(o,v),o.QCC=[],o.COC=[],!O)throw new Error('JPX Error: When regionToParse is used, component size other than 1 is not supported');break;case 65372:f=(0,l.readUint16)(e,g);var R={};switch(h=g+2,x=e[h++],31&x){case 0:E=8,I=!0;break;case 1:E=16,I=!1;break;case 2:E=16,I=!0;break;default:throw new Error('Invalid SQcd value '+x);}for(R.noQuantization=8===E,R.scalarExpounded=I,R.guardBits=x>>5,y=[];h<f+g;){var D={};8===E?(D.epsilon=e[h++]>>3,D.mu=0):(D.epsilon=e[h]>>3,D.mu=(7&e[h])<<8|e[h+1],h+=2),y.push(D)}R.SPqcds=y,o.mainHeader?o.QCD=R:(o.currentTile.QCD=R,o.currentTile.QCC=[]);break;case 65373:f=(0,l.readUint16)(e,g);var A={};h=g+2;var j;switch(257>o.SIZ.Csiz?j=e[h++]:(j=(0,l.readUint16)(e,h),h+=2),x=e[h++],31&x){case 0:E=8,I=!0;break;case 1:E=16,I=!1;break;case 2:E=16,I=!0;break;default:throw new Error('Invalid SQcd value '+x);}for(A.noQuantization=8===E,A.scalarExpounded=I,A.guardBits=x>>5,y=[];h<f+g;)D={},8===E?(D.epsilon=e[h++]>>3,D.mu=0):(D.epsilon=e[h]>>3,D.mu=(7&e[h])<<8|e[h+1],h+=2),y.push(D);A.SPqcds=y,o.mainHeader?o.QCC[j]=A:o.currentTile.QCC[j]=A;break;case 65362:f=(0,l.readUint16)(e,g);var N={};h=g+2;var _=e[h++];N.entropyCoderWithCustomPrecincts=!!(1&_),N.sopMarkerUsed=!!(2&_),N.ephMarkerUsed=!!(4&_),N.progressionOrder=e[h++],N.layersCount=(0,l.readUint16)(e,h),h+=2,N.multipleComponentTransform=e[h++],N.decompositionLevelsCount=e[h++],N.xcb=(15&e[h++])+2,N.ycb=(15&e[h++])+2;var F=e[h++];if(N.selectiveArithmeticCodingBypass=!!(1&F),N.resetContextProbabilities=!!(2&F),N.terminationOnEachCodingPass=!!(4&F),N.verticalyStripe=!!(8&F),N.predictableTermination=!!(16&F),N.segmentationSymbolUsed=!!(32&F),N.reversibleTransformation=e[h++],N.entropyCoderWithCustomPrecincts){for(var B=[],M;h<f+g;)M=e[h++],B.push({PPx:15&M,PPy:M>>4});N.precinctsSizes=B}var q=[];if(N.selectiveArithmeticCodingBypass&&q.push('selectiveArithmeticCodingBypass'),N.resetContextProbabilities&&q.push('resetContextProbabilities'),N.terminationOnEachCodingPass&&q.push('terminationOnEachCodingPass'),N.verticalyStripe&&q.push('verticalyStripe'),N.predictableTermination&&q.push('predictableTermination'),0<q.length)throw u=!0,new Error('Unsupported COD options ('+q.join(', ')+')');o.mainHeader?o.COD=N:(o.currentTile.COD=N,o.currentTile.COC=[]);break;case 65424:f=(0,l.readUint16)(e,g),P={},P.index=(0,l.readUint16)(e,g+2),P.length=(0,l.readUint32)(e,g+4),P.dataEnd=P.length+g-2,P.partIndex=e[g+8],P.partsCount=e[g+9],o.mainHeader=!1,0===P.partIndex&&(P.COD=o.COD,P.COC=o.COC.slice(0),P.QCD=o.QCD,P.QCC=o.QCC.slice(0)),o.currentTile=P;break;case 65427:P=o.currentTile,0===P.partIndex&&(L(o,P.index),b(o)),f=P.dataEnd-g,c||C(o,e,g,f);break;case 65365:case 65367:case 65368:case 65380:f=(0,l.readUint16)(e,g);break;case 65363:throw new Error('Codestream code 0xFF53 (COC) is not implemented');default:throw new Error('Unknown codestream code: '+m.toString(16));}g+=f}}catch(t){if(u||this.failOnCorruptedImage)throw new d(t.message);else(0,l.warn)('JPX: Trying to recover from: '+t.message)}return c||this.decode(o,r),this.width=o.SIZ.Xsiz-o.SIZ.XOsiz,this.height=o.SIZ.Ysiz-o.SIZ.YOsiz,this.componentsCount=o.SIZ.Csiz,o},addPacketsData:function(e,t){for(var n=0;n<t.packetDataOffsets.length;++n)for(var s=t.packetDataOffsets[n],a=e.tiles[s.tileIndex],r=a.components[s.c],o=r.resolutions[s.r],c=s.p,d=s.l,l=g(o,c,d),p=0;p<s.codeblockOffsets.length;++p){var i=s.codeblockOffsets[p],u=i.start===i.end;if(!u){var m=l.codeblocks[p];if(void 0===m.data&&(m.data=[]),void 0!==i.zeroBitPlanes){if(void 0===m.zeroBitPlanes&&(m.zeroBitPlanes=i.zeroBitPlanes),m.zeroBitPlanes!==i.zeroBitPlanes)throw'JPX Error: Unmatched zero bit planes';}else if(void 0===m.zeroBitPlanes)throw'JPX Error: zeroBitPlanes is unknown';m.included=!0,m.data.push({data:t.data,start:i.start,end:i.end,codingpasses:i.codingpasses})}}},decode:function(e,t){if(t!==void 0&&t.regionToParse!==void 0){var n=t.regionToParse;if(n.top===void 0||n.left===void 0||n.right===void 0||n.bottom===void 0)throw new Error('JPX Error: Either left, top, right or bottom are undefined in regionToParse');e.regionToParse=n}this.tiles=S(e),e.regionToParse=void 0}};var O=function(){function e(e,t){var n=(0,l.log2)(s(e,t))+1;this.levels=[];for(var a=0,i;a<n;a++)i={width:e,height:t,items:[]},this.levels.push(i),e=o(e/2),t=o(t/2)}return e.prototype={reset:function(e,t){for(var n=0,s=0,i;n<this.levels.length;){i=this.levels[n];var a=e+t*i.width;if(void 0!==i.items[a]){s=i.items[a];break}i.index=a,e>>=1,t>>=1,n++}n--,i=this.levels[n],i.items[i.index]=s,this.currentLevel=n,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return(e--,0>e)?(this.value=n,!1):(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),k=function(){function e(e,t,n){var a=(0,l.log2)(s(e,t))+1;this.levels=[];for(var r=0,i;r<a;r++){i=new Uint8Array(e*t);for(var c=0,d=i.length;c<d;c++)i[c]=n;var p={width:e,height:t,items:i};this.levels.push(p),e=o(e/2),t=o(t/2)}}return e.prototype={reset:function(e,t,n){for(var s=0;s<this.levels.length;){var i=this.levels[s],a=e+t*i.width;i.index=a;var r=i.items[a];if(255===r)break;if(r>n)return this.currentLevel=s,this.propagateValues(),!1;e>>=1,t>>=1,s++}return this.currentLevel=s-1,!0},incrementValue:function(e){var t=this.levels[this.currentLevel];t.items[t.index]=e+1,this.propagateValues()},propagateValues:function(){for(var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];0<=--e;)t=this.levels[e],t.items[t.index]=n},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return(t.items[t.index]=255,e--,!(0>e))&&(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),R=function(){function e(e,t,n,a,l){this.width=e,this.height=t,this.contextLabelTable='HH'===n?o:'HL'===n?r:s;var c=e*t;this.neighborsSignificance=new Uint8Array(c),this.coefficentsSign=new Uint8Array(c),this.coefficentsMagnitude=14<l?new Uint32Array(c):6<l?new Uint16Array(c):new Uint8Array(c),this.processingFlags=new Uint8Array(c);var d=new Uint8Array(c);if(0!==a)for(var p=0;p<c;p++)d[p]=a;this.bitsDecoded=d,this.reset()}var t=17,n=18,s=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),r=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),o=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);return e.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[t]=92,this.contexts[n]=6},setNeighborsSignificance:function(e,t,n){var s=this.neighborsSignificance,a=this.width,r=this.height,o=0<t,l=t+1<a,c;0<e&&(c=n-a,o&&(s[c-1]+=16),l&&(s[c+1]+=16),s[c]+=4),e+1<r&&(c=n+a,o&&(s[c-1]+=16),l&&(s[c+1]+=16),s[c]+=4),o&&(s[n-1]+=1),l&&(s[n+1]+=1),s[n]|=128},runSignificancePropagationPass:function(){for(var e=this.decoder,t=this.width,n=this.height,s=this.coefficentsMagnitude,a=this.coefficentsSign,r=this.neighborsSignificance,o=this.processingFlags,l=this.contexts,c=this.contextLabelTable,d=this.bitsDecoded,p=0;p<n;p+=4)for(var u=0,g;u<t;u++){g=p*t+u;for(var m=0,f;4>m&&(f=p+m,!(f>=n));m++,g+=t)if(o[g]&=-2,!s[g]&&r[g]){var i=c[r[g]],h=e.readBit(l,i);if(h){var x=this.decodeSignBit(f,u,g);a[g]=x,s[g]=1,this.setNeighborsSignificance(f,u,g),o[g]|=2}d[g]++,o[g]|=1}}},decodeSignBit:function(e,t,n){var s=this.width,i=this.height,a=this.coefficentsMagnitude,r=this.coefficentsSign,o,l,c,d,p,u;d=0<t&&0!==a[n-1],t+1<s&&0!==a[n+1]?(c=r[n+1],d?(l=r[n-1],o=1-c-l):o=1-c-c):d?(l=r[n-1],o=1-l-l):o=0;var g=3*o;return d=0<e&&0!==a[n-s],e+1<i&&0!==a[n+s]?(c=r[n+s],d?(l=r[n-s],o=1-c-l+g):o=1-c-c+g):d?(l=r[n-s],o=1-l-l+g):o=g,0<=o?(p=9+o,u=this.decoder.readBit(this.contexts,p)):(p=9-o,u=1^this.decoder.readBit(this.contexts,p)),u},runMagnitudeRefinementPass:function(){for(var e=this.decoder,t=this.width,n=this.height,s=this.coefficentsMagnitude,i=this.neighborsSignificance,r=this.contexts,o=this.bitsDecoded,l=this.processingFlags,c=1,d=2,p=t*n,u=0,g;u<p;u=g){g=a(p,u+4*t);for(var m=0;m<t;m++)for(var f=u+m;f<g;f+=t)if(s[f]&&0==(l[f]&c)){var h=16;if(0!=(l[f]&d)){l[f]^=d;var x=127&i[f];h=0==x?15:14}var y=e.readBit(r,h);s[f]=s[f]<<1|y,o[f]++,l[f]|=c}}},runCleanupPass:function(){for(var e=this.decoder,s=this.width,r=this.height,o=this.neighborsSignificance,l=this.coefficentsMagnitude,c=this.coefficentsSign,d=this.contexts,p=this.contextLabelTable,u=this.bitsDecoded,g=this.processingFlags,m=2,f=s,h=2*s,x=3*s,y=0,E;y<r;y=E){E=a(y+4,r);for(var I=y*s,b=y+3<r,C=0;C<s;C++){var P=I+C,T=b&&0===g[P]&&0===g[P+f]&&0===g[P+h]&&0===g[P+x]&&0===o[P]&&0===o[P+f]&&0===o[P+h]&&0===o[P+x],S=0,L=P,v=y,i;if(T){var O=e.readBit(d,n);if(!O){u[P]++,u[P+f]++,u[P+h]++,u[P+x]++;continue}S=e.readBit(d,t)<<1|e.readBit(d,t),0!=S&&(v=y+S,L+=S*s),i=this.decodeSignBit(v,C,L),c[L]=i,l[L]=1,this.setNeighborsSignificance(v,C,L),g[L]|=m,L=P;for(var k=y;k<=v;k++,L+=s)u[L]++;S++}for(v=y+S;v<E;v++,L+=s)if(!(l[L]||0!=(g[L]&1))){var R=p[o[L]],D=e.readBit(d,R);1===D&&(i=this.decodeSignBit(v,C,L),c[L]=i,l[L]=1,this.setNeighborsSignificance(v,C,L),g[L]|=m),u[L]++}}}},checkSegmentationSymbol:function(){var e=this.decoder,n=this.contexts,s=e.readBit(n,t)<<3|e.readBit(n,t)<<2|e.readBit(n,t)<<1|e.readBit(n,t);if(10!=s)throw new d('Invalid segmentation symbol')}},e}(),D=function(){function e(){}return e.prototype.calculate=function(e,t,n){for(var s=e[0],a=1,i=e.length;a<i;a++)s=this.iterate(s,e[a],t,n);return s},e.prototype.extend=function(e,t,n){var s=t-1,i=t+1,a=t+n-2,r=t+n;e[s--]=e[i++],e[r++]=e[a--],e[s--]=e[i++],e[r++]=e[a--],e[s--]=e[i++],e[r++]=e[a--],e[s]=e[i],e[r]=e[a]},e.prototype.iterate=function(e,t,n,s){var r=t.relativeRegionInLevel;if(2*e.relativeRegionInLevel.x0>r.x0||2*e.relativeRegionInLevel.y0>r.y0||2*e.relativeRegionInLevel.x1<r.x1||2*e.relativeRegionInLevel.y1<r.y1)throw new Error('JPX Error: region in LL is smaller than region in higher resolution level');if(0!=r.x0%2||0!=r.y0%2)throw new Error('JPX Error: region in HL/LH/HH subbands begins in odd coefficients');var o=e.items,c=r.x1-r.x0,d=r.y1-r.y0,p=e.relativeRegionInLevel.x1-e.relativeRegionInLevel.x0,g=r.x0/2-e.relativeRegionInLevel.x0,m=r.y0/2-e.relativeRegionInLevel.y0,f=t.items,h,i,x,y,l,u;for(h=0;h<d;h+=2)for(y=h*c,x=g+m*p+p*h/2,i=0;i<c;i+=2,x++,y+=2)f[y]=o[x];o=e.items=null;var E=4,I=new Float32Array(c+2*E);if(1!=c)for(u=0,x=0;u<d;u++,x+=c)I.set(f.subarray(x,x+c),E),this.extend(I,E,c),this.filter(I,E,c),f.set(I.subarray(E,E+c),x);else if(0!=(1&n))for(u=0,x=0;u<d;u++,x+=c)f[x]*=0.5;var C=16,P=[];for(h=0;h<C;h++)P.push(new Float32Array(d+2*E));var T=0,S;if(e=E+d,1!=d)for(l=0;l<c;l++){if(0==T){for(C=a(c-l,C),x=l,y=E;y<e;x+=c,y++)for(S=0;S<C;S++)P[S][y]=f[x+S];T=C}T--;var b=P[T];if(this.extend(b,E,d),this.filter(b,E,d),0===T)for(x=l-C+1,y=E;y<e;x+=c,y++)for(S=0;S<C;S++)f[x+S]=P[S][y]}else if(0!=(1&s))for(l=0;l<c;l++)f[l]*=0.5;return{relativeRegionInLevel:r,width:c,height:d,items:f}},e}(),A=function(){function e(){D.call(this)}return e.prototype=Object.create(D.prototype),e.prototype.filter=function(e,t,s){var i=s>>1;t|=0;var a=-1.586134342059924,r=-0.052980118572961,o=0.882911075530934,l=0.443506852043971,c=1.230174104914001,d,p,n,u;for(d=t-3,p=i+4;p--;d+=2)e[d]*=1/c;for(d=t-2,n=l*e[d-1],p=i+3;p--&&(u=l*e[d+1],e[d]=c*e[d]-n-u,p--);d+=2)d+=2,n=l*e[d+1],e[d]=c*e[d]-n-u;for(d=t-1,n=o*e[d-1],p=i+2;p--&&(u=o*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=o*e[d+1],e[d]-=n+u;for(d=t,n=r*e[d-1],p=i+1;p--&&(u=r*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=r*e[d+1],e[d]-=n+u;if(0!=i)for(d=t+1,n=a*e[d-1],p=i;p--&&(u=a*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=a*e[d+1],e[d]-=n+u},e}(),N=function(){function e(){D.call(this)}return e.prototype=Object.create(D.prototype),e.prototype.filter=function(e,t,s){var i=s>>1;t|=0;var a,r;for(a=t,r=i+1;r--;a+=2)e[a]-=e[a-1]+e[a+1]+2>>2;for(a=t+1,r=i;r--;a+=2)e[a]+=e[a-1]+e[a+1]>>1},e}();return e}();t.JpxImage=c},function(e,t,n){'use strict';var s=String.fromCharCode,i=Math.max,a=Math.min;(function(e){function n(e){I>=E.warnings&&console.log('Warning: '+e)}function r(e){throw new Error(e)}function o(e,t){e||r(t)}function l(e){if(!e)return!1;switch(e.protocol){case'http:':case'https:':case'ftp:':case'mailto:':case'tel:':return!0;default:return!1;}}function c(e){o('string'==typeof e,'Invalid argument for stringToBytes');for(var t=e.length,n=new Uint8Array(t),s=0;s<t;++s)n[s]=255&e.charCodeAt(s);return n}function d(e){return void 0===e.length?(o(void 0!==e.byteLength),e.byteLength):e.length}function p(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}function u(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;return e?new Promise(function(s){s(e.apply(n,t))}):Promise.resolve(void 0)}function g(e){if('object'!==('undefined'==typeof e?'undefined':y(e)))return e;switch(e.name){case'AbortException':return new R(e.message);case'MissingPDFException':return new T(e.message);case'UnexpectedResponseException':return new S(e.message,e.status);default:return new C(e.message,e.details);}}function m(e){return!(e instanceof Error)||e instanceof R||e instanceof T||e instanceof S||e instanceof C?e:new C(e.message,e.toString())}function f(e,t,n){t?e.resolve():e.reject(n)}function h(e){return Promise.resolve(e).catch(function(){})}function x(e,t,n){var s=this;this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.postMessageTransfers=!0,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null);var i=this.callbacksCapabilities=Object.create(null),a=this.actionHandler=Object.create(null);this._onComObjOnMessage=function(e){var t=e.data;if(t.targetName===s.sourceName)if(t.stream)s._processStreamMessage(t);else if(t.isReply){var r=t.callbackId;if(t.callbackId in i){var o=i[r];delete i[r],'error'in t?o.reject(g(t.error)):o.resolve(t.data)}else throw new Error('Cannot resolve callback '+r)}else if(t.action in a){var l=a[t.action];if(t.callbackId){var c=s.sourceName,d=t.sourceName;Promise.resolve().then(function(){return l[0].call(l[1],t.data)}).then(function(e){n.postMessage({sourceName:c,targetName:d,isReply:!0,callbackId:t.callbackId,data:e})},function(e){n.postMessage({sourceName:c,targetName:d,isReply:!0,callbackId:t.callbackId,error:m(e)})})}else t.streamId?s._createStreamSink(t):l[0].call(l[1],t.data)}else throw new Error('Unknown action from worker: '+t.action)},n.addEventListener('message',this._onComObjOnMessage)}Object.defineProperty(t,'__esModule',{value:!0});var y='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},E={errors:0,warnings:1,infos:5},I=E.warnings,b=function(){function e(e,t){this.name='PasswordException',this.message=e,this.code=t}return e.prototype=new Error,e.constructor=e,e}(),C=function(){function e(e,t){this.name='UnknownErrorException',this.message=e,this.details=t}return e.prototype=new Error,e.constructor=e,e}(),P=function(){function e(e){this.name='InvalidPDFException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),T=function(){function e(e){this.name='MissingPDFException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),S=function(){function e(e,t){this.name='UnexpectedResponseException',this.message=e,this.status=t}return e.prototype=new Error,e.constructor=e,e}(),L=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name='NotImplementedException',e.constructor=e,e}(),v=function(){function e(e,t){this.begin=e,this.end=t,this.message='Missing data ['+e+', '+t+')'}return e.prototype=new Error,e.prototype.name='MissingDataException',e.constructor=e,e}(),O=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name='XRefParseException',e.constructor=e,e}(),k=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name='FormatError',e.constructor=e,e}(),R=function(){function e(e){this.name='AbortException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),D=/\x00/g,A=function(){function e(){}var t=['rgb(',0,',',0,',',0,')'];e.makeCssRgb=function(e,n,s){return t[1]=e,t[3]=n,t[5]=s,t.join('')},e.transform=function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},e.applyTransform=function(e,t){var n=e[0]*t[0]+e[1]*t[2]+t[4],s=e[0]*t[1]+e[1]*t[3]+t[5];return[n,s]},e.applyInverseTransform=function(e,t){var n=t[0]*t[3]-t[1]*t[2],s=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,i=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[s,i]},e.getAxialAlignedBoundingBox=function(t,n){var s=e.applyTransform(t,n),r=e.applyTransform(t.slice(2,4),n),o=e.applyTransform([t[0],t[3]],n),l=e.applyTransform([t[2],t[1]],n);return[a(s[0],r[0],o[0],l[0]),a(s[1],r[1],o[1],l[1]),i(s[0],r[0],o[0],l[0]),i(s[1],r[1],o[1],l[1])]},e.inverseTransform=function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]},e.apply3dTransform=function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]},e.singularValueDecompose2dScale=function(e){var t=Math.sqrt,n=[e[0],e[2],e[1],e[3]],s=e[0]*n[0]+e[1]*n[2],i=e[0]*n[1]+e[1]*n[3],a=e[2]*n[0]+e[3]*n[2],r=e[2]*n[1]+e[3]*n[3],o=(s+r)/2,l=t((s+r)*(s+r)-4*(s*r-a*i))/2;return[t(o+l||1),t(o-l||1)]},e.normalizeRect=function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t},e.intersect=function(t,n){function s(e,t){return e-t}var i=[t[0],t[2],n[0],n[2]].sort(s),a=[t[1],t[3],n[1],n[3]].sort(s),r=[];if(t=e.normalizeRect(t),n=e.normalizeRect(n),i[0]===t[0]&&i[1]===n[0]||i[0]===n[0]&&i[1]===t[0])r[0]=i[1],r[2]=i[2];else return!1;if(a[0]===t[1]&&a[1]===n[1]||a[0]===n[1]&&a[1]===t[1])r[1]=a[1],r[3]=a[2];else return!1;return r};var n=['','C','CC','CCC','CD','D','DC','DCC','DCCC','CM','','X','XX','XXX','XL','L','LX','LXX','LXXX','XC','','I','II','III','IV','V','VI','VII','VIII','IX'];return e.toRoman=function(e,t){o(Number.isInteger(e)&&0<e,'The number should be a positive integer.');for(var s=[],i;1e3<=e;)e-=1e3,s.push('M');i=0|e/100,e%=100,s.push(n[i]),i=0|e/10,e%=10,s.push(n[10+i]),s.push(n[20+e]);var a=s.join('');return t?a.toLowerCase():a},e.appendToArray=function(e,t){Array.prototype.push.apply(e,t)},e.prependToArray=function(e,t){Array.prototype.unshift.apply(e,t)},e.extendObj=function(e,t){for(var n in t)e[n]=t[n]},e.getInheritableProperty=function(e,t,n){for(;e&&!e.has(t);)e=e.get('Parent');return e?n?e.getArray(t):e.get(t):null},e.inherit=function(e,t,n){for(var s in e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n)e.prototype[s]=n[s]},e.loadScript=function(e,t){var n=document.createElement('script'),s=!1;n.setAttribute('src',e),t&&(n.onload=function(){s||t(),s=!0}),document.getElementsByTagName('head')[0].appendChild(n)},e}(),j=function(){function e(e,t,n,s,i,a){var r=Math.abs;this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=s,this.offsetY=i;var o=(e[2]+e[0])/2,l=(e[3]+e[1])/2,c,d,p,u;switch(n%=360,n=0>n?n+360:n,n){case 180:c=-1,d=0,p=0,u=1;break;case 90:c=0,d=1,p=1,u=0;break;case 270:c=0,d=-1,p=-1,u=0;break;default:c=1,d=0,p=0,u=-1;}a&&(p=-p,u=-u);var g,m,f,h;0===c?(g=r(l-e[1])*t+s,m=r(o-e[0])*t+i,f=r(e[3]-e[1])*t,h=r(e[2]-e[0])*t):(g=r(o-e[0])*t+s,m=r(l-e[1])*t+i,f=r(e[2]-e[0])*t,h=r(e[3]-e[1])*t),this.transform=[c*t,d*t,p*t,u*t,g-c*t*o-p*t*l,m-d*t*o-u*t*l],this.width=f,this.height=h,this.fontScale=t}return e.prototype={clone:function(t){t=t||{};var n='scale'in t?t.scale:this.scale,s='rotation'in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),n,s,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return A.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=A.applyTransform([e[0],e[1]],this.transform),n=A.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]},convertToPdfPoint:function(e,t){return A.applyInverseTransform([e,t],this.transform)}},e}(),N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364],_=function(e,t){if('undefined'!=typeof Blob)return new Blob([e],{type:t});throw new Error('The "Blob" constructor is not supported.')},F=function(){var e='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';return function(t,n){var s=2<arguments.length&&arguments[2]!==void 0&&arguments[2];if(!s&&URL.createObjectURL){var a=_(t,n);return URL.createObjectURL(a)}for(var r='data:'+n+';base64,',o=0,i=t.length;o<i;o+=3){var l=255&t[o],c=255&t[o+1],d=255&t[o+2],p=o+1<i?(15&c)<<2|d>>6:64,u=o+2<i?63&d:64;r+=e[l>>2]+e[(3&l)<<4|c>>4]+e[p]+e[u]}return r}}();x.prototype={on:function(e,t,n){var s=this.actionHandler;if(s[e])throw new Error('There is already an actionName called "'+e+'"');s[e]=[t,n]},send:function(e,t,n){var s={sourceName:this.sourceName,targetName:this.targetName,action:e,data:t};this.postMessage(s,n)},sendWithPromise:function(e,t,n){var s=this.callbackId++,i={sourceName:this.sourceName,targetName:this.targetName,action:e,data:t,callbackId:s},a=p();this.callbacksCapabilities[s]=a;try{this.postMessage(i,n)}catch(t){a.reject(t)}return a.promise},sendWithStream:function(e,t,n){var s=this,i=this.streamId++,a=this.sourceName,r=this.targetName;return new ReadableStream({start:function(n){var o=p();return s.streamControllers[i]={controller:n,startCall:o,isClosed:!1},s.postMessage({sourceName:a,targetName:r,action:e,streamId:i,data:t,desiredSize:n.desiredSize}),o.promise},pull:function(e){var t=p();return s.streamControllers[i].pullCall=t,s.postMessage({sourceName:a,targetName:r,stream:'pull',streamId:i,desiredSize:e.desiredSize}),t.promise},cancel:function(e){var t=p();return s.streamControllers[i].cancelCall=t,s.streamControllers[i].isClosed=!0,s.postMessage({sourceName:a,targetName:r,stream:'cancel',reason:e,streamId:i}),t.promise}},n)},_createStreamSink:function(e){var t=this,n=this,s=this.actionHandler[e.action],i=e.streamId,a=e.desiredSize,r=this.sourceName,o=e.sourceName,l=p(),c=function(e){var n=e.stream,s=e.chunk,a=e.transfers,l=e.success,c=e.reason;t.postMessage({sourceName:r,targetName:o,stream:n,streamId:i,chunk:s,success:l,reason:c},a)},d={enqueue:function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=arguments[2];if(!this.isCancelled){var s=this.desiredSize;this.desiredSize-=t,0<s&&0>=this.desiredSize&&(this.sinkCapability=p(),this.ready=this.sinkCapability.promise),c({stream:'enqueue',chunk:e,transfers:n})}},close:function(){this.isCancelled||(this.isCancelled=!0,c({stream:'close'}),delete n.streamSinks[i])},error:function(e){this.isCancelled||(this.isCancelled=!0,c({stream:'error',reason:e}))},sinkCapability:l,onPull:null,onCancel:null,isCancelled:!1,desiredSize:a,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[i]=d,u(s[0],[e.data,d],s[1]).then(function(){c({stream:'start_complete',success:!0})},function(e){c({stream:'start_complete',success:!1,reason:e})})},_processStreamMessage:function(e){var t=this,n=this.sourceName,s=e.sourceName,i=e.streamId,a=function(e){var a=e.stream,r=e.success,o=e.reason;t.comObj.postMessage({sourceName:n,targetName:s,stream:a,success:r,streamId:i,reason:o})},r=function(){Promise.all([t.streamControllers[e.streamId].startCall,t.streamControllers[e.streamId].pullCall,t.streamControllers[e.streamId].cancelCall].map(function(e){return e&&h(e.promise)})).then(function(){delete t.streamControllers[e.streamId]})};switch(e.stream){case'start_complete':f(this.streamControllers[e.streamId].startCall,e.success,g(e.reason));break;case'pull_complete':f(this.streamControllers[e.streamId].pullCall,e.success,g(e.reason));break;case'pull':if(!this.streamSinks[e.streamId]){a({stream:'pull_complete',success:!0});break}0>=this.streamSinks[e.streamId].desiredSize&&0<e.desiredSize&&this.streamSinks[e.streamId].sinkCapability.resolve(),this.streamSinks[e.streamId].desiredSize=e.desiredSize,u(this.streamSinks[e.streamId].onPull).then(function(){a({stream:'pull_complete',success:!0})},function(e){a({stream:'pull_complete',success:!1,reason:e})});break;case'enqueue':o(this.streamControllers[e.streamId],'enqueue should have stream controller'),this.streamControllers[e.streamId].isClosed||this.streamControllers[e.streamId].controller.enqueue(e.chunk);break;case'close':if(o(this.streamControllers[e.streamId],'close should have stream controller'),this.streamControllers[e.streamId].isClosed)break;this.streamControllers[e.streamId].isClosed=!0,this.streamControllers[e.streamId].controller.close(),r();break;case'error':o(this.streamControllers[e.streamId],'error should have stream controller'),this.streamControllers[e.streamId].controller.error(g(e.reason)),r();break;case'cancel_complete':f(this.streamControllers[e.streamId].cancelCall,e.success,g(e.reason)),r();break;case'cancel':if(!this.streamSinks[e.streamId])break;u(this.streamSinks[e.streamId].onCancel,[g(e.reason)]).then(function(){a({stream:'cancel_complete',success:!0})},function(e){a({stream:'cancel_complete',success:!1,reason:e})}),this.streamSinks[e.streamId].sinkCapability.reject(g(e.reason)),this.streamSinks[e.streamId].isCancelled=!0,delete this.streamSinks[e.streamId];break;default:throw new Error('Unexpected stream case');}},postMessage:function(e,t){t&&this.postMessageTransfers?this.comObj.postMessage(e,t):this.comObj.postMessage(e)},destroy:function(){this.comObj.removeEventListener('message',this._onComObjOnMessage)}},t.FONT_IDENTITY_MATRIX=[0.001,0,0,0.001,0,0],t.IDENTITY_MATRIX=[1,0,0,1,0,0],t.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},t.VERBOSITY_LEVELS=E,t.UNSUPPORTED_FEATURES={unknown:'unknown',forms:'forms',javaScript:'javaScript',smask:'smask',shadingPattern:'shadingPattern',font:'font'},t.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},t.AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},t.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},t.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t.FontType={UNKNOWN:0,TYPE1:1,TYPE1C:2,CIDFONTTYPE0:3,CIDFONTTYPE0C:4,TRUETYPE:5,CIDFONTTYPE2:6,TYPE3:7,OPENTYPE:8,TYPE0:9,MMTYPE1:10},t.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},t.CMapCompressionType={NONE:0,BINARY:1,STREAM:2},t.AbortException=R,t.InvalidPDFException=P,t.MessageHandler=x,t.MissingDataException=v,t.MissingPDFException=T,t.NativeImageDecoding={NONE:'none',DECODE:'decode',DISPLAY:'display'},t.NotImplementedException=L,t.PageViewport=j,t.PasswordException=b,t.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},t.StreamType={UNKNOWN:0,FLATE:1,LZW:2,DCT:3,JPX:4,JBIG:5,A85:6,AHX:7,CCF:8,RL:9},t.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},t.UnexpectedResponseException=S,t.UnknownErrorException=C,t.Util=A,t.XRefParseException=O,t.FormatError=k,t.arrayByteLength=d,t.arraysToBytes=function(e){if(1===e.length&&e[0]instanceof Uint8Array)return e[0];var t=0,n=e.length,s,i,a;for(s=0;s<n;s++)i=e[s],a=d(i),t+=a;var r=0,o=new Uint8Array(t);for(s=0;s<n;s++)i=e[s],i instanceof Uint8Array||('string'==typeof i?i=c(i):i=new Uint8Array(i)),a=i.byteLength,o.set(i,r),r+=a;return o},t.assert=o,t.bytesToString=function(e){o(null!==e&&'object'===('undefined'==typeof e?'undefined':y(e))&&e.length!==void 0,'Invalid argument for bytesToString');var t=e.length,n=8192;if(t<n)return s.apply(null,e);for(var r=[],l=0;l<t;l+=n){var i=a(l+n,t),c=e.subarray(l,i);r.push(s.apply(null,c))}return r.join('')},t.createBlob=_,t.createPromiseCapability=p,t.createObjectURL=F,t.deprecated=function(e){console.log('Deprecated API usage: '+e)},t.getLookupTableFactory=function(e){var t;return function(){return e&&(t=Object.create(null),e(t),e=null),t}},t.getVerbosityLevel=function(){return I},t.info=function(e){I>=E.infos&&console.log('Info: '+e)},t.isArrayBuffer=function(e){return'object'===('undefined'==typeof e?'undefined':y(e))&&null!==e&&e.byteLength!==void 0},t.isBool=function(e){return'boolean'==typeof e},t.isEmptyObj=function(e){for(var t in e)return!1;return!0},t.isNum=function(e){return'number'==typeof e},t.isString=function(e){return'string'==typeof e},t.isSpace=function(e){return 32===e||9===e||13===e||10===e},t.isNodeJS=function(){return'object'===('undefined'==typeof e?'undefined':y(e))&&e+'[object process]'},t.isSameOrigin=function(e,t){try{var n=new URL(e);if(!n.origin||'null'===n.origin)return!1}catch(t){return!1}var s=new URL(t,n);return n.origin===s.origin},t.createValidAbsoluteUrl=function(e,t){if(!e)return null;try{var n=t?new URL(e,t):new URL(e);if(l(n))return n}catch(e){}return null},t.isLittleEndian=function(){var e=new Uint8Array(4);e[0]=1;var t=new Uint32Array(e.buffer,0,1);return 1===t[0]},t.isEvalSupported=function(){try{return new Function(''),!0}catch(t){return!1}},t.loadJpegStream=function(e,t,s){var i=new Image;i.onload=function(){s.resolve(e,i)},i.onerror=function(){s.resolve(e,null),n('Error during JPEG image loading')},i.src=t},t.log2=function(e){return 0>=e?0:Math.ceil(Math.log2(e))},t.readInt8=function(e,t){return e[t]<<24>>24},t.readUint16=function(e,t){return e[t]<<8|e[t+1]},t.readUint32=function(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0},t.removeNullCharacters=function(e){return'string'==typeof e?e.replace(D,''):(n('The argument for removeNullCharacters must be a string.'),e)},t.ReadableStream=ReadableStream,t.setVerbosityLevel=function(e){I=e},t.shadow=function(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n},t.string32=function(e){return s(255&e>>24,255&e>>16,255&e>>8,255&e)},t.stringToBytes=c,t.stringToPDFString=function(e){var t=e.length,n=[],a;if('\xFE'===e[0]&&'\xFF'===e[1])for(a=2;a<t;a+=2)n.push(s(e.charCodeAt(a)<<8|e.charCodeAt(a+1)));else for(a=0;a<t;++a){var i=N[e.charCodeAt(a)];n.push(i?s(i):e.charAt(a))}return n.join('')},t.stringToUTF8String=function(e){return decodeURIComponent(escape(e))},t.utf8StringToString=function(e){return unescape(encodeURIComponent(e))},t.warn=n,t.unreachable=r}).call(t,n(41))},function(e){function t(){throw new Error('setTimeout has not been defined')}function n(){throw new Error('clearTimeout has not been defined')}function s(e){if(d===setTimeout)return setTimeout(e,0);if((d===t||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function i(e){if(p===clearTimeout)return clearTimeout(e);if((p===n||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function a(){g&&f&&(g=!1,f.length?u=f.concat(u):m=-1,u.length&&r())}function r(){if(!g){var e=s(a);g=!0;for(var t=u.length;t;){for(f=u,u=[];++m<t;)f&&f[m].run();m=-1,t=u.length}f=null,g=!1,i(e)}}function o(e,t){this.fun=e,this.array=t}function l(){}var c=e.exports={},d,p;(function(){try{d='function'==typeof setTimeout?setTimeout:t}catch(n){d=t}try{p='function'==typeof clearTimeout?clearTimeout:n}catch(t){p=n}})();var u=[],g=!1,m=-1,f;c.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new o(e,t)),1!==u.length||g||s(r)},o.prototype.run=function(){this.fun.apply(null,this.array)},c.title='browser',c.browser=!0,c.env={},c.argv=[],c.version='',c.versions={},c.on=l,c.addListener=l,c.once=l,c.off=l,c.removeListener=l,c.removeAllListeners=l,c.emit=l,c.prependListener=l,c.prependOnceListener=l,c.listeners=function(){return[]},c.binding=function(){throw new Error('process.binding is not supported')},c.cwd=function(){return'/'},c.chdir=function(){throw new Error('process.chdir is not supported')},c.umask=function(){return 0}},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var n=function(){function e(e,t,n){this.data=e,this.bp=t,this.dataEnd=n,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=65535&this.chigh<<7|127&this.clow>>9,this.clow=65535&this.clow<<7,this.ct-=7,this.a=32768}var t=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];return e.prototype={byteIn:function(){var e=this.data,t=this.bp;if(255===e[t]){var n=e[t+1];143<n?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t)}else t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t;65535<this.clow&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(e,n){var s=e[n]>>1,i=1&e[n],r=t[s],o=r.qe,l=this.a-o,a;if(this.chigh<o)l<o?(l=o,a=i,s=r.nmps):(l=o,a=1^i,1===r.switchFlag&&(i=a),s=r.nlps);else{if(this.chigh-=o,0!=(32768&l))return this.a=l,i;l<o?(a=1^i,1===r.switchFlag&&(i=a),s=r.nlps):(a=i,s=r.nmps)}do 0===this.ct&&this.byteIn(),l<<=1,this.chigh=65535&this.chigh<<1|1&this.clow>>15,this.clow=65535&this.clow<<1,this.ct--;while(0==(32768&l));return this.a=l,e[n]=s<<1|i,a}},e}();t.ArithmeticDecoder=n}]);