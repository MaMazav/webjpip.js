var webjpip=function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=2)}([function(e){'use strict';e.exports.j2kMarkers={StartOfCodestream:[255,79],ImageAndTileSize:[255,81],CodingStyleDefault:[255,82],CodingStyleComponent:[255,83],QuantizationDefault:[255,92],ProgressionOrderChange:[255,95],PackedPacketHeadersInMainHeader:[255,96],PackedPacketHeadersInTileHeader:[255,97],StartOfTile:[255,144],StartOfData:[255,147],EndOfCodestream:[255,217],Comment:[255,100]},e.exports.j2kOffsets={MARKER_SIZE:2,LENGTH_FIELD_SIZE:2,NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER:38,REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER:6},e.exports.jpipEndOfResponseReasons={IMAGE_DONE:1,WINDOW_DONE:2,WINDOW_CHANGE:3,BYTE_LIMIT:4,QUALITY_LIMIT:5,SESSION_LIMIT:6,RESPONSE_LIMIT:7,NON_SPECIFIED:8},e.exports.j2kExceptions={UnsupportedFeatureException:function(e,t){return this.description=e+' (specified in section '+t+' of part 1: Core Coding System standard) is not supported yet',this.toString=function(){return'J2k UnsupportedFeatureException: '+this.description},this},ParseException:function(e){return this.description=e,this.toString=function(){return'J2k ParseException: '+this.description},this},IllegalDataException:function(e,t){return this.description=e+' (see section '+t+' of part 9: Interactivity tools, APIs and Protocols)',this.toString=function(){return'J2k IllegalDataException: '+this.description},this}},e.exports.jpipExceptions={UnsupportedFeatureException:function(e,t){return this.description=e+' (specified in section '+t+' of part 9: Interactivity tools, APIs and Protocols) is not supported yet',this.toString=function(){return'Jpip UnsupportedFeatureException: '+this.description},this},ParseException:function(e){return this.description=e,this.toString=function(){return'Jpip ParseException: '+this.description},this},IllegalDataException:function(e,t){return this.description=e+' (see section '+t+' of part 9: Interactivity tools, APIs and Protocols)',this.toString=function(){return'Jpip IllegalDataException: '+this.description},this},IllegalOperationException:function(e){return this.description=e,this.toString=function(){return'Jpip IllegalOperationException: '+this.description},this},ArgumentException:function(e,t,n){return this.description='Argument '+e+' has invalid value '+t+(void 0===n?'':' :'+n),this.toString=function(){return'Jpip ArgumentException: '+this.description},this},WrongStreamException:function(e,t){var n='JPP (JPIP Precinct)',i='JPT (JPIP Tile-part)';if(t){var s=n;n=i,i=s}return this.description='Stream type is '+i+', but '+e+' is allowed only in '+n+' stream',this.toString=function(){return'Jpip WrongStreamException: '+this.description},this},InternalErrorException:function(e){return this.description=e,this.toString=function(){return'Jpip InternalErrorException: '+this.description},this}},e.exports.j2kExceptions.UnsupportedFeatureException.Name='j2kExceptions.UnsupportedFeatureException',e.exports.j2kExceptions.ParseException.Name='j2kExceptions.ParseException',e.exports.j2kExceptions.IllegalDataException.Name='j2kExceptions.IllegalDataException',e.exports.jpipExceptions.UnsupportedFeatureException.Name='jpipExceptions.UnsupportedFeatureException',e.exports.jpipExceptions.ParseException.Name='jpipExceptions.ParseException',e.exports.jpipExceptions.IllegalDataException.Name='jpipExceptions.IllegalDataException',e.exports.jpipExceptions.IllegalOperationException.Name='jpipExceptions.IllegalOperationException',e.exports.jpipExceptions.ArgumentException.Name='jpipExceptions.ArgumentException',e.exports.jpipExceptions.WrongStreamException.Name='jpipExceptions.WrongStreamException',e.exports.jpipExceptions.InternalErrorException.Name='jpipExceptions.InternalErrorException'},function(e,t,n){'use strict';var i=n(4),s=n(5),r=n(6),a=n(7),o=n(8),l=n(9),c=n(10),d=n(11),p=n(12),u=n(13),g=n(14),m=n(15),f=n(16),x=n(17),h=n(18),y=n(19),I=n(20),E=n(21),b=n(22),C=n(23),P=n(24),T=n(25),S=n(26),L=n(27),v=n(28),O=n(29),k=n(30),R=n(31),D=n(32),_=n(33),A=n(34),N=n(35),j=n(36),M=n(37),F=n(38),B={createChannel:function(e,t){return new o(e,t,B)},createCodestreamReconstructor:function(e,t,n){return new l(e,t,n)},createLevelCalculator:function(e){return new h(e)},createCodestreamStructure:function(e,t){return new c(e,B,t)},createComponentStructure:function(e,t){return new d(e,t)},createCompositeArray:function(e){return new p(e)},createDatabinParts:function(e,t){return new u(e,t,B)},createDatabinsSaver:function(e){return new g(e,B)},createFetcher:function(e,t){return w||(w=n(39)),new w(e,t)},createFetch:function(e,t,n){return new m(e,t,n)},createHeaderModifier:function(e,t){return new f(e,t)},createImageDataContext:function(e,t,n){return new x(e,t,n)},createMarkersParser:function(e){return new y(e,a,B)},createObjectPoolByDatabin:function(){return new I},createOffsetsCalculator:function(e,t){return new E(e,t)},createPacketsDataCollector:function(e,t){return new b(e,t,B)},createParamsCodestreamPart:function(e,t){return new C(e,t,B)},createJpipParamsPrecinctIterator:function(e,t,n,i){return new P(e,t,n,i)},createRequestDatabinsListener:function(e,t,n,i,s){return new T(e,t,n,i,s,B)},createRequestParamsModifier:function(e){return new S(e)},createRequest:function(e,t,n,i,s){return new L(e,a,t,n,i,s)},createSessionHelper:function(e,t,n,s){return new v(e,t,n,s,i)},createSession:function(e,t,n,i,s){return new O(e,t,n,i,s,setInterval,clearInterval,B)},createReconnectableRequester:function(e,t,n,i){return new k(e,t,n,i,B)},createStructureParser:function(e,t,n){return new R(e,t,a,n)},createTileStructure:function(e,t,n){return new D(e,t,B,n)},createBitstreamReader:function(e){return new _(e,s)},createTagTree:function(e,t,n){return new A(e,t,n,s)},createCodeblockLengthParser:function(e){return new N(e,s)},createSubbandLengthInPacketHeaderCalculator:function(e,t,n){return new j(e,t,n,r,s,B)},createPacketLengthCalculator:function(e,t,n,i,s){return new M(e,t,n,i,s,B)},createQualityLayersCache:function(e){return new F(e,B)}},w;e.exports=B},function(e,t,n){'use strict';var i=n(0);e.exports.JpipImage=n(3),e.exports.PdfjsJpxDecoder=n(40),e.exports.j2kExceptions=i.j2kExceptions,e.exports.jpipExceptions=i.jpipExceptions,e.exports.Internals={jpipRuntimeFactory:n(1),jGlobals:i}},function(e,t,n){'use strict';function i(e){var t=e.stack.trim(),n=r.exec(t);if(n&&''!==n[2])return n[2];if(n=a.exec(t),n&&''!==n[1])return n[1];if(n=o.exec(t),n&&''!==n[1])return n[1];if(void 0!==e.fileName)return e.fileName;throw'webjpip.js: Could not get current script URL'}var s=n(1);e.exports=function(e){var t=s.createDatabinsSaver(!1),n=t.getMainHeaderDatabin(),r=s.createMarkersParser(n),a=s.createOffsetsCalculator(n,r),o=s.createStructureParser(t,r,a),l='RPCL',c=s.createCodestreamStructure(o,l),d=s.createQualityLayersCache(c),p=s.createHeaderModifier(a,l),u=s.createCodestreamReconstructor(t,p,d),g=s.createPacketsDataCollector(t,d),m={reconstructor:u,packetsDataCollector:g,qualityLayersCache:d,codestreamStructure:c,databinsSaver:t,jpipFactory:s},f=s.createRequestParamsModifier(c),x=null,h=null,y=s.createFetcher(t,e);this.opened=function(e){x=e.getImageParams()},this.getLevelCalculator=function(){return null==h&&(h=s.createLevelCalculator(x)),h},this.getDecoderWorkersInputRetreiver=function(){return this},this.getFetcher=function(){return y},this.getWorkerTypeOptions=function(){return{ctorName:'webjpip.PdfjsJpxDecoder',ctorArgs:[],scriptsToImport:[i(new Error)],transferables:[[0,'headersCodestream','codestream','buffer'],[0,'codeblocksData','data','buffer']],pathToTransferablesInPromiseResult:[[]]}},this.getKeyAsString=function(e){return JSON.stringify(e)},this.taskStarted=function(e){function t(t){if(r!==t)throw'webjpip error: Unexpected context in data event';var n=r.getFetchedData();e.dataReady(n),r.isDone()&&(e.terminate(),r.dispose())}var n=f.modify(e.key),i=s.createParamsCodestreamPart(n.codestreamPartParams,c),r=s.createImageDataContext(m,i,n.progressiveness);r.on('data',t),r.hasData()&&t(r)}};var r=/at (|[^ ]+ \()([^ ]+):\d+:\d+/,a=new RegExp(/.+@(.*?):\d+:\d+/),o=new RegExp(/.+\/(.*?):\d+(:\d+)*$/)},function(e,t,n){'use strict';var i=n(0);e.exports={request:function(e,t,n,s){function r(){if(!l){if(4!==a.readyState){if(void 0===s||null===a.response||3>a.readyState)return;var e=a.response.byteLength,i=e-c;if(i<s)return;c=e}else if(l=!0,200!==a.status||null===a.response)return void n(a);o||t(a,l)}}var a=new XMLHttpRequest,o=void 0===t,l=!1,c=0;if(a.open('GET',e,!o),a.onreadystatechange=r,o||(a.mozResponseType=a.responseType='arraybuffer'),void 0!==s&&(a.setRequestHeader('X-Content-Type-Options','nosniff'),a.onprogress=r),a.send(null),o&&!l)throw new i.jpipExceptions.InternalErrorException('synchronous ajax call was not finished synchronously');return a}}},function(e,t,n){'use strict';var i=n(0);e.exports={createTransaction:function(){function e(e){if(!n.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot terminate an already terminated transaction');t=e?2:3}var t=1,n={get isAborted(){return 3==t},get isActive(){return 1==t},commit:function(){e(!0)},abort:function(){e(!1)}};return n},createTransactionalObject:function(e,t){function n(e){if(!e.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot use terminated transaction to access objects');if(e!==a&&a.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot simultanously access transactional object from two active transactions')}var s=null,r=e,a={isActive:!1,isAborted:!0},o=t?function(e){return e}:function(e){var t=JSON.parse(JSON.stringify(e));return t};return{getValue:function(e){return(n(e),a===e)?s:(a.isAborted?s=o(r):r=o(s),a=e,s)},setValue:function(e,t){return n(e),a===e?void(s=t):void(!a.isAborted&&(r=o(s)),a=e,s=t)}}}}},function(e){'use strict';e.exports=function(){var e=function(){var e=Array(17);return e[0]=0,e[1]=0,e[2]=1,e[3]=0,e[4]=4,e[5]=3,e[6]=2,e[7]=1,e[8]=0,e[9]=6,e[10]=5,e[11]=4,e[12]=3,e[13]=2,e[14]=1,e[15]=0,e[16]=0,e}(),t=function(){var e=Array(17);return e[0]=1,e[1]=2,e[2]=3,e[3]=5,e[4]=6,e[5]=22,e[6]=30,e[7]=34,e[8]=36,e[9]=37,e[10]=101,e[11]=133,e[12]=149,e[13]=157,e[14]=161,e[15]=163,e[16]=164,e}();return{parse:function(n){var i=n.countOnesAndShiftUntilFirstZeroBit(16);if(null===i)return null;var s=e[i],r=n.shiftBits(s);if(null===r)return null;var a=t[i];return r+a}}}()},function(e,t,n){'use strict';var i=n(0),s={LSB_MASK:1,BIT_4_MASK:16,BITS_56_MASK:96,MSB_MASK:128,LSB_7_MASK:127,parseNumberInVbas:function(e,t,n){var i=s,r=t,a;if(n){a=e[r]&(1<<n)-1}else a=e[r]&i.LSB_7_MASK;for(;!!(e[r]&i.MSB_MASK);)++r,a<<=7,a|=e[r]&i.LSB_7_MASK;return{endOffset:r+1,number:a}},parseMessageHeader:function(e,t,n){var r=s,a=(e[t]&r.BITS_56_MASK)>>>5;if(0==a)throw new i.jpipExceptions.ParseException('Failed parsing message header (A.2.1): prohibited existance class and csn bits 00');var o=!!(e[t]&r.BIT_4_MASK),l=r.parseNumberInVbas(e,t,4),c=l.number,d=l.endOffset,p=0;if(!!(2&a)){var u=r.parseNumberInVbas(e,d);p=u.number,d=u.endOffset}else n&&(p=n.classId);var g=0;if(3==a){var m=r.parseNumberInVbas(e,d);g=m.number,d=m.endOffset}else n&&(g=n.codestreamIndex);var f=r.parseNumberInVbas(e,d),x=f.number;d=f.endOffset;var h=r.parseNumberInVbas(e,d),y=h.number;d=h.endOffset;var I=!!(p&r.LSB_MASK),E;if(I){var b=r.parseNumberInVbas(e,d);E=b.number,d=b.endOffset}var C={isLastByteInDatabin:o,inClassId:c,bodyStart:d,classId:p,codestreamIndex:g,messageOffsetFromDatabinStart:x,messageBodyLength:y};return I&&(C.aux=E),C},getInt32:function(e,t){var n=16777216*e[t],i=e[t+1]<<16,s=e[t+2]<<8,r=e[t+3];return n+i+s+r},getInt16:function(e,t){var n=e[t]<<8,i=e[t+1];return n+i}};e.exports=s},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n){function i(){var e=p.length+d.length;return e}function r(e){var n=t.getDataRequestUrl(),i=t.getTargetId();'0'!==i&&(n+='&tid='+i);var s=null!==l;if(s){var r=u&&e;n+=r?'&wait=no':'&wait=yes'}return n}function a(e,n){var i=r(!0),s=t.getCodestreamStructure(),a=s.getLevelWidth(e.level),o=s.getLevelHeight(e.level),l=e.maxXExclusive-e.minX,c=e.maxYExclusive-e.minY;return i+='&fsiz='+a+','+o+',closest&rsiz='+l+','+c+'&roff='+e.minX+','+e.minY,'max'!==n&&(i+='&layers='+n),i}var o=this,l=null,c=0,d=[],p=[],u=!1;this.requestData=function(r,c,g,m){if(!u){var f=i();if(f>=e)throw new s.jpipExceptions.InternalErrorException('Channel has too many requests not responded yet')}var x=a(r,m),h=n.createRequest(t,o,x,c,g);return null!=l||0===p.length?(p.push(h),h.startRequest()):u?d=[h]:d.push(h),h},this.sendMinimalRequest=function(e){if(null==l&&0<p.length)throw new s.jpipExceptions.InternalErrorException('Minimal requests should be used for first request or keep alive message. Keep alive requires an already initialized channel, and first request requires to not have any previous request');var i=r(),a=n.createRequest(t,o,i,e);p.push(a),a.startRequest()},this.getIsDedicatedForMovableRequest=function(){return u},this.dedicateForMovableRequest=function(){if(u)throw new s.jpipExceptions.InternalErrorException('Channel already dedicated for movable request');u=!0},this.getChannelId=function(){return l},this.setChannelId=function(e){if(null!==e){l=e;var t=d;d=[];for(var n=0;n<t.length;++n)p.push(t[n]),t[n].startRequest()}},this.nextRequestId=function(){return++c},this.getRequestsWaitingForResponse=function(){return p},this.getAllQueuedRequestCount=i,this.requestEnded=function(e,n){for(var r=p,a=!1,c=0;c<r.length;++c)if(r[c]===n){r[c]=r[r.length-1],r.length-=1,a=!0;break}if(!a)throw new s.jpipExceptions.InternalErrorException('channel.requestsWaitingForResponse inconsistency');if(t.requestEnded(e,o),null===l&&0<d.length){var i=d.shift();p.push(i),i.startRequest()}},this.isAllOldRequestsEnded=function(e){for(var t=0;t<p.length;++t)if(p[t].lastRequestId<=e)return!1;return!0}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function s(e,n,s){var o=r(e,n.level);if(null===o)return null;for(var l=0,c=n.getTileIterator();c.tryAdvance();){var p=c.tileIndex,u=a(e,o,l++,c,n.level,n.minNumQualityLayers,n.maxNumQualityLayers,s);if(o+=u,null===u)return null}var g=d(e,o,i.j2kMarkers.EndOfCodestream);return o+=g,t.modifyImageSize(e,n.fullTilesSize),null===e?null:o}function r(n,s){if(e.getIsJpipTilePartStream())throw new i.jpipExceptions.UnsupportedFeatureException('reconstruction of codestream from JPT (Jpip Tile-part) stream','A.3.4');var r=e.getMainHeaderDatabin(),a=r.copyBytes(n,0,{forceCopyAllRange:!0});if(null===a)return null;var o=t.modifyMainOrTileHeader(n,r,0,s);return a+=o,o=c(n,a),a+=o,a}function a(n,i,s,r,a,c,d,p){var u=r.tileIndex,g=i,m=e.getTileHeaderDatabin(u),f=o(n,i,m,s,a);if(null===f)return null;if(i=f.endTileHeaderOffset,!p){var x=l(n,i,r,c,d);if(i+=x,null===x)return null}var h=i,y=h-f.startOfTileHeaderOffset;t.modifyInt32(n,f.headerAndDataLengthPlaceholderOffset,y);return h-g}function o(e,n,s,r,a){var o=n,l=d(e,n,i.j2kMarkers.StartOfTile);n+=l;l=d(e,n,[0,10]),n+=l;l=d(e,n,[r>>>8,255&r]),n+=l;var c=n;l=d(e,n,[0,0,0,0]),n+=l;l=d(e,n,[0]),n+=l;l=d(e,n,[1]),n+=l;var p=n;if(l=s.copyBytes(e,n,{forceCopyAllRange:!0}),n+=l,null===l)return null;var u=[,,],g=s.getDatabinLengthIfKnown();s.copyBytes(u,0,{databinStartOffset:g-2});var m=u[0]===i.j2kMarkers.StartOfData[0]&&u[1]===i.j2kMarkers.StartOfData[1];m||(l=d(e,n,i.j2kMarkers.StartOfData),n+=l);var f=t.modifyMainOrTileHeader(e,s,p,a);n+=f;var x={startOfTileHeaderOffset:o,headerAndDataLengthPlaceholderOffset:c,endTileHeaderOffset:n};return x}function l(t,s,r,a,o){var l=r.tileStructure.getNumQualityLayers(),c=0;'max'===a&&(a=l);for(var d=r.createPrecinctIterator(!0);d.tryAdvance();){var p=l;if(d.isInCodestreamPart){var u=e.getPrecinctDatabin(d.inClassIndex),g=n.getQualityLayerOffset(u,o,d),m=g.endOffset;if(p=l-g.numQualityLayers,g.numQualityLayers<a)return null;var f=u.copyBytes(t,s,{forceCopyAllRange:!0,maxLengthToCopy:m});null===f&&(f=0,p=l),c+=f,s+=f}if(!t.isDummyBufferForLengthCalculation)for(var x=0;x<p;++x)t[s++]=0;c+=p}return c}function c(e,t){var n=t;p(e,t++,255),p(e,t++,100),p(e,t++,0),p(e,t++,9),p(e,t++,77),p(e,t++,97),p(e,t++,109),p(e,t++,97),p(e,t++,122),p(e,t++,97),p(e,t++,118);var i=t-n;return i}function d(e,t,n){if(!e.isDummyBufferForLengthCalculation)for(var s=0;s<n.length;++s)e[s+t]=n[s];return n.length}function p(e,t,n){e.isDummyBufferForLengthCalculation||(e[t]=n)}var u={isDummyBufferForLengthCalculation:!0};this.createCodestreamForRegion=function(e,t){var n=s(u,e,t);if(null===n)return null;var r=new Uint8Array(n),a=s(r,e,t);if(a===n)return r;if(null===a)return null;throw new i.jpipExceptions.InternalErrorException('JpipCodestreamReconstructor: Unmatched actualLength '+a+' and calculatedLength '+n)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function s(e,t,n){if(0>t||t>=n)throw new i.jpipExceptions.ArgumentException(e,t,e+' is expected to be between 0 and '+n-1)}function r(t){if(!u){var n=e.parseDefaultTileParams();u=[,,,];for(var i=0;3>i;++i){u[i]=[,,,];for(var s=0,r;3>s;++s)r={horizontalEdgeType:i,verticalEdgeType:s},u[i][s]=a(n,r)}}var o=u[t.horizontalEdgeType],l=o[t.verticalEdgeType];return l}function a(e,s){o();var r=JSON.parse(JSON.stringify(e));r.tileSize=p.getTileSize(s),r.defaultComponentParams.scaleX=1,r.defaultComponentParams.scaleY=1;for(var a=0;a<r.paramsPerComponent.length;++a)r.paramsPerComponent[a].scaleX=d.componentsScaleX[a],r.paramsPerComponent[a].scaleY=d.componentsScaleY[a];var i=t.createTileStructure(r,l,n);return i}function o(){d||(d=e.parseCodestreamStructure(),p=t.createLevelCalculator(d))}var l=this,c=[],d,p,u;return this.getSizesParams=function(){return o(),d},this.getNumTilesX=function(){o();var e=p.getNumTilesX();return e},this.getNumTilesY=function(){o();var e=p.getNumTilesY();return e},this.getNumComponents=function(){return o(),d.numComponents},this.getImageWidth=function(){o();var e=p.getLevelWidth();return e},this.getImageHeight=function(){o();var e=p.getLevelHeight();return e},this.getLevelWidth=function(e){o();var t=p.getLevelWidth(e);return t},this.getLevelHeight=function(e){o();var t=p.getLevelHeight(e);return t},this.getTileWidth=function(e){o();var t=p.getTileWidth(e);return t},this.getTileHeight=function(e){o();var t=p.getTileHeight(e);return t},this.getFirstTileOffsetX=function(){o();var e=p.getFirstTileOffsetX();return e},this.getFirstTileOffsetY=function(){o();var e=p.getFirstTileOffsetY();return e},this.getTileLeft=function(e,t){o();var n=e%p.getNumTilesX();if(0==n)return 0;var i=(n-1)*p.getTileWidth(t)+p.getFirstTileWidth(t);return i},this.getTileTop=function(e,t){o();var n=Math.floor(e/p.getNumTilesX());if(0===n)return 0;var i=(n-1)*p.getTileHeight(t)+p.getFirstTileHeight(t);return i},this.getDefaultTileStructure=function(){o();var e=r({horizontalEdgeType:p.EDGE_TYPE_NO_EDGE,verticalEdgeType:p.EDGE_TYPE_NO_EDGE});return e},this.getTileStructure=function(t){o();var n=p.getNumTilesX()*p.getNumTilesY()-1;if(0>t||t>n)throw new i.jpipExceptions.ArgumentException('tileId',t,'Expected value between 0 and '+n);var s=p.isEdgeTileId(t);if(void 0===c[t]){var l=e.parseOverridenTileParams(t);c[t]=l?a(l,s):null}if(c[t])return c[t];var d=r(s);return d},this.tilePositionToInClassIndex=function(e){o();var t=p.getNumTilesX(),n=p.getNumTilesY();s('tilePosition.tileX',e.tileX,t),s('tilePosition.tileY',e.tileY,n);var i=e.tileX+e.tileY*t;return i},this.tileInClassIndexToPosition=function(e){o();var t=p.getNumTilesX(),n=p.getNumTilesY();s('inClassIndex',e,t*n);var i=e%t;return{tileX:i,tileY:(e-i)/t}},this.getTilesFromPixels=function(e){return o(),p.getTilesFromPixels(e)},this.getSizeOfTiles=function(e){o();var t=p.getSizeOfTiles(e);return t},this}},function(e,t,n){'use strict';var i=Math.ceil,s=Math.floor,r=n(0);e.exports=function(e,t){function n(e,t,n){var s=o(n),r=t[n],a=i(e/s/r);return a}function a(e,t,n,s,r){var a=o(e.resolutionLevel),l=i(r/a),c=t*s[e.resolutionLevel],d=Math.min(s[e.resolutionLevel],l-c),p=0===e.resolutionLevel?1:2,u=i(d/p),g=p*i(u/n);return 1==d%n&&0<e.resolutionLevel&&--g,g}function o(t){var n=e.numResolutionLevels-t-1;return 1<<n}var l,c;(function(){if(1!==e.scaleX||1!==e.scaleY)throw new r.j2kExceptions.UnsupportedFeatureException('Non 1 component scale','A.5.1');l=s(t.getTileWidth()/e.scaleX),c=s(t.getTileHeight()/e.scaleY)})(),this.getComponentScaleX=function(){return e.scaleX},this.getComponentScaleY=function(){return e.scaleY},this.getNumResolutionLevels=function(){return e.numResolutionLevels},this.getPrecinctWidth=function(t){var n=e.precinctWidthPerLevel[t];return n},this.getPrecinctHeight=function(t){var n=e.precinctHeightPerLevel[t];return n},this.getMaxCodeblockWidth=function(){var t=e.maxCodeblockWidth;return t},this.getMaxCodeblockHeight=function(){var t=e.maxCodeblockHeight;return t},this.getNumCodeblocksXInPrecinct=function(t){var n=a(t,t.precinctX,e.maxCodeblockWidth,e.precinctWidthPerLevel,l);return n},this.getNumCodeblocksYInPrecinct=function(t){var n=a(t,t.precinctY,e.maxCodeblockHeight,e.precinctHeightPerLevel,c);return n},this.getNumPrecinctsX=function(t){var i=n(l,e.precinctWidthPerLevel,t);return i},this.getNumPrecinctsY=function(t){var i=n(c,e.precinctHeightPerLevel,t);return i}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e){function t(t,n){if(t===void 0||n===void 0)throw new i.jpipExceptions.InternalErrorException('minOffset or maxOffset is undefined for CompositeArray.copyToArray');if(t<e)throw new i.jpipExceptions.InternalErrorException('minOffset ('+t+') must be smaller than CompositeArray offset ('+e+')');if(n>e+a)throw new i.jpipExceptions.InternalErrorException('maxOffset ('+n+') must be larger than CompositeArray end offset ('+e+a+')')}function n(t,n){var r=Math.max(e,t),o=e+a;if(void 0!==n&&(o=Math.min(o,n)),r>=o){return{internalIteratorData:{isEndOfRange:!0}}}var l={subArray:null,offset:-1,internalIteratorData:{end:o,currentSubArray:null,currentInternalPartOffset:null,nextInternalPartOffset:e,currentInternalPartIndex:-1,isEndOfRange:!1}},c=!1;do{if(c)throw new i.jpipExceptions.InternalErrorException('Iterator reached to the end although no data has been iterated');c=!s(l)}while(r>=l.internalIteratorData.nextInternalPartOffset);var d=r-l.internalIteratorData.currentInternalPartOffset;return l.internalIteratorData.currentSubArray=l.internalIteratorData.currentSubArray.subarray(d),l.internalIteratorData.currentInternalPartOffset=r,l}function s(e){var t=e.internalIteratorData;if(t.isEndOfRange)return!1;if(e.subArray=t.currentSubArray,e.offset=t.currentInternalPartOffset,++t.currentInternalPartIndex,t.nextInternalPartOffset>=t.end)return t.isEndOfRange=!0,!0;r(t.currentInternalPartIndex),t.currentSubArray=o[t.currentInternalPartIndex],t.currentInternalPartOffset=t.nextInternalPartOffset;var n=o[t.currentInternalPartIndex].length;t.nextInternalPartOffset=t.currentInternalPartOffset+n;var i=t.end-t.currentInternalPartOffset,s=i<t.currentSubArray.length;return s&&(t.currentSubArray=t.currentSubArray.subarray(0,i)),!0}function r(e){if(e>=o.length)throw new i.jpipExceptions.InternalErrorException('CompositeArray: end of part has reached. Check end calculation')}var a=0,o=[];this.getLength=function(){return a},this.getOffset=function(){return e},this.pushSubArray=function(e){o.push(e),a+=e.length},this.copyToOtherAtTheEnd=function(e,i,r){t(i,r);for(var a=n(i,r);s(a);)e.pushSubArray(a.subArray)},this.copyToTypedArray=function(e,i,r,a){t(r,a);for(var o=n(r,a);s(o);){var l=o.offset-i;e.set(o.subArray,l)}},this.copyToArray=function(e,i,r,a){t(r,a);for(var o=n(r,a);s(o);)for(var l=o.offset-i,c=0;c<o.subArray.length;++c)e[l++]=o.subArray[c]},this.copyToOther=function(t){if(t.getOffset()>e)throw new i.jpipExceptions.InternalErrorException('CompositeArray: Trying to copy part into a latter part');var r=t.getOffset()+t.getLength(),o=e+a<=r;if(!o){var l=r,c=n(l);if(!s(c))throw new i.jpipExceptions.InternalErrorException('CompositeArray: Could not merge parts');var d=l;do{if(c.offset!==d)throw new i.jpipExceptions.InternalErrorException('CompositeArray: Non-continuous value of rangeToCopy.offset. Expected: '+d+', Actual: '+c.offset);t.pushSubArray(c.subArray),d+=c.subArray.length}while(s(c))}}}},function(e){'use strict';var t=Math.min;e.exports=function(e,n,s){function i(e,t){var n=!1,i=0,s;if(void 0!==t&&(n=!!t.forceCopyAllRange,i=t.databinStartOffset,s=t.maxLengthToCopy,void 0===i&&(i=0)),void 0===e&&(e=0),0===s)return{resultWithoutCopy:0};if(null!==d&&i>=d)return{resultWithoutCopy:!!s&&n?null:0};var a=o(i);if(a===c.length)return{resultWithoutCopy:n?null:0};if(n){var l=r(i,s,a);if(!l)return{resultWithoutCopy:null}}var p={databinStartOffset:i,maxLengthToCopy:s,resultStartOffset:e};return p}function r(e,t,n){if(c[n].getOffset()>e)return!1;if(t){var i=e-c[n].getOffset(),s=c[n].getLength()-i;return s>=t}if(null===d||n<c.length-1)return!1;var r=c[c.length-1],a=r.getOffset()+r.getLength(),o=a===d;return o}function a(e,n,s){var r;if(void 0!==n)r=e+n;else{var a=c[c.length-1];r=a.getOffset()+a.getLength()}for(var o=null,l=0;l<c.length&&!(c[l].getOffset()>=r);++l){var i=Math.max(e,c[l].getOffset()),d=t(r,c[l].getOffset()+c[l].getLength());s(c[l],i,d),o=c[l]}if(null===o)return 0;var p=t(o.getOffset()+o.getLength(),r);return p-e}function o(e){var t;for(t=0;t<c.length&&!(c[t].getOffset()+c[t].getLength()>e);++t);return t}var l=this,c=[],d=null,p=0,u=[];return this.getDatabinLengthIfKnown=function(){return d},this.getLoadedBytes=function(){return p},this.isAllDatabinLoaded=function(){var e;switch(c.length){case 0:e=0===d;break;case 1:e=0===c[0].getOffset()&&c[0].getLength()===d;break;default:e=!1;}return e},this.getCachedData=function(e){var t=u[e];return void 0===t&&(t={},u[e]=t),t},this.getClassId=function(){return e},this.getInClassId=function(){return n},this.copyToCompositeArray=function(e,t){var n=i(0,t);if(void 0!==n.resultWithoutCopy)return n.resultWithoutCopy;var s=a(n.databinStartOffset,n.maxLengthToCopy,function(t,n,i){t.copyToOtherAtTheEnd(e,n,i)});return s},this.copyBytes=function(e,t,n){var s=i(t,n);if(void 0!==s.resultWithoutCopy)return s.resultWithoutCopy;var r=s.databinStartOffset-s.resultStartOffset,o=e.isDummyBufferForLengthCalculation?function(){}:function(t,n,i){t.copyToArray(e,r,n,i)},l=a(s.databinStartOffset,s.maxLengthToCopy,o);return l},this.getExistingRanges=function(){for(var e=Array(c.length),t=0;t<c.length;++t)e[t]={start:c[t].getOffset(),length:c[t].getLength()};return e},this.addData=function(e,t){if(e.isLastByteInDatabin&&(d=e.messageOffsetFromDatabinStart+e.messageBodyLength),0!==e.messageBodyLength){var n=s.createCompositeArray(e.messageOffsetFromDatabinStart),r=e.bodyStart+e.messageBodyLength;n.pushSubArray(t.subarray(e.bodyStart,r));var a=o(e.messageOffsetFromDatabinStart),l=a;if(0<a){var u=c[a-1],g=u.getOffset()+u.getLength();g===e.messageOffsetFromDatabinStart&&--l}if(l>=c.length)return c.push(n),void(p+=e.messageBodyLength);var m=c[l],f=e.messageOffsetFromDatabinStart+e.messageBodyLength;if(m.getOffset()>f){for(var x=c.length;x>l;--x)c[x]=c[x-1];return c[l]=n,void(p+=e.messageBodyLength)}var i=m.getLength(),h=m.getOffset()>e.messageOffsetFromDatabinStart;h&&(c[l]=n,n=m,m=c[l]),n.copyToOther(m);var y=m.getOffset()+m.getLength(),I;for(I=l;I<c.length-1&&!(y<c[I+1].getOffset());++I)i+=c[I+1].getLength();var E=I-l;if(0<E){c[I].copyToOther(m);for(var b=l+1;b<c.length-E;++b)c[b]=c[b+E];c.length-=E}p+=m.getLength()-i}},this}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t){function n(e,t){if(0!==e.inClassId)throw new s.jpipExceptions.IllegalDataException('Main header data-bin with in-class index other than zero is not valid','A.3.5');var n=h.getLoadedBytes();h.addData(e,t);var i=h.getLoadedBytes()-n;f+=i,x+=i}function r(){}function a(n,i,r,a,o){if(a!==e)throw new s.jpipExceptions.WrongStreamException('databin of type '+o,e);var l=n.databins[r];return l||(l=t.createDatabinParts(i,r),n.databins[r]=l),l}function i(){return{databins:[],listeners:[],databinsWithListeners:[]}}var o=0,l=1,c=2,d=4,p=5,u=[],g=[],m=[],f=0,x=0;u[c]=i(),u[o]=i(),u[l]=u[o],m[c]=!0,m[o]=!0,m[l]=!0,u[d]=i(),u[p]=u[d],g[d]=!0,g[p]=!0;var h=t.createDatabinParts(6,0);return this.getIsJpipTilePartStream=function(){return e},this.getLoadedBytes=function(){return f},this.getMainHeaderDatabin=function(){return h},this.getTileHeaderDatabin=function(e){var t=a(u[c],c,e,!1,'tileHeader');return t},this.getPrecinctDatabin=function(e){var t=a(u[o],o,e,!1,'precinct');return t},this.getTileDatabin=function(e){var t=a(u[d],d,e,!0,'tilePart');return t},this.addEventListener=function(e,t,n,i){if('dataArrived'!==t)throw new s.jpipExceptions.InternalErrorException('Unsupported event: '+t);var r=e.getClassId(),a=e.getInClassId(),o=u[r];if(e!==o.databins[a])throw new s.jpipExceptions.InternalErrorException('Unmatched databin with class-ID='+r+' and in-class-ID='+a);void 0===o.listeners[a]&&(o.listeners[a]=[]),0===o.listeners[a].length&&(x+=e.getLoadedBytes()),o.listeners[a].push({listener:n,listenerThis:i,isRegistered:!0}),o.databinsWithListeners[a]=e},this.removeEventListener=function(e,t,n){if('dataArrived'!==t)throw new s.jpipExceptions.InternalErrorException('Unsupported event: '+t);var r=e.getClassId(),a=e.getInClassId(),o=u[r],l=o.listeners[a];if(e!==o.databins[a]||e!==o.databinsWithListeners[a])throw new s.jpipExceptions.InternalErrorException('Unmatched databin with class-ID='+r+' and in-class-ID='+a);for(var c=0;c<l.length;++c)if(l[c].listener===n)return l[c].isRegistered=!0,l[c]=l[l.length-1],l.length-=1,void(0===l.length&&(delete o.databinsWithListeners[a],x-=e.getLoadedBytes()));throw new s.jpipExceptions.InternalErrorException('Could not unregister listener from databin')},this.cleanupUnregisteredDatabins=function(){for(var e=0;e<u.length;++e)if(void 0!==u[e]){var t=u[e].databinsWithListeners;u[e].databins=t.slice()}f=x},this.saveData=function(e,t){if(0!==e.codestreamIndex)throw new s.jpipExceptions.UnsupportedFeatureException('Non zero Csn (Code Stream Index)','A.2.2');switch(e.classId){case 6:n(e,t);break;case 8:r(e,t);break;default:var o=u[e.classId];if(void 0===o)break;var l=!!g[e.classId],c=a(o,e.classId,e.inClassId,l,'<class ID '+e.classId+'>'),d=c.getLoadedBytes();c.addData(e,t);var p=c.getLoadedBytes()-d;f+=p;var m=o.listeners,h=m[e.inClassId];if(void 0!==h&&0<h.length){x+=p;for(var y=h.slice(),I=0,i;I<y.length;++I)i=y[I],i.isRegistered&&i.listener.call(i.listenerThis,c)}}},this}},function(e,t,n){'use strict';e.exports=function(e,t,n){function s(){if(g>=n.length)throw new i.jpipExceptions.IllegalOperationException('Unexpected requestData() after fetch done');if(null!=c&&null===l)throw new i.jpipExceptions.IllegalOperationException('Cannot resume already-active-fetch');if(d)throw new i.jpipExceptions.IllegalOperationException('Cannot resume already-terminated-fetch');setTimeout(function(){g>=n.length||null!=c||d||(u=p?g:n.length-1,c=t.requestData(o,r,a,n[u].minNumQualityLayers,l))})}function r(t,i){c=null;i&&(g=u,g>=n.length&&e.done())}function a(){}var o=null,l=null,c=null,d=!1,p=!1,u=0,g=0;this.setDedicatedChannelHandle=function(e){l=e},this.move=function(e){if(null===l&&null!=o)throw new i.jpipExceptions.IllegalOperationException('Cannot move non movable fetch');o=e,s()},this.resume=function(){s()},this.stop=function(){if(null==c){if(d)throw new i.jpipExceptions.IllegalOperationException('Cannot stop already terminated fetch');throw new i.jpipExceptions.IllegalOperationException('Cannot stop already stopped fetch')}return l||(t.stopRequestAsync(c),c=null),e.stopped()},this.terminate=function(){if(l)throw new i.jpipExceptions.IllegalOperationException('Unexpected terminate event on movable fetch');if(d)throw new i.jpipExceptions.IllegalOperationException('Double terminate event');c=null,d=!0},this.isProgressiveChanged=function(e){p=e,l&&null!=c&&(c=null,s())}};var i=n(0)},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(t,n,i){var s=e.getCodingStyleOffset(n);if(null!==s){t[i+s+5]=a}}function s(e,t,n){if(0===t.length)return 0;if(!e.isDummyBufferForLengthCalculation)for(var s=0;s<t.length;++s){var i=n+t[s].markerSegmentLengthOffset,r=(e[i]<<8)+e[i+1],a=r-t[s].length;e[i]=a>>>8,e[i+1]=255&a}for(var o=n+t[0].start,l=o,c=0;c<t.length;++c){l+=t[c].length;for(var d=c+1<t.length?n+t[c+1].start:e.length;l<d;++l)e[o]=e[l],++o}var p=l-o;return p}function r(e,t,n){e.isDummyBufferForLengthCalculation||(e[t++]=n>>>24,e[t++]=255&n>>>16,e[t++]=255&n>>>8,e[t++]=255&n)}var a=function(e){switch(e){case'LRCP':return 0;case'RLCP':return 1;case'RPCL':return 2;case'PCRL':return 3;case'CPRL':return 4;default:throw new i.j2kExceptions.IllegalDataException('Progression order of '+e,'A.6.1, table A.16');}}(t);this.modifyMainOrTileHeader=function(t,i,r,a){if(t.isDummyBufferForLengthCalculation||n(t,i,r),void 0===a)return 0;var o=e.getRangesOfBestResolutionLevelsData(i,a);if(null!==o.numDecompositionLevelsOffset&&!t.isDummyBufferForLengthCalculation){var l=r+o.numDecompositionLevelsOffset;t[l]-=a}var c=s(t,o.ranges,r);return-c},this.modifyImageSize=function(t,n){if(!t.isDummyBufferForLengthCalculation){var s=e.getImageAndTileSizeOffset(),a=s+i.j2kOffsets.REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER,o=a+8,l=a+16,c=a+24;r(t,a,n.regionWidth),r(t,a+4,n.regionHeight),r(t,l,n.tileWidth),r(t,l+4,n.tileHeight),r(t,o,0),r(t,o+4,0),r(t,c,0),r(t,c+4,0)}},this.modifyInt32=r}},function(e,t,n){'use strict';function i(e,t,n){this._codestreamPart=t,this._progressiveness=n,this._reconstructor=e.reconstructor,this._packetsDataCollector=e.packetsDataCollector,this._qualityLayersCache=e.qualityLayersCache,this._codestreamStructure=e.codestreamStructure,this._databinsSaver=e.databinsSaver,this._jpipFactory=e.jpipFactory,this._progressiveStagesFinished=0,this._qualityLayersReached=0,this._dataListeners=[],this._offsetX=-1,this._offsetY=-1,this._listener=this._jpipFactory.createRequestDatabinsListener(this._codestreamPart,this._qualityLayerReachedCallback.bind(this),this._codestreamStructure,this._databinsSaver,this._qualityLayersCache)}var s=n(0);e.exports=i,i.prototype.hasData=function(){return this._ensureNotDisposed(),0<this._progressiveStagesFinished},i.prototype.getFetchedData=function(e){if(this._ensureNotDisposed(),!this.hasData())throw'JpipImageDataContext error: cannot call getFetchedData before hasData = true';var t=this._getPartForDataWriter(e),n=this._packetsDataCollector.getAllCodeblocksData(t),i=this._getCodestream(e,!0);if(null===n.codeblocksData)throw new s.jpipExceptions.InternalErrorException('Could not collect codeblocks although progressiveness stage has been reached');if(null===i)throw new s.jpipExceptions.InternalErrorException('Could not reconstruct codestream although progressiveness stage has been reached');return{headersCodestream:i,codeblocksData:n.codeblocksData,width:this._codestreamPart.width,height:this._codestreamPart.height}},i.prototype.getFetchedDataAsCodestream=function(e){return this._getCodestream(e,!1)},i.prototype.on=function(e,t){if(this._ensureNotDisposed(),'data'!==e)throw'JpipImageDataContext error: Unexpected event '+e;this._dataListeners.push(t)},i.prototype.isDone=function(){return this._ensureNotDisposed(),this._isRequestDone},i.prototype.dispose=function(){this._ensureNotDisposed(),this._listener.unregister(),this._listener=null},i.prototype.setIsProgressive=function(e){this._ensureNotDisposed();var t=this._isProgressive;if(this._isProgressive=e,!t&&e&&this.hasData())for(var n=0;n<this._dataListeners.length;++n)this._dataListeners[n](this)},i.prototype.isDisposed=function(){return!this._listener},i.prototype.getNextQualityLayer=function(){return this._progressiveness[this._progressiveStagesFinished].minNumQualityLayers},i.prototype._getCodestream=function(e,t){this._ensureNotDisposed();var n=this._getPartForDataWriter(e),i=this._reconstructor.createCodestreamForRegion(n,t);if(null===i)throw new s.jpipExceptions.InternalErrorException('Could not reconstruct codestream although progressiveness stage has been reached');if(0>this._offsetX){var r=n.getTileIterator();if(!r.tryAdvance())throw new s.jpipExceptions.InternalErrorException('Empty codestreamPart in JpipImageDataContext');var a=r.tileIndex,o=this._codestreamStructure.getTileLeft(a,n.level),l=this._codestreamStructure.getTileTop(a,n.level);this._offsetX=n.minX-o,this._offsetY=n.minY-l}return{codestream:i,offsetX:this._offsetX,offsetY:this._offsetY}},i.prototype._tryAdvanceProgressiveStage=function(){var e=this._progressiveness[this._progressiveStagesFinished].minNumQualityLayers;if(this._qualityLayersReached<e)return!1;for('max'===this._qualityLayersReached&&(this._progressiveStagesFinished=this._progressiveness.length);this._progressiveStagesFinished<this._progressiveness.length;){var t=this._progressiveness[this._progressiveStagesFinished].minNumQualityLayers;if('max'===t||t>this._qualityLayersReached)break;++this._progressiveStagesFinished}return this._isRequestDone=this._progressiveStagesFinished===this._progressiveness.length,!0},i.prototype._qualityLayerReachedCallback=function(e){if(this._qualityLayersReached=e,this._isRequestDone)throw new s.jpipExceptions.InternalErrorException('Request already done but callback is called');if(this._tryAdvanceProgressiveStage()&&(this._isProgressive||this._isRequestDone))for(var t=0;t<this._dataListeners.length;++t)this._dataListeners[t](this)},i.prototype._getPartForDataWriter=function(e){if(0===this._progressiveStagesFinished)throw new s.jpipExceptions.IllegalOperationException('Cannot create codestream before first progressiveness stage has been reached');var t=this._progressiveness[this._progressiveStagesFinished-1].minNumQualityLayers,n='max'===t?e:'max'===e||void 0===e?t:Math.min(t,e);return this._codestreamPart.setMinNumQualityLayers(n),this._codestreamPart.setMaxNumQualityLayersLimit(e),this._codestreamPart},i.prototype._ensureNotDisposed=function(){if(this.isDisposed())throw new s.jpipExceptions.IllegalOperationException('Cannot use ImageDataContext after disposed')}},function(e,t,n){'use strict';var i=Math.max,s=Math.min,r=Math.ceil,a=Math.floor,o=n(0),l=0.6931471805599453;e.exports=function(e){function t(e){var t=e.level,i=f(t),s=x(t),r=e.minTileX+e.minTileY*p(),a=e.maxTileXExclusive-1+(e.maxTileYExclusive-1)*p(),o=d(r),l=d(a),c=n(o,t),u=n(l,t),g=c[0],m=c[1],h=e.maxTileXExclusive-e.minTileX,y=e.maxTileYExclusive-e.minTileY;return 1<h&&(g+=u[0],g+=i*(h-2)),1<y&&(m+=u[1],m+=s*(y-2)),{regionWidth:g,regionHeight:m,tileWidth:i,tileHeight:s}}function n(e,t){var n=c(e.horizontalEdgeType,I,g,f),i=c(e.verticalEdgeType,E,m,x);if(void 0!==t){var s=1<<t;n=r(n/s),i=r(i/s)}return[n,i]}function c(e,t,n,i){var s;switch(e){case C:s=t();break;case P:var r=i(),a=n()-t();s=a%r,0===s&&(s=r);break;case b:s=i();break;default:throw new o.jpipExceptions.InternalErrorException('Unexpected edge type: '+e);}return s}function d(e){var t=p(),n=u(),i=e%t,s=a(e/t);if(s>n||0>i||0>s)throw new o.jpipExceptions.InternalErrorException('Tile index '+e+' is not in range');var r=0==i?C:i==t-1?P:b,l=0===s?C:s===n-1?P:b;return{horizontalEdgeType:r,verticalEdgeType:l}}function p(){var t=r(e.imageWidth/e.tileWidth);return t}function u(){var t=r(e.imageHeight/e.tileHeight);return t}function g(n){if(void 0===n)return e.imageWidth;var i=t({minTileX:0,maxTileXExclusive:p(),minTileY:0,maxTileYExclusive:1,level:n});return i.regionWidth}function m(n){if(void 0===n)return e.imageHeight;var i=t({minTileX:0,maxTileXExclusive:1,minTileY:0,maxTileYExclusive:u(),level:n});return i.regionHeight}function f(t){if(void 0===t)return e.tileWidth;var n=r(e.tileWidth/(1<<t));return n}function x(t){if(void 0===t)return e.tileHeight;var n=r(e.tileHeight/(1<<t));return n}function h(){return e.firstTileOffsetX}function y(){return e.firstTileOffsetY}function I(e){var t=f()-h(),n=g();t>n&&(t=n);var i=r(t/(1<<e));return i}function E(e){var t=x()-y(),n=m();t>n&&(t=n);var i=r(t/(1<<e));return i}var b=0,C=1,P=2;return this.EDGE_TYPE_NO_EDGE=b,this.EDGE_TYPE_FIRST=C,this.EDGE_TYPE_LAST=P,this.getTilesFromPixels=function(e){var t=e.level,n=f(t),o=x(t),l=I(t),c=E(t),d=e.minX,g=e.minY,m=e.maxXExclusive,h=e.maxYExclusive,y=i(0,1+(d-l)/n),b=i(0,1+(g-c)/o),C=s(p(),1+(m-l)/n),P=s(u(),1+(h-c)/o),T={level:t,minTileX:a(y),minTileY:a(b),maxTileXExclusive:r(C),maxTileYExclusive:r(P)};return T},this.getNumTilesX=p,this.getNumTilesY=u,this.getTileWidth=f,this.getTileHeight=x,this.getFirstTileOffsetX=h,this.getFirstTileOffsetY=y,this.getFirstTileWidth=I,this.getFirstTileHeight=E,this.isEdgeTileId=d,this.getTileSize=n,this.getLevelWidth=g,this.getLevelHeight=m,this.getImageLevel=function(){return 0},this.getLevel=function(t){var n=Math.log;if(void 0===e.numResolutionLevelsForLimittedViewer)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';var a=n((t.maxXExclusive-t.minX)/t.screenWidth)/l,o=n((t.maxYExclusive-t.minY)/t.screenHeight)/l,c=r(i(a,o));return c=i(0,s(e.numResolutionLevelsForLimittedViewer-1,c)),c},this.getNumResolutionLevelsForLimittedViewer=function(){if(void 0===e.numResolutionLevelsForLimittedViewer)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';return e.numResolutionLevelsForLimittedViewer},this.getLowestQuality=function(){return 1},this.getHighestQuality=function(){if(void 0===e.highestQuality)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';return e.highestQuality},this.getSizeOfTiles=t,this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(e,t,n){var i=e[n]===t[0]&&e[n+1]===t[1];return i}function s(e,t){var n=r(e,!0),i=l(t,'Predefined marker in jGlobals.j2kMarkers'),s=n.markerToOffset[i];return void 0===s?null:s}function r(t,s){var r=t.getCachedData(c);if(void 0===r.markerToOffset&&(r.isParsedAllMarkers=!1,r.lastOffsetParsed=0,r.markerToOffset={},r.databin=t),r.isParsedAllMarkers)return r;var l=[],d=!0;if(t===e&&0===r.lastOffsetParsed){var p=t.copyBytes(l,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE});if(null===p)d=!1;else if(!n(l,i.j2kMarkers.StartOfCodestream,0))throw new i.j2kExceptions.IllegalDataException('SOC (Start Of Codestream) is not found where expected to be','A.4.1');r.lastOffsetParsed=2}return d&&a(r),o(r,s),r}function a(e){for(var n=e.lastOffsetParsed,s=[],r=e.databin.copyBytes(s,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE+i.j2kOffsets.LENGTH_FIELD_SIZE,databinStartOffset:n});null!==r;){var a=l(s,'offset '+n+' of databin with class ID = '+e.databin.getClassId()+' and in class ID = '+e.databin.getInClassId());e.markerToOffset[a.toString()]=n;var o=t.getInt16(s,i.j2kOffsets.MARKER_SIZE);n+=o+i.j2kOffsets.MARKER_SIZE,r=e.databin.copyBytes(s,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE+i.j2kOffsets.LENGTH_FIELD_SIZE,databinStartOffset:n})}e.lastOffsetParsed=n}function o(t,s){var r=t.databin.getDatabinLengthIfKnown();if(t.isParsedAllMarkers=t.lastOffsetParsed===r,!t.isParsedAllMarkers&&t.databin!==e){var a=[],o=t.databin.copyBytes(a,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE,databinStartOffset:t.lastOffsetParsed});null!==o&&n(a,0,i.j2kMarkers.StartOfData)&&(t.lastOffsetParsed+=i.j2kOffsets.MARKER_SIZE,t.isParsedAllMarkers=!0)}if(s&&!t.isParsedAllMarkers)throw new i.jpipExceptions.InternalErrorException('data-bin with class ID = '+t.databin.getClassId()+' and in class ID = '+t.databin.getInClassId()+' was not recieved yet')}function l(e,t){if(255!==e[0])throw new i.j2kExceptions.IllegalDataException('Expected marker in '+t,'A');var n=e[1].toString(16);return n}var c='markers';this.getMandatoryMarkerOffsetInDatabin=function(e,t,n,r){var a=s(e,t);if(null===a)throw new i.j2kExceptions.IllegalDataException(n+' is not found where expected to be',r);return a},this.checkSupportedMarkers=function(e,t,n){n=!!n;for(var s=r(e,!0),a={},o=0,c;o<t.length;++o)c=l(t[o],'jpipMarkersParser.supportedMarkers['+o+']'),a[c]=!0;for(var d in s.markerToOffset){var p=!!a[d];if(p!==n)throw new i.j2kExceptions.UnsupportedFeatureException('Unsupported marker found: '+d,'unknown')}},this.getMarkerOffsetInDatabin=s,this.isMarker=n}},function(e,t,n){'use strict';var i=n(0);e.exports=function(){var e=[];this.getObject=function(t){var n=t.getClassId(),s=e[n];s===void 0&&(s=[],e[n]=s);var r=t.getInClassId(),a=s[r];if(a===void 0)a={},a.databin=t,s[r]=a;else if(a.databin!==t)throw new i.jpipExceptions.InternalErrorException('Databin IDs are not unique');return a}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(e,t){var n=l(e,t);if(null===n)return null;var s=n+i.j2kOffsets.MARKER_SIZE,r=c(e,8,s),a=r[2],o=!(1&a),d=7,p=r[d],u=o?null:n+14;return{codingStyleDefaultOffset:n,isDefaultPrecinctSize:o,isStartOfPacketMarkerAllowed:!!(2&a),isEndPacketHeaderMarkerAllowed:!!(4&a),numResolutionLevels:p+1,precinctSizesOffset:u,numDecompositionLevelsOffset:s+d}}function s(e,t,n){if(!(null===t||t.isDefaultPrecinctSize)){var s=t.numResolutionLevels-n,r=t.precinctSizesOffset+s,a=t.codingStyleDefaultOffset+i.j2kOffsets.MARKER_SIZE;e.push({markerSegmentLengthOffset:a,start:r,length:n})}}function r(e,t){var n=c(e,1,t+4),s=31&n[0],r;switch(s){case 0:r=1;break;case 1:r=0;break;case 2:r=2;break;default:throw new i.j2kExceptions.IllegalDataException('Quantization style of '+s,'A.6.4');}return r}function a(e,n,s,a){var o=t.getMarkerOffsetInDatabin(n,i.j2kMarkers.QuantizationDefault);if(null!==o){var l=r(n,o);if(0!==l){var c=s.numResolutionLevels-a,d=o+i.j2kOffsets.MARKER_SIZE;e.push({markerSegmentLengthOffset:d,start:o+5+(1+3*(c-1))*l,length:3*a*l})}}}function o(e){var n=t.getMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleComponent);if(null!==n)throw new i.j2kExceptions.UnsupportedFeatureException('COC Marker (Coding Style Component)','A.6.2')}function l(e,n){o(e);var s;return s=n?t.getMandatoryMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleDefault,'COD (Coding style Default)','A.6.1'):t.getMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleDefault),s}function c(e,t,n){var s=[],r=e.copyBytes(s,0,{forceCopyAllRange:!0,maxLengthToCopy:t,databinStartOffset:n});if(null===r)throw new i.jpipExceptions.InternalErrorException('Header data-bin has not yet recieved '+t+' bytes starting from offset '+n);return s}var d=[i.j2kMarkers.ImageAndTileSize,i.j2kMarkers.CodingStyleDefault,i.j2kMarkers.QuantizationDefault,i.j2kMarkers.Comment];this.getCodingStyleOffset=l,this.getCodingStyleBaseParams=n,this.getImageAndTileSizeOffset=function(){var n=t.getMandatoryMarkerOffsetInDatabin(e,i.j2kMarkers.ImageAndTileSize,'Image and Tile Size (SIZ)','A.5.1');return n},this.getRangesOfBestResolutionLevelsData=function(r,o){t.checkSupportedMarkers(r,d,!0);var l=null,c=n(r,!1),p=c;null===c?p=n(e,!0):l=c.numDecompositionLevelsOffset;var u=p.numResolutionLevels;if(u<=o)throw new i.jpipExceptions.InternalErrorException('numResolutionLevels ('+o+') <= COD.numResolutionLevels ('+u+')');var g=[];s(g,c,o),a(g,r,p,o);var m={ranges:g,numDecompositionLevelsOffset:l};return m}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function s(t,s){for(var a=0,o=t.getTileIterator(),l={packetDataOffsets:[],data:n.createCompositeArray(0),allRelevantBytesLoaded:0};o.tryAdvance();){var c=o.createPrecinctIterator(),d=o.tileStructure.getNumQualityLayers();if(void 0!==t.maxNumQualityLayers&&(d=Math.min(d,t.maxNumQualityLayers)),'max'===t.minNumQualityLayers)t.minNumQualityLayers=d;else if(t.minNumQualityLayers>d)throw new i.jpipExceptions.InternalErrorException('minNumQualityLayers is larger than quality');for(;c.tryAdvance();){if(!c.isInCodestreamPart)throw new i.jpipExceptions.InternalErrorException('Unexpected precinct not in codestream part');var p=e.getPrecinctDatabin(c.inClassIndex),u=s.getObject(p);void 0===u.layerPerCodeblock&&(u.layerPerCodeblock=[]);var g=r(l,a,c,p,u,d);if(g<t.minNumQualityLayers)return null}++a}var m=new Uint8Array(l.data.getLength());return l.data.copyToTypedArray(m,0,0,l.data.getLength()),l.data=m,l}function r(e,n,s,r,a,o){var l,c;for(l=0;l<o;++l){var d=t.getPacketOffsetsByCodeblockIndex(r,l,s);if(null===d)break;c=d.headerStartOffset+d.headerLength;for(var p=d.codeblockBodyLengthByIndex.length,u=Array(p),g=!1,m=0,i;m<p;++m){if(i=a.layerPerCodeblock[m],void 0===i)i={layer:-1},a.layerPerCodeblock[m]=i;else if(i.layer>=l)continue;var f=d.codeblockBodyLengthByIndex[m],x=e.data.getLength(),h=r.copyToCompositeArray(e.data,{databinStartOffset:c,maxLengthToCopy:f.codeblockBodyLengthBytes,forceCopyAllRange:!0});if(h!==f.codeblockBodyLengthBytes){u.length=m,g=!0;break}i.layer=l,u[m]={start:x,end:x+f.codeblockBodyLengthBytes,codingpasses:f.codingPasses,zeroBitPlanes:f.zeroBitPlanes},c+=f.codeblockBodyLengthBytes}var y={tileIndex:n,r:s.resolutionLevel,p:s.precinctIndexInComponentResolution,c:s.component,l:l,codeblockOffsets:u};if(e.packetDataOffsets.push(y),g)break}return e.allRelevantBytesLoaded+=c,l}this.getAllCodeblocksData=function(e){var t=n.createObjectPoolByDatabin(),i=s(e,t);return{codeblocksData:i,alreadyReturnedCodeblocks:t}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function s(e){if(!e.isStarted)return r(),e.isStarted=!0,e.currentX=l.minTileX,e.currentY=l.minTileY,!0;if(e.currentY>=l.maxTileYExclusive)throw new i.jpipExceptions.InternalErrorException('Cannot advance tile iterator after end');if(++e.currentX,e.currentX<l.maxTileXExclusive)return!0;e.currentX=l.minTileX,++e.currentY;var t=e.currentY<l.maxTileYExclusive;return t}function r(){null!=l||(e?l=t.getTilesFromPixels(e):l={level:0,minTileX:0,minTileY:0,maxTileXExclusive:t.getNumTilesX(),maxTileYExclusive:t.getNumTilesY()})}var a='max',o='max',l=null,c=null;Object.defineProperty(this,'level',{get:function(){return e?e.level:0}}),Object.defineProperty(this,'minX',{get:function(){return e?e.minX:0}}),Object.defineProperty(this,'minY',{get:function(){return e?e.minY:0}}),Object.defineProperty(this,'width',{get:function(){return e?e.maxXExclusive-e.minX:t.getImageWidth()}}),Object.defineProperty(this,'height',{get:function(){return e?e.maxYExclusive-e.minY:t.getImageHeight()}}),Object.defineProperty(this,'minNumQualityLayers',{get:function(){return a}}),Object.defineProperty(this,'maxNumQualityLayers',{get:function(){return e&&'max'!==e.quality?'max'==o?e.quality:Math.min(e.quality,o):o}}),Object.defineProperty(this,'fullTilesSize',{get:function(){return null==c&&(r(),c=t.getSizeOfTiles(l)),c}}),this.setMinNumQualityLayers=function(e){a=e},this.setMaxNumQualityLayersLimit=function(e){o=e||'max'},this.getTileIterator=function(){var r={isStarted:!1,currentX:-1,currentY:-1},a={get tileIndex(){if(!r.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var e=t.getNumTilesX(),n=r.currentY*e,s=n+r.currentX;return s},get tileStructure(){if(!r.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var e=a.tileIndex,n=t.getTileStructure(e);return n},createPrecinctIterator:function(s){if(!r.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var o=a.tileIndex;return n.createJpipParamsPrecinctIterator(t,o,e,s)},tryAdvance:function(){var e=s(r);return e}};return a}}},function(e,t,n){'use strict';var i=Math.max,s=Math.min,r=Math.ceil,a=Math.floor,o=n(0);e.exports=function(e,t,n,l){function c(){if(C=e.getTileStructure(t),!!n&&void 0!==n.level){var i=C.getMinNumResolutionLevelsOverComponents();if(i<=n.level)throw new o.jpipExceptions.InternalErrorException('Cannot advance resolution: level='+n.level+' but should be smaller than '+i)}if(E=d(),!l&&null!==E){var s=E[0][0];m=s.minPrecinctX,f=s.minPrecinctY}b=C.getProgressionOrder()}function d(){if(!n)return null;for(var o=e.getNumComponents(),l=Array(o),c=n.level||0,d=e.getTileLeft(t,c),p=e.getTileTop(t,c),u=n.minX-d,g=n.minY-p,m=n.maxXExclusive-d,f=n.maxYExclusive-p,x=0;x<o;++x){for(var h=C.getComponentStructure(x),y=h.getNumResolutionLevels(),I=y-c,E=h.getNumResolutionLevels(),b=Array(y),P=0;P<I;++P){var T=h.getComponentScaleX(),S=h.getComponentScaleY(),L=I-P-1,v=T<<L,O=S<<L,k=4,R=a(u/v)-k,D=a(g/O)-k,_=r(m/v)+k,A=r(f/O)+k,N=h.getPrecinctWidth(P)*T,j=h.getPrecinctHeight(P)*S,M=a(R/N),F=a(D/j),B=r(_/N),w=r(A/j),q=h.getNumPrecinctsX(P),X=h.getNumPrecinctsY(P);b[P]={minPrecinctX:i(0,M),minPrecinctY:i(0,F),maxPrecinctXExclusive:s(B,q),maxPrecinctYExclusive:s(w,X)}}l[x]=b}return l}function p(t,i){var s=C.getComponentStructure(g);switch(b[t]){case'R':var r=s.getNumResolutionLevels();return!!n&&n.level&&(r-=n.level),++x,x%=r,x;case'C':return++g,g%=e.getNumComponents(),g;case'P':var a,l,c,d;if(null!==i){var p=i[g],u=p[x];a=u.minPrecinctX,l=u.minPrecinctY,c=u.maxPrecinctXExclusive,d=u.maxPrecinctYExclusive}else a=0,l=0,c=s.getNumPrecinctsX(x),d=s.getNumPrecinctsY(x);return(m-=a-1,m%=c-a,m+=a,m!=a)?m-a:(f-=l-1,f%=d-l,f+=l,f-l);case'L':throw new o.jpipExceptions.InternalErrorException('Advancing L is not supported in JPIP');default:throw new o.jpipExceptions.InternalErrorException('Unexpected letter in progression order: '+b[t]);}}var u=!1,g=0,m=m,f=f,x=0,h=!0,y=-1,I=-1,E=null,b,C;return Object.defineProperty(this,'tileIndex',{get:function(){return t}}),Object.defineProperty(this,'component',{get:function(){return g}}),Object.defineProperty(this,'precinctX',{get:function(){return m}}),Object.defineProperty(this,'precinctY',{get:function(){return f}}),Object.defineProperty(this,'resolutionLevel',{get:function(){return x}}),Object.defineProperty(this,'isInCodestreamPart',{get:function(){return h}}),this.tryAdvance=function(){if(!u)return c(),u=!0,!0;var e=!0,t=l?null:E,n=!1;y=-1,I=-1;for(var s=2,i;0<=s&&(i=p(s,t),e=0===i,!!e);--s)'P'!==b[s]||l||(n=!0);if(e)return!1;if(null==E)return h=!0,!0;var r=E[g],a=r[x];return n&&(m=a.minPrecinctX,f=a.minPrecinctY),h=m>=a.minPrecinctX&&f>=a.minPrecinctY&&m<a.maxPrecinctXExclusive&&f<a.maxPrecinctYExclusive,!0},Object.defineProperty(this,'precinctIndexInComponentResolution',{get:function(){return 0>y&&(y=C.precinctPositionToIndexInComponentResolution(this)),y}}),Object.defineProperty(this,'inClassIndex',{get:function(){return 0>I&&(I=C.precinctPositionToInClassIndex(this)),I}}),this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,s,r,a){function o(e){if(e.isAllDatabinLoaded()){var t=x.getObject(e);if(!t.isAlreadyLoaded){t.isAlreadyLoaded=!0,--p;for(var r=e.getInClassId(),a=n.getTileStructure(r),o=a.getNumQualityLayers(),u=t.precinctIterator;u.tryAdvance();){if(!u.isInCodestreamPart)throw new i.jpipExceptions.InternalErrorException('Unexpected precinct not in codestream part');var g=s.getPrecinctDatabin(u.inClassIndex);f.push(g);var m=x.getObject(g);if(void 0!==m.qualityInTile)throw new i.jpipExceptions.InternalErrorException('Tile was iterated twice in codestream part');m.qualityInTile=o,c(g,m,u),s.addEventListener(g,'dataArrived',l)}d()}}}function l(e){var t=x.getObject(e),n=t.numQualityLayersReached,i=t.qualityInTile;n===i||(--h[n],c(e,t),d())}function c(t,n,i){var s=r.getQualityLayerOffset(t,e.maxNumQualityLayers,i),a=s.numQualityLayers;n.numQualityLayersReached=a;var o=n.qualityInTile;if(a!==o){var l=h[a]||0;h[a]=l+1}}function d(){if(!(0<h[u]||'max'===u||u>=y||0<p)){var e=h.length,n;do{if(++u,u>=e){u='max';break}n=0<h[u]}while(!n);t(u)}}var p=0,u=0,g=!1,m=[],f=[],x=a.createObjectPoolByDatabin(),h=[],y;(function(){++p;for(var t=e.getTileIterator();t.tryAdvance();){var n=t.tileIndex,i=s.getTileHeaderDatabin(n);m.push(i);var r=x.getObject(i);r.precinctIterator=t.createPrecinctIterator(),s.addEventListener(i,'dataArrived',o),++p,o(i)}--p,d()})(),this.unregister=function(){if(!g){for(var e=0;e<m.length;++e)s.removeEventListener(m[e],'dataArrived',o);for(var t=0;t<f.length;++t)s.removeEventListener(f[t],'dataArrived',l);g=!0}}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e){function t(e,t,n){for(var a=Array(e.length),o=0,i;o<e.length;++o){if(i=e[o].minNumQualityLayers,'max'!==i){if(void 0!==t&&i>t)throw new s.jpipExceptions.ArgumentException('progressiveness['+o+'].minNumQualityLayers',i,'minNumQualityLayers is bigger than fetchParams.quality');i=r(i,n,'progressiveness['+o+'].minNumQualityLayers')}a[o]={minNumQualityLayers:i}}return a}function n(t){var n=[],s=e.getDefaultTileStructure(),r=s.getNumQualityLayers(),a='max';void 0!==t&&(r=Math.min(r,t),a=r);for(var o=4>r?r-1:3,l=1;l<o;++l)n.push({minNumQualityLayers:l});var c=Math.round(r/2);return c>o&&n.push({minNumQualityLayers:c}),n.push({minNumQualityLayers:a}),n}function i(t){var n=r(t.level,'level',void 0,!0),i=r(t.quality,'quality',void 0,!0),a=r(t.minX,'minX'),o=r(t.minY,'minY'),l=r(t.maxXExclusive,'maxXExclusive'),c=r(t.maxYExclusive,'maxYExclusive'),d=e.getLevelWidth(n),p=e.getLevelHeight(n);if(0>a||l>d||0>o||c>p||a>=l||o>=c)throw new s.jpipExceptions.ArgumentException('codestreamPartParams',t);return{minX:a,minY:o,maxXExclusive:l,maxYExclusive:c,level:n,quality:i}}function r(e,t,n,i){if(e===void 0&&(n!==void 0||i))return n;var r=+e;if(isNaN(r)||r!==Math.floor(r))throw new s.jpipExceptions.ArgumentException(t,e);return r}this.modify=function(e,r){var a=i(e);r=r||{};var o=r.useCachedDataOnly,l=r.disableProgressiveness,c;if(r.progressiveness!==void 0){if(o||l)throw new s.jpipExceptions.ArgumentException('options.progressiveness',r.progressiveness,'options contradiction: cannot accept both progressivenessand useCachedDataOnly/disableProgressiveness options');c=t(r.progressiveness,a.quality,'quality')}else if(o)c=[{minNumQualityLayers:0}];else if(l){var d=a.quality,p=d===void 0?'max':d;c=[{minNumQualityLayers:p}]}else c=n(a.quality);return{codestreamPartParams:a,progressiveness:c}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(t,e,n,s,r,a){function o(e,i){var s=!1;try{var r=c(e,i);if(r===f)return;s=r===m}catch(n){s=!0,t.onException(n)}try{s||t.waitForConcurrentRequestsToEnd(x),n.requestEnded(e,x),s&&!y&&a!==void 0&&a(),t.checkConcurrentRequestsFinished()}catch(n){t.onException(n)}}function l(e){n.requestEnded(e,x),t.checkConcurrentRequestsFinished(),a!==void 0&&a()}function c(e,s){if(!s)throw new i.jpipExceptions.InternalErrorException('AJAX callback called although response is not done yet and chunked encoding is not enabled');var r=t.getCreatedChannelId(e);null===r?null===n.getChannelId()&&t.onException(new i.jpipExceptions.IllegalDataException('Cannot extract cid from cnew response','D.2.3')):null===n.getChannelId()?n.setChannelId(r):t.onException(new i.jpipExceptions.IllegalDataException('Channel created although was not requested','D.2.3'));var a=u(e);if(null===a)return m;var o=p(e,a);return o}function d(){E=n.nextRequestId();var e=s+'&len='+I+'&qid='+E;I*=2;var i=null===n.getChannelId();if(i){e+='&cnew=http';var r=t.getFirstChannel();null!==r&&(e+='&cid='+r.getChannelId())}else e+='&cid='+n.getChannelId();t.sendAjax(e,o,l)}function p(e,n){var s=m,r=new Uint8Array(e.response);if(n>r.length-2||0!==r[n])throw new i.jpipExceptions.IllegalDataException('Could not find End Of Response (EOR) code at the end of response','D.3');switch(r[n+1]){case i.jpipEndOfResponseReasons.IMAGE_DONE:case i.jpipEndOfResponseReasons.WINDOW_DONE:case i.jpipEndOfResponseReasons.QUALITY_LIMIT:s=g;break;case i.jpipEndOfResponseReasons.WINDOW_CHANGE:if(!y)throw new i.jpipExceptions.IllegalOperationException('Server response was terminated due to newer request issued on same channel. That may be an internal webjpip.js error - Check that movable requests are well maintained');break;case i.jpipEndOfResponseReasons.BYTE_LIMIT:case i.jpipEndOfResponseReasons.RESPONSE_LIMIT:y||(d(),s=f);break;case i.jpipEndOfResponseReasons.SESSION_LIMIT:t.onException(new i.jpipExceptions.IllegalOperationException('Server resources associated with the session is limitted, no further requests should be issued to this session'));break;case i.jpipEndOfResponseReasons.NON_SPECIFIED:t.onException(new i.jpipExceptions.IllegalOperationException('Server error terminated response with no reason specified'));break;default:t.onException(new i.jpipExceptions.IllegalDataException('Server responded with illegal End Of Response (EOR) code: '+r[n+1]));}return s}function u(n){try{for(var i=new Uint8Array(n.response),s=0,r;s<i.length&&!(0===i[s]);){var a=e.parseMessageHeader(i,s,r);if(a.bodyStart+a.messageBodyLength>i.length)return s;t.getDatabinsSaver().saveData(a,i),s=a.bodyStart+a.messageBodyLength,r=a}return s}catch(n){return t.onException(n),null}}var g=1,m=2,f=3,x=this,h=!1,y=!1,I=10*1024,E;this.startRequest=function(){if(h)throw new i.jpipExceptions.InternalErrorException('startRequest called twice');else if(y)throw new i.jpipExceptions.InternalErrorException('request was already stopped');h=!0,t.requestStarted(),d()},this.stopRequestAsync=function(){y=!0},this.getLastRequestId=function(){if(!h)throw new i.jpipExceptions.InternalErrorException('Unexpected call to getLastRequestId on inactive request');return E},this.callCallbackAfterConcurrentRequestsFinished=function(){r(x,!0)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,s,r){function a(e){var t=new i.jpipExceptions.InternalErrorException('Bad jpip server response (status = '+e.status+')');o(t)}function o(e){e===void 0&&(e=null),null!==l&&l({isReady:m,exception:e})}var l=null,c=null,d=[],p=null,u=0,g=[],m=!1,f=t||'0';this.onException=function(e){o(e)},this.getIsReady=function(){return m},this.setIsReady=function(e){m=e,o()},this.getCodestreamStructure=function(){return n},this.getDatabinsSaver=function(){return s},this.getDataRequestUrl=function(){return e},this.getTargetId=function(){return f},this.getFirstChannel=function(){return p},this.setStatusCallback=function(e){l=e},this.setRequestEndedCallback=function(e){c=e},this.requestStarted=function(){++u},this.requestEnded=function(e,t){--u;var n=e.getResponseHeader('JPIP-tid');if(''!==n&&null!==n)if('0'===f)f=n;else if(f!==n)throw new i.jpipExceptions.IllegalDataException('Server returned unmatched target ID');null==p&&(p=t);var s=t.getIsDedicatedForMovableRequest()?null:t;null!==c&&c(s)},this.getActiveRequestsCount=function(){return u},this.channelCreated=function(e){d.push(e)},this.getCreatedChannelId=function(e){var t=e.getResponseHeader('JPIP-cnew');if(!t)return null;for(var n=t.split(','),s=0,i;s<n.length;++s)if(i=n[s].split('='),'cid'===i[0])return i[1];return null},this.waitForConcurrentRequestsToEnd=function(e){for(var t=[],n=0;n<d.length;++n){var i=d[n].getRequestsWaitingForResponse(),s=i.length;if(0!==s){for(var r=i[0].getLastRequestId(),a=1;a<i.length;++a)r=Math.max(r,i[a].getLastRequestId());t.push({channel:d[n],requestId:r})}}g.push({request:e,concurrentRequests:t})},this.checkConcurrentRequestsFinished=function(){for(var e=g.length-1;0<=e;--e){for(var t=g[e].concurrentRequests,n=t.length-1,i;0<=n;--n)i=t[n],i.channel.isAllOldRequestsEnded(i.requestId)&&(t[n]=t[t.length-1],t.length-=1);if(!(0<t.length)){var s=g[e].request,r=s.callback;g[e]=g[g.length-1],g.length-=1,s.callCallbackAfterConcurrentRequestsFinished()}}},this.sendAjax=function(e,t,n){var i;i=n?function(e){a(e),n(e)}:a,r.request(e,t,i)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,s,r,a,o,l){function c(){null!=P&&o(P),y.setIsReady(!1),y.sendAjax(L,h)}function d(e){++C;var n=l.createChannel(t,y);return y.channelCreated(n),e||b.push(n),n}function p(e,t){for(var n=null,s=e+1,r=0,i,a;r<b.length&&(a=b[r].getAllQueuedRequestCount(),a<s&&(n=b[r],i=r,s=a),0!==a);++r);return t&&null!==n?(b[i]=b[b.length-1],b.length-=1,n):n}function u(){var e=r.getMainHeaderDatabin();if(!e.isAllDatabinLoaded())throw new i.jpipExceptions.IllegalDataException('Main header was not loaded on session creation');var t=y.getFirstChannel(),n=t.getChannelId();return L=T+'&cclose=*&cid='+n,x?void c():void(null===n||(P=a(g,f),y.setIsReady(!0)))}function g(){if(!(0<y.getActiveRequestsCount())){var e=y.getFirstChannel();e.sendMinimalRequest(function(){})}}function m(){if(null===y||!y.getIsReady())throw new i.jpipExceptions.InternalErrorException('Cannot perform this operation when the session is not ready')}var f=30*1e3,x=!1,h=null,y=null,I=null,E=null,b=[],C=0,P=null,T,S,L;this.open=function(e){if(null!=y)throw new i.jpipExceptions.InternalErrorException('session.open() should be called only once');var t=0>e.indexOf('?')?'?':'&';T=e+t+'type='+(r.getIsJpipTilePartStream()?'jpt-stream':'jpp-stream'),S=T+'&stream=0',y=l.createSessionHelper(S,n,s,r),null!=I&&y.setStatusCallback(I),null!=E&&y.setRequestEndedCallback(E);var a=d();a.sendMinimalRequest(u)},this.getTargetId=function(){return m(),y.getTargetId()},this.getIsReady=function(){var e=null!==y&&y.getIsReady();return e},this.setStatusCallback=function(e){I=e,null!==y&&y.setStatusCallback(e)},this.setRequestEndedCallback=function(e){E=e,null!==y&&y.setRequestEndedCallback(e)},this.hasActiveRequests=function(){m();var e=0<y.getActiveRequestsCount();return e},this.tryGetChannel=function(n){m();var i=C<e,s=i||n?0:t-1,r=p(s,n);return null===r&&i&&(r=d(n)),n&&null!==r&&r.dedicateForMovableRequest(),r},this.close=function(e){if(0==C)throw new i.jpipExceptions.InternalErrorException('Cannot close session before open');if(x)throw new i.jpipExceptions.InternalErrorException('Cannot close session twice');x=!0,h=e,L!=void 0&&c()}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n,i,r,a){function o(){if(null!==S)throw new s.jpipExceptions.IllegalOperationException('Previous session still not established');return null==y?void(i.cleanupUnregisteredDatabins(),l()):void(null!==P&&P({isReady:!0,exception:'Previous session that should be closed still alive.Maybe old requestContexts have not beed closed. Reconnect will not be done'}))}function l(){var s;null!=h&&(s=h.getTargetId()),S=r.createSession(e,t,s,n,i),S.setStatusCallback(d),S.open(I)}function c(e){var t=h.tryGetChannel(!0);if(null===t)throw new s.jpipExceptions.IllegalOperationException('Too many concurrent requests. Limit the use of dedicated (movable) requests, enlarge maxChannelsInSession or wait for requests to finish and avoid create new ones');if(!t.getIsDedicatedForMovableRequest())throw new s.jpipExceptions.InternalErrorException('getIsDedicatedForMovableRequest inconsistency');e.internalDedicatedChannel=t}function d(e){if(null===S||e.isReady!==S.getIsReady())throw new s.jpipExceptions.InternalErrorException('Unexpected statusCallback when not registered to session or inconsistent isReady');if(e.isReady){if(null!=y)throw new s.jpipExceptions.InternalErrorException('sessionWaitingForDisconnect should be null');y=h,h=S,S=null,null!=y&&(y.setStatusCallback(null),!f()&&y.setRequestEndedCallback(f)),h.setStatusCallback(P),h.setRequestEndedCallback(m);for(var t=0;t<C.length;++t)c(C[t])}null!==P&&P(e)}function p(e){null!==e&&(++E,e.close(u))}function u(){--E,0==E&&T!==void 0&&T()}function g(){if(null===h)throw new s.jpipExceptions.InternalErrorException('This operation is forbidden when session is not ready')}function m(e){var t=null;if(i.getLoadedBytes()>x&&o(),null!==e){if(e.getIsDedicatedForMovableRequest())throw new s.jpipExceptions.InternalErrorException('Expected non-movable channel as channelFreed');do{if(0===b.length){t=null;break}if(t=b.shift(),null!==t.internalRequest)throw new s.jpipExceptions.InternalErrorException('Request was already sent but still in queue')}while(t.isEnded);null!==t&&(t.internalRequest=e.requestData(t.codestreamPartParams,t.callback,t.failureCallback,t.numQualityLayers))}}function f(){var e=!y.hasActiveRequests();return e&&(y.close(),y=null),e}var x=a||10*1048576,h=null,y=null,I=null,E=0,b=[],C=[],P=null,T=null,S;this.getIsReady=function(){return null!=h&&h.getIsReady()},this.open=function(e){if(e===void 0||null===e)throw new s.jpipExceptions.ArgumentException('baseUrl',e);if(null!=I)throw new s.jpipExceptions.IllegalOperationException('Image was already opened');I=e,l()},this.close=function(e){if(null!=T)throw new s.jpipExceptions.IllegalOperationException('closed twice');T=e,E=1,p(h),p(S),p(y),u()},this.setStatusCallback=function(e){P=e,null!=h&&h.setStatusCallback(e)},this.dedicateChannelForMovableRequest=function(){g();var e={internalDedicatedChannel:null};return C.push(e),c(e),e},this.requestData=function(e,t,n,i,r){g();var a={isEnded:!1,internalRequest:null,codestreamPartParams:e,callback:t,failureCallback:n,numQualityLayers:i},o=!!r,l;if(o)l=r.internalDedicatedChannel;else{if(l=h.tryGetChannel(),null===l)return b.push(a),a;if(l.getIsDedicatedForMovableRequest())throw new s.jpipExceptions.InternalErrorException('Expected non-movable channel')}if(l.getIsDedicatedForMovableRequest()!==o)throw new s.jpipExceptions.InternalErrorException('getIsDedicatedForMovableRequest inconsistency');return a.internalRequest=l.requestData(e,t,n,i),a},this.stopRequestAsync=function(e){e.isEnded=!0,null!==e.internalRequest&&e.internalRequest.stopRequestAsync()},this.reconnect=o}},function(e,t,n){'use strict';var s=Math.pow,r=n(0);e.exports=function(e,t,n,a){function i(c,d){var p=a.getCodingStyleBaseParams(c,d);if(null===p)return null;var u=e.getMainHeaderDatabin(),g=a.getImageAndTileSizeOffset(),m=g+r.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER,f=l(u,2,m),x=n.getInt16(f,0),h=t.getMarkerOffsetInDatabin(c,r.j2kMarkers.PackedPacketHeadersInTileHeader),y=t.getMarkerOffsetInDatabin(u,r.j2kMarkers.PackedPacketHeadersInMainHeader),I=p.codingStyleDefaultOffset+6,E=l(c,6,I),b=n.getInt16(E,0),C=o(E,4),P=o(E,5),T=Array(p.numResolutionLevels),S=Array(p.numResolutionLevels),L=null;if(!p.isDefaultPrecinctSize){var v=p.numResolutionLevels;L=l(c,v,p.precinctSizesOffset)}for(var O=32768,k=0;k<p.numResolutionLevels;++k){if(p.isDefaultPrecinctSize){T[k]=O,S[k]=O;continue}var i=k,R=L[i];T[k]=1*s(2,15&R),S[k]=1*s(2,R>>>4)}for(var D=Array(x),_=0;_<x;++_)D[_]={maxCodeblockWidth:C,maxCodeblockHeight:P,numResolutionLevels:p.numResolutionLevels,precinctWidthPerLevel:T,precinctHeightPerLevel:S};var A={maxCodeblockWidth:C,maxCodeblockHeight:P,numResolutionLevels:p.numResolutionLevels,precinctWidthPerLevel:T,precinctHeightPerLevel:S},N={numQualityLayers:b,isPacketHeadersNearData:null===h&&null===y,isStartOfPacketMarkerAllowed:p.isStartOfPacketMarkerAllowed,isEndPacketHeaderMarkerAllowed:p.isEndPacketHeaderMarkerAllowed,paramsPerComponent:D,defaultComponentParams:A};return N}function o(e,t){var n=e[t],i=2+(15&n);if(10<i)throw new r.j2kExceptions.IllegalDataException('Illegal codeblock width exponent '+i,'A.6.1, Table A.18');return 1<<i}function l(e,t,n){var i=[],s=e.copyBytes(i,0,{forceCopyAllRange:!0,maxLengthToCopy:t,databinStartOffset:n});if(null===s)throw new r.jpipExceptions.InternalErrorException('Header data-bin has not yet recieved '+t+' bytes starting from offset '+n);return i}this.parseCodestreamStructure=function(){for(var t=e.getMainHeaderDatabin(),s=a.getImageAndTileSizeOffset(),o=l(t,38,s+r.j2kOffsets.MARKER_SIZE+r.j2kOffsets.LENGTH_FIELD_SIZE),c=r.j2kOffsets.REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER-(r.j2kOffsets.MARKER_SIZE+r.j2kOffsets.LENGTH_FIELD_SIZE),d=r.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER-(r.j2kOffsets.MARKER_SIZE+r.j2kOffsets.LENGTH_FIELD_SIZE),p=n.getInt32(o,c),u=n.getInt32(o,c+4),g=n.getInt32(o,10),m=n.getInt32(o,14),f=n.getInt32(o,18),x=n.getInt32(o,22),h=n.getInt32(o,26),y=n.getInt32(o,30),I=n.getInt16(o,d),E=s+r.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER+2,b=l(t,3*I,E),C=Array(I),P=Array(I),T=0;T<I;++T)C[T]=b[3*T+1],P[T]=b[3*T+2];return{numComponents:I,componentsScaleX:C,componentsScaleY:P,imageWidth:p-h,imageHeight:u-y,tileWidth:f,tileHeight:x,firstTileOffsetX:h,firstTileOffsetY:y}},this.parseDefaultTileParams=function(){var t=e.getMainHeaderDatabin(),n=i(t,!0);return n},this.parseOverridenTileParams=function(t){var n=e.getTileHeaderDatabin(t),s=i(n,!1);return s}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,s){function r(e,t,n){if(0>t||t>=n)throw new i.jpipExceptions.ArgumentException(e,t,e+' is expected to be between 0 and '+n-1)}function a(e,t,n,i,s){var r=n(e),a=i(e),o=s(e);if(r>=a||o>=a)return!0;return 0==r%o||0==o%r}var o,l,d,p;this.getProgressionOrder=function(){return s},this.getDefaultComponentStructure=function(){return o},this.getComponentStructure=function(e){return l[e]},this.getTileWidth=function(){return e.tileSize[0]},this.getTileHeight=function(){return e.tileSize[1]},this.getNumQualityLayers=function(){return e.numQualityLayers},this.getIsPacketHeaderNearData=function(){return e.isPacketHeadersNearData},this.getIsStartOfPacketMarkerAllowed=function(){return e.isStartOfPacketMarkerAllowed},this.getIsEndPacketHeaderMarkerAllowed=function(){return e.isEndPacketHeaderMarkerAllowed},this.getMinNumResolutionLevelsOverComponents=function(){return p},this.precinctInClassIndexToPosition=function(e){if(0>e)throw new i.jpipExceptions.ArgumentException('inClassIndex',e,'Invalid negative in-class index of precinct');var n=t.getNumTilesX()*t.getNumTilesY(),s=t.getNumComponents(),r=e%n,a=(e-r)/n,o=a%s,c=l[o],p=c.getNumResolutionLevels(),u=(a-o)/s,g=0,m;for(m=1;m<p;++m){var f=d[o][m];if(f>u)break;g=f}--m;var x=u-g,h=c.getNumPrecinctsX(m),y=c.getNumPrecinctsY(m),I=x%h,E=(x-I)/h;if(E>=y)throw new i.jpipExceptions.ArgumentException('inClassIndex',e,'Invalid in-class index of precinct');var b={tileIndex:r,component:o,precinctX:I,precinctY:E,resolutionLevel:m};return b},this.precinctPositionToInClassIndex=function(e){var n=t.getNumComponents();r('precinctPosition.component',e.component,n);var i=l[e.component],s=i.getNumResolutionLevels();r('precinctPosition.resolutionLevel',e.resolutionLevel,s);var a=t.getNumTilesX()*t.getNumTilesY(),o=i.getNumPrecinctsX(e.resolutionLevel),c=i.getNumPrecinctsY(e.resolutionLevel);r('precinctPosition.precinctX',e.precinctX,o),r('precinctPosition.precinctY',e.precinctY,c),r('precinctPosition.tileIndex',e.tileIndex,a);var p=e.precinctX+e.precinctY*o,u=d[e.component][e.resolutionLevel],g=e.component+(p+u)*t.getNumComponents(),m=e.tileIndex+g*t.getNumTilesX()*t.getNumTilesY();return m},this.precinctPositionToIndexInComponentResolution=function(e){var t=l[e.component],n=t.getNumPrecinctsX(e.resolutionLevel),i=e.precinctX+e.precinctY*n;return i},o=n.createComponentStructure(e.defaultComponentParams,this),l=Array(t.getNumComponents());for(var c=0;c<t.getNumComponents();++c)l[c]=n.createComponentStructure(e.paramsPerComponent[c],this);return function(){d=Array(n);var n=t.getNumComponents(),s=e.defaultComponentParams;p=s.numResolutionLevels;for(var o=!0,u=!0,g=0,c;g<n;++g){c=e.paramsPerComponent[g],p=Math.min(p,c.numResolutionLevels),d[g]=Array(c.numResolutionLevels);for(var m=l[g],f=0,x=m.getNumPrecinctsX(g),h=m.getNumPrecinctsY(g),y=0;y<c.numResolutionLevels;++y){d[g][y]=f;var r=m.getNumPrecinctsX(y),I=m.getNumPrecinctsY(y);f+=r*I,(s.precinctWidthPerLevel[y]!==c.precinctWidthPerLevel[y]||s.precinctHeightPerLevel[y]!==c.precinctHeightPerLevel[y])&&(o=!1);var E=a(y,c.numResolutionLevels,m.getPrecinctWidth,t.getLevelWidth,t.getTileWidth),b=a(y,c.numResolutionLevels,m.getPrecinctWidth,t.getLevelWidth,t.getTileWidth);u&=E&&b}}if(!o)throw new i.j2kExceptions.UnsupportedFeatureException('Special Coding Style for Component (COC)','A.6.2');if(!u)throw new i.j2kExceptions.UnsupportedFeatureException('Precinct TopLeft which is not matched to tile TopLeft','B.6')}(),function(e){if(4!==e.length)throw new i.j2kExceptions.IllegalDataException('Illegal progression order '+e+': unexpected length');if('L'!==e[3])throw new i.jpipExceptions.IllegalDataException('Illegal target progression order of '+e,'A.3.2.1');var t=0<=e.indexOf('P'),n=0<=e.indexOf('C'),s=0<=e.indexOf('R');if(!t||!n||!s)throw new i.j2kExceptions.IllegalDataException('Illegal progression order '+e+': missing letter');if('RPCL'!==e)throw new i.j2kExceptions.UnsupportedFeatureException('Progression order of '+e,'A.6.1')}(s),this}},function(e,t,n){'use strict';var i=Math.min,s=n(0);e.exports=function(){function e(e,s,a,o){var l=0,c=o,d;do{if(!n(e,s))return null;var p=a?~s.currentByte:s.currentByte,u=i(r[p],s.validBitsInCurrentByte+1),g=u-1;if(c!==void 0){if(u>c){t(s,c),l+=c;break}c-=g}l+=g,d=u<=s.validBitsInCurrentByte,d?t(s,u):s.validBitsInCurrentByte=0}while(!d);return l}function t(e,t){e.validBitsInCurrentByte-=t,0<e.validBitsInCurrentByte&&(e.currentByte=255&e.currentByte<<t)}function n(e,t){if(0<t.validBitsInCurrentByte)return!0;var n=t.isSkipNextByte?2:1,i=[],r=e.copyBytes(i,0,{forceCopyAllRange:!0,databinStartOffset:t.nextOffsetToParse,maxLengthToCopy:n});if(r!==n)return!1;var a=t.originalByteWithoutShift;if(t.currentByte=i[n-1],t.validBitsInCurrentByte=8,t.originalByteWithoutShift=t.currentByte,255===a){if(0!=(128&i[0]))throw new s.j2kExceptions.IllegalDataException('Expected 0 bit after 0xFF byte','B.10.1');t.isSkipNextByte||(t.currentByte<<=1,t.validBitsInCurrentByte=7)}return t.isSkipNextByte=!1,t.nextOffsetToParse+=n,!0}var r=function(){var e=Array(255);e[0]=9,e[1]=8,e[2]=7,e[3]=7;var t;for(t=4;7>=t;++t)e[t]=6;for(t=8;15>=t;++t)e[t]=5;for(t=16;31>=t;++t)e[t]=4;for(t=32;63>=t;++t)e[t]=3;for(t=64;127>=t;++t)e[t]=2;for(t=128;255>=t;++t)e[t]=1;for(t=0;255>=t;++t)e[t-256]=e[t];return e}();return function(r,a){var o=a.createTransactionalObject({nextOffsetToParse:0,validBitsInCurrentByte:0,originalByteWithoutShift:null,currentByte:null,isSkipNextByte:!1}),l=null;Object.defineProperty(this,'activeTransaction',{get:function(){if(null==l||!l.isActive)throw new s.jpipExceptions.InternalErrorException('No active transaction in bitstreamReader');return l}}),Object.defineProperty(this,'bitsCounter',{get:function(){var e=o.getValue(l);if(n(r,e),e.isSkipNextByte)throw new s.jpipExceptions.InternalErrorException('Unexpected state of bitstreamReader: When 0xFF encountered, tryValidateCurrentByte should skip the whole byte  after shiftRemainingBitsInByte and clear isSkipNextByte. However the flag is still set');var t=8*e.nextOffsetToParse-e.validBitsInCurrentByte;return t}}),Object.defineProperty(this,'databinOffset',{get:function(){var e=o.getValue(l);if(e.isSkipNextByte)return e.nextOffsetToParse+1;if(0!=e.validBitsInCurrentByte%8||255===e.originalByteWithoutShift)throw new s.jpipExceptions.InternalErrorException('Cannot calculate databin offset when bitstreamReader  is in the middle of the byte');return e.nextOffsetToParse-e.validBitsInCurrentByte/8},set:function(e){var t=o.getValue(l);t.validBitsInCurrentByte=0,t.isSkipNextByte=!1,t.originalByteWithoutShift=null,t.nextOffsetToParse=e}}),this.startNewTransaction=function(){if(null!=l&&l.isActive)throw new s.jpipExceptions.InternalErrorException('Cannot start new transaction in bitstreamReader while another transaction is active');l=a.createTransaction()},this.shiftRemainingBitsInByte=function(){var e=o.getValue(l);e.isSkipNextByte=255===e.originalByteWithoutShift,e.validBitsInCurrentByte=Math.floor(e.validBitsInCurrentByte/8)},this.shiftBit=function(){var t=o.getValue(l);if(!n(r,t))return null;var i=e(r,t,!0,1);return i},this.countZerosAndShiftUntilFirstOneBit=function(t){var n=o.getValue(l),i=e(r,n,!1,t);return i},this.countOnesAndShiftUntilFirstZeroBit=function(t){var n=o.getValue(l),i=e(r,n,!0,t);return i},this.shiftBits=function(e){for(var s=0,a=o.getValue(l),c=e;0<c;){if(!n(r,a))return null;var d=i(a.validBitsInCurrentByte,c),p=a.currentByte>>8-d;s=(s<<d)+p,t(a,d),c-=d}return s}}}()},function(e,t,n){'use strict';var i=Math.ceil,s=Math.floor,r=n(0);e.exports=function(e,t,n,a){function o(t,n){var i=0,a=null;return function(){if(null===i)throw new r.jpipExceptions.InternalErrorException('Iterated too deep in tag tree');if(i===u.length)return i=null,null;var o=u.length-i-1,c=s(t>>o),d=s(n>>o),p=u[i].width*d+c,g=u[i].content[p];void 0===g&&(g=l(i,p));var m=g.getValue(e.activeTransaction);return null!=a&&a.minimalPossibleValue>m.minimalPossibleValue&&(m.minimalPossibleValue=a.minimalPossibleValue),a=m,++i,m}}function l(e,t){var n=a.createTransactionalObject({minimalPossibleValue:0,isFinalValue:!1});return u[e].content[t]=n,n}function c(){var t=p.getValue(e.activeTransaction);return t}function d(){p.setValue(e.activeTransaction,!0)}var p=a.createTransactionalObject(!1,!0),u;(function(){u=[];for(var e=t,s=n;1<=e||1<=s;){e=i(e),s=i(s);var r=e*s;u.unshift({width:e,height:s,content:Array(r)}),e/=2,s/=2}l(0,0)})(),this.setMinimalValueIfNotReadBits=function(t){if(!c()){var n=u[0].content[0],i=n.getValue(e.activeTransaction);i.minimalPossibleValue=t}},this.isSmallerThanOrEqualsTo=function(t,n,i){d();for(var s=o(t,n),a=s(),l;null!==a;){if(a.minimalPossibleValue>i)return!1;if(!a.isFinalValue){var c=i-a.minimalPossibleValue+1,p=e.countZerosAndShiftUntilFirstOneBit(c);if(null===p)return null;a.minimalPossibleValue+=p,p<c&&(a.isFinalValue=!0)}l=a,a=s()}var u=l.minimalPossibleValue<=i;if(u&&!l.isFinalValue)throw new r.jpipExceptions.InternalErrorException('Wrong parsing in TagTree.isSmallerThanOrEqualsTo: not sure if value is smaller than asked');return u},this.getValue=function(t,n){var i=o(t,n),s=i(),r;for(d();null!==s;){if(!s.isFinalValue){var a=e.countZerosAndShiftUntilFirstOneBit();if(null===a)return null;s.minimalPossibleValue+=a,s.isFinalValue=!0}r=s,s=i()}return r.minimalPossibleValue}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(){var e=function(){for(var e=164,t=Array(e),n=1,s=2,r=0;n<=e;){for(var a=n;a<s;++a)t[a]=r;n*=2,s*=2,++r}return t}();return function(t,n){var s=n.createTransactionalObject({lBlockValue:3});this.parse=function(n){var r=t.countOnesAndShiftUntilFirstZeroBit();if(null===r)return null;var a=s.getValue(t.activeTransaction);a.lBlockValue+=r;var o=e[n];if(o===void 0)throw new i.jpipExceptions.InternalErrorException('Unexpected value of coding passes '+n+'. Expected positive integer <= 164');var l=a.lBlockValue+o,c=t.shiftBits(l);return c}}}()},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,s,r,a){function o(t){var n=u.getValue(e.activeTransaction);if(n>=t+1)throw new i.jpipExceptions.InternalErrorException('Unexpected quality layer to parse')}function l(){if(null==d){d=Array(t),p=Array(t);for(var i=0;i<t;++i){d[i]=Array(n),p[i]=Array(n);for(var s=0;s<n;++s)d[i][s]=a.createCodeblockLengthParser(e,r),p[i][s]=r.createTransactionalObject({isIncluded:!1})}}}function c(t,n,i){var r=p[t][n].getValue(e.activeTransaction),a;if(a=r.isIncluded?e.shiftBit():g.isSmallerThanOrEqualsTo(t,n,i),null===a)return null;if(!a)return{codeblockBodyLengthBytes:0,codingPasses:0};var o=null;if(!r.isIncluded&&(o=m.getValue(t,n),null===o))return null;var l=s.parse(e);if(null===l)return null;var c=d[t][n],u=c.parse(l);if(null===u)return null;r.isIncluded=!0;var f={codeblockBodyLengthBytes:u,codingPasses:l};return null!==o&&(f.zeroBitPlanes=o),f}var d=null,p=null,u=r.createTransactionalObject(0,!0),g=a.createTagTree(e,t,n),m=a.createTagTree(e,t,n);this.calculateSubbandLength=function(i){o(i),l(),g.setMinimalValueIfNotReadBits(i);for(var s=0,r=0,a=Array(t*n),d=0;d<n;++d)for(var p=0,m;p<t;++p){if(m=c(p,d,i),null===m)return null;a[r++]=m,s+=m.codeblockBodyLengthBytes}return u.setValue(e.activeTransaction,i+1),{codeblockBodyLengthByIndex:a,overallBodyLengthBytes:s}}}},function(e,t,n){'use strict';var s=Math.ceil,r=Math.floor,i=n(0);e.exports=function(e,t,n,a,o,l){function c(e){for(;f.length<e;){x.startNewTransaction();var t=d(f.length);if(null===t)return void x.activeTransaction.abort();f.push(t),x.activeTransaction.commit()}}function d(e){var t;if(0<e){var n=f[e-1];t=n.headerStartOffset+n.headerLength+n.overallBodyLengthBytes}else t=a;if(x.databinOffset=t,E&&b){var i=g(145);if(null===i)return null;if(i){x.databinOffset+=6}}var s=x.shiftBit();if(null===s)return null;if(!s)return x.shiftRemainingBitsInByte(),{headerStartOffset:t,headerLength:1,codeblockBodyLengthByIndex:[],overallBodyLengthBytes:0};var r=p(e);if(null===r)return null;var o=x.databinOffset;return r.headerLength=o-t,r.headerStartOffset=t,r}function p(e){for(var t=0,n=null,i=0;i<P.length;++i){var s=P[i],r=s.calculateSubbandLength(e);if(null===r)return null;n=null==n?r.codeblockBodyLengthByIndex:n.concat(r.codeblockBodyLengthByIndex),t+=r.overallBodyLengthBytes}if(x.shiftRemainingBitsInByte(),C){var a=g(146);if(null===a)return null;if(a){x.databinOffset+=2}}return{codeblockBodyLengthByIndex:n,overallBodyLengthBytes:t}}function u(e){var t=Math.min(e,f.length);if(0===t)return{endOffset:a,numQualityLayers:0};var n=f[t-1],i=n.headerStartOffset+n.headerLength+n.overallBodyLengthBytes;return{endOffset:i,numQualityLayers:t}}function g(e){var t=[,,],i=n.copyBytes(t,0,{databinStartOffset:x.databinOffset,maxLengthToCopy:2,forceCopyAllRange:!1});switch(i){case 2:var s=255===t[0]&&t[1]===e;return s;case 1:return!(255!==t[0])&&null;default:return null;}}function m(){if(!E)throw new i.jpipExceptions.UnsupportedFeatureException('PPM or PPT','A.7.4 and A.7.5')}var f=[],x=l.createBitstreamReader(n),h=t.getNumCodeblocksXInPrecinct(o),y=t.getNumCodeblocksYInPrecinct(o),I=e.getNumQualityLayers(),E=e.getIsPacketHeaderNearData(),b=e.getIsStartOfPacketMarkerAllowed(),C=e.getIsEndPacketHeaderMarkerAllowed(),P=function(){for(var e=0===o.resolutionLevel?1:3,t=[],n=0;n<e;++n){var i,a;(0===o.resolutionLevel?(i=h,a=y):(i=1===n?s(h/2):r(h/2),a=0===n?s(y/2):r(y/2)),0!==i&&0!==a)&&t.push(l.createSubbandLengthInPacketHeaderCalculator(x,i,a))}return t}();this.calculateEndOffsetOfLastFullPacket=function(e){var t;if(!(e===void 0||e>=I))t=e;else if(!n.isAllDatabinLoaded())t=I;else{var i=n.getDatabinLengthIfKnown();return{endOffset:i,numQualityLayers:I}}m(),c(t);var s=u(t);return s},this.getPacketOffsetsByCodeblockIndex=function(e){return m(),c(e+1),f.length<=e?null:f[e]}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(n,r){var a=n.getCachedData(s);if(void 0!==a.calculator)return a.calculator;if(void 0===r)throw new i.jpipExceptions.InternalErrorException('precinctPosition should be given on the first time of using QualityLayersCache on this precinct');var o=e.getTileStructure(r.tileIndex),l=o.getComponentStructure(r.component);return a.calculator=t.createPacketLengthCalculator(o,l,n,0,r),a.calculator}var s='packetLengthCalculator';this.getPacketOffsetsByCodeblockIndex=function(e,t,i){var s=n(e,i),r=s.getPacketOffsetsByCodeblockIndex(t);return r},this.getQualityLayerOffset=function(e,t,i){var s=e.getExistingRanges(),r=n(e,i),a;1>s.length||0<s[0].start?(a=0,t=0):a=s[0].start+s[0].length;for(var o=r.calculateEndOffsetOfLastFullPacket(t);a<o.endOffset;){var l=o.numQualityLayers-1;o=r.calculateEndOffsetOfLastFullPacket(l)}return o}}},function(e,t,n){'use strict';var i=n(0),s=n(1);e.exports=function(e,t){function n(e,t){var n=s.createFetch(e,g,t);return e.on('isProgressiveChanged',n.isProgressiveChanged),e.on('terminate',n.terminate),e.on('stop',n.stop),e.on('resume',n.resum),n}t=t||{};var i=null,r=null,a=t.maxChannelsInSession||1,o=t.maxRequestsWaitingForResponseInChannel||1,l=e.getMainHeaderDatabin(),c=s.createMarkersParser(l),d=s.createOffsetsCalculator(l,c),p=s.createStructureParser(e,c,d),u=s.createCodestreamStructure(p,'RPCL'),g=s.createReconnectableRequester(a,o,u,e),m=s.createRequestParamsModifier(u);return g.setStatusCallback(function(e){var t=null;null!==e.exception&&(t=e.exception.toString());var n={isReady:e.isReady,exception:t};if(i&&(n.isReady||n.exception)){var s=i,a=r;if(i=null,r=null,!n.isReady)return void a(n.exception);var o=u.getSizesParams(),l=JSON.parse(JSON.stringify(o)),c=u.getDefaultTileStructure(),d=c.getDefaultComponentStructure();l.imageLevel=0,l.lowestQuality=1,l.highestQuality=c.getNumQualityLayers(),l.numResolutionLevelsForLimittedViewer=d.getNumResolutionLevels(),s(l)}}),this.open=function(e){return new Promise(function(t,n){i=t,r=n,g.open(e)})},this.close=function(){return new Promise(function(e){g.close(e)})},this.on=function(){},this.startFetch=function(e,t){var i=m.modify(t),s=n(e,i.progressiveness);s.move(i.codestreamPartParams)},this.startMovableFetch=function(e,t){var i=m.modify(t),s=n(e,i.progressiveness),r=g.dedicateChannelForMovableRequest();s.setDedicatedChannelHandle(r),e.on('move',s.move),s.move(i.codestreamPartParams)},this.reconnect=function(){g.reconnect()},this}},function(e,t,n){'use strict';function i(){this._image=new a.JpxImage}var s=Math.max,r=Math.min,a=n(41);e.exports=i;n(0);i.prototype.start=function(e){var t=this;return new Promise(function(n){var i={left:e.headersCodestream.offsetX,top:e.headersCodestream.offsetY,right:e.headersCodestream.offsetX+e.width,bottom:e.headersCodestream.offsetY+e.height},s=t._image.parseCodestream(e.headersCodestream.codestream,0,e.headersCodestream.codestream.length,{isOnlyParseHeaders:!0});t._image.addPacketsData(s,e.codeblocksData),t._image.decode(s,{regionToParse:i});var r=t._copyTilesPixelsToOnePixelsArray(t._image.tiles,i,t._image.componentsCount);n(r)})},i.prototype._copyTilesPixelsToOnePixelsArray=function(e,t,n){for(var a=e[0],o=t.right-t.left,l=t.bottom-t.top,c=new ImageData(o,l),d=4,p=o*d,u=0;u<e.length;++u){var i=e[u].left+e[u].width,g=e[u].top+e[u].height,m=s(t.left,e[u].left),f=s(t.top,e[u].top),x=r(t.right,i),h=r(t.bottom,g);if(m!==e[u].left||f!==e[u].top||x-m!==e[u].width||h-f!==e[u].height)throw'Unsupported tiles to copy';var y=m-t.left,I=f-t.top;this._copyTile(c.data,e[u],y*d+I*p,p,n)}return c},i.prototype._copyTile=function(e,t,n,i,s){var r=1,a=2,o=1,l=t.pixels||t.items;switch(void 0===s&&(s=l.length/(t.width*t.height)),s){case 1:r=0,a=0;break;case 3:o=3;break;case 4:o=4;break;default:throw'Unsupported components count '+s;}for(var c=n,d=0,p=0,u;p<t.height;++p){u=c;for(var g=0;g<t.width;++g)e[c+0]=l[d+0],e[c+1]=l[d+r],e[c+2]=l[d+a],e[c+3]=255,d+=o,c+=4;c=u+i}}},function(e,t,n){'use strict';var s=Math.max,a=Math.min,o=Math.ceil,r=Math.floor;Object.defineProperty(t,'__esModule',{value:!0}),t.JpxImage=void 0;var l=n(42),i=n(44),d=function(){function e(e){this.message='JPX error: '+e}return e.prototype=new Error,e.prototype.name='JpxError',e.constructor=e,e}(),c=function(){function e(){this.failOnCorruptedImage=!1}function t(e,t){e.x0=o(t.XOsiz/e.XRsiz),e.x1=o(t.Xsiz/e.XRsiz),e.y0=o(t.YOsiz/e.YRsiz),e.y1=o(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function n(e,t){for(var n=e.SIZ,r=[],l=o((n.Xsiz-n.XTOsiz)/n.XTsiz),c=o((n.Ysiz-n.YTOsiz)/n.YTsiz),d=0,u;d<c;d++)for(var g=0;g<l;g++)u={},u.tx0=s(n.XTOsiz+g*n.XTsiz,n.XOsiz),u.ty0=s(n.YTOsiz+d*n.YTsiz,n.YOsiz),u.tx1=a(n.XTOsiz+(g+1)*n.XTsiz,n.Xsiz),u.ty1=a(n.YTOsiz+(d+1)*n.YTsiz,n.Ysiz),u.width=u.tx1-u.tx0,u.height=u.ty1-u.ty0,u.components=[],r.push(u);e.tiles=r;for(var p=n.Csiz,m=0,i;m<p;m++){i=t[m];for(var f=0,x=r.length,h;f<x;f++)h={},u=r[f],h.tcx0=o(u.tx0/i.XRsiz),h.tcy0=o(u.ty0/i.YRsiz),h.tcx1=o(u.tx1/i.XRsiz),h.tcy1=o(u.ty1/i.YRsiz),h.width=h.tcx1-h.tcx0,h.height=h.tcy1-h.tcy0,u.components[m]=h}}function c(e,t,n){var i=t.codingStyleParameters,s={};return i.entropyCoderWithCustomPrecincts?(s.PPx=i.precinctsSizes[n].PPx,s.PPy=i.precinctsSizes[n].PPy):(s.PPx=15,s.PPy=15),s.xcb_=0<n?a(i.xcb,s.PPx-1):a(i.xcb,s.PPx),s.ycb_=0<n?a(i.ycb,s.PPy-1):a(i.ycb,s.PPy),s}function p(e,t,n){var i=1<<n.PPx,s=1<<n.PPy,a=0===t.resLevel,l=1<<n.PPx+(a?0:-1),c=1<<n.PPy+(a?0:-1),d=t.trx1>t.trx0?o(t.trx1/i)-r(t.trx0/i):0,p=t.try1>t.try0?o(t.try1/s)-r(t.try0/s):0;t.precinctParameters={precinctWidth:i,precinctHeight:s,numprecinctswide:d,numprecinctshigh:p,numprecincts:d*p,precinctWidthInSubband:l,precinctHeightInSubband:c}}function u(e,t,n){var o=n.xcb_,l=n.ycb_,c=1<<o,d=1<<l,p=t.tbx0>>o,u=t.tby0>>l,g=t.tbx1+c-1>>o,m=t.tby1+d-1>>l,f=t.resolution.precinctParameters,x=[],h=[],y,I,E,b;for(I=u;I<m;I++)for(y=p;y<g;y++){E={cbx:y,cby:I,tbx0:c*y,tby0:d*I,tbx1:c*(y+1),tby1:d*(I+1)},E.tbx0_=s(t.tbx0,E.tbx0),E.tby0_=s(t.tby0,E.tby0),E.tbx1_=a(t.tbx1,E.tbx1),E.tby1_=a(t.tby1,E.tby1);var C=r((E.tbx0_-t.tbx0)/f.precinctWidthInSubband),P=r((E.tby0_-t.tby0)/f.precinctHeightInSubband);if(b=C+P*f.numprecinctswide,E.precinctNumber=b,E.subbandType=t.type,E.Lblock=3,!(E.tbx1_<=E.tbx0_||E.tby1_<=E.tby0_)){x.push(E);var T=h[b];if(void 0===T?h[b]=T={cbxMin:y,cbyMin:I,cbxMax:y,cbyMax:I,pixelsPrecinct:t.resolution.pixelsPrecincts[b]}:(y<T.cbxMin?T.cbxMin=y:y>T.cbxMax&&(T.cbxMax=y),I<T.cbyMin?T.cbyMin=I:I>T.cbyMax&&(T.cbyMax=I)),void 0!==T.pixelsPrecinct){var S=T.pixelsPrecinct;E.tbx0_<S.tbxMin_?S.tbxMin_=E.tbx0_:S.tbxMax_=E.tbx1_,E.tby0_<S.tbyMin_?S.tbyMin_=E.tby0_:S.tbyMax_=E.tby1_}else T.pixelsPrecinct={codeblocks:[],tbxMin_:E.tbx0_,tbxMax_:E.tbx1_,tbyMin_:E.tby0_,tbyMax_:E.tby1_},t.resolution.pixelsPrecincts[b]=T.pixelsPrecinct;E.subbandPrecinct=T,T.pixelsPrecinct.codeblocks.push(E)}}t.codeblockParameters={codeblockWidth:o,codeblockHeight:l,numcodeblockwide:g-p+1,numcodeblockhigh:m-u+1},t.codeblocks=x,t.subbandPrecincts=h}function g(e,t,n){return{layerNumber:n,codeblocks:e.pixelsPrecincts[t].codeblocks}}function m(e){for(var t=e.SIZ,n=e.currentTile.index,a=e.tiles[n],o=a.codingStyleDefaultParameters.layersCount,c=t.Csiz,p=0,u=0;u<c;u++)p=s(p,a.components[u].codingStyleParameters.decompositionLevelsCount);var m=0,l=0,r=0,i=0;this.nextPacket=function(){for(;m<o;m++){for(;l<=p;l++){for(;r<c;r++){var e=a.components[r];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[l],n=t.precinctParameters.numprecincts,s;i<n;)return s=g(t,i,m),i++,s;i=0}}r=0}l=0}throw new d('Out of packets')}}function f(e){for(var t=e.SIZ,n=e.currentTile.index,a=e.tiles[n],o=a.codingStyleDefaultParameters.layersCount,c=t.Csiz,p=0,u=0;u<c;u++)p=s(p,a.components[u].codingStyleParameters.decompositionLevelsCount);var m=0,r=0,l=0,i=0;this.nextPacket=function(){for(;m<=p;m++){for(;r<o;r++){for(;l<c;l++){var e=a.components[l];if(!(m>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[m],n=t.precinctParameters.numprecincts,s;i<n;)return s=g(t,i,r),i++,s;i=0}}l=0}r=0}throw new d('Out of packets')}}function x(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],a=i.codingStyleDefaultParameters.layersCount,o=t.Csiz,u=0,m,l,r,c;for(r=0;r<o;r++){var p=i.components[r];u=s(u,p.codingStyleParameters.decompositionLevelsCount)}var f=new Int32Array(u+1);for(l=0;l<=u;++l){var x=0;for(r=0;r<o;++r){var h=i.components[r].resolutions;l<h.length&&(x=s(x,h[l].precinctParameters.numprecincts))}f[l]=x}m=0,l=0,r=0,c=0,this.nextPacket=function(){for(;l<=u;l++){for(;c<f[l];c++){for(;r<o;r++){var e=i.components[r];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){var t=e.resolutions[l],n=t.precinctParameters.numprecincts;if(!(c>=n)){for(;m<a;){var s=g(t,c,m);return m++,s}m=0}}}r=0}c=0}throw new d('Out of packets')}}function h(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],s=i.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=E(i),p=o,u=0,l=0,r=0,c=0,m=0;this.nextPacket=function(){for(;m<p.maxNumHigh;m++){for(;c<p.maxNumWide;c++){for(;r<a;r++){for(var e=i.components[r],t=e.codingStyleParameters.decompositionLevelsCount;l<=t;l++){var n=e.resolutions[l],f=o.components[r].resolutions[l],x=I(c,m,f,p,n);if(null!==x){for(;u<s;){var h=g(n,x,u);return u++,h}u=0}}l=0}r=0}c=0}throw new d('Out of packets')}}function y(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],s=i.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=E(i),p=0,l=0,r=0,c=0,u=0;this.nextPacket=function(){for(;r<a;++r){for(var e=i.components[r],t=o.components[r],n=e.codingStyleParameters.decompositionLevelsCount;u<t.maxNumHigh;u++){for(;c<t.maxNumWide;c++){for(;l<=n;l++){var m=e.resolutions[l],f=t.resolutions[l],x=I(c,u,f,t,m);if(null!==x){for(;p<s;){var h=g(m,x,p);return p++,h}p=0}}l=0}c=0}u=0}throw new d('Out of packets')}}function I(e,t,n,i,s){var r=e*i.minWidth,a=t*i.minHeight;if(0!=r%n.width||0!=a%n.height)return null;var o=a/n.width*s.precinctParameters.numprecinctswide;return r/n.height+o}function E(e){for(var t=Number.MAX_VALUE,n=e.components.length,i=t,o=t,l=0,d=0,p=Array(n),u=0;u<n;u++){for(var c=e.components[u],g=c.codingStyleParameters.decompositionLevelsCount,m=Array(g+1),f=t,x=t,h=0,y=0,I=1,E=g;0<=E;--E){var r=c.resolutions[E],b=I*r.precinctParameters.precinctWidth,C=I*r.precinctParameters.precinctHeight;f=a(f,b),x=a(x,C),h=s(h,r.precinctParameters.numprecinctswide),y=s(y,r.precinctParameters.numprecinctshigh),m[E]={width:b,height:C},I<<=1}i=a(i,f),o=a(o,x),l=s(l,h),d=s(d,y),p[u]={resolutions:m,minWidth:f,minHeight:x,maxNumWide:h,maxNumHigh:y}}return{components:p,minWidth:i,minHeight:o,maxNumWide:l,maxNumHigh:d}}function b(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],s=t.Csiz,a=0;a<s;a++){for(var l=i.components[a],g=l.codingStyleParameters.decompositionLevelsCount,I=[],E=[],b=0,C=0;C<=g;C++){var r=c(e,l,C),P={},T=1<<g-C;P.trx0=o(l.tcx0/T),P.try0=o(l.tcy0/T),P.trx1=o(l.tcx1/T),P.try1=o(l.tcy1/T),P.resLevel=C,P.pixelsPrecincts=[],p(e,P,r),I.push(P);var S;if(0===C)S={},S.type='LL',S.tbx0=o(l.tcx0/T),S.tby0=o(l.tcy0/T),S.tbx1=o(l.tcx1/T),S.tby1=o(l.tcy1/T),S.resolution=P,S.indexInTileComponent=b++,u(e,S,r),E.push(S),P.subbands=[S];else{var L=1<<g-C+1,v=[];S={},S.type='HL',S.tbx0=o(l.tcx0/L-0.5),S.tby0=o(l.tcy0/L),S.tbx1=o(l.tcx1/L-0.5),S.tby1=o(l.tcy1/L),S.resolution=P,S.indexInTileComponent=b++,u(e,S,r),E.push(S),v.push(S),S={},S.type='LH',S.tbx0=o(l.tcx0/L),S.tby0=o(l.tcy0/L-0.5),S.tbx1=o(l.tcx1/L),S.tby1=o(l.tcy1/L-0.5),S.resolution=P,S.indexInTileComponent=b++,u(e,S,r),E.push(S),v.push(S),S={},S.type='HH',S.tbx0=o(l.tcx0/L-0.5),S.tby0=o(l.tcy0/L-0.5),S.tbx1=o(l.tcx1/L-0.5),S.tby1=o(l.tcy1/L-0.5),S.resolution=P,S.indexInTileComponent=b++,u(e,S,r),E.push(S),v.push(S),P.subbands=v}}l.resolutions=I,l.subbands=E}var O=i.codingStyleDefaultParameters.progressionOrder;switch(O){case 0:i.packetsIterator=new m(e);break;case 1:i.packetsIterator=new f(e);break;case 2:i.packetsIterator=new x(e);break;case 3:i.packetsIterator=new h(e);break;case 4:i.packetsIterator=new y(e);break;default:throw new d('Unsupported progression order '+O);}}function C(e,t,n,s){function r(e){for(;u<e;){var i=t[n+p];p++,g?(I=I<<7|i,u+=7,g=!1):(I=I<<8|i,u+=8),255===i&&(g=!0)}return u-=e,I>>>u&(1<<e)-1}function a(e){return 255===t[n+p-1]&&t[n+p]===e?(o(1),!0):255===t[n+p]&&t[n+p+1]===e&&(o(2),!0)}function o(e){p+=e}function c(){u=0,g&&(p++,g=!1)}function d(){if(0===r(1))return 1;if(0===r(1))return 2;var e=r(2);return 3>e?e+3:(e=r(5),31>e)?e+6:(e=r(7),e+37)}for(var p=0,u=0,g=!1,m=e.currentTile.index,f=e.tiles[m],x=e.COD.sopMarkerUsed,h=e.COD.ephMarkerUsed,y=f.packetsIterator,I;p<s;){c(),x&&a(145)&&o(4);var E=y.nextPacket();if(r(1)){for(var b=E.layerNumber,C=[],P=0,i=E.codeblocks.length,T;P<i;P++){T=E.codeblocks[P];var S=T.subbandPrecinct,L=T.cbx-S.cbxMin,v=T.cby-S.cbyMin,O=!1,k=!1,R;if(void 0!==T.included)O=!!r(1);else{S=T.subbandPrecinct;var A,N;if(void 0!==S.inclusionTree)A=S.inclusionTree;else{var j=S.cbxMax-S.cbxMin+1,M=S.cbyMax-S.cbyMin+1;A=new _(j,M,b),N=new D(j,M),S.inclusionTree=A,S.zeroBitPlanesTree=N}if(A.reset(L,v,b))for(;;)if(!r(1)){A.incrementValue(b);break}else if(R=!A.nextLevel(),R){T.included=!0,O=k=!0;break}}if(O){if(k){for(N=S.zeroBitPlanesTree,N.reset(L,v);;)if(!r(1))N.incrementValue();else if(R=!N.nextLevel(),R)break;T.zeroBitPlanes=N.value}for(var F=d();r(1);)T.Lblock++;var B=(0,l.log2)(F),w=(F<1<<B?B-1:B)+T.Lblock,q=r(w);C.push({codeblock:T,codingpasses:F,dataLength:q})}}for(c(),h&&a(146);0<C.length;){var X=C.shift();T=X.codeblock,void 0===T.data&&(T.data=[]),T.data.push({data:t,start:n+p,end:n+p+X.dataLength,codingpasses:X.codingpasses}),p+=X.dataLength}}}return p}function P(e,t,n){var s=e.tbx1_-e.tbx0_,r=e.tby1_-e.tby0_,a,o;a=new A(s,r,e.subbandType,e.zeroBitPlanes,t),o=2;var l=e.data,c=0,d=0,p,u,g;for(p=0,u=l.length;p<u;p++)g=l[p],c+=g.end-g.start,d+=g.codingpasses;var m=new Uint8Array(c),f=0;for(p=0,u=l.length;p<u;p++){g=l[p];var x=g.data.subarray(g.start,g.end);m.set(x,f),f+=x.length}var h=new i.ArithmeticDecoder(m,0,c);for(a.setDecoder(h),p=0;p<d;p++)0===o?a.runSignificancePropagationPass():1===o?a.runMagnitudeRefinementPass():2===o?(a.runCleanupPass(),n&&a.checkSegmentationSymbol()):void 0,o=(o+1)%3;return a}function T(e,t,i,s,r,a,o,l,c,d){for(var p=r.tbx1_-r.tbx0_,u=r.tby1_-r.tby0_,g=P(r,l,d),m=g.coefficentsSign,f=g.coefficentsMagnitude,x=g.bitsDecoded,h=c?0:0.5,y=a.x0-r.tbx0_+(a.y0-r.tby0_)*p,I=t,E=a.y0,b,C,T;E<a.y1;++E){var S=y,L=I;for(y+=p,I+=s,b=a.x0;b<a.x1;b++)C=f[S],0!==C&&(C=(C+h)*o,0!==m[S]&&(C=-C),T=x[S],e[L]=c&&T>=l?C:C*(1<<l-T)),L+=i,++S}}function S(e,t,n,o,l,c,d,p){var u=p.x1-p.x0,g=p.y1-p.y0,m=new Float32Array(u*g),f={x0:0,x1:0,y0:0,y1:1},x;if(e.hasDecodedCoefficients){decodedCoefficients;for(var h=!0,y=0,I=e.pixelsPrecincts.length,E;y<I;++y)if(E=e.pixelsPrecincts[y],x0=s(E.tbxMin_,p.x0),y0=s(E.tbyMin_,p.y0),x1=a(E.tbxMax_,p.x1),y1=a(E.tbyMax_,p.y1),!(x0>=x1||y0>=y1)){if(!E.decodedCoefficients){h=!1;continue}for(var b=E.decodedCoefficients,C=x1-x0,P=E.tbxMax_-E.tbxMin_,S=p.x1-p.x0,L=x0-E.tbxMin_+(y0-E.tbyMin_)*P,v=x0-p.x0+(y0-p.y0)*S,O=y0;O<y1;++O)m.set(b.subarray(L,L+C),v),L+=P,v+=S}if(h)return m}for(var k=0,D=e.subbands.length;k<D;k++){var _=e.subbands[k],A='LL'!==_.type,x;A?(f.x0=(p.x0-e.trx0)/2+_.tbx0,f.y0=(p.y0-e.try0)/2+_.tby0,f.x1=(p.x1-e.trx0)/2+_.tbx0,f.y1=(p.y1-e.try0)/2+_.tby0,x=f):x=p;var N='H'===_.type.charAt(0)?1:0,j='H'===_.type.charAt(1)?u:0,A='LL'!==_.type,M=A?2:1,F=u*M,B={x0:0,y0:0,x1:0,y1:0},w,q;if(!n){w=t[0].mu;var X=_.resolution.resLevel;q=t[0].epsilon+(0<X?1-X:0)}else{var r=_.indexInTileComponent;w=t[r].mu,q=t[r].epsilon}for(var H=R[_.type],Y=c?1:Math.pow(2,o+H-q)*(1+w/2048),z=l+q-1,U=0,i=_.codeblocks.length,W;U<i;++U)if((W=_.codeblocks[U],void 0!==W.data)&&!W.subbandPrecinct.pixelsPrecinct.decodedCoefficients&&(B.x0=s(W.tbx0_,x.x0),B.y0=s(W.tby0_,x.y0),B.x1=a(W.tbx1_,x.x1),B.y1=a(W.tby1_,x.y1),!(B.x0>=B.x1||B.y0>=B.y1))){var Q=(B.x0-x.x0)*M+(B.y0-x.y0)*F+(N+j);T(m,Q,M,F,W,B,Y,z,c,d)}}return m}function L(e,t,n,l){for(var c=t.codingStyleParameters,d=t.quantizationParameters,p=c.decompositionLevelsCount,u=d.SPqcds,g=d.scalarExpounded,m=d.guardBits,f=c.segmentationSymbolUsed,x=e.components[n].precision,h=c.reversibleTransformation,y=[],I={x0:0,y0:0,x1:0,y1:0},E=0;E<=p;E++){var i=t.resolutions[E],b=i.trx1-i.trx0,C=i.try1-i.try0,I;if(l===void 0)I.x0=i.trx0,I.y0=i.try0,I.x1=i.trx1,I.y1=i.try1;else{var P=1<<p-E,T=4;I.x0=o(l.x0/P)-T,I.y0=o(l.y0/P)-T,I.x1=o(l.x1/P)+T,I.y1=o(l.y1/P)+T,I.x0=2*r(I.x0/2)+i.trx0,I.y0=2*r(I.y0/2)+i.try0,I.x1=2*r(I.x1/2)+i.trx0,I.y1=2*r(I.y1/2)+i.try0,I.x0=s(I.x0,i.trx0),I.y0=s(I.y0,i.try0),I.x1=a(I.x1,i.trx1),I.y1=a(I.y1,i.try1)}var L=S(i,u,g,x,m,h,f,I),v={x0:I.x0-i.trx0,y0:I.y0-i.try0,x1:I.x1-i.trx0,y1:I.y1-i.try0};y.push({width:b,height:C,items:L,relativeRegionInLevel:v})}return y}function v(e,t,n){var r=t.components[n],o=r.codingStyleParameters,l=o.reversibleTransformation,c=l?new M:new j,d;if(void 0!==e.regionToParse){var p=a(r.tcx1,e.regionToParse.right),u=a(r.tcy1,e.regionToParse.bottom);d={x0:s(0,e.regionToParse.left-r.tcx0),y0:s(0,e.regionToParse.top-r.tcy0),x1:p-r.tcx0,y1:u-r.tcy0}}var g=L(e,r,n,d),m=c.calculate(g,r.tcx0,r.tcy0),f=m.relativeRegionInLevel,x=f.x1-f.x0,h=!1;if(void 0!==e.regionToParse&&(h=d.x0!==f.x0||d.y0!==f.y0||d.x1!==f.x1||d.y1!==f.y1),!h){var y=f.y1-f.y0;return{left:r.tcx0,top:r.tcy0,width:x,height:y,items:m.items}}for(var I=d.x1-d.x0,E=d.y1-d.y0,b=m.items,C=new Float32Array(I*E),P=d.y0-f.y0,T=d.x0-f.x0,S=0,v=T+x*P,O=0,i;O<E;++O)i=v+I,C.set(b.subarray(v,i),S),v+=x,S+=I;return{left:r.tcx0+d.x0,top:r.tcy0+d.y0,width:I,height:E,items:C}}function O(e){for(var t=e.SIZ,n=e.components,s=t.Csiz,r=[],a=0,i=e.tiles.length,o;a<i;a++)if(o=e.tiles[a],!(void 0!==e.regionToParse&&(e.regionToParse.left>=o.tx1||e.regionToParse.top>=o.ty1||e.regionToParse.right<=o.tx0||e.regionToParse.bottom<=o.ty0))){var l=[],d;for(d=0;d<s;d++)l[d]=v(e,o,d);var c=l[0],p=new Uint8ClampedArray(c.items.length*s),u={left:c.left,top:c.top,width:c.width,height:c.height,items:p},m=0,f,x,h,y,I,E,b;if(o.codingStyleDefaultParameters.multipleComponentTransform){var C=4===s,P=l[0].items,T=l[1].items,S=l[2].items,L=C?l[3].items:null;f=n[0].precision-8,x=(128<<f)+0.5;var O=o.components[0],k=s-3;if(y=P.length,!O.codingStyleParameters.reversibleTransformation)for(h=0;h<y;h++,m+=k)I=P[h]+x,E=T[h],b=S[h],p[m++]=I+1.402*b>>f,p[m++]=I-0.34413*E-0.71414*b>>f,p[m++]=I+1.772*E>>f;else for(h=0;h<y;h++,m+=k){I=P[h]+x,E=T[h],b=S[h];var R=I-(b+E>>2);p[m++]=R+b>>f,p[m++]=R>>f,p[m++]=R+E>>f}if(C)for(h=0,m=3;h<y;h++,m+=4)p[m]=L[h]+x>>f}else for(d=0;d<s;d++){var g=l[d].items;for(f=n[d].precision-8,x=(128<<f)+0.5,(m=d,h=0,y=g.length);h<y;h++)p[m]=g[h]+x>>f,m+=s}r.push(u)}return r}function k(e,t){for(var n=e.SIZ,i=n.Csiz,s=e.tiles[t],r=0;r<i;r++){var a=s.components[r],o=e.currentTile.QCC[r]===void 0?e.currentTile.QCD:e.currentTile.QCC[r];a.quantizationParameters=o;var l=e.currentTile.COC[r]===void 0?e.currentTile.COD:e.currentTile.COC[r];a.codingStyleParameters=l}s.codingStyleDefaultParameters=e.currentTile.COD}var R={LL:0,LH:1,HL:1,HH:2};e.prototype={parse:function(e){var t=(0,l.readUint16)(e,0);if(65359===t)return void this.parseCodestream(e,0,e.length);for(var n=0,i=e.length;n<i;){var s=8,r=(0,l.readUint32)(e,n),a=(0,l.readUint32)(e,n+4);if(n+=s,1===r&&(r=4294967296*(0,l.readUint32)(e,n)+(0,l.readUint32)(e,n+4),n+=8,s+=8),0===r&&(r=i-n+s),r<s)throw new d('Invalid box field size');var o=r-s,c=!0;switch(a){case 1785737832:c=!1;break;case 1668246642:var p=e[n];if(1===p){var u=(0,l.readUint32)(e,n+3);switch(u){case 16:case 17:case 18:break;default:(0,l.warn)('Unknown colorspace '+u);}}else 2===p&&(0,l.info)('ICC profile not supported');break;case 1785737827:this.parseCodestream(e,n,n+o);break;case 1783636000:218793738!==(0,l.readUint32)(e,n)&&(0,l.warn)('Invalid JP2 signature');break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:var g=String.fromCharCode(255&a>>24,255&a>>16,255&a>>8,255&a);(0,l.warn)('Unsupported header type '+a+' ('+g+')');}c&&(n+=o)}},parseImageProperties:function(e){for(var t=e.getByte();0<=t;){var n=t;t=e.getByte();var i=n<<8|t;if(65361==i){e.skip(4);var s=e.getInt32()>>>0,r=e.getInt32()>>>0,a=e.getInt32()>>>0,o=e.getInt32()>>>0;e.skip(16);var l=e.getUint16();return this.width=s-a,this.height=r-o,this.componentsCount=l,void(this.bitsPerComponent=8)}}throw new d('No size marker found in JPX stream')},parseCodestream:function(e,s,r,a){var o={};a=a||{};var c=!!a.isOnlyParseHeaders,p=a.regionToParse;if(void 0!==p&&c)throw'JPX Error: options.regionToParse is uneffective if options.isOnlyParseHeaders = true';var u=!1;try{for(var g=s,m;g+1<r;){m=(0,l.readUint16)(e,g),g+=2;var f=0,x,h,y,I,E,P;switch(m){case 65359:o.mainHeader=!0;break;case 65497:break;case 65361:f=(0,l.readUint16)(e,g);var T={};T.Xsiz=(0,l.readUint32)(e,g+4),T.Ysiz=(0,l.readUint32)(e,g+8),T.XOsiz=(0,l.readUint32)(e,g+12),T.YOsiz=(0,l.readUint32)(e,g+16),T.XTsiz=(0,l.readUint32)(e,g+20),T.YTsiz=(0,l.readUint32)(e,g+24),T.XTOsiz=(0,l.readUint32)(e,g+28),T.YTOsiz=(0,l.readUint32)(e,g+32);var S=(0,l.readUint16)(e,g+36);T.Csiz=S;var L=[],v=!0;x=g+38;for(var O=0,i;O<S;O++)i={precision:(127&e[x])+1,isSigned:!!(128&e[x]),XRsiz:e[x+1],YRsiz:e[x+2]},x+=3,t(i,T),L.push(i),void 0!==p&&(v&=1===i.XRsiz&&1===i.YRsiz);if(o.SIZ=T,o.components=L,n(o,L),o.QCC=[],o.COC=[],!v)throw new Error('JPX Error: When regionToParse is used, component size other than 1 is not supported');break;case 65372:f=(0,l.readUint16)(e,g);var R={};switch(x=g+2,h=e[x++],31&h){case 0:I=8,E=!0;break;case 1:I=16,E=!1;break;case 2:I=16,E=!0;break;default:throw new Error('Invalid SQcd value '+h);}for(R.noQuantization=8===I,R.scalarExpounded=E,R.guardBits=h>>5,y=[];x<f+g;){var D={};8===I?(D.epsilon=e[x++]>>3,D.mu=0):(D.epsilon=e[x]>>3,D.mu=(7&e[x])<<8|e[x+1],x+=2),y.push(D)}R.SPqcds=y,o.mainHeader?o.QCD=R:(o.currentTile.QCD=R,o.currentTile.QCC=[]);break;case 65373:f=(0,l.readUint16)(e,g);var _={};x=g+2;var A;switch(257>o.SIZ.Csiz?A=e[x++]:(A=(0,l.readUint16)(e,x),x+=2),h=e[x++],31&h){case 0:I=8,E=!0;break;case 1:I=16,E=!1;break;case 2:I=16,E=!0;break;default:throw new Error('Invalid SQcd value '+h);}for(_.noQuantization=8===I,_.scalarExpounded=E,_.guardBits=h>>5,y=[];x<f+g;)D={},8===I?(D.epsilon=e[x++]>>3,D.mu=0):(D.epsilon=e[x]>>3,D.mu=(7&e[x])<<8|e[x+1],x+=2),y.push(D);_.SPqcds=y,o.mainHeader?o.QCC[A]=_:o.currentTile.QCC[A]=_;break;case 65362:f=(0,l.readUint16)(e,g);var N={};x=g+2;var j=e[x++];N.entropyCoderWithCustomPrecincts=!!(1&j),N.sopMarkerUsed=!!(2&j),N.ephMarkerUsed=!!(4&j),N.progressionOrder=e[x++],N.layersCount=(0,l.readUint16)(e,x),x+=2,N.multipleComponentTransform=e[x++],N.decompositionLevelsCount=e[x++],N.xcb=(15&e[x++])+2,N.ycb=(15&e[x++])+2;var M=e[x++];if(N.selectiveArithmeticCodingBypass=!!(1&M),N.resetContextProbabilities=!!(2&M),N.terminationOnEachCodingPass=!!(4&M),N.verticalyStripe=!!(8&M),N.predictableTermination=!!(16&M),N.segmentationSymbolUsed=!!(32&M),N.reversibleTransformation=e[x++],N.entropyCoderWithCustomPrecincts){for(var F=[],B;x<f+g;)B=e[x++],F.push({PPx:15&B,PPy:B>>4});N.precinctsSizes=F}var w=[];if(N.selectiveArithmeticCodingBypass&&w.push('selectiveArithmeticCodingBypass'),N.resetContextProbabilities&&w.push('resetContextProbabilities'),N.terminationOnEachCodingPass&&w.push('terminationOnEachCodingPass'),N.verticalyStripe&&w.push('verticalyStripe'),N.predictableTermination&&w.push('predictableTermination'),0<w.length)throw u=!0,new Error('Unsupported COD options ('+w.join(', ')+')');o.mainHeader?o.COD=N:(o.currentTile.COD=N,o.currentTile.COC=[]);break;case 65424:f=(0,l.readUint16)(e,g),P={},P.index=(0,l.readUint16)(e,g+2),P.length=(0,l.readUint32)(e,g+4),P.dataEnd=P.length+g-2,P.partIndex=e[g+8],P.partsCount=e[g+9],o.mainHeader=!1,0===P.partIndex&&(P.COD=o.COD,P.COC=o.COC.slice(0),P.QCD=o.QCD,P.QCC=o.QCC.slice(0)),o.currentTile=P;break;case 65427:P=o.currentTile,0===P.partIndex&&(k(o,P.index),b(o)),f=P.dataEnd-g,c||C(o,e,g,f);break;case 65365:case 65367:case 65368:case 65380:f=(0,l.readUint16)(e,g);break;case 65363:throw new Error('Codestream code 0xFF53 (COC) is not implemented');default:throw new Error('Unknown codestream code: '+m.toString(16));}g+=f}}catch(t){if(u||this.failOnCorruptedImage)throw new d(t.message);else(0,l.warn)('JPX: Trying to recover from: '+t.message)}return c||this.decode(o,a),this.width=o.SIZ.Xsiz-o.SIZ.XOsiz,this.height=o.SIZ.Ysiz-o.SIZ.YOsiz,this.componentsCount=o.SIZ.Csiz,o},addPacketsData:function(e,t){for(var n=0;n<t.packetDataOffsets.length;++n)for(var s=t.packetDataOffsets[n],r=e.tiles[s.tileIndex],a=r.components[s.c],o=a.resolutions[s.r],l=s.p,c=o.pixelsPrecincts[l].codeblocks,d=0;d<s.codeblockOffsets.length;++d){var i=s.codeblockOffsets[d],p=i.start===i.end;if(!p){var u=c[d];if(void 0===u.data&&(u.data=[]),void 0!==i.zeroBitPlanes){if(void 0===u.zeroBitPlanes&&(u.zeroBitPlanes=i.zeroBitPlanes),u.zeroBitPlanes!==i.zeroBitPlanes)throw'JPX Error: Unmatched zero bit planes';}else if(void 0===u.zeroBitPlanes)throw'JPX Error: zeroBitPlanes is unknown';u.included=!0,u.data.push({data:t.data,start:i.start,end:i.end,codingpasses:i.codingpasses})}}},decodePrecinctCoefficients:function(e,t,n,i,s){var r=e.tiles[t],a=r.components[n],o=a.resolutions[i],l=o.pixelsPrecincts[s],c=a.codingStyleParameters,d=a.quantizationParameters,p=d.SPqcds,u=d.scalarExpounded,g=d.guardBits,m=c.segmentationSymbolUsed,f=a.precision,x=c.reversibleTransformation,h={x0:l.tbxMin_,x1:l.tbxMax_,y0:l.tbyMin_,y1:l.tbyMax_},y=S(o,p,u,f,g,x,m,h);return y},setPrecinctCoefficients:function(e,t,n,i,s,r){var a=e.tiles[n],o=a.components[i],l=o.resolutions[s],c=l.pixelsPrecincts[r];c.decodedCoefficients=t,l.hasDecodedCoefficients=!0},decode:function(e,t){if(t!==void 0&&t.regionToParse!==void 0){var n=t.regionToParse;if(n.top===void 0||n.left===void 0||n.right===void 0||n.bottom===void 0)throw new Error('JPX Error: Either left, top, right or bottom are undefined in regionToParse');e.regionToParse=n}this.tiles=O(e),e.regionToParse=void 0}};var D=function(){function e(e,t){var n=(0,l.log2)(s(e,t))+1;this.levels=[];for(var r=0,i;r<n;r++)i={width:e,height:t,items:[]},this.levels.push(i),e=o(e/2),t=o(t/2)}return e.prototype={reset:function(e,t){for(var n=0,i=0,s;n<this.levels.length;){s=this.levels[n];var r=e+t*s.width;if(void 0!==s.items[r]){i=s.items[r];break}s.index=r,e>>=1,t>>=1,n++}n--,s=this.levels[n],s.items[s.index]=i,this.currentLevel=n,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return(e--,0>e)?(this.value=n,!1):(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),_=function(){function e(e,t,n){var r=(0,l.log2)(s(e,t))+1;this.levels=[];for(var a=0,i;a<r;a++){i=new Uint8Array(e*t);for(var c=0,d=i.length;c<d;c++)i[c]=n;var p={width:e,height:t,items:i};this.levels.push(p),e=o(e/2),t=o(t/2)}}return e.prototype={reset:function(e,t,n){for(var i=0;i<this.levels.length;){var s=this.levels[i],r=e+t*s.width;s.index=r;var a=s.items[r];if(255===a)break;if(a>n)return this.currentLevel=i,this.propagateValues(),!1;e>>=1,t>>=1,i++}return this.currentLevel=i-1,!0},incrementValue:function(e){var t=this.levels[this.currentLevel];t.items[t.index]=e+1,this.propagateValues()},propagateValues:function(){for(var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];0<=--e;)t=this.levels[e],t.items[t.index]=n},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return(t.items[t.index]=255,e--,!(0>e))&&(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),A=function(){function e(e,t,n,a,l){this.width=e,this.height=t,this.contextLabelTable='HH'===n?o:'HL'===n?r:s;var c=e*t;this.neighborsSignificance=new Uint8Array(c),this.coefficentsSign=new Uint8Array(c),this.coefficentsMagnitude=14<l?new Uint32Array(c):6<l?new Uint16Array(c):new Uint8Array(c),this.processingFlags=new Uint8Array(c);var d=new Uint8Array(c);if(0!==a)for(var p=0;p<c;p++)d[p]=a;this.bitsDecoded=d,this.reset()}var t=17,n=18,s=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),r=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),o=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);return e.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[t]=92,this.contexts[n]=6},setNeighborsSignificance:function(e,t,n){var s=this.neighborsSignificance,r=this.width,a=this.height,o=0<t,l=t+1<r,c;0<e&&(c=n-r,o&&(s[c-1]+=16),l&&(s[c+1]+=16),s[c]+=4),e+1<a&&(c=n+r,o&&(s[c-1]+=16),l&&(s[c+1]+=16),s[c]+=4),o&&(s[n-1]+=1),l&&(s[n+1]+=1),s[n]|=128},runSignificancePropagationPass:function(){for(var e=this.decoder,t=this.width,n=this.height,s=this.coefficentsMagnitude,r=this.coefficentsSign,a=this.neighborsSignificance,o=this.processingFlags,l=this.contexts,c=this.contextLabelTable,d=this.bitsDecoded,p=0;p<n;p+=4)for(var u=0,g;u<t;u++){g=p*t+u;for(var m=0,f;4>m&&(f=p+m,!(f>=n));m++,g+=t)if(o[g]&=-2,!s[g]&&a[g]){var i=c[a[g]],x=e.readBit(l,i);if(x){var h=this.decodeSignBit(f,u,g);r[g]=h,s[g]=1,this.setNeighborsSignificance(f,u,g),o[g]|=2}d[g]++,o[g]|=1}}},decodeSignBit:function(e,t,n){var i=this.width,s=this.height,r=this.coefficentsMagnitude,a=this.coefficentsSign,o,l,c,d,p,u;d=0<t&&0!==r[n-1],t+1<i&&0!==r[n+1]?(c=a[n+1],d?(l=a[n-1],o=1-c-l):o=1-c-c):d?(l=a[n-1],o=1-l-l):o=0;var g=3*o;return d=0<e&&0!==r[n-i],e+1<s&&0!==r[n+i]?(c=a[n+i],d?(l=a[n-i],o=1-c-l+g):o=1-c-c+g):d?(l=a[n-i],o=1-l-l+g):o=g,0<=o?(p=9+o,u=this.decoder.readBit(this.contexts,p)):(p=9-o,u=1^this.decoder.readBit(this.contexts,p)),u},runMagnitudeRefinementPass:function(){for(var e=this.decoder,t=this.width,n=this.height,i=this.coefficentsMagnitude,s=this.neighborsSignificance,r=this.contexts,o=this.bitsDecoded,l=this.processingFlags,c=1,d=2,p=t*n,u=0,g;u<p;u=g){g=a(p,u+4*t);for(var m=0;m<t;m++)for(var f=u+m;f<g;f+=t)if(i[f]&&0==(l[f]&c)){var x=16;if(0!=(l[f]&d)){l[f]^=d;var h=127&s[f];x=0==h?15:14}var y=e.readBit(r,x);i[f]=i[f]<<1|y,o[f]++,l[f]|=c}}},runCleanupPass:function(){for(var e=this.decoder,s=this.width,r=this.height,o=this.neighborsSignificance,l=this.coefficentsMagnitude,c=this.coefficentsSign,d=this.contexts,p=this.contextLabelTable,u=this.bitsDecoded,g=this.processingFlags,m=2,f=s,x=2*s,h=3*s,y=0,I;y<r;y=I){I=a(y+4,r);for(var E=y*s,b=y+3<r,C=0;C<s;C++){var P=E+C,T=b&&0===g[P]&&0===g[P+f]&&0===g[P+x]&&0===g[P+h]&&0===o[P]&&0===o[P+f]&&0===o[P+x]&&0===o[P+h],S=0,L=P,v=y,i;if(T){var O=e.readBit(d,n);if(!O){u[P]++,u[P+f]++,u[P+x]++,u[P+h]++;continue}S=e.readBit(d,t)<<1|e.readBit(d,t),0!=S&&(v=y+S,L+=S*s),i=this.decodeSignBit(v,C,L),c[L]=i,l[L]=1,this.setNeighborsSignificance(v,C,L),g[L]|=m,L=P;for(var k=y;k<=v;k++,L+=s)u[L]++;S++}for(v=y+S;v<I;v++,L+=s)if(!(l[L]||0!=(g[L]&1))){var R=p[o[L]],D=e.readBit(d,R);1===D&&(i=this.decodeSignBit(v,C,L),c[L]=i,l[L]=1,this.setNeighborsSignificance(v,C,L),g[L]|=m),u[L]++}}}},checkSegmentationSymbol:function(){var e=this.decoder,n=this.contexts,i=e.readBit(n,t)<<3|e.readBit(n,t)<<2|e.readBit(n,t)<<1|e.readBit(n,t);if(10!=i)throw new d('Invalid segmentation symbol')}},e}(),N=function(){function e(){}return e.prototype.calculate=function(e,t,n){for(var s=e[0],r=1,i=e.length;r<i;r++)s=this.iterate(s,e[r],t,n);return s},e.prototype.extend=function(e,t,n){var i=t-1,s=t+1,r=t+n-2,a=t+n;e[i--]=e[s++],e[a++]=e[r--],e[i--]=e[s++],e[a++]=e[r--],e[i--]=e[s++],e[a++]=e[r--],e[i]=e[s],e[a]=e[r]},e.prototype.iterate=function(e,t,n,s){var r=t.relativeRegionInLevel;if(2*e.relativeRegionInLevel.x0>r.x0||2*e.relativeRegionInLevel.y0>r.y0||2*e.relativeRegionInLevel.x1<r.x1||2*e.relativeRegionInLevel.y1<r.y1)throw new Error('JPX Error: region in LL is smaller than region in higher resolution level');if(0!=r.x0%2||0!=r.y0%2)throw new Error('JPX Error: region in HL/LH/HH subbands begins in odd coefficients');var o=e.items,c=r.x1-r.x0,d=r.y1-r.y0,p=e.relativeRegionInLevel.x1-e.relativeRegionInLevel.x0,g=r.x0/2-e.relativeRegionInLevel.x0,m=r.y0/2-e.relativeRegionInLevel.y0,f=t.items,x,i,h,y,l,u;for(x=0;x<d;x+=2)for(y=x*c,h=g+m*p+p*x/2,i=0;i<c;i+=2,h++,y+=2)f[y]=o[h];o=e.items=null;var I=4,E=new Float32Array(c+2*I);if(1!=c)for(u=0,h=0;u<d;u++,h+=c)E.set(f.subarray(h,h+c),I),this.extend(E,I,c),this.filter(E,I,c),f.set(E.subarray(I,I+c),h);else if(0!=(1&n))for(u=0,h=0;u<d;u++,h+=c)f[h]*=0.5;var C=16,P=[];for(x=0;x<C;x++)P.push(new Float32Array(d+2*I));var T=0,S;if(e=I+d,1!=d)for(l=0;l<c;l++){if(0==T){for(C=a(c-l,C),h=l,y=I;y<e;h+=c,y++)for(S=0;S<C;S++)P[S][y]=f[h+S];T=C}T--;var b=P[T];if(this.extend(b,I,d),this.filter(b,I,d),0===T)for(h=l-C+1,y=I;y<e;h+=c,y++)for(S=0;S<C;S++)f[h+S]=P[S][y]}else if(0!=(1&s))for(l=0;l<c;l++)f[l]*=0.5;return{relativeRegionInLevel:r,width:c,height:d,items:f}},e}(),j=function(){function e(){N.call(this)}return e.prototype=Object.create(N.prototype),e.prototype.filter=function(e,t,i){var s=i>>1;t|=0;var r=-1.586134342059924,a=-0.052980118572961,o=0.882911075530934,l=0.443506852043971,c=1.230174104914001,d,p,n,u;for(d=t-3,p=s+4;p--;d+=2)e[d]*=1/c;for(d=t-2,n=l*e[d-1],p=s+3;p--&&(u=l*e[d+1],e[d]=c*e[d]-n-u,p--);d+=2)d+=2,n=l*e[d+1],e[d]=c*e[d]-n-u;for(d=t-1,n=o*e[d-1],p=s+2;p--&&(u=o*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=o*e[d+1],e[d]-=n+u;for(d=t,n=a*e[d-1],p=s+1;p--&&(u=a*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=a*e[d+1],e[d]-=n+u;if(0!=s)for(d=t+1,n=r*e[d-1],p=s;p--&&(u=r*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=r*e[d+1],e[d]-=n+u},e}(),M=function(){function e(){N.call(this)}return e.prototype=Object.create(N.prototype),e.prototype.filter=function(e,t,i){var s=i>>1;t|=0;var r,a;for(r=t,a=s+1;a--;r+=2)e[r]-=e[r-1]+e[r+1]+2>>2;for(r=t+1,a=s;a--;r+=2)e[r]+=e[r-1]+e[r+1]>>1},e}();return e}();t.JpxImage=c},function(e,t,n){'use strict';var s=String.fromCharCode,i=Math.max,a=Math.min;(function(e){function n(e){E>=I.warnings&&console.log('Warning: '+e)}function r(e){throw new Error(e)}function o(e,t){e||r(t)}function l(e){if(!e)return!1;switch(e.protocol){case'http:':case'https:':case'ftp:':case'mailto:':case'tel:':return!0;default:return!1;}}function c(e){o('string'==typeof e,'Invalid argument for stringToBytes');for(var t=e.length,n=new Uint8Array(t),s=0;s<t;++s)n[s]=255&e.charCodeAt(s);return n}function d(e){return void 0===e.length?(o(void 0!==e.byteLength),e.byteLength):e.length}function p(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}function u(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;return e?new Promise(function(i){i(e.apply(n,t))}):Promise.resolve(void 0)}function g(e){if('object'!==('undefined'==typeof e?'undefined':y(e)))return e;switch(e.name){case'AbortException':return new R(e.message);case'MissingPDFException':return new T(e.message);case'UnexpectedResponseException':return new S(e.message,e.status);default:return new C(e.message,e.details);}}function m(e){return!(e instanceof Error)||e instanceof R||e instanceof T||e instanceof S||e instanceof C?e:new C(e.message,e.toString())}function f(e,t,n){t?e.resolve():e.reject(n)}function x(e){return Promise.resolve(e).catch(function(){})}function h(e,t,n){var i=this;this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.postMessageTransfers=!0,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null);var s=this.callbacksCapabilities=Object.create(null),r=this.actionHandler=Object.create(null);this._onComObjOnMessage=function(e){var t=e.data;if(t.targetName===i.sourceName)if(t.stream)i._processStreamMessage(t);else if(t.isReply){var a=t.callbackId;if(t.callbackId in s){var o=s[a];delete s[a],'error'in t?o.reject(g(t.error)):o.resolve(t.data)}else throw new Error('Cannot resolve callback '+a)}else if(t.action in r){var l=r[t.action];if(t.callbackId){var c=i.sourceName,d=t.sourceName;Promise.resolve().then(function(){return l[0].call(l[1],t.data)}).then(function(e){n.postMessage({sourceName:c,targetName:d,isReply:!0,callbackId:t.callbackId,data:e})},function(e){n.postMessage({sourceName:c,targetName:d,isReply:!0,callbackId:t.callbackId,error:m(e)})})}else t.streamId?i._createStreamSink(t):l[0].call(l[1],t.data)}else throw new Error('Unknown action from worker: '+t.action)},n.addEventListener('message',this._onComObjOnMessage)}Object.defineProperty(t,'__esModule',{value:!0});var y='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},I={errors:0,warnings:1,infos:5},E=I.warnings,b=function(){function e(e,t){this.name='PasswordException',this.message=e,this.code=t}return e.prototype=new Error,e.constructor=e,e}(),C=function(){function e(e,t){this.name='UnknownErrorException',this.message=e,this.details=t}return e.prototype=new Error,e.constructor=e,e}(),P=function(){function e(e){this.name='InvalidPDFException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),T=function(){function e(e){this.name='MissingPDFException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),S=function(){function e(e,t){this.name='UnexpectedResponseException',this.message=e,this.status=t}return e.prototype=new Error,e.constructor=e,e}(),L=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name='NotImplementedException',e.constructor=e,e}(),v=function(){function e(e,t){this.begin=e,this.end=t,this.message='Missing data ['+e+', '+t+')'}return e.prototype=new Error,e.prototype.name='MissingDataException',e.constructor=e,e}(),O=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name='XRefParseException',e.constructor=e,e}(),k=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name='FormatError',e.constructor=e,e}(),R=function(){function e(e){this.name='AbortException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),D=/\x00/g,_=function(){function e(){}var t=['rgb(',0,',',0,',',0,')'];e.makeCssRgb=function(e,n,i){return t[1]=e,t[3]=n,t[5]=i,t.join('')},e.transform=function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},e.applyTransform=function(e,t){var n=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[n,i]},e.applyInverseTransform=function(e,t){var n=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,s=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[i,s]},e.getAxialAlignedBoundingBox=function(t,n){var s=e.applyTransform(t,n),r=e.applyTransform(t.slice(2,4),n),o=e.applyTransform([t[0],t[3]],n),l=e.applyTransform([t[2],t[1]],n);return[a(s[0],r[0],o[0],l[0]),a(s[1],r[1],o[1],l[1]),i(s[0],r[0],o[0],l[0]),i(s[1],r[1],o[1],l[1])]},e.inverseTransform=function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]},e.apply3dTransform=function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]},e.singularValueDecompose2dScale=function(e){var t=Math.sqrt,n=[e[0],e[2],e[1],e[3]],i=e[0]*n[0]+e[1]*n[2],s=e[0]*n[1]+e[1]*n[3],r=e[2]*n[0]+e[3]*n[2],a=e[2]*n[1]+e[3]*n[3],o=(i+a)/2,l=t((i+a)*(i+a)-4*(i*a-r*s))/2;return[t(o+l||1),t(o-l||1)]},e.normalizeRect=function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t},e.intersect=function(t,n){function i(e,t){return e-t}var s=[t[0],t[2],n[0],n[2]].sort(i),r=[t[1],t[3],n[1],n[3]].sort(i),a=[];if(t=e.normalizeRect(t),n=e.normalizeRect(n),s[0]===t[0]&&s[1]===n[0]||s[0]===n[0]&&s[1]===t[0])a[0]=s[1],a[2]=s[2];else return!1;if(r[0]===t[1]&&r[1]===n[1]||r[0]===n[1]&&r[1]===t[1])a[1]=r[1],a[3]=r[2];else return!1;return a};var n=['','C','CC','CCC','CD','D','DC','DCC','DCCC','CM','','X','XX','XXX','XL','L','LX','LXX','LXXX','XC','','I','II','III','IV','V','VI','VII','VIII','IX'];return e.toRoman=function(e,t){o(Number.isInteger(e)&&0<e,'The number should be a positive integer.');for(var i=[],s;1e3<=e;)e-=1e3,i.push('M');s=0|e/100,e%=100,i.push(n[s]),s=0|e/10,e%=10,i.push(n[10+s]),i.push(n[20+e]);var r=i.join('');return t?r.toLowerCase():r},e.appendToArray=function(e,t){Array.prototype.push.apply(e,t)},e.prependToArray=function(e,t){Array.prototype.unshift.apply(e,t)},e.extendObj=function(e,t){for(var n in t)e[n]=t[n]},e.getInheritableProperty=function(e,t,n){for(;e&&!e.has(t);)e=e.get('Parent');return e?n?e.getArray(t):e.get(t):null},e.inherit=function(e,t,n){for(var i in e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n)e.prototype[i]=n[i]},e.loadScript=function(e,t){var n=document.createElement('script'),i=!1;n.setAttribute('src',e),t&&(n.onload=function(){i||t(),i=!0}),document.getElementsByTagName('head')[0].appendChild(n)},e}(),A=function(){function e(e,t,n,i,s,r){var a=Math.abs;this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=i,this.offsetY=s;var o=(e[2]+e[0])/2,l=(e[3]+e[1])/2,c,d,p,u;switch(n%=360,n=0>n?n+360:n,n){case 180:c=-1,d=0,p=0,u=1;break;case 90:c=0,d=1,p=1,u=0;break;case 270:c=0,d=-1,p=-1,u=0;break;default:c=1,d=0,p=0,u=-1;}r&&(p=-p,u=-u);var g,m,f,x;0===c?(g=a(l-e[1])*t+i,m=a(o-e[0])*t+s,f=a(e[3]-e[1])*t,x=a(e[2]-e[0])*t):(g=a(o-e[0])*t+i,m=a(l-e[1])*t+s,f=a(e[2]-e[0])*t,x=a(e[3]-e[1])*t),this.transform=[c*t,d*t,p*t,u*t,g-c*t*o-p*t*l,m-d*t*o-u*t*l],this.width=f,this.height=x,this.fontScale=t}return e.prototype={clone:function(t){t=t||{};var n='scale'in t?t.scale:this.scale,i='rotation'in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),n,i,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return _.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=_.applyTransform([e[0],e[1]],this.transform),n=_.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]},convertToPdfPoint:function(e,t){return _.applyInverseTransform([e,t],this.transform)}},e}(),N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364],j=function(e,t){if('undefined'!=typeof Blob)return new Blob([e],{type:t});throw new Error('The "Blob" constructor is not supported.')},M=function(){var e='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';return function(t,n){var s=2<arguments.length&&arguments[2]!==void 0&&arguments[2];if(!s&&URL.createObjectURL){var r=j(t,n);return URL.createObjectURL(r)}for(var a='data:'+n+';base64,',o=0,i=t.length;o<i;o+=3){var l=255&t[o],c=255&t[o+1],d=255&t[o+2],p=o+1<i?(15&c)<<2|d>>6:64,u=o+2<i?63&d:64;a+=e[l>>2]+e[(3&l)<<4|c>>4]+e[p]+e[u]}return a}}();h.prototype={on:function(e,t,n){var i=this.actionHandler;if(i[e])throw new Error('There is already an actionName called "'+e+'"');i[e]=[t,n]},send:function(e,t,n){var i={sourceName:this.sourceName,targetName:this.targetName,action:e,data:t};this.postMessage(i,n)},sendWithPromise:function(e,t,n){var i=this.callbackId++,s={sourceName:this.sourceName,targetName:this.targetName,action:e,data:t,callbackId:i},r=p();this.callbacksCapabilities[i]=r;try{this.postMessage(s,n)}catch(t){r.reject(t)}return r.promise},sendWithStream:function(e,t,n){var i=this,s=this.streamId++,r=this.sourceName,a=this.targetName;return new ReadableStream({start:function(n){var o=p();return i.streamControllers[s]={controller:n,startCall:o,isClosed:!1},i.postMessage({sourceName:r,targetName:a,action:e,streamId:s,data:t,desiredSize:n.desiredSize}),o.promise},pull:function(e){var t=p();return i.streamControllers[s].pullCall=t,i.postMessage({sourceName:r,targetName:a,stream:'pull',streamId:s,desiredSize:e.desiredSize}),t.promise},cancel:function(e){var t=p();return i.streamControllers[s].cancelCall=t,i.streamControllers[s].isClosed=!0,i.postMessage({sourceName:r,targetName:a,stream:'cancel',reason:e,streamId:s}),t.promise}},n)},_createStreamSink:function(e){var t=this,n=this,i=this.actionHandler[e.action],s=e.streamId,r=e.desiredSize,a=this.sourceName,o=e.sourceName,l=p(),c=function(e){var n=e.stream,i=e.chunk,r=e.transfers,l=e.success,c=e.reason;t.postMessage({sourceName:a,targetName:o,stream:n,streamId:s,chunk:i,success:l,reason:c},r)},d={enqueue:function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=arguments[2];if(!this.isCancelled){var i=this.desiredSize;this.desiredSize-=t,0<i&&0>=this.desiredSize&&(this.sinkCapability=p(),this.ready=this.sinkCapability.promise),c({stream:'enqueue',chunk:e,transfers:n})}},close:function(){this.isCancelled||(this.isCancelled=!0,c({stream:'close'}),delete n.streamSinks[s])},error:function(e){this.isCancelled||(this.isCancelled=!0,c({stream:'error',reason:e}))},sinkCapability:l,onPull:null,onCancel:null,isCancelled:!1,desiredSize:r,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[s]=d,u(i[0],[e.data,d],i[1]).then(function(){c({stream:'start_complete',success:!0})},function(e){c({stream:'start_complete',success:!1,reason:e})})},_processStreamMessage:function(e){var t=this,n=this.sourceName,i=e.sourceName,s=e.streamId,r=function(e){var r=e.stream,a=e.success,o=e.reason;t.comObj.postMessage({sourceName:n,targetName:i,stream:r,success:a,streamId:s,reason:o})},a=function(){Promise.all([t.streamControllers[e.streamId].startCall,t.streamControllers[e.streamId].pullCall,t.streamControllers[e.streamId].cancelCall].map(function(e){return e&&x(e.promise)})).then(function(){delete t.streamControllers[e.streamId]})};switch(e.stream){case'start_complete':f(this.streamControllers[e.streamId].startCall,e.success,g(e.reason));break;case'pull_complete':f(this.streamControllers[e.streamId].pullCall,e.success,g(e.reason));break;case'pull':if(!this.streamSinks[e.streamId]){r({stream:'pull_complete',success:!0});break}0>=this.streamSinks[e.streamId].desiredSize&&0<e.desiredSize&&this.streamSinks[e.streamId].sinkCapability.resolve(),this.streamSinks[e.streamId].desiredSize=e.desiredSize,u(this.streamSinks[e.streamId].onPull).then(function(){r({stream:'pull_complete',success:!0})},function(e){r({stream:'pull_complete',success:!1,reason:e})});break;case'enqueue':o(this.streamControllers[e.streamId],'enqueue should have stream controller'),this.streamControllers[e.streamId].isClosed||this.streamControllers[e.streamId].controller.enqueue(e.chunk);break;case'close':if(o(this.streamControllers[e.streamId],'close should have stream controller'),this.streamControllers[e.streamId].isClosed)break;this.streamControllers[e.streamId].isClosed=!0,this.streamControllers[e.streamId].controller.close(),a();break;case'error':o(this.streamControllers[e.streamId],'error should have stream controller'),this.streamControllers[e.streamId].controller.error(g(e.reason)),a();break;case'cancel_complete':f(this.streamControllers[e.streamId].cancelCall,e.success,g(e.reason)),a();break;case'cancel':if(!this.streamSinks[e.streamId])break;u(this.streamSinks[e.streamId].onCancel,[g(e.reason)]).then(function(){r({stream:'cancel_complete',success:!0})},function(e){r({stream:'cancel_complete',success:!1,reason:e})}),this.streamSinks[e.streamId].sinkCapability.reject(g(e.reason)),this.streamSinks[e.streamId].isCancelled=!0,delete this.streamSinks[e.streamId];break;default:throw new Error('Unexpected stream case');}},postMessage:function(e,t){t&&this.postMessageTransfers?this.comObj.postMessage(e,t):this.comObj.postMessage(e)},destroy:function(){this.comObj.removeEventListener('message',this._onComObjOnMessage)}},t.FONT_IDENTITY_MATRIX=[0.001,0,0,0.001,0,0],t.IDENTITY_MATRIX=[1,0,0,1,0,0],t.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},t.VERBOSITY_LEVELS=I,t.UNSUPPORTED_FEATURES={unknown:'unknown',forms:'forms',javaScript:'javaScript',smask:'smask',shadingPattern:'shadingPattern',font:'font'},t.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},t.AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},t.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},t.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t.FontType={UNKNOWN:0,TYPE1:1,TYPE1C:2,CIDFONTTYPE0:3,CIDFONTTYPE0C:4,TRUETYPE:5,CIDFONTTYPE2:6,TYPE3:7,OPENTYPE:8,TYPE0:9,MMTYPE1:10},t.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},t.CMapCompressionType={NONE:0,BINARY:1,STREAM:2},t.AbortException=R,t.InvalidPDFException=P,t.MessageHandler=h,t.MissingDataException=v,t.MissingPDFException=T,t.NativeImageDecoding={NONE:'none',DECODE:'decode',DISPLAY:'display'},t.NotImplementedException=L,t.PageViewport=A,t.PasswordException=b,t.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},t.StreamType={UNKNOWN:0,FLATE:1,LZW:2,DCT:3,JPX:4,JBIG:5,A85:6,AHX:7,CCF:8,RL:9},t.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},t.UnexpectedResponseException=S,t.UnknownErrorException=C,t.Util=_,t.XRefParseException=O,t.FormatError=k,t.arrayByteLength=d,t.arraysToBytes=function(e){if(1===e.length&&e[0]instanceof Uint8Array)return e[0];var t=0,n=e.length,s,i,r;for(s=0;s<n;s++)i=e[s],r=d(i),t+=r;var a=0,o=new Uint8Array(t);for(s=0;s<n;s++)i=e[s],i instanceof Uint8Array||('string'==typeof i?i=c(i):i=new Uint8Array(i)),r=i.byteLength,o.set(i,a),a+=r;return o},t.assert=o,t.bytesToString=function(e){o(null!==e&&'object'===('undefined'==typeof e?'undefined':y(e))&&e.length!==void 0,'Invalid argument for bytesToString');var t=e.length,n=8192;if(t<n)return s.apply(null,e);for(var r=[],l=0;l<t;l+=n){var i=a(l+n,t),c=e.subarray(l,i);r.push(s.apply(null,c))}return r.join('')},t.createBlob=j,t.createPromiseCapability=p,t.createObjectURL=M,t.deprecated=function(e){console.log('Deprecated API usage: '+e)},t.getLookupTableFactory=function(e){var t;return function(){return e&&(t=Object.create(null),e(t),e=null),t}},t.getVerbosityLevel=function(){return E},t.info=function(e){E>=I.infos&&console.log('Info: '+e)},t.isArrayBuffer=function(e){return'object'===('undefined'==typeof e?'undefined':y(e))&&null!==e&&e.byteLength!==void 0},t.isBool=function(e){return'boolean'==typeof e},t.isEmptyObj=function(e){for(var t in e)return!1;return!0},t.isNum=function(e){return'number'==typeof e},t.isString=function(e){return'string'==typeof e},t.isSpace=function(e){return 32===e||9===e||13===e||10===e},t.isNodeJS=function(){return'object'===('undefined'==typeof e?'undefined':y(e))&&e+'[object process]'},t.isSameOrigin=function(e,t){try{var n=new URL(e);if(!n.origin||'null'===n.origin)return!1}catch(t){return!1}var i=new URL(t,n);return n.origin===i.origin},t.createValidAbsoluteUrl=function(e,t){if(!e)return null;try{var n=t?new URL(e,t):new URL(e);if(l(n))return n}catch(e){}return null},t.isLittleEndian=function(){var e=new Uint8Array(4);e[0]=1;var t=new Uint32Array(e.buffer,0,1);return 1===t[0]},t.isEvalSupported=function(){try{return new Function(''),!0}catch(t){return!1}},t.loadJpegStream=function(e,t,i){var s=new Image;s.onload=function(){i.resolve(e,s)},s.onerror=function(){i.resolve(e,null),n('Error during JPEG image loading')},s.src=t},t.log2=function(e){return 0>=e?0:Math.ceil(Math.log2(e))},t.readInt8=function(e,t){return e[t]<<24>>24},t.readUint16=function(e,t){return e[t]<<8|e[t+1]},t.readUint32=function(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0},t.removeNullCharacters=function(e){return'string'==typeof e?e.replace(D,''):(n('The argument for removeNullCharacters must be a string.'),e)},t.ReadableStream=ReadableStream,t.setVerbosityLevel=function(e){E=e},t.shadow=function(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n},t.string32=function(e){return s(255&e>>24,255&e>>16,255&e>>8,255&e)},t.stringToBytes=c,t.stringToPDFString=function(e){var t=e.length,n=[],r;if('\xFE'===e[0]&&'\xFF'===e[1])for(r=2;r<t;r+=2)n.push(s(e.charCodeAt(r)<<8|e.charCodeAt(r+1)));else for(r=0;r<t;++r){var i=N[e.charCodeAt(r)];n.push(i?s(i):e.charAt(r))}return n.join('')},t.stringToUTF8String=function(e){return decodeURIComponent(escape(e))},t.utf8StringToString=function(e){return unescape(encodeURIComponent(e))},t.warn=n,t.unreachable=r}).call(t,n(43))},function(e){function t(){throw new Error('setTimeout has not been defined')}function n(){throw new Error('clearTimeout has not been defined')}function s(e){if(d===setTimeout)return setTimeout(e,0);if((d===t||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function i(e){if(p===clearTimeout)return clearTimeout(e);if((p===n||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function r(){g&&f&&(g=!1,f.length?u=f.concat(u):m=-1,u.length&&a())}function a(){if(!g){var e=s(r);g=!0;for(var t=u.length;t;){for(f=u,u=[];++m<t;)f&&f[m].run();m=-1,t=u.length}f=null,g=!1,i(e)}}function o(e,t){this.fun=e,this.array=t}function l(){}var c=e.exports={},d,p;(function(){try{d='function'==typeof setTimeout?setTimeout:t}catch(n){d=t}try{p='function'==typeof clearTimeout?clearTimeout:n}catch(t){p=n}})();var u=[],g=!1,m=-1,f;c.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new o(e,t)),1!==u.length||g||s(a)},o.prototype.run=function(){this.fun.apply(null,this.array)},c.title='browser',c.browser=!0,c.env={},c.argv=[],c.version='',c.versions={},c.on=l,c.addListener=l,c.once=l,c.off=l,c.removeListener=l,c.removeAllListeners=l,c.emit=l,c.prependListener=l,c.prependOnceListener=l,c.listeners=function(){return[]},c.binding=function(){throw new Error('process.binding is not supported')},c.cwd=function(){return'/'},c.chdir=function(){throw new Error('process.chdir is not supported')},c.umask=function(){return 0}},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var n=function(){function e(e,t,n){this.data=e,this.bp=t,this.dataEnd=n,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=65535&this.chigh<<7|127&this.clow>>9,this.clow=65535&this.clow<<7,this.ct-=7,this.a=32768}var t=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];return e.prototype={byteIn:function(){var e=this.data,t=this.bp;if(255===e[t]){var n=e[t+1];143<n?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t)}else t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t;65535<this.clow&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(e,n){var i=e[n]>>1,s=1&e[n],r=t[i],o=r.qe,l=this.a-o,a;if(this.chigh<o)l<o?(l=o,a=s,i=r.nmps):(l=o,a=1^s,1===r.switchFlag&&(s=a),i=r.nlps);else{if(this.chigh-=o,0!=(32768&l))return this.a=l,s;l<o?(a=1^s,1===r.switchFlag&&(s=a),i=r.nlps):(a=s,i=r.nmps)}do 0===this.ct&&this.byteIn(),l<<=1,this.chigh=65535&this.chigh<<1|1&this.clow>>15,this.clow=65535&this.clow<<1,this.ct--;while(0==(32768&l));return this.a=l,e[n]=i<<1|s,a}},e}();t.ArithmeticDecoder=n}]);