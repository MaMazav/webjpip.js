var webjpip=function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=4)}([function(e){'use strict';e.exports.j2kMarkers={StartOfCodestream:[255,79],ImageAndTileSize:[255,81],CodingStyleDefault:[255,82],CodingStyleComponent:[255,83],QuantizationDefault:[255,92],ProgressionOrderChange:[255,95],PackedPacketHeadersInMainHeader:[255,96],PackedPacketHeadersInTileHeader:[255,97],StartOfTile:[255,144],StartOfData:[255,147],EndOfCodestream:[255,217],Comment:[255,100]},e.exports.j2kOffsets={MARKER_SIZE:2,LENGTH_FIELD_SIZE:2,NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER:38,REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER:6},e.exports.jpipEndOfResponseReasons={IMAGE_DONE:1,WINDOW_DONE:2,WINDOW_CHANGE:3,BYTE_LIMIT:4,QUALITY_LIMIT:5,SESSION_LIMIT:6,RESPONSE_LIMIT:7,NON_SPECIFIED:8},e.exports.j2kExceptions={UnsupportedFeatureException:function(e,t){return this.description=e,t&&(this.description+=' (specified in section '+t+' of part 1: Core Coding System standard) is not supported yet'),this.toString=function(){return'J2k UnsupportedFeatureException: '+this.description},this},ParseException:function(e){return this.description=e,this.toString=function(){return'J2k ParseException: '+this.description},this},IllegalDataException:function(e,t){return this.description=e+' (see section '+t+' of part 9: Interactivity tools, APIs and Protocols)',this.toString=function(){return'J2k IllegalDataException: '+this.description},this}},e.exports.jpipExceptions={UnsupportedFeatureException:function(e,t){return this.description=e,t&&(this.description+=' (specified in section '+t+' of part 9: Interactivity tools, APIs and Protocols) is not supported yet'),this.toString=function(){return'Jpip UnsupportedFeatureException: '+this.description},this},ParseException:function(e){return this.description=e,this.toString=function(){return'Jpip ParseException: '+this.description},this},IllegalDataException:function(e,t){return this.description=e+' (see section '+t+' of part 9: Interactivity tools, APIs and Protocols)',this.toString=function(){return'Jpip IllegalDataException: '+this.description},this},IllegalOperationException:function(e){return this.description=e,this.toString=function(){return'Jpip IllegalOperationException: '+this.description},this},ArgumentException:function(e,t,n){return this.description='Argument '+e+' has invalid value '+t+(void 0===n?'':' :'+n),this.toString=function(){return'Jpip ArgumentException: '+this.description},this},WrongStreamException:function(e,t){var n='JPP (JPIP Precinct)',i='JPT (JPIP Tile-part)';if(t){var r=n;n=i,i=r}return this.description='Stream type is '+i+', but '+e+' is allowed only in '+n+' stream',this.toString=function(){return'Jpip WrongStreamException: '+this.description},this},InternalErrorException:function(e){return this.description=e,this.toString=function(){return'Jpip InternalErrorException: '+this.description},this}},e.exports.j2kExceptions.UnsupportedFeatureException.Name='j2kExceptions.UnsupportedFeatureException',e.exports.j2kExceptions.ParseException.Name='j2kExceptions.ParseException',e.exports.j2kExceptions.IllegalDataException.Name='j2kExceptions.IllegalDataException',e.exports.jpipExceptions.UnsupportedFeatureException.Name='jpipExceptions.UnsupportedFeatureException',e.exports.jpipExceptions.ParseException.Name='jpipExceptions.ParseException',e.exports.jpipExceptions.IllegalDataException.Name='jpipExceptions.IllegalDataException',e.exports.jpipExceptions.IllegalOperationException.Name='jpipExceptions.IllegalOperationException',e.exports.jpipExceptions.ArgumentException.Name='jpipExceptions.ArgumentException',e.exports.jpipExceptions.WrongStreamException.Name='jpipExceptions.WrongStreamException',e.exports.jpipExceptions.InternalErrorException.Name='jpipExceptions.InternalErrorException'},function(e,t,n){'use strict';var i=n(6),r=n(7),a=n(8),s=n(9),o=n(10),l=n(11),c=n(12),d=n(13),p=n(14),u=n(15),g=n(16),f=n(17),m=n(18),x=n(19),h=n(20),y=n(21),I=n(22),E=n(23),b=n(24),C=n(25),P=n(26),T=n(27),S=n(28),v=n(29),L=n(30),O=n(31),R=n(32),k=n(33),D=n(34),A=n(35),_=n(36),j=n(37),N=n(38),F=n(39),B=n(40),M=n(41),w=n(42),q={createChannel:function(e,t){return new o(e,t,q)},createCodestreamReconstructor:function(e,t,n){return new l(e,t,n)},createLevelCalculator:function(e){return new y(e)},createCodestreamStructure:function(e,t){return new c(e,q,t)},createComponentStructure:function(e,t){return new d(e,t)},createCompositeArray:function(e){return new p(e)},createDatabinParts:function(e,t){return new u(e,t,q)},createDatabinsSaver:function(e){return new g(e,q)},createFetcher:function(e,t,n){return new m(e,t,n,q)},createFetch:function(e,t,n){return new f(e,t,n)},createHeaderModifier:function(e,t){return new x(e,t)},createImageDataContext:function(e,t,n,i){return new h(e,t,n,i)},createMarkersParser:function(e){return new I(e,s,q)},createOffsetsCalculator:function(e,t){return new E(e,t)},createPacketsDataCollector:function(e,t){return new b(e,t,q)},createParamsCodestreamPart:function(e,t){return new C(e,t,q)},createParamsPrecinctIterator:function(e,t,n,i){return new P(e,t,n,i)},createPrecinctCodestreamPart:function(e,t,n,i,r,a,s){return new T(e,t,n,i,r,a,s)},createPrecinctsIteratorWaiter:function(e,t,n,i){return new S(e,t,n,i,q)},createQualityWaiter:function(e,t,n,i,r,a,s,o){return new v(e,t,n,i,r,a,s,o,q)},createRequestParamsModifier:function(e){return new L(e)},createRequest:function(e,t,n,i,r){return new O(e,s,t,n,i,r)},createSessionHelper:function(e,t,n,r){return new R(e,t,n,r,i)},createSession:function(e,t,n,i,r){return new k(e,t,n,i,r,setInterval,clearInterval,q)},createReconnectableRequester:function(e,t,n,i){return new D(e,t,n,i,q)},createStructureParser:function(e,t,n){return new A(e,t,s,n)},createTileStructure:function(e,t,n){return new _(e,t,q,n)},createBitstreamReader:function(e){return new j(e,r)},createTagTree:function(e,t,n){return new N(e,t,n,r)},createCodeblockLengthParser:function(e){return new F(e,r)},createSubbandLengthInPacketHeaderCalculator:function(e,t,n){return new B(e,t,n,a,r,q)},createPacketLengthCalculator:function(e,t,n,i,r){return new M(e,t,n,i,r,q)},createQualityLayersCache:function(e){return new w(e,q)}};e.exports=q},function(e,t,n){'use strict';var r=Math.floor,a=Math.ceil,s=Math.max,o=Math.min;Object.defineProperty(t,'__esModule',{value:!0}),t.JpxImage=void 0;var l=n(44),i=n(45),d=function(){function e(e){this.message='JPX error: '+e}return e.prototype=new Error,e.prototype.name='JpxError',e.constructor=e,e}(),c=function(){function e(){this.failOnCorruptedImage=!1}function t(e,t){for(var n=t.subbands,r=0,i;r<e.subbandPrecincts.length;++r){var a='LL'!==t.subbands[r].type,l=e.subbandPrecincts[r].tbxMin_,c=e.subbandPrecincts[r].tbyMin_,d=e.subbandPrecincts[r].tbxMax_,p=e.subbandPrecincts[r].tbyMax_;a&&(l=2*(l-t.subbands[r].tbx0)+t.trx0,c=2*(c-t.subbands[r].tby0)+t.try0,d=2*(d-t.subbands[r].tbx0)+t.trx0,p=2*(p-t.subbands[r].tby0)+t.try0),0===r?i={x0:l,y0:c,x1:d,y1:p}:(i.x0=o(i.x0,l),i.y0=o(i.y0,c),i.x1=s(i.x1,d),i.y1=s(i.y1,p))}return i}function n(e,t){e.x0=a(t.XOsiz/e.XRsiz),e.x1=a(t.Xsiz/e.XRsiz),e.y0=a(t.YOsiz/e.YRsiz),e.y1=a(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function c(e,t){for(var n=e.SIZ,r=[],l=a((n.Xsiz-n.XTOsiz)/n.XTsiz),c=a((n.Ysiz-n.YTOsiz)/n.YTsiz),d=0,u;d<c;d++)for(var g=0;g<l;g++)u={},u.tx0=s(n.XTOsiz+g*n.XTsiz,n.XOsiz),u.ty0=s(n.YTOsiz+d*n.YTsiz,n.YOsiz),u.tx1=o(n.XTOsiz+(g+1)*n.XTsiz,n.Xsiz),u.ty1=o(n.YTOsiz+(d+1)*n.YTsiz,n.Ysiz),u.width=u.tx1-u.tx0,u.height=u.ty1-u.ty0,u.components=[],r.push(u);e.tiles=r;for(var p=n.Csiz,f=0,i;f<p;f++){i=t[f];for(var m=0,x=r.length,h;m<x;m++)h={},u=r[m],h.tcx0=a(u.tx0/i.XRsiz),h.tcy0=a(u.ty0/i.YRsiz),h.tcx1=a(u.tx1/i.XRsiz),h.tcy1=a(u.ty1/i.YRsiz),h.width=h.tcx1-h.tcx0,h.height=h.tcy1-h.tcy0,u.components[f]=h}}function p(e,t,n){var i=t.codingStyleParameters,r={};return i.entropyCoderWithCustomPrecincts?(r.PPx=i.precinctsSizes[n].PPx,r.PPy=i.precinctsSizes[n].PPy):(r.PPx=15,r.PPy=15),r.xcb_=0<n?o(i.xcb,r.PPx-1):o(i.xcb,r.PPx),r.ycb_=0<n?o(i.ycb,r.PPy-1):o(i.ycb,r.PPy),r}function u(e,t,n){var i=1<<n.PPx,s=1<<n.PPy,o=0===t.resLevel,l=1<<n.PPx+(o?0:-1),c=1<<n.PPy+(o?0:-1),d=t.trx1>t.trx0?a(t.trx1/i)-r(t.trx0/i):0,p=t.try1>t.try0?a(t.try1/s)-r(t.try0/s):0;t.precinctParameters={precinctWidth:i,precinctHeight:s,numprecinctswide:d,numprecinctshigh:p,numprecincts:d*p,precinctWidthInSubband:l,precinctHeightInSubband:c}}function g(e,t,n,a){var l=n.xcb_,c=n.ycb_,d=1<<l,p=1<<c,u=t.tbx0>>l,g=t.tby0>>c,f=t.tbx1+d-1>>l,m=t.tby1+p-1>>c,x=t.resolution.precinctParameters,h=[],y=[],I,E,b,C;for(E=g;E<m;E++)for(I=u;I<f;I++){b={cbx:I,cby:E,tbx0:d*I,tby0:p*E,tbx1:d*(I+1),tby1:p*(E+1),parentSubband:t},b.tbx0_=s(t.tbx0,b.tbx0),b.tby0_=s(t.tby0,b.tby0),b.tbx1_=o(t.tbx1,b.tbx1),b.tby1_=o(t.tby1,b.tby1);var P=r((b.tbx0_-t.tbx0)/x.precinctWidthInSubband),T=r((b.tby0_-t.tby0)/x.precinctHeightInSubband);if(C=P+T*x.numprecinctswide,b.precinctNumber=C,b.subbandType=t.type,b.Lblock=3,!(b.tbx1_<=b.tbx0_||b.tby1_<=b.tby0_)){h.push(b);var S=y[C];void 0===S?y[C]=S={cbxMin:I,cbyMin:E,cbxMax:I,cbyMax:E,tbxMin_:b.tbx0_,tbxMax_:b.tbx1_,tbyMin_:b.tby0_,tbyMax_:b.tby1_,pixelsPrecinct:t.resolution.pixelsPrecincts[C]}:(I<S.cbxMin?(S.cbxMin=I,S.tbxMin_=b.tbx0_):I>S.cbxMax&&(S.cbxMax=I,S.tbxMax_=b.tbx1_),E<S.cbyMin?(S.cbyMin=E,S.tbyMin_=b.tby0_):E>S.cbyMax&&(S.cbyMax=E,S.tbyMax_=b.tby1_)),void 0===S.pixelsPrecinct&&(S.pixelsPrecinct={codeblocks:[],subbandPrecincts:[],hasData:!1},t.resolution.pixelsPrecincts[C]=S.pixelsPrecinct),b.precinct=S;var v=S.pixelsPrecinct;v.codeblocks.push(b),void 0===v.subbandPrecincts[a]&&(v.subbandPrecincts[a]=S)}}t.codeblockParameters={codeblockWidth:l,codeblockHeight:c,numcodeblockwide:f-u+1,numcodeblockhigh:m-g+1},t.codeblocks=h,t.subbandPrecincts=y,t.codeblocksWithData=[]}function f(e,t,n){return{layerNumber:n,codeblocks:e.pixelsPrecincts[t].codeblocks}}function m(e){for(var t=e.SIZ,n=e.currentTile.index,a=e.tiles[n],o=a.codingStyleDefaultParameters.layersCount,c=t.Csiz,p=0,u=0;u<c;u++)p=s(p,a.components[u].codingStyleParameters.decompositionLevelsCount);var g=0,l=0,r=0,i=0;this.nextPacket=function(){for(;g<o;g++){for(;l<=p;l++){for(;r<c;r++){var e=a.components[r];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[l],n=t.precinctParameters.numprecincts,s;i<n;)return s=f(t,i,g),i++,s;i=0}}r=0}l=0}throw new d('Out of packets')}}function x(e){for(var t=e.SIZ,n=e.currentTile.index,a=e.tiles[n],o=a.codingStyleDefaultParameters.layersCount,c=t.Csiz,p=0,u=0;u<c;u++)p=s(p,a.components[u].codingStyleParameters.decompositionLevelsCount);var g=0,r=0,l=0,i=0;this.nextPacket=function(){for(;g<=p;g++){for(;r<o;r++){for(;l<c;l++){var e=a.components[l];if(!(g>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[g],n=t.precinctParameters.numprecincts,s;i<n;)return s=f(t,i,r),i++,s;i=0}}l=0}r=0}throw new d('Out of packets')}}function h(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],a=i.codingStyleDefaultParameters.layersCount,o=t.Csiz,u=0,g,l,r,c;for(r=0;r<o;r++){var p=i.components[r];u=s(u,p.codingStyleParameters.decompositionLevelsCount)}var m=new Int32Array(u+1);for(l=0;l<=u;++l){var x=0;for(r=0;r<o;++r){var h=i.components[r].resolutions;l<h.length&&(x=s(x,h[l].precinctParameters.numprecincts))}m[l]=x}g=0,l=0,r=0,c=0,this.nextPacket=function(){for(;l<=u;l++){for(;c<m[l];c++){for(;r<o;r++){var e=i.components[r];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){var t=e.resolutions[l],n=t.precinctParameters.numprecincts;if(!(c>=n)){for(;g<a;){var s=f(t,c,g);return g++,s}g=0}}}r=0}c=0}throw new d('Out of packets')}}function y(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],a=i.codingStyleDefaultParameters.layersCount,s=t.Csiz,o=b(i),p=o,u=0,l=0,r=0,c=0,g=0;this.nextPacket=function(){for(;g<p.maxNumHigh;g++){for(;c<p.maxNumWide;c++){for(;r<s;r++){for(var e=i.components[r],t=e.codingStyleParameters.decompositionLevelsCount;l<=t;l++){var n=e.resolutions[l],m=o.components[r].resolutions[l],x=E(c,g,m,p,n);if(null!==x){for(;u<a;){var h=f(n,x,u);return u++,h}u=0}}l=0}r=0}c=0}throw new d('Out of packets')}}function I(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],a=i.codingStyleDefaultParameters.layersCount,s=t.Csiz,o=b(i),p=0,l=0,r=0,c=0,u=0;this.nextPacket=function(){for(;r<s;++r){for(var e=i.components[r],t=o.components[r],n=e.codingStyleParameters.decompositionLevelsCount;u<t.maxNumHigh;u++){for(;c<t.maxNumWide;c++){for(;l<=n;l++){var g=e.resolutions[l],m=t.resolutions[l],x=E(c,u,m,t,g);if(null!==x){for(;p<a;){var h=f(g,x,p);return p++,h}p=0}}l=0}c=0}u=0}throw new d('Out of packets')}}function E(e,t,n,i,r){var a=e*i.minWidth,s=t*i.minHeight;if(0!=a%n.width||0!=s%n.height)return null;var o=s/n.width*r.precinctParameters.numprecinctswide;return a/n.height+o}function b(e){for(var t=Number.MAX_VALUE,n=e.components.length,i=t,a=t,l=0,d=0,p=Array(n),u=0;u<n;u++){for(var c=e.components[u],g=c.codingStyleParameters.decompositionLevelsCount,f=Array(g+1),m=t,x=t,h=0,y=0,I=1,E=g;0<=E;--E){var r=c.resolutions[E],b=I*r.precinctParameters.precinctWidth,C=I*r.precinctParameters.precinctHeight;m=o(m,b),x=o(x,C),h=s(h,r.precinctParameters.numprecinctswide),y=s(y,r.precinctParameters.numprecinctshigh),f[E]={width:b,height:C},I<<=1}i=o(i,m),a=o(a,x),l=s(l,h),d=s(d,y),p[u]={resolutions:f,minWidth:m,minHeight:x,maxNumWide:h,maxNumHigh:y}}return{components:p,minWidth:i,minHeight:a,maxNumWide:l,maxNumHigh:d}}function C(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],s=t.Csiz,o=0;o<s;o++){for(var l=i.components[o],c=l.codingStyleParameters.decompositionLevelsCount,f=[],E=[],b=0,C=0;C<=c;C++){var r=p(e,l,C),P={},T=1<<c-C;P.trx0=a(l.tcx0/T),P.try0=a(l.tcy0/T),P.trx1=a(l.tcx1/T),P.try1=a(l.tcy1/T),P.resLevel=C,P.pixelsPrecincts=[],P.pixelsPrecinctsWithDecodedCoefficients=[],u(e,P,r),f.push(P);var S;if(0===C)S={},S.type='LL',S.tbx0=a(l.tcx0/T),S.tby0=a(l.tcy0/T),S.tbx1=a(l.tcx1/T),S.tby1=a(l.tcy1/T),S.resolution=P,S.indexInTileComponent=b++,g(e,S,r,0),E.push(S),P.subbands=[S];else{var v=1<<c-C+1,L=[];S={},S.type='HL',S.tbx0=a(l.tcx0/v-0.5),S.tby0=a(l.tcy0/v),S.tbx1=a(l.tcx1/v-0.5),S.tby1=a(l.tcy1/v),S.resolution=P,S.indexInTileComponent=b++,g(e,S,r,0),E.push(S),L.push(S),S={},S.type='LH',S.tbx0=a(l.tcx0/v),S.tby0=a(l.tcy0/v-0.5),S.tbx1=a(l.tcx1/v),S.tby1=a(l.tcy1/v-0.5),S.resolution=P,S.indexInTileComponent=b++,g(e,S,r,1),E.push(S),L.push(S),S={},S.type='HH',S.tbx0=a(l.tcx0/v-0.5),S.tby0=a(l.tcy0/v-0.5),S.tbx1=a(l.tcx1/v-0.5),S.tby1=a(l.tcy1/v-0.5),S.resolution=P,S.indexInTileComponent=b++,g(e,S,r,2),E.push(S),L.push(S),P.subbands=L}}l.resolutions=f,l.subbands=E}var O=i.codingStyleDefaultParameters.progressionOrder;switch(O){case 0:i.packetsIterator=new m(e);break;case 1:i.packetsIterator=new x(e);break;case 2:i.packetsIterator=new h(e);break;case 3:i.packetsIterator=new y(e);break;case 4:i.packetsIterator=new I(e);break;default:throw new d('Unsupported progression order '+O);}}function P(e,t,n,r){function a(e){for(;u<e;){var i=t[n+p];p++,g?(I=I<<7|i,u+=7,g=!1):(I=I<<8|i,u+=8),255===i&&(g=!0)}return u-=e,I>>>u&(1<<e)-1}function s(e){return 255===t[n+p-1]&&t[n+p]===e?(o(1),!0):255===t[n+p]&&t[n+p+1]===e&&(o(2),!0)}function o(e){p+=e}function c(){u=0,g&&(p++,g=!1)}function d(){if(0===a(1))return 1;if(0===a(1))return 2;var e=a(2);return 3>e?e+3:(e=a(5),31>e)?e+6:(e=a(7),e+37)}for(var p=0,u=0,g=!1,f=e.currentTile.index,m=e.tiles[f],x=e.COD.sopMarkerUsed,h=e.COD.ephMarkerUsed,y=m.packetsIterator,I;p<r;){c(),x&&s(145)&&o(4);var E=y.nextPacket();if(a(1)){for(var b=E.layerNumber,C=[],P=0,i=E.codeblocks.length,T;P<i;P++){T=E.codeblocks[P];var S=T.precinct,v=T.cbx-S.cbxMin,L=T.cby-S.cbyMin,O=!1,R=!1,D;if(void 0!==T.included)O=!!a(1);else{S=T.precinct;var _,j;if(void 0!==S.inclusionTree)_=S.inclusionTree;else{var N=S.cbxMax-S.cbxMin+1,F=S.cbyMax-S.cbyMin+1;_=new A(N,F,b),j=new k(N,F),S.inclusionTree=_,S.zeroBitPlanesTree=j}if(_.reset(v,L,b))for(;;)if(!a(1)){_.incrementValue(b);break}else if(D=!_.nextLevel(),D){T.included=!0,O=R=!0;break}}if(O){if(R){for(j=S.zeroBitPlanesTree,j.reset(v,L);;)if(!a(1))j.incrementValue();else if(D=!j.nextLevel(),D)break;T.zeroBitPlanes=j.value}for(var B=d();a(1);)T.Lblock++;var M=(0,l.log2)(B),w=(B<1<<M?M-1:M)+T.Lblock,q=a(w);C.push({codeblock:T,codingpasses:B,dataLength:q})}}for(c(),h&&s(146);0<C.length;){var X=C.shift();T=X.codeblock,(void 0===T.data||T.dataInvalidationId!==e.dataInvalidationId)&&(T.data=[],T.parentSubband.codeblocksWithData.push(T),T.parentSubband.dataInvalidationId=e.dataInvalidationId,T.dataInvalidationId=e.dataInvalidationId),T.data.push({data:t,start:n+p,end:n+p+X.dataLength,codingpasses:X.codingpasses}),T.precinct.pixelsPrecinct.hasData=!0,p+=X.dataLength}}}return p}function T(e,t,a,l,c,d,p,u,g){var f=u.x1-u.x0,m=u.y1-u.y0,x=new Float32Array(f*m),h={x0:0,x1:0,y0:0,y1:1},y;if(e.hasDecodedCoefficients&&e.dataInvalidationId===g){var I=S(e,u,x,f,g);if(I)return x}for(var E=0,b=e.subbands.length,C;E<b;E++)if(C=e.subbands[E],C.dataInvalidationId===g){var P='LL'!==C.type,y;P?(h.x0=(u.x0-e.trx0)/2+C.tbx0,h.y0=(u.y0-e.try0)/2+C.tby0,h.x1=(u.x1-e.trx0)/2+C.tbx0,h.y1=(u.y1-e.try0)/2+C.tby0,y=h):y=u;var T=C.tbx0,v=C.tby0,L=C.tbx1-C.tbx0,O=C.codeblocksWithData,R='H'===C.type.charAt(0)?1:0,A='H'===C.type.charAt(1)?f:0,P='LL'!==C.type,N=P?2:1,F=f*N,B={x0:0,y0:0,x1:0,y1:0},M,w;if(!a){M=t[0].mu;var q=C.resolution.resLevel;w=t[0].epsilon+(0<q?1-q:0)}else{var r=C.indexInTileComponent;M=t[r].mu,w=t[r].epsilon}for(var X=D[C.type],H=d?1:Math.pow(2,l+X-w)*(1+M/2048),Y=c+w-1,U=0,W=O.length,z;U<W;++U)if((z=O[U],!(z.precinct.pixelsPrecinct.decodedCoefficients&&z.dataInvalidationId===g))&&(B.x0=s(z.tbx0_,y.x0),B.y0=s(z.tby0_,y.y0),B.x1=o(z.tbx1_,y.x1),B.y1=o(z.tby1_,y.y1),!(B.x0>=B.x1||B.y0>=B.y1))){var Q=(B.x0-y.x0)*N+(B.y0-y.y0)*F+(R+A),V=z.tbx1_-z.tbx0_,J=z.tby1_-z.tby0_,K,G;K=new _(V,J,z.subbandType,z.zeroBitPlanes,Y),G=2;var Z=z.data,$=0,ee=0,te,j,ne;for(te=0,j=Z.length;te<j;te++)ne=Z[te],$+=ne.end-ne.start,ee+=ne.codingpasses;var ie=new Uint8Array($),re=0;for(te=0,j=Z.length;te<j;te++){ne=Z[te];var ae=ne.data.subarray(ne.start,ne.end);ie.set(ae,re),re+=ae.length}var se=new i.ArithmeticDecoder(ie,0,$);for(K.setDecoder(se),te=0;te<ee;te++)0===G?K.runSignificancePropagationPass():1===G?K.runMagnitudeRefinementPass():2===G?(K.runCleanupPass(),p&&K.checkSegmentationSymbol()):void 0,G=(G+1)%3;for(var oe=z.tbx0_-T+(z.tby0_-v)*L,le=K.coefficentsSign,ce=K.coefficentsMagnitude,de=K.bitsDecoded,pe=d?0:0.5,ue=B.x0-z.tbx0_+(B.y0-z.tby0_)*V,ge=Q,te=B.y0,fe,k,me;te<B.y1;te++){var re=ue,xe=ge;for(ue+=V,ge+=F,fe=B.x0;fe<B.x1;fe++)k=ce[re],0!==k&&(k=(k+pe)*H,0!==le[re]&&(k=-k),me=de[re],x[xe]=d&&me>=Y?k:k*(1<<Y-me)),oe++,re++,xe+=N;oe+=L-V}}}return x}function S(e,n,i,r,a){for(var l=!0,c=e.subbands,d='LL'!==c[0].type,p=e.pixelsPrecinctsWithDecodedCoefficients.length,u=0;u<p;++u){var g=e.pixelsPrecinctsWithDecodedCoefficients[u],f=t(g,e),m=s(f.x0,n.x0),x=s(f.y0,n.y0),h=o(f.x1,n.x1),y=o(f.y1,n.y1);if(!(m>=h||x>=y)&&g.dataInvalidationId===a){if(!g.decodedCoefficients){g.hasData&&(l=!1);continue}for(var I=g.decodedCoefficients,E=f.x1-f.x0,b=r,C=m-f.x0+(x-f.y0)*E,P=m-n.x0+(x-n.y0)*b,T=x;T<y;++T)i.set(I.subarray(C,C+(h-m)),P),C+=E,P+=b}}return l}function v(e,t,n){var l=t.components[n],c=l.codingStyleParameters,d=l.quantizationParameters,p=c.decompositionLevelsCount,u=d.SPqcds,g=d.scalarExpounded,f=d.guardBits,m=c.segmentationSymbolUsed,x=e.components[n].precision,h=c.reversibleTransformation,y=h?new F:new N,I;if(e.regionToParse!==void 0){var E=o(l.tcx1,e.regionToParse.right),b=o(l.tcy1,e.regionToParse.bottom);I={x0:s(0,e.regionToParse.left-l.tcx0),y0:s(0,e.regionToParse.top-l.tcy0),x1:E-l.tcx0,y1:b-l.tcy0}}for(var C=[],P={x0:0,y0:0,x1:0,y1:0},S=0;S<=p;S++){var i=l.resolutions[S],v=i.trx1-i.trx0,O=i.try1-i.try0,P;if(I===void 0)P.x0=i.trx0,P.y0=i.try0,P.x1=i.trx1,P.y1=i.try1;else{var R=1<<p-S,k=4;P.x0=a(I.x0/R)-k,P.y0=a(I.y0/R)-k,P.x1=a(I.x1/R)+k,P.y1=a(I.y1/R)+k,P.x0=2*r(P.x0/2)+i.trx0,P.y0=2*r(P.y0/2)+i.try0,P.x1=2*r(P.x1/2)+i.trx0,P.y1=2*r(P.y1/2)+i.try0,P.x0=s(P.x0,i.trx0),P.y0=s(P.y0,i.try0),P.x1=o(P.x1,i.trx1),P.y1=o(P.y1,i.try1)}var D=T(i,u,g,x,f,h,m,P,e.dataInvalidationId),A={x0:P.x0-i.trx0,y0:P.y0-i.try0,x1:P.x1-i.trx0,y1:P.y1-i.try0};C.push({levelWidth:v,levelHeight:O,items:D,relativeRegionInLevel:A})}var _=y.calculate(C,l.tcx0,l.tcy0),A=_.relativeRegionInLevel;if(e.regionToParse!==void 0){var j=I.x0!==A.x0||I.y0!==A.y0||I.x1!==A.x1||I.y1!==A.y1;if(j){var B=L(I,A,_.items);return{left:l.tcx0+I.x0,top:l.tcy0+I.y0,width:I.x1-I.x0,height:I.y1-I.y0,items:B}}}return{left:l.tcx0,top:l.tcy0,width:A.x1-A.x0,height:A.y1-A.y0,items:_.items}}function L(e,t,n){for(var r=e.x1-e.x0,a=e.y1-e.y0,s=t.x1-t.x0,o=new Float32Array(r*a),l=e.y0-t.y0,c=e.x0-t.x0,d=0,p=c+s*l,u=0,i;u<a;++u)i=p+r,o.set(n.subarray(p,i),d),p+=s,d+=r;return o}function O(e){for(var t=e.SIZ,n=e.components,r=t.Csiz,a=[],s=0,i=e.tiles.length,o;s<i;s++)if(o=e.tiles[s],!(void 0!==e.regionToParse&&(e.regionToParse.left>=o.tx1||e.regionToParse.top>=o.ty1||e.regionToParse.right<=o.tx0||e.regionToParse.bottom<=o.ty0))){var l=[],d;for(d=0;d<r;d++)l[d]=v(e,o,d);var c=l[0],p=new Uint8ClampedArray(c.items.length*r),u={left:c.left,top:c.top,width:c.width,height:c.height,items:p},f=0,m,x,h,y,I,E,b;if(o.codingStyleDefaultParameters.multipleComponentTransform){var C=4===r,P=l[0].items,T=l[1].items,S=l[2].items,L=C?l[3].items:null;m=n[0].precision-8,x=(128<<m)+0.5;var O=o.components[0],R=r-3;if(y=P.length,!O.codingStyleParameters.reversibleTransformation)for(h=0;h<y;h++,f+=R)I=P[h]+x,E=T[h],b=S[h],p[f++]=I+1.402*b>>m,p[f++]=I-0.34413*E-0.71414*b>>m,p[f++]=I+1.772*E>>m;else for(h=0;h<y;h++,f+=R){I=P[h]+x,E=T[h],b=S[h];var k=I-(b+E>>2);p[f++]=k+b>>m,p[f++]=k>>m,p[f++]=k+E>>m}if(C)for(h=0,f=3;h<y;h++,f+=4)p[f]=L[h]+x>>m}else for(d=0;d<r;d++){var g=l[d].items;for(m=n[d].precision-8,x=(128<<m)+0.5,(f=d,h=0,y=g.length);h<y;h++)p[f]=g[h]+x>>m,f+=r}a.push(u)}return a}function R(e,t){for(var n=e.SIZ,i=n.Csiz,r=e.tiles[t],a=0;a<i;a++){var s=r.components[a],o=e.currentTile.QCC[a]===void 0?e.currentTile.QCD:e.currentTile.QCC[a];s.quantizationParameters=o;var l=e.currentTile.COC[a]===void 0?e.currentTile.COD:e.currentTile.COC[a];s.codingStyleParameters=l}r.codingStyleDefaultParameters=e.currentTile.COD}var D={LL:0,LH:1,HL:1,HH:2};e.prototype={parse:function(e){var t=(0,l.readUint16)(e,0);if(65359===t)return void this.parseCodestream(e,0,e.length);for(var n=0,i=e.length;n<i;){var r=8,a=(0,l.readUint32)(e,n),s=(0,l.readUint32)(e,n+4);if(n+=r,1===a&&(a=4294967296*(0,l.readUint32)(e,n)+(0,l.readUint32)(e,n+4),n+=8,r+=8),0===a&&(a=i-n+r),a<r)throw new d('Invalid box field size');var o=a-r,c=!0;switch(s){case 1785737832:c=!1;break;case 1668246642:var p=e[n];if(1===p){var u=(0,l.readUint32)(e,n+3);switch(u){case 16:case 17:case 18:break;default:(0,l.warn)('Unknown colorspace '+u);}}else 2===p&&(0,l.info)('ICC profile not supported');break;case 1785737827:this.parseCodestream(e,n,n+o);break;case 1783636000:218793738!==(0,l.readUint32)(e,n)&&(0,l.warn)('Invalid JP2 signature');break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:var g=String.fromCharCode(255&s>>24,255&s>>16,255&s>>8,255&s);(0,l.warn)('Unsupported header type '+s+' ('+g+')');}c&&(n+=o)}},parseImageProperties:function(e){for(var t=e.getByte();0<=t;){var n=t;t=e.getByte();var i=n<<8|t;if(65361==i){e.skip(4);var r=e.getInt32()>>>0,a=e.getInt32()>>>0,s=e.getInt32()>>>0,o=e.getInt32()>>>0;e.skip(16);var l=e.getUint16();return this.width=r-s,this.height=a-o,this.componentsCount=l,void(this.bitsPerComponent=8)}}throw new d('No size marker found in JPX stream')},parseCodestream:function(e,t,r,a){var s={};a=a||{};var o=!!a.isOnlyParseHeaders,p=a.regionToParse;if(void 0!==p&&o)throw'JPX Error: options.regionToParse is uneffective if options.isOnlyParseHeaders = true';var u=!1;try{for(var g=t,f;g+1<r;){f=(0,l.readUint16)(e,g),g+=2;var m=0,x,h,y,I,E,b;switch(f){case 65359:s.mainHeader=!0;break;case 65497:break;case 65361:m=(0,l.readUint16)(e,g);var T={};T.Xsiz=(0,l.readUint32)(e,g+4),T.Ysiz=(0,l.readUint32)(e,g+8),T.XOsiz=(0,l.readUint32)(e,g+12),T.YOsiz=(0,l.readUint32)(e,g+16),T.XTsiz=(0,l.readUint32)(e,g+20),T.YTsiz=(0,l.readUint32)(e,g+24),T.XTOsiz=(0,l.readUint32)(e,g+28),T.YTOsiz=(0,l.readUint32)(e,g+32);var S=(0,l.readUint16)(e,g+36);T.Csiz=S;var v=[],L=!0;x=g+38;for(var O=0,i;O<S;O++)i={precision:(127&e[x])+1,isSigned:!!(128&e[x]),XRsiz:e[x+1],YRsiz:e[x+2]},x+=3,n(i,T),v.push(i),void 0!==p&&(L&=1===i.XRsiz&&1===i.YRsiz);if(s.SIZ=T,s.components=v,c(s,v),s.QCC=[],s.COC=[],!L)throw new Error('JPX Error: When regionToParse is used, component size other than 1 is not supported');break;case 65372:m=(0,l.readUint16)(e,g);var k={};switch(x=g+2,h=e[x++],31&h){case 0:I=8,E=!0;break;case 1:I=16,E=!1;break;case 2:I=16,E=!0;break;default:throw new Error('Invalid SQcd value '+h);}for(k.noQuantization=8===I,k.scalarExpounded=E,k.guardBits=h>>5,y=[];x<m+g;){var D={};8===I?(D.epsilon=e[x++]>>3,D.mu=0):(D.epsilon=e[x]>>3,D.mu=(7&e[x])<<8|e[x+1],x+=2),y.push(D)}k.SPqcds=y,s.mainHeader?s.QCD=k:(s.currentTile.QCD=k,s.currentTile.QCC=[]);break;case 65373:m=(0,l.readUint16)(e,g);var A={};x=g+2;var _;switch(257>s.SIZ.Csiz?_=e[x++]:(_=(0,l.readUint16)(e,x),x+=2),h=e[x++],31&h){case 0:I=8,E=!0;break;case 1:I=16,E=!1;break;case 2:I=16,E=!0;break;default:throw new Error('Invalid SQcd value '+h);}for(A.noQuantization=8===I,A.scalarExpounded=E,A.guardBits=h>>5,y=[];x<m+g;)D={},8===I?(D.epsilon=e[x++]>>3,D.mu=0):(D.epsilon=e[x]>>3,D.mu=(7&e[x])<<8|e[x+1],x+=2),y.push(D);A.SPqcds=y,s.mainHeader?s.QCC[_]=A:s.currentTile.QCC[_]=A;break;case 65362:m=(0,l.readUint16)(e,g);var j={};x=g+2;var N=e[x++];j.entropyCoderWithCustomPrecincts=!!(1&N),j.sopMarkerUsed=!!(2&N),j.ephMarkerUsed=!!(4&N),j.progressionOrder=e[x++],j.layersCount=(0,l.readUint16)(e,x),x+=2,j.multipleComponentTransform=e[x++],j.decompositionLevelsCount=e[x++],j.xcb=(15&e[x++])+2,j.ycb=(15&e[x++])+2;var F=e[x++];if(j.selectiveArithmeticCodingBypass=!!(1&F),j.resetContextProbabilities=!!(2&F),j.terminationOnEachCodingPass=!!(4&F),j.verticallyStripe=!!(8&F),j.predictableTermination=!!(16&F),j.segmentationSymbolUsed=!!(32&F),j.reversibleTransformation=e[x++],j.entropyCoderWithCustomPrecincts){for(var B=[],M;x<m+g;)M=e[x++],B.push({PPx:15&M,PPy:M>>4});j.precinctsSizes=B}var w=[];if(j.selectiveArithmeticCodingBypass&&w.push('selectiveArithmeticCodingBypass'),j.resetContextProbabilities&&w.push('resetContextProbabilities'),j.terminationOnEachCodingPass&&w.push('terminationOnEachCodingPass'),j.verticallyStripe&&w.push('verticallyStripe'),j.predictableTermination&&w.push('predictableTermination'),0<w.length)throw u=!0,new Error('Unsupported COD options ('+w.join(', ')+')');s.mainHeader?s.COD=j:(s.currentTile.COD=j,s.currentTile.COC=[]);break;case 65424:m=(0,l.readUint16)(e,g),b={},b.index=(0,l.readUint16)(e,g+2),b.length=(0,l.readUint32)(e,g+4),b.dataEnd=b.length+g-2,b.partIndex=e[g+8],b.partsCount=e[g+9],s.mainHeader=!1,0===b.partIndex&&(b.COD=s.COD,b.COC=s.COC.slice(0),b.QCD=s.QCD,b.QCC=s.QCC.slice(0)),s.currentTile=b;break;case 65427:b=s.currentTile,0===b.partIndex&&(R(s,b.index),C(s)),m=b.dataEnd-g,o||P(s,e,g,m);break;case 65365:case 65367:case 65368:case 65380:m=(0,l.readUint16)(e,g);break;case 65363:throw new Error('Codestream code 0xFF53 (COC) is not implemented');default:throw new Error('Unknown codestream code: '+f.toString(16));}g+=m}}catch(t){if(u||this.failOnCorruptedImage)throw new d(t.message);else(0,l.warn)('JPX: Trying to recover from: '+t.message)}return o||this.decode(s,a),this.width=s.SIZ.Xsiz-s.SIZ.XOsiz,this.height=s.SIZ.Ysiz-s.SIZ.YOsiz,this.componentsCount=s.SIZ.Csiz,s},invalidateData:function(e){e.dataInvalidationId=(e.dataInvalidationId||0)+1},addPacketsData:function(e,t){for(var n=0;n<t.packetDataOffsets.length;++n){var r=t.packetDataOffsets[n],a=e.tiles[r.tileIndex],s=a.components[r.c],o=s.resolutions[r.r],l=r.p,c=o.pixelsPrecincts[l],d=c.codeblocks;c.hasData=!0;for(var p=0;p<r.codeblockOffsets.length;++p){var i=r.codeblockOffsets[p],u=i.start===i.end;if(!u){var g=d[p];if(g.dataInvalidationId!==e.dataInvalidationId){g.dataInvalidationId=e.dataInvalidationId,g.data=void 0,g.zeroBitPlanes=void 0;var f=g.parentSubband.dataInvalidationId;f!==e.dataInvalidationId&&(f=e.dataInvalidationId,g.parentSubband.dataInvalidationId=f,g.parentSubband.codeblocksWithData=[])}if(void 0===g.data&&(g.data=[],g.parentSubband.codeblocksWithData.push(g)),void 0!==i.zeroBitPlanes){if(void 0===g.zeroBitPlanes&&(g.zeroBitPlanes=i.zeroBitPlanes),g.zeroBitPlanes!==i.zeroBitPlanes)throw'JPX Error: Unmatched zero bit planes';}else if(void 0===g.zeroBitPlanes)throw'JPX Error: zeroBitPlanes is unknown';g.included=!0,g.data.push({data:t.data,start:i.start,end:i.end,codingpasses:i.codingpasses})}}}},decodePrecinctCoefficients:function(e,n,i,r,a){var s=e.tiles[n],o=s.components[i],l=o.resolutions[r],c=l.pixelsPrecincts[a],d=o.codingStyleParameters,p=o.quantizationParameters,u=p.SPqcds,g=p.scalarExpounded,f=p.guardBits,m=d.segmentationSymbolUsed,x=e.components[i].precision,h=d.reversibleTransformation,y=t(c,l),I=T(l,u,g,x,f,h,m,y,e.dataInvalidationId);return I},setPrecinctCoefficients:function(e,t,n,i,r,a){var s=e.tiles[n],o=s.components[i],l=o.resolutions[r],c=l.pixelsPrecincts[a];l.dataInvalidationId!==e.dataInvalidationId&&(l.dataInvalidationId=e.dataInvalidationId,l.pixelsPrecinctsWithDecodedCoefficients=[]),c.hasDecodedCoefficients||l.pixelsPrecinctsWithDecodedCoefficients.push(c),c.decodedCoefficients=t,l.hasDecodedCoefficients=!0,c.dataInvalidationId=e.dataInvalidationId},decode:function(e,t){if(t!==void 0&&t.regionToParse!==void 0){var n=t.regionToParse;if(n.top===void 0||n.left===void 0||n.right===void 0||n.bottom===void 0)throw new Error('JPX Error: Either left, top, right or bottom are undefined in regionToParse');e.regionToParse=n}this.tiles=O(e),e.regionToParse=void 0}};var k=function(){function e(e,t){var n=(0,l.log2)(s(e,t))+1;this.levels=[];for(var r=0,i;r<n;r++)i={width:e,height:t,items:[]},this.levels.push(i),e=a(e/2),t=a(t/2)}return e.prototype={reset:function(e,t){for(var n=0,i=0,r;n<this.levels.length;){r=this.levels[n];var a=e+t*r.width;if(void 0!==r.items[a]){i=r.items[a];break}r.index=a,e>>=1,t>>=1,n++}n--,r=this.levels[n],r.items[r.index]=i,this.currentLevel=n,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return(e--,0>e)?(this.value=n,!1):(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),A=function(){function e(e,t,n){var r=(0,l.log2)(s(e,t))+1;this.levels=[];for(var o=0,i;o<r;o++){i=new Uint8Array(e*t);for(var c=0,d=i.length;c<d;c++)i[c]=n;var p={width:e,height:t,items:i};this.levels.push(p),e=a(e/2),t=a(t/2)}}return e.prototype={reset:function(e,t,n){for(var i=0;i<this.levels.length;){var r=this.levels[i],a=e+t*r.width;r.index=a;var s=r.items[a];if(255===s)break;if(s>n)return this.currentLevel=i,this.propagateValues(),!1;e>>=1,t>>=1,i++}return this.currentLevel=i-1,!0},incrementValue:function(e){var t=this.levels[this.currentLevel];t.items[t.index]=e+1,this.propagateValues()},propagateValues:function(){for(var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];0<=--e;)t=this.levels[e],t.items[t.index]=n},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return(t.items[t.index]=255,e--,!(0>e))&&(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),_=function(){function e(e,t,n,o,l){this.width=e,this.height=t,this.contextLabelTable='HH'===n?s:'HL'===n?a:r;var c=e*t;this.neighborsSignificance=new Uint8Array(c),this.coefficentsSign=new Uint8Array(c),this.coefficentsMagnitude=14<l?new Uint32Array(c):6<l?new Uint16Array(c):new Uint8Array(c),this.processingFlags=new Uint8Array(c);var d=new Uint8Array(c);if(0!==o)for(var p=0;p<c;p++)d[p]=o;this.bitsDecoded=d,this.reset()}var t=17,n=18,r=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),a=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),s=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);return e.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[t]=92,this.contexts[n]=6},setNeighborsSignificance:function(e,t,n){var r=this.neighborsSignificance,a=this.width,s=this.height,o=0<t,l=t+1<a,c;0<e&&(c=n-a,o&&(r[c-1]+=16),l&&(r[c+1]+=16),r[c]+=4),e+1<s&&(c=n+a,o&&(r[c-1]+=16),l&&(r[c+1]+=16),r[c]+=4),o&&(r[n-1]+=1),l&&(r[n+1]+=1),r[n]|=128},runSignificancePropagationPass:function(){for(var e=this.decoder,t=this.width,n=this.height,r=this.coefficentsMagnitude,a=this.coefficentsSign,s=this.neighborsSignificance,o=this.processingFlags,l=this.contexts,c=this.contextLabelTable,d=this.bitsDecoded,p=0;p<n;p+=4)for(var u=0,g;u<t;u++){g=p*t+u;for(var f=0,m;4>f&&(m=p+f,!(m>=n));f++,g+=t)if(o[g]&=-2,!r[g]&&s[g]){var i=c[s[g]],x=e.readBit(l,i);if(x){var h=this.decodeSignBit(m,u,g);a[g]=h,r[g]=1,this.setNeighborsSignificance(m,u,g),o[g]|=2}d[g]++,o[g]|=1}}},decodeSignBit:function(e,t,n){var i=this.width,r=this.height,a=this.coefficentsMagnitude,s=this.coefficentsSign,o,l,c,d,p,u;d=0<t&&0!==a[n-1],t+1<i&&0!==a[n+1]?(c=s[n+1],d?(l=s[n-1],o=1-c-l):o=1-c-c):d?(l=s[n-1],o=1-l-l):o=0;var g=3*o;return d=0<e&&0!==a[n-i],e+1<r&&0!==a[n+i]?(c=s[n+i],d?(l=s[n-i],o=1-c-l+g):o=1-c-c+g):d?(l=s[n-i],o=1-l-l+g):o=g,0<=o?(p=9+o,u=this.decoder.readBit(this.contexts,p)):(p=9-o,u=1^this.decoder.readBit(this.contexts,p)),u},runMagnitudeRefinementPass:function(){for(var e=this.decoder,t=this.width,n=this.height,i=this.coefficentsMagnitude,r=this.neighborsSignificance,a=this.contexts,s=this.bitsDecoded,l=this.processingFlags,c=1,d=2,p=t*n,u=0,g;u<p;u=g){g=o(p,u+4*t);for(var f=0;f<t;f++)for(var m=u+f;m<g;m+=t)if(i[m]&&0==(l[m]&c)){var x=16;if(0!=(l[m]&d)){l[m]^=d;var h=127&r[m];x=0==h?15:14}var y=e.readBit(a,x);i[m]=i[m]<<1|y,s[m]++,l[m]|=c}}},runCleanupPass:function(){for(var e=this.decoder,r=this.width,a=this.height,s=this.neighborsSignificance,l=this.coefficentsMagnitude,c=this.coefficentsSign,d=this.contexts,p=this.contextLabelTable,u=this.bitsDecoded,g=this.processingFlags,f=2,m=r,x=2*r,h=3*r,y=0,I;y<a;y=I){I=o(y+4,a);for(var E=y*r,b=y+3<a,C=0;C<r;C++){var P=E+C,T=b&&0===g[P]&&0===g[P+m]&&0===g[P+x]&&0===g[P+h]&&0===s[P]&&0===s[P+m]&&0===s[P+x]&&0===s[P+h],S=0,v=P,L=y,i;if(T){var O=e.readBit(d,n);if(!O){u[P]++,u[P+m]++,u[P+x]++,u[P+h]++;continue}S=e.readBit(d,t)<<1|e.readBit(d,t),0!=S&&(L=y+S,v+=S*r),i=this.decodeSignBit(L,C,v),c[v]=i,l[v]=1,this.setNeighborsSignificance(L,C,v),g[v]|=f,v=P;for(var R=y;R<=L;R++,v+=r)u[v]++;S++}for(L=y+S;L<I;L++,v+=r)if(!(l[v]||0!=(g[v]&1))){var k=p[s[v]],D=e.readBit(d,k);1===D&&(i=this.decodeSignBit(L,C,v),c[v]=i,l[v]=1,this.setNeighborsSignificance(L,C,v),g[v]|=f),u[v]++}}}},checkSegmentationSymbol:function(){var e=this.decoder,n=this.contexts,i=e.readBit(n,t)<<3|e.readBit(n,t)<<2|e.readBit(n,t)<<1|e.readBit(n,t);if(10!=i)throw new d('Invalid segmentation symbol')}},e}(),j=function(){function e(){}return e.prototype.calculate=function(e,t,n){for(var r=e[0],a=1,i=e.length;a<i;a++)r=this.iterate(r,e[a],t,n);return r},e.prototype.extend=function(e,t,n){var i=t-1,r=t+1,a=t+n-2,s=t+n;e[i--]=e[r++],e[s++]=e[a--],e[i--]=e[r++],e[s++]=e[a--],e[i--]=e[r++],e[s++]=e[a--],e[i]=e[r],e[s]=e[a]},e.prototype.iterate=function(e,t,n,r){var a=t.relativeRegionInLevel;if(2*e.relativeRegionInLevel.x0>a.x0||2*e.relativeRegionInLevel.y0>a.y0||2*e.relativeRegionInLevel.x1<a.x1||2*e.relativeRegionInLevel.y1<a.y1)throw new Error('JPX Error: region in LL is smaller than region in higher resolution level');if(0!=a.x0%2||0!=a.y0%2)throw new Error('JPX Error: region in HL/LH/HH subbands begins in odd coefficients');var s=e.items,c=a.x1-a.x0,d=a.y1-a.y0,p=e.relativeRegionInLevel.x1-e.relativeRegionInLevel.x0,g=a.x0/2-e.relativeRegionInLevel.x0,f=a.y0/2-e.relativeRegionInLevel.y0,m=t.items,x,i,h,y,l,u;for(x=0;x<d;x+=2)for(y=x*c,h=g+f*p+p*x/2,i=0;i<c;i+=2,h++,y+=2)m[y]=s[h];s=e.items=null;var I=4,E=new Float32Array(c+2*I);if(1!=c)for(u=0,h=0;u<d;u++,h+=c)E.set(m.subarray(h,h+c),I),this.extend(E,I,c),this.filter(E,I,c),m.set(E.subarray(I,I+c),h);else if(0!=(1&n))for(u=0,h=0;u<d;u++,h+=c)m[h]*=0.5;var C=16,P=[];for(x=0;x<C;x++)P.push(new Float32Array(d+2*I));var T=0,S;if(e=I+d,1!=d)for(l=0;l<c;l++){if(0==T){for(C=o(c-l,C),h=l,y=I;y<e;h+=c,y++)for(S=0;S<C;S++)P[S][y]=m[h+S];T=C}T--;var b=P[T];if(this.extend(b,I,d),this.filter(b,I,d),0===T)for(h=l-C+1,y=I;y<e;h+=c,y++)for(S=0;S<C;S++)m[h+S]=P[S][y]}else if(0!=(1&r))for(l=0;l<c;l++)m[l]*=0.5;return{relativeRegionInLevel:a,width:c,height:d,items:m}},e}(),N=function(){function e(){j.call(this)}return e.prototype=Object.create(j.prototype),e.prototype.filter=function(e,t,i){var r=i>>1;t|=0;var a=-1.586134342059924,s=-0.052980118572961,o=0.882911075530934,l=0.443506852043971,c=1.230174104914001,d,p,n,u;for(d=t-3,p=r+4;p--;d+=2)e[d]*=1/c;for(d=t-2,n=l*e[d-1],p=r+3;p--&&(u=l*e[d+1],e[d]=c*e[d]-n-u,p--);d+=2)d+=2,n=l*e[d+1],e[d]=c*e[d]-n-u;for(d=t-1,n=o*e[d-1],p=r+2;p--&&(u=o*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=o*e[d+1],e[d]-=n+u;for(d=t,n=s*e[d-1],p=r+1;p--&&(u=s*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=s*e[d+1],e[d]-=n+u;if(0!=r)for(d=t+1,n=a*e[d-1],p=r;p--&&(u=a*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=a*e[d+1],e[d]-=n+u},e}(),F=function(){function e(){j.call(this)}return e.prototype=Object.create(j.prototype),e.prototype.filter=function(e,t,i){var r=i>>1;t|=0;var a,s;for(a=t,s=r+1;s--;a+=2)e[a]-=e[a-1]+e[a+1]+2>>2;for(a=t+1,s=r;s--;a+=2)e[a]+=e[a-1]+e[a+1]>>1},e}();return e}();t.JpxImage=c},function(e,t,n){'use strict';function i(){this._image=new r.JpxImage,this._cachedContexts=[]}var r=n(2);e.exports=i,Object.defineProperty(i.prototype,'image',{get:function(){return this._image}}),i.prototype.getContext=function(e){var t=this._cachedContexts[e.length];t||(t=[],this._cachedContexts[e.length]=t);for(var n=0,r=!1;n<t.length&&!r;){for(var a=t[n].codestream,s=0;s<a.length&&a[s]===e[s];)++s;r=s===a.length,++n}var i;return r?(i=t[n-1].context,this._image.invalidateData(i)):(i=this._image.parseCodestream(e,0,e.length,{isOnlyParseHeaders:!0}),t.push({codestream:e,context:i})),i}},function(e,t,n){'use strict';var i=n(0);e.exports.JpipImage=n(5),e.exports.j2kExceptions=i.j2kExceptions,e.exports.jpipExceptions=i.jpipExceptions,e.exports.Internals={PdfjsJpxDecoderLegacy:n(43),PdfjsJpxPixelsDecoder:n(46),PdfjsJpxCoefficientsDecoder:n(47),jpipRuntimeFactory:n(1),jGlobals:i}},function(e,t,n){'use strict';function i(e,t){function n(e){var t=a.createDatabinsSaver(!1),n=t.getMainHeaderDatabin(),i=a.createMarkersParser(n),r=a.createOffsetsCalculator(n,i),s=a.createStructureParser(t,i,r),o='RPCL',l=a.createCodestreamStructure(s,o),c=a.createQualityLayersCache(l),d=a.createHeaderModifier(r,o),p=a.createCodestreamReconstructor(t,d,c),u=a.createPacketsDataCollector(t,c),g=a.createRequestParamsModifier(l);return{reconstructor:p,packetsDataCollector:u,qualityLayersCache:c,codestreamStructure:l,databinsSaver:t,paramsModifier:g,fetcherSharedObjects:{},fetcherOptions:e,jpipFactory:a}}function c(){y||(y=t?f.paramsModifier.modifyCustomProgressiveness(t):f.paramsModifier.getAutomaticProgressiveness(),h.setProgressiveness(y))}function d(e){function t(){d||(d=!0,c.unregister())}var n=f.paramsModifier.modifyCodestreamPartParams(e.key),i=a.createParamsCodestreamPart(n,f.codestreamStructure),r=0,l=[],c;e.on('dependencyTaskData',function(e,t){l[t.inClassIndex];c.precinctQualityLayerReached(t.inClassIndex,e.minQuality)});var d=!1;e.on('statusUpdated',function(e){if(!d&&!e.isWaitingForWorkerResult&&e.terminatedDependsTasks===e.dependsTasks)throw new s.jpipExceptions.InternalErrorException('jpip error: Unexpected unended task without pending depend tasks')}),e.on('custom',function(e){'aborting'===e&&t()}),c=a.createQualityWaiter(i,y,0,function(){null==p&&(p=f.reconstructor.createHeadersCodestream(i),g=u(i,n),m=f.codestreamStructure.getNumTilesX(),x=i.tilesBounds);var r=c.getProgressiveStagesFinished(),a='force'===y[r-1].force||'forceAll'===y[r-1].force;e.dataReady({headersCodestream:p,offsetInRegion:g,imageTilesX:m,tilesBounds:x,precinctCoefficients:e.dependTaskResults},o,a),c.isDone()&&(t(),e.terminate())},f.codestreamStructure,f.databinsSaver,function(t,n,i,a,s){l[a]=r++;var o=s.precinctPositionToIndexInComponentResolution(i);e.registerTaskDependency({taskType:'COEFFS',tileIndex:i.tileIndex,resolutionLevel:i.resolutionLevel,precinctX:i.precinctX,precinctY:i.precinctY,component:i.component,inClassIndex:a,precinctIndexInComponentResolution:o})}),c.register();var p=null,g=null,m,x}function p(e){function t(t){if(r!==t)throw new s.jpipExceptions.InternalErrorException('webjpip error: Unexpected context in data event');o=!0;var i=r.getProgressiveStagesFinished(),a='force'!==y[i-1].force&&'forceAll'!==y[i-1].force,c;a||(c=y[i-1].minNumQualityLayers);var d=r.getFetchedData(c);if(e.dataReady(d,l,a),r.isDone()){if(!o)throw new s.jpipExceptions.InternalErrorException('webjpip error: Coefficients task without data');n(),e.terminate()}}function n(){c||(c=!0,r.dispose())}var i=a.createPrecinctCodestreamPart(g(),f.codestreamStructure.getTileStructure(e.key.tileIndex),e.key.tileIndex,e.key.component,e.key.resolutionLevel,e.key.precinctX,e.key.precinctY);e.on('custom',function(e){'aborting'===e&&n()});var r=a.createImageDataContext(f,i,e.key.maxQuality,y),o=!1,c=!1;r.on('data',t),0<r.getProgressiveStagesFinished()&&t(r)}function u(e,t){if(t){var n=e.getTileIterator();if(!n.tryAdvance())throw new s.jpipExceptions.InternalErrorException('Empty codestreamPart in JpipImageDataContext');var i=n.tileIndex,r=f.codestreamStructure.getTileLeft(i,e.level),a=f.codestreamStructure.getTileTop(i,e.level);return{offsetX:t.minX-r,offsetY:t.minY-a,width:t.maxXExclusive-t.minX,height:t.maxYExclusive-t.minY}}return{offsetX:0,offsetY:0,width:f.codestreamStructure.getImageWidth(),height:f.codestreamStructure.getImageHeight()}}function g(){return null==x&&(x=a.createLevelCalculator(m)),x}var f;if(e&&e.jpipFactory)f=e;else{if(!e||!e.url)throw new s.jpipExceptions.ArgumentException('options.url',void 0);f=n(e)}var m=null,x=null,h=a.createFetcher(f.databinsSaver,f.fetcherSharedObjects,f.fetcherOptions),y;this.nonProgressive=function(e){return this.customProgressive([{minNumQualityLayers:e||'max',forceMaxQuality:'force'}])},this.autoProgressive=function(e){var t=this.getAutomaticProgressiveness(e);return this.customProgressive(t)},this.customProgressive=function(e){var t=f.paramsModifier.modifyCustomProgressiveness(e);return new i(f,t)},this.opened=function(e){m=e.getImageParams()},this.getLevelCalculator=g,this.getDecoderWorkersInputRetreiver=function(){return this},this.getFetcher=function(){return h},this.getWorkerTypeOptions=function(e){switch(e){case o:return{ctorName:'webjpip.Internals.PdfjsJpxPixelsDecoder',ctorArgs:[],scriptsToImport:[r(new Error)],pathToTransferablesInPromiseResult:[[0,'data','buffer']]};case l:return{ctorName:'webjpip.Internals.PdfjsJpxCoefficientsDecoder',ctorArgs:[],scriptsToImport:[r(new Error)],transferables:[[0,'headersCodestream','buffer'],[0,'codeblocksData','data','buffer']],pathToTransferablesInPromiseResult:[[0,'coefficients','buffer']]};default:throw new s.jpipExceptions.InternalErrorException('webjpip error: Unexpected worker type in getWorkerTypeOptions '+e);}},this.getKeyAsString=function(e){if('COEFFS'===e.taskType)return'C:'+e.inClassIndex;var t=f.paramsModifier.modifyCodestreamPartParams(e);return'P:xmin'+t.minX+'ymin'+t.minY+'xmax'+t.maxXExclusive+'ymax'+t.maxYExclusive+'r'+t.level},this.taskStarted=function(e){c(),'COEFFS'===e.key.taskType?p(e):d(e)};i.useLegacy&&(this.getWorkerTypeOptions=function(){return{ctorName:'webjpip.Internals.PdfjsJpxDecoderLegacy',ctorArgs:[],scriptsToImport:[r(new Error)],transferables:[[0,'headersCodestream','buffer'],[0,'codeblocksData','data','buffer']],pathToTransferablesInPromiseResult:[[]]}},this.getKeyAsString=function(e){return JSON.stringify(e)},this.taskStarted=function(e){function t(t){if(r!==t)throw new s.jpipExceptions.InternalErrorException('webjpip error: Unexpected context in data event');var n=r.getFetchedData();n.offsetInRegion=o,e.dataReady(n,!0),r.isDone()&&(e.terminate(),r.dispose())}c();var n=f.paramsModifier.modifyCodestreamPartParams(e.key),i=a.createParamsCodestreamPart(n,f.codestreamStructure),r=a.createImageDataContext(f,i,n.quality,y),o=u(i,n);r.on('data',t),r.hasData()&&t(r)})}function r(e){var t=e.stack.trim(),n=c.exec(t);if(n&&''!==n[2])return n[2];if(n=d.exec(t),n&&''!==n[1])return n[1];if(n=p.exec(t),n&&''!==n[1])return n[1];if(void 0!==e.fileName)return e.fileName;throw new s.jpipExceptions.InternalErrorException('webjpip.js: Could not get current script URL')}var a=n(1),s=n(0);e.exports=i;var o=1,l=2;i.toggleLegacy=function(){i.useLegacy=!i.useLegacy};var c=/at (|[^ ]+ \()([^ ]+):\d+:\d+/,d=new RegExp(/.+@(.*?):\d+:\d+/),p=new RegExp(/.+\/(.*?):\d+(:\d+)*$/)},function(e,t,n){'use strict';var i=n(0);e.exports={request:function(e,t,n,r){function a(){if(!l){if(4!==s.readyState){if(void 0===r||null===s.response||3>s.readyState)return;var e=s.response.byteLength,i=e-c;if(i<r)return;c=e}else if(l=!0,200!==s.status||null===s.response)return void n(s);o||t(s,l)}}var s=new XMLHttpRequest,o=void 0===t,l=!1,c=0;if(s.open('GET',e,!o),s.onreadystatechange=a,o||(s.mozResponseType=s.responseType='arraybuffer'),void 0!==r&&(s.setRequestHeader('X-Content-Type-Options','nosniff'),s.onprogress=a),s.send(null),o&&!l)throw new i.jpipExceptions.InternalErrorException('synchronous ajax call was not finished synchronously');return s}}},function(e,t,n){'use strict';var i=n(0);e.exports={createTransaction:function(){function e(e){if(!n.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot terminate an already terminated transaction');t=e?2:3}var t=1,n={get isAborted(){return 3==t},get isActive(){return 1==t},commit:function(){e(!0)},abort:function(){e(!1)}};return n},createTransactionalObject:function(e,t){function n(e){if(!e.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot use terminated transaction to access objects');if(e!==s&&s.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot simultanously access transactional object from two active transactions')}var r=null,a=e,s={isActive:!1,isAborted:!0};return{getValue:function(e){return(n(e),s===e)?r:(s.isAborted?r=t(a):a=t(r),s=e,r)},setValue:function(e,i){return n(e),s===e?void(r=i):void(!s.isAborted&&(a=t(r)),s=e,r=i)}}}}},function(e){'use strict';e.exports=function(){var e=function(){var e=Array(17);return e[0]=0,e[1]=0,e[2]=1,e[3]=0,e[4]=4,e[5]=3,e[6]=2,e[7]=1,e[8]=0,e[9]=6,e[10]=5,e[11]=4,e[12]=3,e[13]=2,e[14]=1,e[15]=0,e[16]=0,e}(),t=function(){var e=Array(17);return e[0]=1,e[1]=2,e[2]=3,e[3]=5,e[4]=6,e[5]=22,e[6]=30,e[7]=34,e[8]=36,e[9]=37,e[10]=101,e[11]=133,e[12]=149,e[13]=157,e[14]=161,e[15]=163,e[16]=164,e}();return{parse:function(n){var i=n.countOnesAndShiftUntilFirstZeroBit(16);if(null===i)return null;var r=e[i],a=n.shiftBits(r);if(null===a)return null;var s=t[i];return a+s}}}()},function(e,t,n){'use strict';var i=n(0),r={LSB_MASK:1,BIT_4_MASK:16,BITS_56_MASK:96,MSB_MASK:128,LSB_7_MASK:127,parseNumberInVbas:function(e,t,n){var i=r,a=t,s;if(n){s=e[a]&(1<<n)-1}else s=e[a]&i.LSB_7_MASK;for(;!!(e[a]&i.MSB_MASK);)++a,s<<=7,s|=e[a]&i.LSB_7_MASK;return{endOffset:a+1,number:s}},parseMessageHeader:function(e,t,n){var a=r,s=(e[t]&a.BITS_56_MASK)>>>5;if(0==s)throw new i.jpipExceptions.ParseException('Failed parsing message header (A.2.1): prohibited existance class and csn bits 00');var o=!!(e[t]&a.BIT_4_MASK),l=a.parseNumberInVbas(e,t,4),c=l.number,d=l.endOffset,p=0;if(!!(2&s)){var u=a.parseNumberInVbas(e,d);p=u.number,d=u.endOffset}else n&&(p=n.classId);var g=0;if(3==s){var f=a.parseNumberInVbas(e,d);g=f.number,d=f.endOffset}else n&&(g=n.codestreamIndex);var m=a.parseNumberInVbas(e,d),x=m.number;d=m.endOffset;var h=a.parseNumberInVbas(e,d),y=h.number;d=h.endOffset;var I=!!(p&a.LSB_MASK),E;if(I){var b=a.parseNumberInVbas(e,d);E=b.number,d=b.endOffset}var C={isLastByteInDatabin:o,inClassId:c,bodyStart:d,classId:p,codestreamIndex:g,messageOffsetFromDatabinStart:x,messageBodyLength:y};return I&&(C.aux=E),C},getInt32:function(e,t){var n=16777216*e[t],i=e[t+1]<<16,r=e[t+2]<<8,a=e[t+3];return n+i+r+a},getInt16:function(e,t){var n=e[t]<<8,i=e[t+1];return n+i}};e.exports=r},function(e,t,n){'use strict';var r=n(0);e.exports=function(e,t,n){function i(){var e=p.length+d.length;return e}function a(e){var n=t.getDataRequestUrl(),i=t.getTargetId();'0'!==i&&(n+='&tid='+i);var r=null!==l;if(r){var a=u&&e;n+=a?'&wait=no':'&wait=yes'}return n}function s(e,n){var i=a(!0),r=t.getCodestreamStructure(),s=r.getLevelWidth(e.level),o=r.getLevelHeight(e.level),l=e.maxXExclusive-e.minX,c=e.maxYExclusive-e.minY;return i+='&fsiz='+s+','+o+',closest&rsiz='+l+','+c+'&roff='+e.minX+','+e.minY,'max'!==n&&(i+='&layers='+n),i}var o=this,l=null,c=0,d=[],p=[],u=!1;this.requestData=function(a,c,g,f){if(!u){var m=i();if(m>=e)throw new r.jpipExceptions.InternalErrorException('Channel has too many requests not responded yet')}var x=s(a,f),h=n.createRequest(t,o,x,c,g);return null!=l||0===p.length?(p.push(h),h.startRequest()):u?d=[h]:d.push(h),h},this.sendMinimalRequest=function(e){if(null==l&&0<p.length)throw new r.jpipExceptions.InternalErrorException('Minimal requests should be used for first request or keep alive message. Keep alive requires an already initialized channel, and first request requires to not have any previous request');var i=a(),s=n.createRequest(t,o,i,e);p.push(s),s.startRequest()},this.getIsDedicatedForMovableRequest=function(){return u},this.dedicateForMovableRequest=function(){if(u)throw new r.jpipExceptions.InternalErrorException('Channel already dedicated for movable request');u=!0},this.getChannelId=function(){return l},this.setChannelId=function(e){if(null!==e){l=e;var t=d;d=[];for(var n=0;n<t.length;++n)p.push(t[n]),t[n].startRequest()}},this.nextRequestId=function(){return++c},this.getRequestsWaitingForResponse=function(){return p},this.getAllQueuedRequestCount=i,this.requestEnded=function(e,n){for(var a=p,s=!1,c=0;c<a.length;++c)if(a[c]===n){a[c]=a[a.length-1],a.length-=1,s=!0;break}if(!s)throw new r.jpipExceptions.InternalErrorException('channel.requestsWaitingForResponse inconsistency');if(t.requestEnded(e,o),null===l&&0<d.length){var i=d.shift();p.push(i),i.startRequest()}},this.isAllOldRequestsEnded=function(e){for(var t=0;t<p.length;++t)if(p[t].lastRequestId<=e)return!1;return!0}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function r(e,t,n,r){var s=a(g,e,t,n,r);if(null===s)return null;var o=new Uint8Array(s),l=a(o,e,t,n,r);if(l===s)return o;if(null===l)return null;throw new i.jpipExceptions.InternalErrorException('JpipCodestreamReconstructor: Unmatched actualLength '+l+' and calculatedLength '+s)}function a(e,n,r,a,l){var c=s(e,n.level);if(null===c)return null;for(var d=0,u=n.getTileIterator();u.tryAdvance();){var g=u.tileIndex,f=o(e,c,d++,u,n.level,r,a,l);if(c+=f,null===f)return null}var m=p(e,c,i.j2kMarkers.EndOfCodestream);return c+=m,t.modifyImageSize(e,n.fullTilesSize),null===e?null:c}function s(n,r){if(e.getIsJpipTilePartStream())throw new i.jpipExceptions.UnsupportedFeatureException('reconstruction of codestream from JPT (Jpip Tile-part) stream','A.3.4');var a=e.getMainHeaderDatabin(),s=a.copyBytes(n,0,{forceCopyAllRange:!0});if(null===s)return null;var o=t.modifyMainOrTileHeader(n,a,0,r);return s+=o,o=d(n,s),s+=o,s}function o(n,i,r,a,s,o,d,p){var u=a.tileIndex,g=i,f=e.getTileHeaderDatabin(u),m=l(n,i,f,r,s);if(null===m)return null;if(i=m.endTileHeaderOffset,!p){var x=c(n,i,a,o,d);if(i+=x,null===x)return null}var h=i,y=h-m.startOfTileHeaderOffset;t.modifyInt32(n,m.headerAndDataLengthPlaceholderOffset,y);return h-g}function l(e,n,r,a,s){var o=n,l=p(e,n,i.j2kMarkers.StartOfTile);n+=l;l=p(e,n,[0,10]),n+=l;l=p(e,n,[a>>>8,255&a]),n+=l;var c=n;l=p(e,n,[0,0,0,0]),n+=l;l=p(e,n,[0]),n+=l;l=p(e,n,[1]),n+=l;var d=n;if(l=r.copyBytes(e,n,{forceCopyAllRange:!0}),n+=l,null===l)return null;var u=[,,],g=r.getDatabinLengthIfKnown();r.copyBytes(u,0,{databinStartOffset:g-2});var f=u[0]===i.j2kMarkers.StartOfData[0]&&u[1]===i.j2kMarkers.StartOfData[1];f||(l=p(e,n,i.j2kMarkers.StartOfData),n+=l);var m=t.modifyMainOrTileHeader(e,r,d,s);n+=m;var x={startOfTileHeaderOffset:o,headerAndDataLengthPlaceholderOffset:c,endTileHeaderOffset:n};return x}function c(t,r,a,s,o){var l=a.tileStructure.getNumQualityLayers(),c=0;'max'===s&&(s=l);for(var d=a.createPrecinctIterator(!0);d.tryAdvance();){var p=l;if(d.isInCodestreamPart){var u=a.tileStructure.precinctPositionToInClassIndex(d),g=e.getPrecinctDatabin(u),f=n.getQualityLayerOffset(g,o,d),m=f.endOffset;if(p=l-f.numQualityLayers,f.numQualityLayers<s)return null;var x=g.copyBytes(t,r,{forceCopyAllRange:!0,maxLengthToCopy:m});null===x&&(x=0,p=l),c+=x,r+=x}if(!t.isDummyBufferForLengthCalculation)for(var h=0;h<p;++h)t[r++]=0;c+=p}return c}function d(e,t){var n=t;u(e,t++,255),u(e,t++,100),u(e,t++,0),u(e,t++,9),u(e,t++,77),u(e,t++,97),u(e,t++,109),u(e,t++,97),u(e,t++,122),u(e,t++,97),u(e,t++,118);var i=t-n;return i}function p(e,t,n){if(!e.isDummyBufferForLengthCalculation)for(var r=0;r<n.length;++r)e[r+t]=n[r];return n.length}function u(e,t,n){e.isDummyBufferForLengthCalculation||(e[t]=n)}var g={isDummyBufferForLengthCalculation:!0};this.createCodestream=function(e,t,n){return r(e,t,n)},this.createHeadersCodestream=function(e){var t=1;return r(e,t,t,!0)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function r(e,t,n){if(0>t||t>=n)throw new i.jpipExceptions.ArgumentException(e,t,e+' is expected to be between 0 and '+n-1)}function a(t){if(!u){var n=e.parseDefaultTileParams();u=[,,,];for(var i=0;3>i;++i){u[i]=[,,,];for(var r=0,a;3>r;++r)a={horizontalEdgeType:i,verticalEdgeType:r},u[i][r]=s(n,a)}}var o=u[t.horizontalEdgeType],l=o[t.verticalEdgeType];return l}function s(e,r){o();var a=JSON.parse(JSON.stringify(e));a.tileSize=p.getTileSize(r),a.defaultComponentParams.scaleX=1,a.defaultComponentParams.scaleY=1;for(var s=0;s<a.paramsPerComponent.length;++s)a.paramsPerComponent[s].scaleX=d.componentsScaleX[s],a.paramsPerComponent[s].scaleY=d.componentsScaleY[s];var i=t.createTileStructure(a,l,n);return i}function o(){d||(d=e.parseCodestreamStructure(),p=t.createLevelCalculator(d))}var l=this,c=[],d,p,u;return this.getSizesParams=function(){return o(),d},this.getNumTilesX=function(){o();var e=p.getNumTilesX();return e},this.getNumTilesY=function(){o();var e=p.getNumTilesY();return e},this.getNumComponents=function(){return o(),d.numComponents},this.getImageWidth=function(){o();var e=p.getLevelWidth();return e},this.getImageHeight=function(){o();var e=p.getLevelHeight();return e},this.getLevelWidth=function(e){o();var t=p.getLevelWidth(e);return t},this.getLevelHeight=function(e){o();var t=p.getLevelHeight(e);return t},this.getTileWidth=function(e){o();var t=p.getTileWidth(e);return t},this.getTileHeight=function(e){o();var t=p.getTileHeight(e);return t},this.getFirstTileOffsetX=function(){o();var e=p.getFirstTileOffsetX();return e},this.getFirstTileOffsetY=function(){o();var e=p.getFirstTileOffsetY();return e},this.getTileLeft=function(e,t){o();var n=e%p.getNumTilesX();if(0==n)return 0;var i=(n-1)*p.getTileWidth(t)+p.getFirstTileWidth(t);return i},this.getTileTop=function(e,t){o();var n=Math.floor(e/p.getNumTilesX());if(0===n)return 0;var i=(n-1)*p.getTileHeight(t)+p.getFirstTileHeight(t);return i},this.getDefaultTileStructure=function(){o();var e=a({horizontalEdgeType:p.EDGE_TYPE_NO_EDGE,verticalEdgeType:p.EDGE_TYPE_NO_EDGE});return e},this.getTileStructure=function(t){o();var n=p.getNumTilesX()*p.getNumTilesY()-1;if(0>t||t>n)throw new i.jpipExceptions.ArgumentException('tileId',t,'Expected value between 0 and '+n);var r=p.isEdgeTileId(t);if(void 0===c[t]){var l=e.parseOverridenTileParams(t);c[t]=l?s(l,r):null}if(c[t])return c[t];var d=a(r);return d},this.tilePositionToInClassIndex=function(e){o();var t=p.getNumTilesX(),n=p.getNumTilesY();r('tilePosition.tileX',e.tileX,t),r('tilePosition.tileY',e.tileY,n);var i=e.tileX+e.tileY*t;return i},this.tileInClassIndexToPosition=function(e){o();var t=p.getNumTilesX(),n=p.getNumTilesY();r('inClassIndex',e,t*n);var i=e%t;return{tileX:i,tileY:(e-i)/t}},this.getTilesFromPixels=function(e){return o(),p.getTilesFromPixels(e)},this.getSizeOfTiles=function(e){o();var t=p.getSizeOfTiles(e);return t},this}},function(e,t,n){'use strict';var i=Math.floor,r=Math.ceil,a=n(0);e.exports=function(e,t){function n(e,t,n){var i=o(n),a=t[n],s=r(e/i/a);return s}function s(e,t,n,i,a){var s=o(e.resolutionLevel),l=r(a/s),c=t*i[e.resolutionLevel],d=Math.min(i[e.resolutionLevel],l-c),p=0===e.resolutionLevel?1:2,u=r(d/p),g=p*r(u/n);return 1==d%n&&0<e.resolutionLevel&&--g,g}function o(t){var n=e.numResolutionLevels-t-1;return 1<<n}var l,c;(function(){if(1!==e.scaleX||1!==e.scaleY)throw new a.j2kExceptions.UnsupportedFeatureException('Non 1 component scale','A.5.1');l=i(t.getTileWidth()/e.scaleX),c=i(t.getTileHeight()/e.scaleY)})(),this.getComponentScaleX=function(){return e.scaleX},this.getComponentScaleY=function(){return e.scaleY},this.getNumResolutionLevels=function(){return e.numResolutionLevels},this.getPrecinctWidth=function(t){var n=e.precinctWidthPerLevel[t];return n},this.getPrecinctHeight=function(t){var n=e.precinctHeightPerLevel[t];return n},this.getMaxCodeblockWidth=function(){var t=e.maxCodeblockWidth;return t},this.getMaxCodeblockHeight=function(){var t=e.maxCodeblockHeight;return t},this.getNumCodeblocksXInPrecinct=function(t){var n=s(t,t.precinctX,e.maxCodeblockWidth,e.precinctWidthPerLevel,l);return n},this.getNumCodeblocksYInPrecinct=function(t){var n=s(t,t.precinctY,e.maxCodeblockHeight,e.precinctHeightPerLevel,c);return n},this.getNumPrecinctsX=function(t){var i=n(l,e.precinctWidthPerLevel,t);return i},this.getNumPrecinctsY=function(t){var i=n(c,e.precinctHeightPerLevel,t);return i}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e){function t(t,n){if(t===void 0||n===void 0)throw new i.jpipExceptions.InternalErrorException('minOffset or maxOffset is undefined for CompositeArray.copyToArray');if(t<e)throw new i.jpipExceptions.InternalErrorException('minOffset ('+t+') must be smaller than CompositeArray offset ('+e+')');if(n>e+s)throw new i.jpipExceptions.InternalErrorException('maxOffset ('+n+') must be larger than CompositeArray end offset ('+e+s+')')}function n(t,n){var a=Math.max(e,t),o=e+s;if(void 0!==n&&(o=Math.min(o,n)),a>=o){return{internalIteratorData:{isEndOfRange:!0}}}var l={subArray:null,offset:-1,internalIteratorData:{end:o,currentSubArray:null,currentInternalPartOffset:null,nextInternalPartOffset:e,currentInternalPartIndex:-1,isEndOfRange:!1}},c=!1;do{if(c)throw new i.jpipExceptions.InternalErrorException('Iterator reached to the end although no data has been iterated');c=!r(l)}while(a>=l.internalIteratorData.nextInternalPartOffset);var d=a-l.internalIteratorData.currentInternalPartOffset;return l.internalIteratorData.currentSubArray=l.internalIteratorData.currentSubArray.subarray(d),l.internalIteratorData.currentInternalPartOffset=a,l}function r(e){var t=e.internalIteratorData;if(t.isEndOfRange)return!1;if(e.subArray=t.currentSubArray,e.offset=t.currentInternalPartOffset,++t.currentInternalPartIndex,t.nextInternalPartOffset>=t.end)return t.isEndOfRange=!0,!0;a(t.currentInternalPartIndex),t.currentSubArray=o[t.currentInternalPartIndex],t.currentInternalPartOffset=t.nextInternalPartOffset;var n=o[t.currentInternalPartIndex].length;t.nextInternalPartOffset=t.currentInternalPartOffset+n;var i=t.end-t.currentInternalPartOffset,r=i<t.currentSubArray.length;return r&&(t.currentSubArray=t.currentSubArray.subarray(0,i)),!0}function a(e){if(e>=o.length)throw new i.jpipExceptions.InternalErrorException('CompositeArray: end of part has reached. Check end calculation')}var s=0,o=[];this.getLength=function(){return s},this.getOffset=function(){return e},this.pushSubArray=function(e){o.push(e),s+=e.length},this.copyToOtherAtTheEnd=function(e,i,a){t(i,a);for(var s=n(i,a);r(s);)e.pushSubArray(s.subArray)},this.copyToTypedArray=function(e,i,a,s){t(a,s);for(var o=n(a,s);r(o);){var l=o.offset-i;e.set(o.subArray,l)}},this.copyToArray=function(e,i,a,s){t(a,s);for(var o=n(a,s);r(o);)for(var l=o.offset-i,c=0;c<o.subArray.length;++c)e[l++]=o.subArray[c]},this.copyToOther=function(t){if(t.getOffset()>e)throw new i.jpipExceptions.InternalErrorException('CompositeArray: Trying to copy part into a latter part');var a=t.getOffset()+t.getLength(),o=e+s<=a;if(!o){var l=a,c=n(l);if(!r(c))throw new i.jpipExceptions.InternalErrorException('CompositeArray: Could not merge parts');var d=l;do{if(c.offset!==d)throw new i.jpipExceptions.InternalErrorException('CompositeArray: Non-continuous value of rangeToCopy.offset. Expected: '+d+', Actual: '+c.offset);t.pushSubArray(c.subArray),d+=c.subArray.length}while(r(c))}}}},function(e){'use strict';var t=Math.min;e.exports=function(e,n,r){function i(e,t){var n=!1,i=0,r;if(void 0!==t&&(n=!!t.forceCopyAllRange,i=t.databinStartOffset,r=t.maxLengthToCopy,void 0===i&&(i=0)),void 0===e&&(e=0),0===r)return{resultWithoutCopy:0};if(null!==d&&i>=d)return{resultWithoutCopy:!!r&&n?null:0};var s=o(i);if(s===c.length)return{resultWithoutCopy:n?null:0};if(n){var l=a(i,r,s);if(!l)return{resultWithoutCopy:null}}var p={databinStartOffset:i,maxLengthToCopy:r,resultStartOffset:e};return p}function a(e,t,n){if(c[n].getOffset()>e)return!1;if(t){var i=e-c[n].getOffset(),r=c[n].getLength()-i;return r>=t}if(null===d||n<c.length-1)return!1;var a=c[c.length-1],s=a.getOffset()+a.getLength(),o=s===d;return o}function s(e,n,r){var a;if(void 0!==n)a=e+n;else{var s=c[c.length-1];a=s.getOffset()+s.getLength()}for(var o=null,l=0;l<c.length&&!(c[l].getOffset()>=a);++l){var i=Math.max(e,c[l].getOffset()),d=t(a,c[l].getOffset()+c[l].getLength());r(c[l],i,d),o=c[l]}if(null===o)return 0;var p=t(o.getOffset()+o.getLength(),a);return p-e}function o(e){var t;for(t=0;t<c.length&&!(c[t].getOffset()+c[t].getLength()>e);++t);return t}var l=this,c=[],d=null,p=0,u=[];return this.getDatabinLengthIfKnown=function(){return d},this.getLoadedBytes=function(){return p},this.isAllDatabinLoaded=function(){var e;switch(c.length){case 0:e=0===d;break;case 1:e=0===c[0].getOffset()&&c[0].getLength()===d;break;default:e=!1;}return e},this.getCachedData=function(e){var t=u[e];return void 0===t&&(t={},u[e]=t),t},this.getClassId=function(){return e},this.getInClassId=function(){return n},this.copyToCompositeArray=function(e,t){var n=i(0,t);if(void 0!==n.resultWithoutCopy)return n.resultWithoutCopy;var r=s(n.databinStartOffset,n.maxLengthToCopy,function(t,n,i){t.copyToOtherAtTheEnd(e,n,i)});return r},this.copyBytes=function(e,t,n){var r=i(t,n);if(void 0!==r.resultWithoutCopy)return r.resultWithoutCopy;var a=r.databinStartOffset-r.resultStartOffset,o=e.isDummyBufferForLengthCalculation?function(){}:function(t,n,i){t.copyToArray(e,a,n,i)},l=s(r.databinStartOffset,r.maxLengthToCopy,o);return l},this.getExistingRanges=function(){for(var e=Array(c.length),t=0;t<c.length;++t)e[t]={start:c[t].getOffset(),length:c[t].getLength()};return e},this.addData=function(e,t){if(e.isLastByteInDatabin&&(d=e.messageOffsetFromDatabinStart+e.messageBodyLength),0!==e.messageBodyLength){var n=r.createCompositeArray(e.messageOffsetFromDatabinStart),a=e.bodyStart+e.messageBodyLength;n.pushSubArray(t.subarray(e.bodyStart,a));var s=o(e.messageOffsetFromDatabinStart),l=s;if(0<s){var u=c[s-1],g=u.getOffset()+u.getLength();g===e.messageOffsetFromDatabinStart&&--l}if(l>=c.length)return c.push(n),void(p+=e.messageBodyLength);var f=c[l],m=e.messageOffsetFromDatabinStart+e.messageBodyLength;if(f.getOffset()>m){for(var x=c.length;x>l;--x)c[x]=c[x-1];return c[l]=n,void(p+=e.messageBodyLength)}var i=f.getLength(),h=f.getOffset()>e.messageOffsetFromDatabinStart;h&&(c[l]=n,n=f,f=c[l]),n.copyToOther(f);var y=f.getOffset()+f.getLength(),I;for(I=l;I<c.length-1&&!(y<c[I+1].getOffset());++I)i+=c[I+1].getLength();var E=I-l;if(0<E){c[I].copyToOther(f);for(var b=l+1;b<c.length-E;++b)c[b]=c[b+E];c.length-=E}p+=f.getLength()-i}},this}},function(e,t,n){'use strict';var r=n(0);e.exports=function(e,t){function n(e,t){if(0!==e.inClassId)throw new r.jpipExceptions.IllegalDataException('Main header data-bin with in-class index other than zero is not valid','A.3.5');var n=h.getLoadedBytes();h.addData(e,t);var i=h.getLoadedBytes()-n;m+=i,x+=i}function a(){}function s(n,i,a,s,o){if(s!==e)throw new r.jpipExceptions.WrongStreamException('databin of type '+o,e);var l=n.databins[a];return l||(l=t.createDatabinParts(i,a),n.databins[a]=l),l}function i(){return{databins:[],listeners:[],databinsWithListeners:[]}}var o=0,l=1,c=2,d=4,p=5,u=[],g=[],f=[],m=0,x=0;u[c]=i(),u[o]=i(),u[l]=u[o],f[c]=!0,f[o]=!0,f[l]=!0,u[d]=i(),u[p]=u[d],g[d]=!0,g[p]=!0;var h=t.createDatabinParts(6,0);return this.getIsJpipTilePartStream=function(){return e},this.getLoadedBytes=function(){return m},this.getMainHeaderDatabin=function(){return h},this.getTileHeaderDatabin=function(e){var t=s(u[c],c,e,!1,'tileHeader');return t},this.getPrecinctDatabin=function(e){var t=s(u[o],o,e,!1,'precinct');return t},this.getTileDatabin=function(e){var t=s(u[d],d,e,!0,'tilePart');return t},this.addEventListener=function(e,t,n,i){if('dataArrived'!==t)throw new r.jpipExceptions.InternalErrorException('Unsupported event: '+t);var a=e.getClassId(),s=e.getInClassId(),o=u[a];if(e!==o.databins[s])throw new r.jpipExceptions.InternalErrorException('Unmatched databin with class-ID='+a+' and in-class-ID='+s);void 0===o.listeners[s]&&(o.listeners[s]=[]),0===o.listeners[s].length&&(x+=e.getLoadedBytes());var l={listener:n,listenerThis:i,databin:e,isRegistered:!0,index:o.listeners[s].length};return o.listeners[s].push(l),o.databinsWithListeners[s]=e,l},this.removeEventListener=function(e){var t=e.databin.getClassId(),n=e.databin.getInClassId(),i=u[t],a=i.listeners[n];if(e.databin!==i.databins[n]||e.databin!==i.databinsWithListeners[n])throw new r.jpipExceptions.InternalErrorException('Unmatched databin with class-ID='+t+' and in-class-ID='+n);if(e!==a[e.index])throw new r.jpipExceptions.InternalErrorException('Incosnsitency in databin listeners indices');a[e.index].isRegistered=!1,a[e.index]=a[a.length-1],a[a.length-1].index=e.index,a.length-=1,0===a.length&&(delete i.databinsWithListeners[n],x-=e.databin.getLoadedBytes())},this.cleanupUnregisteredDatabins=function(){for(var e=0;e<u.length;++e)if(void 0!==u[e]){var t=u[e].databinsWithListeners;u[e].databins=t.slice()}m=x},this.saveData=function(e,t){if(0!==e.codestreamIndex)throw new r.jpipExceptions.UnsupportedFeatureException('Non zero Csn (Code Stream Index)','A.2.2');switch(e.classId){case 6:n(e,t);break;case 8:a(e,t);break;default:var o=u[e.classId];if(void 0===o)break;var l=!!g[e.classId],c=s(o,e.classId,e.inClassId,l,'<class ID '+e.classId+'>'),d=c.getLoadedBytes();c.addData(e,t);var p=c.getLoadedBytes()-d;m+=p;var f=o.listeners,h=f[e.inClassId];if(void 0!==h&&0<h.length){x+=p;for(var y=h.slice(),I=0,i;I<y.length;++I)i=y[I],i.isRegistered&&i.listener.call(i.listenerThis,c)}}},this}},function(e,t,n){'use strict';e.exports=function(e,t,n){function r(){if(g>=n.length)throw new i.jpipExceptions.IllegalOperationException('Unexpected requestData() after fetch done');if(null!=c&&null===l)throw new i.jpipExceptions.IllegalOperationException('Cannot resume already-active-fetch');if(d)throw new i.jpipExceptions.IllegalOperationException('Cannot resume already-terminated-fetch');setTimeout(function(){g>=n.length||null!=c||d||(u=p?g:n.length-1,c=t.requestData(o,a,s,n[u].minNumQualityLayers,l))})}function a(t,i){c=null;i&&(g=u,g>=n.length&&e.done())}function s(){}var o=null,l=null,c=null,d=!1,p=!1,u=0,g=0;this.setDedicatedChannelHandle=function(e){l=e},this.move=function(e){if(null===l&&null!=o)throw new i.jpipExceptions.IllegalOperationException('Cannot move non movable fetch');o=e,r()},this.resume=function(){r()},this.stop=function(){if(null==c){if(d)throw new i.jpipExceptions.IllegalOperationException('Cannot stop already terminated fetch');throw new i.jpipExceptions.IllegalOperationException('Cannot stop already stopped fetch')}return l||(t.stopRequestAsync(c),c=null),e.stopped()},this.terminate=function(){if(l)throw new i.jpipExceptions.IllegalOperationException('Unexpected terminate event on movable fetch');if(d)throw new i.jpipExceptions.IllegalOperationException('Double terminate event');c=null,d=!0},this.isProgressiveChanged=function(e){p=e,l&&null!=c&&(c=null,r())}};var i=n(0)},function(e,t,n){'use strict';n(0);e.exports=function(e,t,n,i){function r(e){var n=i.createFetch(e,t.requester,p);return e.on('isProgressiveChanged',n.isProgressiveChanged),e.on('terminate',n.terminate),e.on('stop',n.stop),e.on('resume',n.resum),n}function a(e){var n=null;null!==e.exception&&(n=e.exception.toString());var i={isReady:e.isReady,exception:n};if(!l||!i.isReady&&!i.exception){if(i.exception)try{console.error('JpipFetcher.requesterStatusCallback got unexpected exception: '+i.exception)}catch(t){}return}var r=l,a=c;if(l=null,c=null,!i.isReady)return void a(i.exception);var s=t.codestreamStructure.getSizesParams(),o=JSON.parse(JSON.stringify(s)),d=t.codestreamStructure.getDefaultTileStructure(),p=d.getDefaultComponentStructure();o.imageLevel=0,o.lowestQuality=1,o.highestQuality=d.getNumQualityLayers(),o.numResolutionLevelsForLimittedViewer=p.getNumResolutionLevels(),r(o)}n=n||{};var s=!1,o=!1,l=null,c=null,d=n.url,p;return this.setProgressiveness=function(e){p=e},this.open=function(){if(s)throw'webJpip error: Cannot call JpipFetcher.open() twice';if(s=!0,t.openedCount)return++t.openedCount,t.openPromise;var r=n.maxChannelsInSession||1,o=n.maxRequestsWaitingForResponseInChannel||1,p=e.getMainHeaderDatabin(),u=i.createMarkersParser(p),g=i.createOffsetsCalculator(p,u),f=i.createStructureParser(e,u,g);return t.codestreamStructure=i.createCodestreamStructure(f,'RPCL'),t.paramsModifier=i.createRequestParamsModifier(t.codestreamStructure),t.requester=i.createReconnectableRequester(r,o,t.codestreamStructure,e),t.requester.setStatusCallback(a),t.isOpenCalledBeforePromiseInitialized=!1,t.openedCount=1,t.openPromise=new Promise(function(e,n){l=e,c=n,t.requester.open(d)}),t.openPromise},this.close=function(){return new Promise(function(e,n){if(o)return void n('Already closed');if(!s)return void n('Not opened');o=!0;var i=--t.openedCount;0>i&&n('Inconsistency in openedCount'),0==i&&t.requester.close(e)})},this.on=function(){},this.startFetch=function(e,n){var i=t.paramsModifier.modifyCodestreamPartParams(n),a=r(e);a.move(i)},this.startMovableFetch=function(e,n){var i=t.paramsModifier.modifyCodestreamPartParams(n),a=r(e),s=t.requester.dedicateChannelForMovableRequest();a.setDedicatedChannelHandle(s),e.on('move',a.move),a.move(i)},this.reconnect=function(){t.requester.reconnect()},this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(t,n,i){var r=e.getCodingStyleOffset(n);if(null!==r){t[i+r+5]=s}}function r(e,t,n){if(0===t.length)return 0;if(!e.isDummyBufferForLengthCalculation)for(var r=0;r<t.length;++r){var i=n+t[r].markerSegmentLengthOffset,a=(e[i]<<8)+e[i+1],s=a-t[r].length;e[i]=s>>>8,e[i+1]=255&s}for(var o=n+t[0].start,l=o,c=0;c<t.length;++c){l+=t[c].length;for(var d=c+1<t.length?n+t[c+1].start:e.length;l<d;++l)e[o]=e[l],++o}var p=l-o;return p}function a(e,t,n){e.isDummyBufferForLengthCalculation||(e[t++]=n>>>24,e[t++]=255&n>>>16,e[t++]=255&n>>>8,e[t++]=255&n)}var s=function(e){switch(e){case'LRCP':return 0;case'RLCP':return 1;case'RPCL':return 2;case'PCRL':return 3;case'CPRL':return 4;default:throw new i.j2kExceptions.IllegalDataException('Progression order of '+e,'A.6.1, table A.16');}}(t);this.modifyMainOrTileHeader=function(t,i,a,s){if(t.isDummyBufferForLengthCalculation||n(t,i,a),void 0===s)return 0;var o=e.getRangesOfBestResolutionLevelsData(i,s);if(null!==o.numDecompositionLevelsOffset&&!t.isDummyBufferForLengthCalculation){var l=a+o.numDecompositionLevelsOffset;t[l]-=s}var c=r(t,o.ranges,a);return-c},this.modifyImageSize=function(t,n){if(!t.isDummyBufferForLengthCalculation){var r=e.getImageAndTileSizeOffset(),s=r+i.j2kOffsets.REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER,o=s+8,l=s+16,c=s+24;a(t,s,n.regionWidth),a(t,s+4,n.regionHeight),a(t,l,n.tileWidth),a(t,l+4,n.tileHeight),a(t,o,0),a(t,o+4,0),a(t,c,0),a(t,c+4,0)}},this.modifyInt32=a}},function(e,t,n){'use strict';function i(e,t,n,i){this._codestreamPart=t,this._reconstructor=e.reconstructor,this._packetsDataCollector=e.packetsDataCollector,this._qualityLayersCache=e.qualityLayersCache,this._codestreamStructure=e.codestreamStructure,this._databinsSaver=e.databinsSaver,this._jpipFactory=e.jpipFactory,this._maxQualityPerPrecinct=[],this._registeredPrecinctDatabins=[],this._dataListeners=[],this._isDisposed=!1,this._isProgressive=!0,this._listener=this._jpipFactory.createQualityWaiter(this._codestreamPart,i,n,this._qualityLayerReachedCallback,this._codestreamStructure,this._databinsSaver,this._startTrackPrecinct,this),this._listener.register()}var r=n(0);e.exports=i,i.prototype.getProgressiveStagesFinished=function(){return this._ensureNotDisposed(),this._listener.getProgressiveStagesFinished()},i.prototype.getFetchedData=function(e){if(this._ensureNotDisposed(),0===this.getProgressiveStagesFinished())throw'JpipImageDataContext error: cannot call getFetchedData before getProgressiveStagesFinished() > 0';var t=this._listener.getQualityReached();if(e){if(e>t)throw'JpipImageDataContext error: getFetchedData called with quality higher than already reached';t=e}var n=this._packetsDataCollector.getAllCodeblocksData(this._codestreamPart,t,e),i=this._getCodestream(!0);if(null===n.codeblocksData)throw new r.jpipExceptions.InternalErrorException('Could not collect codeblocks although progressiveness stage has been reached');if(null===i)throw new r.jpipExceptions.InternalErrorException('Could not reconstruct codestream although progressiveness stage has been reached');return{headersCodestream:i,codeblocksData:n.codeblocksData,minQuality:t}},i.prototype.getFetchedDataAsCodestream=function(){return this._getCodestream(!1)},i.prototype.on=function(e,t){if(this._ensureNotDisposed(),'data'!==e)throw'JpipImageDataContext error: Unexpected event '+e;this._dataListeners.push(t)},i.prototype.isDone=function(){return this._ensureNotDisposed(),this._listener.isDone()},i.prototype.dispose=function(){this._ensureNotDisposed(),this._isDisposed=!0,this._listener.unregister(),this._listener=null;for(var e=0,t;e<this._registeredPrecinctDatabins.length;++e)t=this._registeredPrecinctDatabins[e],this._databinsSaver.removeEventListener(t)},i.prototype.setIsProgressive=function(e){this._ensureNotDisposed();var t=this._isProgressive;if(this._isProgressive=e,!t&&e&&0<this.getProgressiveStagesFinished())for(var n=0;n<this._dataListeners.length;++n)this._dataListeners[n](this)},i.prototype._getCodestream=function(e){this._ensureNotDisposed();var t=this._listener.getQualityReached(),n;if(n=e?this._reconstructor.createHeadersCodestream(this._codestreamPart):this._reconstructor.createCodestream(this._codestreamPart,t),null===n)throw new r.jpipExceptions.InternalErrorException('Could not reconstruct codestream although progressiveness stage has been reached');return n},i.prototype._startTrackPrecinct=function(e,t,n){var i=e.getInClassId();this._maxQualityPerPrecinct[i]=t;var r=this._databinsSaver.addEventListener(e,'dataArrived',this._precinctDataArrived,this);this._registeredPrecinctDatabins.push(r),this._precinctDataArrived(e,n)},i.prototype._precinctDataArrived=function(e,t){var n=e.getInClassId(),i=this._maxQualityPerPrecinct[n],r=this._qualityLayersCache.getQualityLayerOffset(e,i,t);this._listener.precinctQualityLayerReached(n,r.numQualityLayers)},i.prototype._qualityLayerReachedCallback=function(){if(this._isProgressive||this._listener.isDone())for(var e=0;e<this._dataListeners.length;++e)this._dataListeners[e](this)},i.prototype._ensureNotDisposed=function(){if(this._isDisposed)throw new r.jpipExceptions.IllegalOperationException('Cannot use ImageDataContext after disposed')}},function(e,t,n){'use strict';var i=Math.floor,r=Math.ceil,a=Math.max,s=Math.min,o=n(0),l=0.6931471805599453;e.exports=function(e){function t(e){var t=e.level,i=m(t),r=x(t),a=e.minTileX+e.minTileY*p(),s=e.maxTileXExclusive-1+(e.maxTileYExclusive-1)*p(),o=d(a),l=d(s),c=n(o,t),u=n(l,t),g=c.width,f=c.height,h=e.maxTileXExclusive-e.minTileX,y=e.maxTileYExclusive-e.minTileY;return 1<h&&(g+=u.width,g+=i*(h-2)),1<y&&(f+=u.height,f+=r*(y-2)),{regionWidth:g,regionHeight:f,tileWidth:i,tileHeight:r}}function n(e,t){var n=c(e.horizontalEdgeType,I,g,m),i=c(e.verticalEdgeType,E,f,x);if(void 0!==t){var a=1<<t;n=r(n/a),i=r(i/a)}return{width:n,height:i}}function c(e,t,n,i){var r;switch(e){case C:r=t();break;case P:var a=i(),s=n()-t();r=s%a,0===r&&(r=a);break;case b:r=i();break;default:throw new o.jpipExceptions.InternalErrorException('Unexpected edge type: '+e);}return r}function d(e){var t=p(),n=u(),r=e%t,a=i(e/t);if(a>n||0>r||0>a)throw new o.jpipExceptions.InternalErrorException('Tile index '+e+' is not in range');var s=0==r?C:r==t-1?P:b,l=0===a?C:a===n-1?P:b;return{horizontalEdgeType:s,verticalEdgeType:l}}function p(){var t=r(e.imageWidth/e.tileWidth);return t}function u(){var t=r(e.imageHeight/e.tileHeight);return t}function g(n){if(void 0===n)return e.imageWidth;var i=t({minTileX:0,maxTileXExclusive:p(),minTileY:0,maxTileYExclusive:1,level:n});return i.regionWidth}function f(n){if(void 0===n)return e.imageHeight;var i=t({minTileX:0,maxTileXExclusive:1,minTileY:0,maxTileYExclusive:u(),level:n});return i.regionHeight}function m(t){if(void 0===t)return e.tileWidth;var n=r(e.tileWidth/(1<<t));return n}function x(t){if(void 0===t)return e.tileHeight;var n=r(e.tileHeight/(1<<t));return n}function h(){return e.firstTileOffsetX}function y(){return e.firstTileOffsetY}function I(e){var t=m()-h(),n=g();t>n&&(t=n);var i=r(t/(1<<e));return i}function E(e){var t=x()-y(),n=f();t>n&&(t=n);var i=r(t/(1<<e));return i}var b=0,C=1,P=2;return this.EDGE_TYPE_NO_EDGE=b,this.EDGE_TYPE_FIRST=C,this.EDGE_TYPE_LAST=P,this.getTilesFromPixels=function(e){var t=e.level,n=m(t),o=x(t),l=I(t),c=E(t),d=e.minX,g=e.minY,f=e.maxXExclusive,h=e.maxYExclusive,y=a(0,1+(d-l)/n),b=a(0,1+(g-c)/o),C=s(p(),1+(f-l)/n),P=s(u(),1+(h-c)/o),T={level:t,minTileX:i(y),minTileY:i(b),maxTileXExclusive:r(C),maxTileYExclusive:r(P)};return T},this.getNumTilesX=p,this.getNumTilesY=u,this.getTileWidth=m,this.getTileHeight=x,this.getFirstTileOffsetX=h,this.getFirstTileOffsetY=y,this.getFirstTileWidth=I,this.getFirstTileHeight=E,this.isEdgeTileId=d,this.getTileSize=n,this.getLevelWidth=g,this.getLevelHeight=f,this.getImageLevel=function(){return 0},this.getLevel=function(t){var n=Math.log;if(void 0===e.numResolutionLevelsForLimittedViewer)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';var i=n((t.maxXExclusive-t.minX)/t.screenWidth)/l,o=n((t.maxYExclusive-t.minY)/t.screenHeight)/l,c=r(a(i,o));return c=a(0,s(e.numResolutionLevelsForLimittedViewer-1,c)),c},this.getNumResolutionLevelsForLimittedViewer=function(){if(void 0===e.numResolutionLevelsForLimittedViewer)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';return e.numResolutionLevelsForLimittedViewer},this.getLowestQuality=function(){return 1},this.getHighestQuality=function(){if(void 0===e.highestQuality)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';return e.highestQuality},this.getSizeOfTiles=t,this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(e,t,n){var i=e[n]===t[0]&&e[n+1]===t[1];return i}function r(e,t){var n=a(e,!0),i=l(t,'Predefined marker in jGlobals.j2kMarkers'),r=n.markerToOffset[i];return void 0===r?null:r}function a(t,r){var a=t.getCachedData(c);if(void 0===a.markerToOffset&&(a.isParsedAllMarkers=!1,a.lastOffsetParsed=0,a.markerToOffset={},a.databin=t),a.isParsedAllMarkers)return a;var l=[],d=!0;if(t===e&&0===a.lastOffsetParsed){var p=t.copyBytes(l,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE});if(null===p)d=!1;else if(!n(l,i.j2kMarkers.StartOfCodestream,0))throw new i.j2kExceptions.IllegalDataException('SOC (Start Of Codestream) is not found where expected to be','A.4.1');a.lastOffsetParsed=2}return d&&s(a),o(a,r),a}function s(e){for(var n=e.lastOffsetParsed,r=[],a=e.databin.copyBytes(r,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE+i.j2kOffsets.LENGTH_FIELD_SIZE,databinStartOffset:n});null!==a;){var s=l(r,'offset '+n+' of databin with class ID = '+e.databin.getClassId()+' and in class ID = '+e.databin.getInClassId());e.markerToOffset[s.toString()]=n;var o=t.getInt16(r,i.j2kOffsets.MARKER_SIZE);n+=o+i.j2kOffsets.MARKER_SIZE,a=e.databin.copyBytes(r,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE+i.j2kOffsets.LENGTH_FIELD_SIZE,databinStartOffset:n})}e.lastOffsetParsed=n}function o(t,r){var a=t.databin.getDatabinLengthIfKnown();if(t.isParsedAllMarkers=t.lastOffsetParsed===a,!t.isParsedAllMarkers&&t.databin!==e){var s=[],o=t.databin.copyBytes(s,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE,databinStartOffset:t.lastOffsetParsed});null!==o&&n(s,0,i.j2kMarkers.StartOfData)&&(t.lastOffsetParsed+=i.j2kOffsets.MARKER_SIZE,t.isParsedAllMarkers=!0)}if(r&&!t.isParsedAllMarkers)throw new i.jpipExceptions.InternalErrorException('data-bin with class ID = '+t.databin.getClassId()+' and in class ID = '+t.databin.getInClassId()+' was not recieved yet')}function l(e,t){if(255!==e[0])throw new i.j2kExceptions.IllegalDataException('Expected marker in '+t,'A');var n=e[1].toString(16);return n}var c='markers';this.getMandatoryMarkerOffsetInDatabin=function(e,t,n,a){var s=r(e,t);if(null===s)throw new i.j2kExceptions.IllegalDataException(n+' is not found where expected to be',a);return s},this.checkSupportedMarkers=function(e,t,n){n=!!n;for(var r=a(e,!0),s={},o=0,c;o<t.length;++o)c=l(t[o],'jpipMarkersParser.supportedMarkers['+o+']'),s[c]=!0;for(var d in r.markerToOffset){var p=!!s[d];if(p!==n)throw new i.j2kExceptions.UnsupportedFeatureException('Unsupported marker found: '+d,'unknown')}},this.getMarkerOffsetInDatabin=r,this.isMarker=n}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(e,t){var n=l(e,t);if(null===n)return null;var r=n+i.j2kOffsets.MARKER_SIZE,a=c(e,8,r),s=a[2],o=!(1&s),d=7,p=a[d],u=o?null:n+14;return{codingStyleDefaultOffset:n,isDefaultPrecinctSize:o,isStartOfPacketMarkerAllowed:!!(2&s),isEndPacketHeaderMarkerAllowed:!!(4&s),numResolutionLevels:p+1,precinctSizesOffset:u,numDecompositionLevelsOffset:r+d}}function r(e,t,n){if(!(null===t||t.isDefaultPrecinctSize)){var r=t.numResolutionLevels-n,a=t.precinctSizesOffset+r,s=t.codingStyleDefaultOffset+i.j2kOffsets.MARKER_SIZE;e.push({markerSegmentLengthOffset:s,start:a,length:n})}}function a(e,t){var n=c(e,1,t+4),r=31&n[0],a;switch(r){case 0:a=1;break;case 1:a=0;break;case 2:a=2;break;default:throw new i.j2kExceptions.IllegalDataException('Quantization style of '+r,'A.6.4');}return a}function s(e,n,r,s){var o=t.getMarkerOffsetInDatabin(n,i.j2kMarkers.QuantizationDefault);if(null!==o){var l=a(n,o);if(0!==l){var c=r.numResolutionLevels-s,d=o+i.j2kOffsets.MARKER_SIZE;e.push({markerSegmentLengthOffset:d,start:o+5+(1+3*(c-1))*l,length:3*s*l})}}}function o(e){var n=t.getMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleComponent);if(null!==n)throw new i.j2kExceptions.UnsupportedFeatureException('COC Marker (Coding Style Component)','A.6.2')}function l(e,n){o(e);var r;return r=n?t.getMandatoryMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleDefault,'COD (Coding style Default)','A.6.1'):t.getMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleDefault),r}function c(e,t,n){var r=[],a=e.copyBytes(r,0,{forceCopyAllRange:!0,maxLengthToCopy:t,databinStartOffset:n});if(null===a)throw new i.jpipExceptions.InternalErrorException('Header data-bin has not yet recieved '+t+' bytes starting from offset '+n);return r}var d=[i.j2kMarkers.ImageAndTileSize,i.j2kMarkers.CodingStyleDefault,i.j2kMarkers.QuantizationDefault,i.j2kMarkers.Comment];this.getCodingStyleOffset=l,this.getCodingStyleBaseParams=n,this.getImageAndTileSizeOffset=function(){var n=t.getMandatoryMarkerOffsetInDatabin(e,i.j2kMarkers.ImageAndTileSize,'Image and Tile Size (SIZ)','A.5.1');return n},this.getRangesOfBestResolutionLevelsData=function(a,o){t.checkSupportedMarkers(a,d,!0);var l=null,c=n(a,!1),p=c;null===c?p=n(e,!0):l=c.numDecompositionLevelsOffset;var u=p.numResolutionLevels;if(u<=o)throw new i.jpipExceptions.InternalErrorException('numResolutionLevels ('+o+') <= COD.numResolutionLevels ('+u+')');var g=[];r(g,c,o),s(g,a,p,o);var f={ranges:g,numDecompositionLevelsOffset:l};return f}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function r(t,r,s,o){for(var l=0,c=t.getTileIterator(),d={packetDataOffsets:[],data:n.createCompositeArray(0),allRelevantBytesLoaded:0};c.tryAdvance();){var p=c.createPrecinctIterator(),u=c.tileStructure.getNumQualityLayers();if(void 0!==s&&'max'!==s&&(u=Math.min(u,s)),'max'===r)t.minNumQualityLayers=u;else if(r>u)throw new i.jpipExceptions.InternalErrorException('minQuality is larger than quality');for(;p.tryAdvance();){if(!p.isInCodestreamPart)throw new i.jpipExceptions.InternalErrorException('Unexpected precinct not in codestream part');var g=c.tileStructure.precinctPositionToInClassIndex(p),f=e.getPrecinctDatabin(g),m=o[g];void 0===m&&(m={layerPerCodeblock:[]},o[g]=m);var x=a(d,l,c.tileStructure,p,f,m,u);if(x<r)return null}++l}var h=new Uint8Array(d.data.getLength());return d.data.copyToTypedArray(h,0,0,d.data.getLength()),d.data=h,d}function a(e,n,r,a,s,o,l){var c,d;for(c=0;c<l;++c){var p=t.getPacketOffsetsByCodeblockIndex(s,c,a);if(null===p)break;d=p.headerStartOffset+p.headerLength;for(var u=p.codeblockBodyLengthByIndex.length,g=Array(u),f=!1,m=0,i;m<u;++m){if(i=o.layerPerCodeblock[m],void 0===i)i={layer:-1},o.layerPerCodeblock[m]=i;else if(i.layer>=c)continue;var x=p.codeblockBodyLengthByIndex[m],h=e.data.getLength(),y=s.copyToCompositeArray(e.data,{databinStartOffset:d,maxLengthToCopy:x.codeblockBodyLengthBytes,forceCopyAllRange:!0});if(y!==x.codeblockBodyLengthBytes){g.length=m,f=!0;break}i.layer=c,g[m]={start:h,end:h+x.codeblockBodyLengthBytes,codingpasses:x.codingPasses,zeroBitPlanes:x.zeroBitPlanes},d+=x.codeblockBodyLengthBytes}var I=r.precinctPositionToIndexInComponentResolution(a),E={tileIndex:n,r:a.resolutionLevel,p:I,c:a.component,l:c,codeblockOffsets:g};if(e.packetDataOffsets.push(E),f)break}return e.allRelevantBytesLoaded+=d,c}this.getAllCodeblocksData=function(e,t,n){var i=[],a=r(e,t,n,i);return{codeblocksData:a,alreadyReturnedCodeblocks:i}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function r(e){if(!e.isStarted)return a(),e.isStarted=!0,e.currentX=s.minTileX,e.currentY=s.minTileY,!0;if(e.currentY>=s.maxTileYExclusive)throw new i.jpipExceptions.InternalErrorException('Cannot advance tile iterator after end');if(++e.currentX,e.currentX<s.maxTileXExclusive)return!0;e.currentX=s.minTileX,++e.currentY;var t=e.currentY<s.maxTileYExclusive;return t}function a(){null!=s||(e?s=t.getTilesFromPixels(e):s={level:0,minTileX:0,minTileY:0,maxTileXExclusive:t.getNumTilesX(),maxTileYExclusive:t.getNumTilesY()})}var s=null,o=null;Object.defineProperty(this,'level',{get:function(){return e?e.level:0}}),Object.defineProperty(this,'fullTilesSize',{get:function(){return null==o&&(a(),o=t.getSizeOfTiles(s)),o}}),Object.defineProperty(this,'tilesBounds',{get:function(){return a(),s}}),this.getTileIterator=function(){var a={isStarted:!1,currentX:-1,currentY:-1},s={get tileIndex(){if(!a.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var e=t.getNumTilesX(),n=a.currentY*e,r=n+a.currentX;return r},get tileStructure(){if(!a.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var e=s.tileIndex,n=t.getTileStructure(e);return n},createPrecinctIterator:function(r){if(!a.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var o=s.tileIndex;return n.createParamsPrecinctIterator(t,o,e,r)},tryAdvance:function(){var e=r(a);return e}};return s}}},function(e,t,n){'use strict';var i=Math.floor,r=Math.ceil,a=Math.max,s=Math.min,o=n(0);e.exports=function(e,t,n,l){function c(){if(C=e.getTileStructure(t),!!n&&void 0!==n.level){var i=C.getMinNumResolutionLevelsOverComponents();if(i<=n.level)throw new o.jpipExceptions.InternalErrorException('Cannot advance resolution: level='+n.level+' but should be smaller than '+i)}if(E=d(),!l&&null!==E){var r=E[0][0];f=r.minPrecinctX,m=r.minPrecinctY}b=C.getProgressionOrder()}function d(){if(!n)return null;for(var o=e.getNumComponents(),l=Array(o),c=n.level||0,d=e.getTileLeft(t,c),p=e.getTileTop(t,c),u=n.minX-d,g=n.minY-p,f=n.maxXExclusive-d,m=n.maxYExclusive-p,x=0;x<o;++x){for(var h=C.getComponentStructure(x),y=h.getNumResolutionLevels(),I=y-c,E=h.getNumResolutionLevels(),b=Array(y),P=0;P<I;++P){var T=h.getComponentScaleX(),S=h.getComponentScaleY(),v=I-P-1,L=T<<v,O=S<<v,R=4,k=i(u/L)-R,D=i(g/O)-R,A=r(f/L)+R,_=r(m/O)+R,j=h.getPrecinctWidth(P)*T,N=h.getPrecinctHeight(P)*S,F=i(k/j),B=i(D/N),M=r(A/j),w=r(_/N),q=h.getNumPrecinctsX(P),X=h.getNumPrecinctsY(P);b[P]={minPrecinctX:a(0,F),minPrecinctY:a(0,B),maxPrecinctXExclusive:s(M,q),maxPrecinctYExclusive:s(w,X)}}l[x]=b}return l}function p(t,i){var r=C.getComponentStructure(g);switch(b[t]){case'R':var a=r.getNumResolutionLevels();return!!n&&n.level&&(a-=n.level),++x,x%=a,x;case'C':return++g,g%=e.getNumComponents(),g;case'P':var s,l,c,d;if(null!==i){var p=i[g],u=p[x];s=u.minPrecinctX,l=u.minPrecinctY,c=u.maxPrecinctXExclusive,d=u.maxPrecinctYExclusive}else s=0,l=0,c=r.getNumPrecinctsX(x),d=r.getNumPrecinctsY(x);return(f-=s-1,f%=c-s,f+=s,f!=s)?f-s:(m-=l-1,m%=d-l,m+=l,m-l);case'L':throw new o.jpipExceptions.InternalErrorException('Advancing L is not supported in JPIP');default:throw new o.jpipExceptions.InternalErrorException('Unexpected letter in progression order: '+b[t]);}}var u=!1,g=0,f=f,m=m,x=0,h=!0,y=-1,I=-1,E=null,b,C;return Object.defineProperty(this,'tileIndex',{get:function(){return t}}),Object.defineProperty(this,'component',{get:function(){return g}}),Object.defineProperty(this,'precinctX',{get:function(){return f}}),Object.defineProperty(this,'precinctY',{get:function(){return m}}),Object.defineProperty(this,'resolutionLevel',{get:function(){return x}}),Object.defineProperty(this,'isInCodestreamPart',{get:function(){return h}}),this.tryAdvance=function(){if(!u)return c(),u=!0,!0;var e=!0,t=l?null:E,n=!1;y=-1,I=-1;for(var r=2,i;0<=r&&(i=p(r,t),e=0===i,!!e);--r)'P'!==b[r]||l||(n=!0);if(e)return!1;if(null==E)return h=!0,!0;var a=E[g],s=a[x];return n&&(f=s.minPrecinctX,m=s.minPrecinctY),h=f>=s.minPrecinctX&&m>=s.minPrecinctY&&f<s.maxPrecinctXExclusive&&m<s.maxPrecinctYExclusive,!0},this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r,a,s,o){function l(e,t){if(0===t)throw new i.jpipExceptions.InternalErrorException('Cannot use '+e+' iterator before started');else if(1<t)throw new i.jpipExceptions.InternalErrorException('Cannot use '+e+' iterator after ended')}var c=null,d=null,p=function(){var e=t.getComponentStructure(r),n=e.getNumResolutionLevels();return n-a-1}();Object.defineProperty(this,'level',{get:function(){return p}}),Object.defineProperty(this,'fullTilesSize',{get:function(){if(null==c){var t=this.tilesBounds;c=e.getSizeOfTiles(t)}return c}}),Object.defineProperty(this,'tilesBounds',{get:function(){if(null==d){var t=e.getNumTilesX(),i=n%t,r=Math.floor(n/t);d={level:p,minTileX:i,minTileY:r,maxTileXExclusive:i+1,maxTileYExclusive:r+1}}return d}}),this.getTileIterator=function(){var e=0;return{get tileIndex(){return l('tile',e),n},get tileStructure(){return l('tile',e),t},tryAdvance:function(){if(2<e)throw new i.jpipExceptions.InternalErrorException('Cannot advance tile iterator after ended');return++e,2>e},createPrecinctIterator:function(t){if(l('tile',e),t)throw new i.jpipExceptions.InternalErrorException('Precinct iterator of single precinct part cannot iterate precincts out of part');var c=0;return{get tileIndex(){return l('precinct',c),n},get component(){return l('precinct',c),r},get precinctX(){return l('precinct',c),s},get precinctY(){return l('precinct',c),o},get resolutionLevel(){return l('precinct',c),a},get isInCodestreamPart(){return l('precinct',c),!0},tryAdvance:function(){if(1<c)throw new i.jpipExceptions.InternalErrorException('Cannot advance precinct iterator after ended');return++c,2>c}}}}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r){function a(e){if(e.isAllDatabinLoaded()){var n=e.getInClassId(),a=d[n];if(!a.isAlreadyLoaded){a.isAlreadyLoaded=!0,--s;for(var o=t.getTileStructure(n),l=a.precinctIterator;l.tryAdvance();){if(!l.isInCodestreamPart)throw new i.jpipExceptions.InternalErrorException('Unexpected precinct not in codestream part');r(l,o)}}}}var s=0,o=!1,l=!1,c=[],d=[];this.isAllTileHeadersLoaded=function(){return 0==s},this.register=function(){if(o)throw new i.jpipExceptions.InternalErrorException('JpipQualityWaiter already registered');o=!0,++s;for(var t=e.getTileIterator();t.tryAdvance();){var r=t.tileIndex,l=n.getTileHeaderDatabin(r),p=l.getInClassId();d[p]={precinctIterator:t.createPrecinctIterator(),isAlreadyLoaded:!1};var u=n.addEventListener(l,'dataArrived',a);c.push(u),++s,a(l)}--s},this.unregister=function(){if(!o)throw new i.jpipExceptions.InternalErrorException('JpipQualityWaiter not registered');if(!l){l=!0;for(var e=0;e<c.length;++e)n.removeEventListener(c[e])}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r,a,s,o,l,c){function d(e,t){var n=x[e];if(!n)return void(E[e]=t);--h[n.qualityReached],n.isMaxQuality&&(--y,n.isMaxQuality=!1);var i='max'===t?n.qualityInTile:t;n.isUpdated=n.qualityReached!==i,n.qualityReached=i,i===n.qualityInTile&&(++y,n.isMaxQuality=!0);var r=h[i]||0;return h[i]=r+1,n}function p(){if(!(0===h.length||0<h[u]||'max'===u||g>=t.length||!P.isAllTileHeadersLoaded())){if(m)throw new i.jpipExceptions.InternalErrorException('Request already done but callback is called');var e;do{if(++u,u>=h.length)throw new i.jpipExceptions.InternalErrorException('Advancing progressiveness rolled out of array of precincts counts by quality');e=0<h[u]}while(!e);var n=t[g].minNumQualityLayers;if(!(u<n)){for(var a=!0,s;g<t.length&&(s=t[g].minNumQualityLayers,!('max'===s&&y!=I||s>u));){var o='force'===t[g].forceMaxQuality||'forceAll'===t[g].forceMaxQuality,c=!0;g<t.length-1&&(c=y==I&&'max'===t[g+1].minNumQualityLayers),++g,a||c||!o||r.call(l),a=!1}m=g===t.length,r.call(l)}}}var u=0,g=0,f=!1,m=!1,x=[],h=[0],y=0,I=0,E=[],b=a.getDefaultTileStructure(),C=b.getNumQualityLayers(),P=c.createPrecinctsIteratorWaiter(e,a,s,function(e,t){var n=t.precinctPositionToInClassIndex(e),r=s.getPrecinctDatabin(n);if(x[n])throw new i.jpipExceptions.InternalErrorException('Precinct was iterated twice in codestream part');++h[0],++I;var a=t.getNumQualityLayers();x[n]={qualityReached:0,isUpdated:!1,isMaxQuality:!1,qualityInTile:a};var c=E[n];c&&(delete E[n],d(n,c)),o.call(l,r,a,e,n,t),f&&p()});this.register=function(){P.register(),f=!0,p()},this.unregister=function(){P.unregister()},this.precinctQualityLayerReached=function(e,t){var n=d(e,t);n.isUpdated&&n.qualityInTile&&(n.isUpdated=!1,p())},this.getProgressiveStagesFinished=function(){return g},this.isDone=function(){return m},this.getQualityReached=function(){if(0==g)throw new i.jpipExceptions.IllegalOperationException('Cannot create codestream before first progressiveness stage has been reached');var e=t[g-1].minNumQualityLayers;return e}}},function(e,t,n){'use strict';var r=n(0);e.exports=function(e){function t(t){var i=n(t.level,'level',void 0,!0),a=n(t.minX,'minX'),s=n(t.minY,'minY'),o=n(t.maxXExclusive,'maxXExclusive'),l=n(t.maxYExclusive,'maxYExclusive'),c=e.getLevelWidth(i),d=e.getLevelHeight(i);if(0>a||o>c||0>s||l>d||a>=o||s>=l)throw new r.jpipExceptions.ArgumentException('codestreamPartParams',t);return{minX:a,minY:s,maxXExclusive:o,maxYExclusive:l,level:i}}function n(e,t,n,i){if(e===void 0&&(n!==void 0||i))return n;var a=+e;if(isNaN(a)||a!==Math.floor(a))throw new r.jpipExceptions.ArgumentException(t,e);return a}this.modifyCodestreamPartParams=function(e){var n=t(e);return n},this.modifyCustomProgressiveness=function(e){if(!e||!e.length)throw new r.jpipExceptions.ArgumentException('progressiveness',e,'custom progressiveness argument should be non empty array');for(var t=Array(e.length),a=0,i;a<e.length;++a){i=e[a].minNumQualityLayers,'max'!==i&&(i=n(i,'progressiveness['+a+'].minNumQualityLayers'));var s='no';if(e[a].forceMaxQuality){if(s=e[a].forceMaxQuality,'no'!==s&&'force'!==s&&'forceAll'!==s)throw new r.jpipExceptions.ArgumentException('progressiveness['+a+'].forceMaxQuality',s,'forceMaxQuality should be "no", "force" or "forceAll"');if('forceAll'===s)throw new r.jpipExceptions.UnsupportedFeatureException('"forceAll" value for forceMaxQuality in progressiveness')}t[a]={minNumQualityLayers:i,forceMaxQuality:s}}return t},this.getAutomaticProgressiveness=function(t){var n=[],r=e.getDefaultTileStructure(),a=r.getNumQualityLayers(),s='max';void 0!==t&&'max'!==t&&(a=Math.min(a,t),s=a);for(var o=4>a?a-1:3,l=1;l<o;++l)n.push({minNumQualityLayers:l,forceMaxQuality:'no'});var c=Math.round(a/2);return c>o&&('max'===s||c<s)&&n.push({minNumQualityLayers:c,forceMaxQuality:'no'}),n.push({minNumQualityLayers:s,forceMaxQuality:'no'}),n[0].forceMaxQuality='force',n}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(t,e,n,r,a,s){function o(e,i){var r=!1;try{var a=c(e,i);if(a===m)return;r=a===f}catch(n){r=!0,t.onException(n)}try{r||t.waitForConcurrentRequestsToEnd(x),n.requestEnded(e,x),r&&!y&&s!==void 0&&s(),t.checkConcurrentRequestsFinished()}catch(n){t.onException(n)}}function l(e){n.requestEnded(e,x),t.checkConcurrentRequestsFinished(),s!==void 0&&s()}function c(e,r){if(!r)throw new i.jpipExceptions.InternalErrorException('AJAX callback called although response is not done yet and chunked encoding is not enabled');var a=t.getCreatedChannelId(e);null===a?null===n.getChannelId()&&t.onException(new i.jpipExceptions.IllegalDataException('Cannot extract cid from cnew response','D.2.3')):null===n.getChannelId()?n.setChannelId(a):t.onException(new i.jpipExceptions.IllegalDataException('Channel created although was not requested','D.2.3'));var s=u(e);if(null===s)return f;var o=p(e,s);return o}function d(){E=n.nextRequestId();var e=r+'&len='+I+'&qid='+E;I*=2;var i=null===n.getChannelId();if(i){e+='&cnew=http';var a=t.getFirstChannel();null!==a&&(e+='&cid='+a.getChannelId())}else e+='&cid='+n.getChannelId();t.sendAjax(e,o,l)}function p(e,n){var r=f,a=new Uint8Array(e.response);if(n>a.length-2||0!==a[n])throw new i.jpipExceptions.IllegalDataException('Could not find End Of Response (EOR) code at the end of response','D.3');switch(a[n+1]){case i.jpipEndOfResponseReasons.IMAGE_DONE:case i.jpipEndOfResponseReasons.WINDOW_DONE:case i.jpipEndOfResponseReasons.QUALITY_LIMIT:r=g;break;case i.jpipEndOfResponseReasons.WINDOW_CHANGE:if(!y)throw new i.jpipExceptions.IllegalOperationException('Server response was terminated due to newer request issued on same channel. That may be an internal webjpip.js error - Check that movable requests are well maintained');break;case i.jpipEndOfResponseReasons.BYTE_LIMIT:case i.jpipEndOfResponseReasons.RESPONSE_LIMIT:y||(d(),r=m);break;case i.jpipEndOfResponseReasons.SESSION_LIMIT:t.onException(new i.jpipExceptions.IllegalOperationException('Server resources associated with the session is limitted, no further requests should be issued to this session'));break;case i.jpipEndOfResponseReasons.NON_SPECIFIED:t.onException(new i.jpipExceptions.IllegalOperationException('Server error terminated response with no reason specified'));break;default:t.onException(new i.jpipExceptions.IllegalDataException('Server responded with illegal End Of Response (EOR) code: '+a[n+1]));}return r}function u(n){try{for(var i=new Uint8Array(n.response),r=0,a;r<i.length&&!(0===i[r]);){var s=e.parseMessageHeader(i,r,a);if(s.bodyStart+s.messageBodyLength>i.length)return r;t.getDatabinsSaver().saveData(s,i),r=s.bodyStart+s.messageBodyLength,a=s}return r}catch(n){return t.onException(n),null}}var g=1,f=2,m=3,x=this,h=!1,y=!1,I=10*1024,E;this.startRequest=function(){if(h)throw new i.jpipExceptions.InternalErrorException('startRequest called twice');else if(y)throw new i.jpipExceptions.InternalErrorException('request was already stopped');h=!0,t.requestStarted(),d()},this.stopRequestAsync=function(){y=!0},this.getLastRequestId=function(){if(!h)throw new i.jpipExceptions.InternalErrorException('Unexpected call to getLastRequestId on inactive request');return E},this.callCallbackAfterConcurrentRequestsFinished=function(){a(x,!0)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r,a){function s(e){var t=new i.jpipExceptions.InternalErrorException('Bad jpip server response (status = '+e.status+')');o(t)}function o(e){e===void 0&&(e=null),null!==l&&l({isReady:f,exception:e})}var l=null,c=null,d=[],p=null,u=0,g=[],f=!1,m=t||'0';this.onException=function(e){o(e)},this.getIsReady=function(){return f},this.setIsReady=function(e){f=e,o()},this.getCodestreamStructure=function(){return n},this.getDatabinsSaver=function(){return r},this.getDataRequestUrl=function(){return e},this.getTargetId=function(){return m},this.getFirstChannel=function(){return p},this.setStatusCallback=function(e){l=e},this.setRequestEndedCallback=function(e){c=e},this.requestStarted=function(){++u},this.requestEnded=function(e,t){--u;var n=e.getResponseHeader('JPIP-tid');if(''!==n&&null!==n)if('0'===m)m=n;else if(m!==n)throw new i.jpipExceptions.IllegalDataException('Server returned unmatched target ID');null==p&&(p=t);var r=t.getIsDedicatedForMovableRequest()?null:t;null!==c&&c(r)},this.getActiveRequestsCount=function(){return u},this.channelCreated=function(e){d.push(e)},this.getCreatedChannelId=function(e){var t=e.getResponseHeader('JPIP-cnew');if(!t)return null;for(var n=t.split(','),r=0,i;r<n.length;++r)if(i=n[r].split('='),'cid'===i[0])return i[1];return null},this.waitForConcurrentRequestsToEnd=function(e){for(var t=[],n=0;n<d.length;++n){var i=d[n].getRequestsWaitingForResponse(),r=i.length;if(0!==r){for(var a=i[0].getLastRequestId(),s=1;s<i.length;++s)a=Math.max(a,i[s].getLastRequestId());t.push({channel:d[n],requestId:a})}}g.push({request:e,concurrentRequests:t})},this.checkConcurrentRequestsFinished=function(){for(var e=g.length-1;0<=e;--e){for(var t=g[e].concurrentRequests,n=t.length-1,i;0<=n;--n)i=t[n],i.channel.isAllOldRequestsEnded(i.requestId)&&(t[n]=t[t.length-1],t.length-=1);if(!(0<t.length)){var r=g[e].request,a=r.callback;g[e]=g[g.length-1],g.length-=1,r.callCallbackAfterConcurrentRequestsFinished()}}},this.sendAjax=function(e,t,n){var i;i=n?function(e){s(e),n(e)}:s,a.request(e,t,i)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r,a,s,o,l){function c(){null!=P&&o(P),y.setIsReady(!1),y.sendAjax(v,h)}function d(e){++C;var n=l.createChannel(t,y);return y.channelCreated(n),e||b.push(n),n}function p(e,t){for(var n=null,r=e+1,a=0,i,s;a<b.length&&(s=b[a].getAllQueuedRequestCount(),s<r&&(n=b[a],i=a,r=s),0!==s);++a);return t&&null!==n?(b[i]=b[b.length-1],b.length-=1,n):n}function u(){var e=a.getMainHeaderDatabin();if(!e.isAllDatabinLoaded())throw new i.jpipExceptions.IllegalDataException('Main header was not loaded on session creation');var t=y.getFirstChannel(),n=t.getChannelId();return v=T+'&cclose=*&cid='+n,x?void c():void(null===n||(P=s(g,m),y.setIsReady(!0)))}function g(){if(!(0<y.getActiveRequestsCount())){var e=y.getFirstChannel();e.sendMinimalRequest(function(){})}}function f(){if(null===y||!y.getIsReady())throw new i.jpipExceptions.InternalErrorException('Cannot perform this operation when the session is not ready')}var m=30*1e3,x=!1,h=null,y=null,I=null,E=null,b=[],C=0,P=null,T,S,v;this.open=function(e){if(null!=y)throw new i.jpipExceptions.InternalErrorException('session.open() should be called only once');var t=0>e.indexOf('?')?'?':'&';T=e+t+'type='+(a.getIsJpipTilePartStream()?'jpt-stream':'jpp-stream'),S=T+'&stream=0',y=l.createSessionHelper(S,n,r,a),null!=I&&y.setStatusCallback(I),null!=E&&y.setRequestEndedCallback(E);var s=d();s.sendMinimalRequest(u)},this.getTargetId=function(){return f(),y.getTargetId()},this.getIsReady=function(){var e=null!==y&&y.getIsReady();return e},this.setStatusCallback=function(e){I=e,null!==y&&y.setStatusCallback(e)},this.setRequestEndedCallback=function(e){E=e,null!==y&&y.setRequestEndedCallback(e)},this.hasActiveRequests=function(){f();var e=0<y.getActiveRequestsCount();return e},this.tryGetChannel=function(n){f();var i=C<e,r=i||n?0:t-1,a=p(r,n);return null===a&&i&&(a=d(n)),n&&null!==a&&a.dedicateForMovableRequest(),a},this.close=function(e){if(0==C)throw new i.jpipExceptions.InternalErrorException('Cannot close session before open');if(x)throw new i.jpipExceptions.InternalErrorException('Cannot close session twice');x=!0,h=e,v!=void 0&&c()}}},function(e,t,n){'use strict';var r=n(0);e.exports=function(e,t,n,i,a,s){function o(){if(null!==S)throw new r.jpipExceptions.IllegalOperationException('Previous session still not established');return null==y?void(i.cleanupUnregisteredDatabins(),l()):void(null!==P&&P({isReady:!0,exception:'Previous session that should be closed still alive.Maybe old requestContexts have not beed closed. Reconnect will not be done'}))}function l(){var r;null!=h&&(r=h.getTargetId()),S=a.createSession(e,t,r,n,i),S.setStatusCallback(d),S.open(I)}function c(e){var t=h.tryGetChannel(!0);if(null===t)throw new r.jpipExceptions.IllegalOperationException('Too many concurrent requests. Limit the use of dedicated (movable) requests, enlarge maxChannelsInSession or wait for requests to finish and avoid create new ones');if(!t.getIsDedicatedForMovableRequest())throw new r.jpipExceptions.InternalErrorException('getIsDedicatedForMovableRequest inconsistency');e.internalDedicatedChannel=t}function d(e){if(null===S||e.isReady!==S.getIsReady())throw new r.jpipExceptions.InternalErrorException('Unexpected statusCallback when not registered to session or inconsistent isReady');if(e.isReady){if(null!=y)throw new r.jpipExceptions.InternalErrorException('sessionWaitingForDisconnect should be null');y=h,h=S,S=null,null!=y&&(y.setStatusCallback(null),!m()&&y.setRequestEndedCallback(m)),h.setStatusCallback(P),h.setRequestEndedCallback(f);for(var t=0;t<C.length;++t)c(C[t])}null!==P&&P(e)}function p(e){null!==e&&(++E,e.close(u))}function u(){--E,0==E&&T!==void 0&&T()}function g(){if(null===h)throw new r.jpipExceptions.InternalErrorException('This operation is forbidden when session is not ready')}function f(e){var t=null;if(i.getLoadedBytes()>x&&o(),null!==e){if(e.getIsDedicatedForMovableRequest())throw new r.jpipExceptions.InternalErrorException('Expected non-movable channel as channelFreed');do{if(0===b.length){t=null;break}if(t=b.shift(),null!==t.internalRequest)throw new r.jpipExceptions.InternalErrorException('Request was already sent but still in queue')}while(t.isEnded);null!==t&&(t.internalRequest=e.requestData(t.codestreamPartParams,t.callback,t.failureCallback,t.numQualityLayers))}}function m(){var e=!y.hasActiveRequests();return e&&(y.close(),y=null),e}var x=s||10*1048576,h=null,y=null,I=null,E=0,b=[],C=[],P=null,T=null,S;this.getIsReady=function(){return null!=h&&h.getIsReady()},this.open=function(e){if(e===void 0||null===e)throw new r.jpipExceptions.ArgumentException('baseUrl',e);if(null!=I)throw new r.jpipExceptions.IllegalOperationException('Image was already opened');I=e,l()},this.close=function(e){if(null!=T)throw new r.jpipExceptions.IllegalOperationException('closed twice');T=e,E=1,p(h),p(S),p(y),u()},this.setStatusCallback=function(e){P=e,null!=h&&h.setStatusCallback(e)},this.dedicateChannelForMovableRequest=function(){g();var e={internalDedicatedChannel:null};return C.push(e),c(e),e},this.requestData=function(e,t,n,i,a){g();var s={isEnded:!1,internalRequest:null,codestreamPartParams:e,callback:t,failureCallback:n,numQualityLayers:i},o=!!a,l;if(o)l=a.internalDedicatedChannel;else{if(l=h.tryGetChannel(),null===l)return b.push(s),s;if(l.getIsDedicatedForMovableRequest())throw new r.jpipExceptions.InternalErrorException('Expected non-movable channel')}if(l.getIsDedicatedForMovableRequest()!==o)throw new r.jpipExceptions.InternalErrorException('getIsDedicatedForMovableRequest inconsistency');return s.internalRequest=l.requestData(e,t,n,i),s},this.stopRequestAsync=function(e){e.isEnded=!0,null!==e.internalRequest&&e.internalRequest.stopRequestAsync()},this.reconnect=o}},function(e,t,n){'use strict';var r=Math.pow,a=n(0);e.exports=function(e,t,n,s){function i(c,d){var p=s.getCodingStyleBaseParams(c,d);if(null===p)return null;var u=e.getMainHeaderDatabin(),g=s.getImageAndTileSizeOffset(),f=g+a.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER,m=l(u,2,f),x=n.getInt16(m,0),h=t.getMarkerOffsetInDatabin(c,a.j2kMarkers.PackedPacketHeadersInTileHeader),y=t.getMarkerOffsetInDatabin(u,a.j2kMarkers.PackedPacketHeadersInMainHeader),I=p.codingStyleDefaultOffset+6,E=l(c,6,I),b=n.getInt16(E,0),C=o(E,4),P=o(E,5),T=Array(p.numResolutionLevels),S=Array(p.numResolutionLevels),v=null;if(!p.isDefaultPrecinctSize){var L=p.numResolutionLevels;v=l(c,L,p.precinctSizesOffset)}for(var O=32768,R=0;R<p.numResolutionLevels;++R){if(p.isDefaultPrecinctSize){T[R]=O,S[R]=O;continue}var i=R,k=v[i];T[R]=1*r(2,15&k),S[R]=1*r(2,k>>>4)}for(var D=Array(x),A=0;A<x;++A)D[A]={maxCodeblockWidth:C,maxCodeblockHeight:P,numResolutionLevels:p.numResolutionLevels,precinctWidthPerLevel:T,precinctHeightPerLevel:S};var _={maxCodeblockWidth:C,maxCodeblockHeight:P,numResolutionLevels:p.numResolutionLevels,precinctWidthPerLevel:T,precinctHeightPerLevel:S},j={numQualityLayers:b,isPacketHeadersNearData:null===h&&null===y,isStartOfPacketMarkerAllowed:p.isStartOfPacketMarkerAllowed,isEndPacketHeaderMarkerAllowed:p.isEndPacketHeaderMarkerAllowed,paramsPerComponent:D,defaultComponentParams:_};return j}function o(e,t){var n=e[t],i=2+(15&n);if(10<i)throw new a.j2kExceptions.IllegalDataException('Illegal codeblock width exponent '+i,'A.6.1, Table A.18');return 1<<i}function l(e,t,n){var i=[],r=e.copyBytes(i,0,{forceCopyAllRange:!0,maxLengthToCopy:t,databinStartOffset:n});if(null===r)throw new a.jpipExceptions.InternalErrorException('Header data-bin has not yet recieved '+t+' bytes starting from offset '+n);return i}this.parseCodestreamStructure=function(){for(var t=e.getMainHeaderDatabin(),r=s.getImageAndTileSizeOffset(),o=l(t,38,r+a.j2kOffsets.MARKER_SIZE+a.j2kOffsets.LENGTH_FIELD_SIZE),c=a.j2kOffsets.REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER-(a.j2kOffsets.MARKER_SIZE+a.j2kOffsets.LENGTH_FIELD_SIZE),d=a.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER-(a.j2kOffsets.MARKER_SIZE+a.j2kOffsets.LENGTH_FIELD_SIZE),p=n.getInt32(o,c),u=n.getInt32(o,c+4),g=n.getInt32(o,10),f=n.getInt32(o,14),m=n.getInt32(o,18),x=n.getInt32(o,22),h=n.getInt32(o,26),y=n.getInt32(o,30),I=n.getInt16(o,d),E=r+a.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER+2,b=l(t,3*I,E),C=Array(I),P=Array(I),T=0;T<I;++T)C[T]=b[3*T+1],P[T]=b[3*T+2];return{numComponents:I,componentsScaleX:C,componentsScaleY:P,imageWidth:p-h,imageHeight:u-y,tileWidth:m,tileHeight:x,firstTileOffsetX:h,firstTileOffsetY:y}},this.parseDefaultTileParams=function(){var t=e.getMainHeaderDatabin(),n=i(t,!0);return n},this.parseOverridenTileParams=function(t){var n=e.getTileHeaderDatabin(t),r=i(n,!1);return r}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r){function a(e,t,n){if(0>t||t>=n)throw new i.jpipExceptions.ArgumentException(e,t,e+' is expected to be between 0 and '+n-1)}function s(e,t,n,i,r){var a=n(e),s=i(e),o=r(e);if(a>=s||o>=s)return!0;return 0==a%o||0==o%a}var o,l,d,p;this.getProgressionOrder=function(){return r},this.getDefaultComponentStructure=function(){return o},this.getComponentStructure=function(e){return l[e]},this.getTileWidth=function(){return e.tileSize.width},this.getTileHeight=function(){return e.tileSize.height},this.getNumQualityLayers=function(){return e.numQualityLayers},this.getIsPacketHeaderNearData=function(){return e.isPacketHeadersNearData},this.getIsStartOfPacketMarkerAllowed=function(){return e.isStartOfPacketMarkerAllowed},this.getIsEndPacketHeaderMarkerAllowed=function(){return e.isEndPacketHeaderMarkerAllowed},this.getMinNumResolutionLevelsOverComponents=function(){return p},this.precinctInClassIndexToPosition=function(e){if(0>e)throw new i.jpipExceptions.ArgumentException('inClassIndex',e,'Invalid negative in-class index of precinct');var n=t.getNumTilesX()*t.getNumTilesY(),r=t.getNumComponents(),a=e%n,s=(e-a)/n,o=s%r,c=l[o],p=c.getNumResolutionLevels(),u=(s-o)/r,g=0,f;for(f=1;f<p;++f){var m=d[o][f];if(m>u)break;g=m}--f;var x=u-g,h=c.getNumPrecinctsX(f),y=c.getNumPrecinctsY(f),I=x%h,E=(x-I)/h;if(E>=y)throw new i.jpipExceptions.ArgumentException('inClassIndex',e,'Invalid in-class index of precinct');var b={tileIndex:a,component:o,precinctX:I,precinctY:E,resolutionLevel:f};return b},this.precinctPositionToInClassIndex=function(e){var n=t.getNumComponents();a('precinctPosition.component',e.component,n);var i=l[e.component],r=i.getNumResolutionLevels();a('precinctPosition.resolutionLevel',e.resolutionLevel,r);var s=t.getNumTilesX()*t.getNumTilesY(),o=i.getNumPrecinctsX(e.resolutionLevel),c=i.getNumPrecinctsY(e.resolutionLevel);a('precinctPosition.precinctX',e.precinctX,o),a('precinctPosition.precinctY',e.precinctY,c),a('precinctPosition.tileIndex',e.tileIndex,s);var p=e.precinctX+e.precinctY*o,u=d[e.component][e.resolutionLevel],g=e.component+(p+u)*t.getNumComponents(),f=e.tileIndex+g*t.getNumTilesX()*t.getNumTilesY();return f},this.precinctPositionToIndexInComponentResolution=function(e){var t=l[e.component],n=t.getNumPrecinctsX(e.resolutionLevel),i=e.precinctX+e.precinctY*n;return i},o=n.createComponentStructure(e.defaultComponentParams,this),l=Array(t.getNumComponents());for(var c=0;c<t.getNumComponents();++c)l[c]=n.createComponentStructure(e.paramsPerComponent[c],this);return function(){d=Array(n);var n=t.getNumComponents(),a=e.defaultComponentParams;p=a.numResolutionLevels;for(var o=!0,u=!0,g=0,c;g<n;++g){c=e.paramsPerComponent[g],p=Math.min(p,c.numResolutionLevels),d[g]=Array(c.numResolutionLevels);for(var f=l[g],m=0,x=f.getNumPrecinctsX(g),h=f.getNumPrecinctsY(g),y=0;y<c.numResolutionLevels;++y){d[g][y]=m;var r=f.getNumPrecinctsX(y),I=f.getNumPrecinctsY(y);m+=r*I,(a.precinctWidthPerLevel[y]!==c.precinctWidthPerLevel[y]||a.precinctHeightPerLevel[y]!==c.precinctHeightPerLevel[y])&&(o=!1);var E=s(y,c.numResolutionLevels,f.getPrecinctWidth,t.getLevelWidth,t.getTileWidth),b=s(y,c.numResolutionLevels,f.getPrecinctWidth,t.getLevelWidth,t.getTileWidth);u&=E&&b}}if(!o)throw new i.j2kExceptions.UnsupportedFeatureException('Special Coding Style for Component (COC)','A.6.2');if(!u)throw new i.j2kExceptions.UnsupportedFeatureException('Precinct TopLeft which is not matched to tile TopLeft','B.6')}(),function(e){if(4!==e.length)throw new i.j2kExceptions.IllegalDataException('Illegal progression order '+e+': unexpected length');if('L'!==e[3])throw new i.jpipExceptions.IllegalDataException('Illegal target progression order of '+e,'A.3.2.1');var t=0<=e.indexOf('P'),n=0<=e.indexOf('C'),r=0<=e.indexOf('R');if(!t||!n||!r)throw new i.j2kExceptions.IllegalDataException('Illegal progression order '+e+': missing letter');if('RPCL'!==e)throw new i.j2kExceptions.UnsupportedFeatureException('Progression order of '+e,'A.6.1')}(r),this}},function(e,t,n){'use strict';var i=Math.min,r=n(0);e.exports=function(){function e(e,r,a,o){var l=0,c=o,d;do{if(!n(e,r))return null;var p=a?~r.currentByte:r.currentByte,u=i(s[p],r.validBitsInCurrentByte+1),g=u-1;if(c!==void 0){if(u>c){t(r,c),l+=c;break}c-=g}l+=g,d=u<=r.validBitsInCurrentByte,d?t(r,u):r.validBitsInCurrentByte=0}while(!d);return l}function t(e,t){e.validBitsInCurrentByte-=t,0<e.validBitsInCurrentByte&&(e.currentByte=255&e.currentByte<<t)}function n(e,t){if(0<t.validBitsInCurrentByte)return!0;var n=t.isSkipNextByte?2:1,i=[],a=e.copyBytes(i,0,{forceCopyAllRange:!0,databinStartOffset:t.nextOffsetToParse,maxLengthToCopy:n});if(a!==n)return!1;var s=t.originalByteWithoutShift;if(t.currentByte=i[n-1],t.validBitsInCurrentByte=8,t.originalByteWithoutShift=t.currentByte,255===s){if(0!=(128&i[0]))throw new r.j2kExceptions.IllegalDataException('Expected 0 bit after 0xFF byte','B.10.1');t.isSkipNextByte||(t.currentByte<<=1,t.validBitsInCurrentByte=7)}return t.isSkipNextByte=!1,t.nextOffsetToParse+=n,!0}var a=-1,s=function(){var e=Array(255);e[0]=9,e[1]=8,e[2]=7,e[3]=7;var t;for(t=4;7>=t;++t)e[t]=6;for(t=8;15>=t;++t)e[t]=5;for(t=16;31>=t;++t)e[t]=4;for(t=32;63>=t;++t)e[t]=3;for(t=64;127>=t;++t)e[t]=2;for(t=128;255>=t;++t)e[t]=1;for(t=0;255>=t;++t)e[t-256]=e[t];return e}();return function(s,o){var l=o.createTransactionalObject({nextOffsetToParse:0,validBitsInCurrentByte:0,originalByteWithoutShift:a,currentByte:a,isSkipNextByte:!1},function(e){return{nextOffsetToParse:e.nextOffsetToParse,validBitsInCurrentByte:e.validBitsInCurrentByte,originalByteWithoutShift:e.originalByteWithoutShift,currentByte:e.currentByte,isSkipNextByte:e.isSkipNextByte}}),c=null;Object.defineProperty(this,'activeTransaction',{get:function(){if(null==c||!c.isActive)throw new r.jpipExceptions.InternalErrorException('No active transaction in bitstreamReader');return c}}),Object.defineProperty(this,'bitsCounter',{get:function(){var e=l.getValue(c);if(n(s,e),e.isSkipNextByte)throw new r.jpipExceptions.InternalErrorException('Unexpected state of bitstreamReader: When 0xFF encountered, tryValidateCurrentByte should skip the whole byte  after shiftRemainingBitsInByte and clear isSkipNextByte. However the flag is still set');var t=8*e.nextOffsetToParse-e.validBitsInCurrentByte;return t}}),Object.defineProperty(this,'databinOffset',{get:function(){var e=l.getValue(c);if(e.isSkipNextByte)return e.nextOffsetToParse+1;if(0!=e.validBitsInCurrentByte%8||255===e.originalByteWithoutShift)throw new r.jpipExceptions.InternalErrorException('Cannot calculate databin offset when bitstreamReader  is in the middle of the byte');return e.nextOffsetToParse-e.validBitsInCurrentByte/8},set:function(e){var t=l.getValue(c);t.validBitsInCurrentByte=0,t.isSkipNextByte=!1,t.originalByteWithoutShift=a,t.nextOffsetToParse=e}}),this.startNewTransaction=function(){if(null!=c&&c.isActive)throw new r.jpipExceptions.InternalErrorException('Cannot start new transaction in bitstreamReader while another transaction is active');c=o.createTransaction()},this.shiftRemainingBitsInByte=function(){var e=l.getValue(c);e.isSkipNextByte=255===e.originalByteWithoutShift,e.validBitsInCurrentByte=Math.floor(e.validBitsInCurrentByte/8)},this.shiftBit=function(){var t=l.getValue(c);if(!n(s,t))return null;var i=e(s,t,!0,1);return i},this.countZerosAndShiftUntilFirstOneBit=function(t){var n=l.getValue(c),i=e(s,n,!1,t);return i},this.countOnesAndShiftUntilFirstZeroBit=function(t){var n=l.getValue(c),i=e(s,n,!0,t);return i},this.shiftBits=function(e){for(var r=0,a=l.getValue(c),o=e;0<o;){if(!n(s,a))return null;var d=i(a.validBitsInCurrentByte,o),p=a.currentByte>>8-d;r=(r<<d)+p,t(a,d),o-=d}return r}}}()},function(e,t,n){'use strict';var i=Math.floor,r=Math.ceil,a=n(0);e.exports=function(e,t,n,s){function o(t,n){var r=0,s=null;return function(){if(null===r)throw new a.jpipExceptions.InternalErrorException('Iterated too deep in tag tree');if(r===u.length)return r=null,null;var o=u.length-r-1,c=i(t>>o),d=i(n>>o),p=u[r].width*d+c,g=u[r].content[p];void 0===g&&(g=l(r,p));var f=g.getValue(e.activeTransaction);return null!=s&&s.minimalPossibleValue>f.minimalPossibleValue&&(f.minimalPossibleValue=s.minimalPossibleValue),s=f,++r,f}}function l(e,t){var n=s.createTransactionalObject({minimalPossibleValue:0,isFinalValue:!1},function(e){return{minimalPossibleValue:e.minimalPossibleValue,isFinalValue:e.isFinalValue}});return u[e].content[t]=n,n}function c(){var t=p.getValue(e.activeTransaction);return t}function d(){p.setValue(e.activeTransaction,!0)}var p=s.createTransactionalObject(!1,function(e){return e}),u;(function(){u=[];for(var e=t,i=n;1<=e||1<=i;){e=r(e),i=r(i);var a=e*i;u.unshift({width:e,height:i,content:Array(a)}),e/=2,i/=2}l(0,0)})(),this.setMinimalValueIfNotReadBits=function(t){if(!c()){var n=u[0].content[0],i=n.getValue(e.activeTransaction);i.minimalPossibleValue=t}},this.isSmallerThanOrEqualsTo=function(t,n,i){d();for(var r=o(t,n),s=r(),l;null!==s;){if(s.minimalPossibleValue>i)return!1;if(!s.isFinalValue){var c=i-s.minimalPossibleValue+1,p=e.countZerosAndShiftUntilFirstOneBit(c);if(null===p)return null;s.minimalPossibleValue+=p,p<c&&(s.isFinalValue=!0)}l=s,s=r()}var u=l.minimalPossibleValue<=i;if(u&&!l.isFinalValue)throw new a.jpipExceptions.InternalErrorException('Wrong parsing in TagTree.isSmallerThanOrEqualsTo: not sure if value is smaller than asked');return u},this.getValue=function(t,n){var i=o(t,n),r=i(),a;for(d();null!==r;){if(!r.isFinalValue){var s=e.countZerosAndShiftUntilFirstOneBit();if(null===s)return null;r.minimalPossibleValue+=s,r.isFinalValue=!0}a=r,r=i()}return a.minimalPossibleValue}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(){var e=function(){for(var e=164,t=Array(e),n=1,r=2,a=0;n<=e;){for(var s=n;s<r;++s)t[s]=a;n*=2,r*=2,++a}return t}();return function(t,n){var r=n.createTransactionalObject({lBlockValue:3},function(e){return{lBlockValue:e.lBlockValue}});this.parse=function(n){var a=t.countOnesAndShiftUntilFirstZeroBit();if(null===a)return null;var s=r.getValue(t.activeTransaction);s.lBlockValue+=a;var o=e[n];if(o===void 0)throw new i.jpipExceptions.InternalErrorException('Unexpected value of coding passes '+n+'. Expected positive integer <= 164');var l=s.lBlockValue+o,c=t.shiftBits(l);return c}}}()},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r,a,s){function o(t){var n=u.getValue(e.activeTransaction);if(n>=t+1)throw new i.jpipExceptions.InternalErrorException('Unexpected quality layer to parse')}function l(){if(null==d){d=Array(t),p=Array(t);for(var i=0;i<t;++i){d[i]=Array(n),p[i]=Array(n);for(var r=0;r<n;++r)d[i][r]=s.createCodeblockLengthParser(e,a),p[i][r]=a.createTransactionalObject({isIncluded:!1},function(e){return{isIncluded:e.isIncluded}})}}}function c(t,n,i){var a=p[t][n].getValue(e.activeTransaction),s;if(s=a.isIncluded?e.shiftBit():g.isSmallerThanOrEqualsTo(t,n,i),null===s)return null;if(!s)return{codeblockBodyLengthBytes:0,codingPasses:0};var o=null;if(!a.isIncluded&&(o=f.getValue(t,n),null===o))return null;var l=r.parse(e);if(null===l)return null;var c=d[t][n],u=c.parse(l);if(null===u)return null;a.isIncluded=!0;var m={codeblockBodyLengthBytes:u,codingPasses:l};return null!==o&&(m.zeroBitPlanes=o),m}var d=null,p=null,u=a.createTransactionalObject(0,function(e){return e}),g=s.createTagTree(e,t,n),f=s.createTagTree(e,t,n);this.calculateSubbandLength=function(i){o(i),l(),g.setMinimalValueIfNotReadBits(i);for(var r=0,a=0,s=Array(t*n),d=0;d<n;++d)for(var p=0,f;p<t;++p){if(f=c(p,d,i),null===f)return null;s[a++]=f,r+=f.codeblockBodyLengthBytes}return u.setValue(e.activeTransaction,i+1),{codeblockBodyLengthByIndex:s,overallBodyLengthBytes:r}}}},function(e,t,n){'use strict';var r=Math.floor,a=Math.ceil,i=n(0);e.exports=function(e,t,n,s,o,l){function c(e){for(;m.length<e;){x.startNewTransaction();var t=d(m.length);if(null===t)return void x.activeTransaction.abort();m.push(t),x.activeTransaction.commit()}}function d(e){var t;if(0<e){var n=m[e-1];t=n.headerStartOffset+n.headerLength+n.overallBodyLengthBytes}else t=s;if(x.databinOffset=t,E&&b){var i=g(145);if(null===i)return null;if(i){x.databinOffset+=6}}var r=x.shiftBit();if(null===r)return null;if(!r)return x.shiftRemainingBitsInByte(),{headerStartOffset:t,headerLength:1,codeblockBodyLengthByIndex:[],overallBodyLengthBytes:0};var a=p(e);if(null===a)return null;var o=x.databinOffset;return a.headerLength=o-t,a.headerStartOffset=t,a}function p(e){for(var t=0,n=null,i=0;i<P.length;++i){var r=P[i],a=r.calculateSubbandLength(e);if(null===a)return null;n=null==n?a.codeblockBodyLengthByIndex:n.concat(a.codeblockBodyLengthByIndex),t+=a.overallBodyLengthBytes}if(x.shiftRemainingBitsInByte(),C){var s=g(146);if(null===s)return null;if(s){x.databinOffset+=2}}return{codeblockBodyLengthByIndex:n,overallBodyLengthBytes:t}}function u(e){var t=Math.min(e,m.length);if(0===t)return{endOffset:s,numQualityLayers:0};var n=m[t-1],i=n.headerStartOffset+n.headerLength+n.overallBodyLengthBytes;return{endOffset:i,numQualityLayers:t}}function g(e){var t=[,,],i=n.copyBytes(t,0,{databinStartOffset:x.databinOffset,maxLengthToCopy:2,forceCopyAllRange:!1});switch(i){case 2:var r=255===t[0]&&t[1]===e;return r;case 1:return!(255!==t[0])&&null;default:return null;}}function f(){if(!E)throw new i.jpipExceptions.UnsupportedFeatureException('PPM or PPT','A.7.4 and A.7.5')}var m=[],x=l.createBitstreamReader(n),h=t.getNumCodeblocksXInPrecinct(o),y=t.getNumCodeblocksYInPrecinct(o),I=e.getNumQualityLayers(),E=e.getIsPacketHeaderNearData(),b=e.getIsStartOfPacketMarkerAllowed(),C=e.getIsEndPacketHeaderMarkerAllowed(),P=function(){for(var e=0===o.resolutionLevel?1:3,t=[],n=0;n<e;++n){var i,s;(0===o.resolutionLevel?(i=h,s=y):(i=1===n?a(h/2):r(h/2),s=0===n?a(y/2):r(y/2)),0!==i&&0!==s)&&t.push(l.createSubbandLengthInPacketHeaderCalculator(x,i,s))}return t}();this.calculateEndOffsetOfLastFullPacket=function(e){var t;if(!(e===void 0||e>=I))t=e;else if(!n.isAllDatabinLoaded())t=I;else{var i=n.getDatabinLengthIfKnown();return{endOffset:i,numQualityLayers:I}}f(),c(t);var r=u(t);return r},this.getPacketOffsetsByCodeblockIndex=function(e){return f(),c(e+1),m.length<=e?null:m[e]}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(n,a){var s=n.getCachedData(r);if(void 0!==s.calculator)return s.calculator;if(void 0===a)throw new i.jpipExceptions.InternalErrorException('precinctPosition should be given on the first time of using QualityLayersCache on this precinct');var o=e.getTileStructure(a.tileIndex),l=o.getComponentStructure(a.component);return s.calculator=t.createPacketLengthCalculator(o,l,n,0,a),s.calculator}var r='packetLengthCalculator';this.getPacketOffsetsByCodeblockIndex=function(e,t,i){var r=n(e,i),a=r.getPacketOffsetsByCodeblockIndex(t);return a},this.getQualityLayerOffset=function(e,t,i){var r=e.getExistingRanges(),a=n(e,i),s;1>r.length||0<r[0].start?(s=0,t=0):s=r[0].start+r[0].length;for(var o=a.calculateEndOffsetOfLastFullPacket(t);s<o.endOffset;){var l=o.numQualityLayers-1;o=a.calculateEndOffsetOfLastFullPacket(l)}return o}}},function(e,t,n){'use strict';function i(){this._image=new s.JpxImage}var r=Math.max,a=Math.min,s=n(2);e.exports=i;n(0);i.prototype.start=function(e){var t=this;return new Promise(function(n){var r={left:e.offsetInRegion.offsetX,top:e.offsetInRegion.offsetY,right:e.offsetInRegion.offsetX+e.offsetInRegion.width,bottom:e.offsetInRegion.offsetY+e.offsetInRegion.height},a=t._image.parseCodestream(e.headersCodestream,0,e.headersCodestream.length,{isOnlyParseHeaders:!0});if(e.codeblocksData&&t._image.addPacketsData(a,e.codeblocksData),e.precinctCoefficients)for(var s=0,i;s<e.precinctCoefficients.length;++s)i=e.precinctCoefficients[s],t._image.setPrecinctCoefficients(a,i.coefficients,i.tileIndex,i.c,i.r,i.p);t._image.decode(a,{regionToParse:r});var o=t._copyTilesPixelsToOnePixelsArray(t._image.tiles,r,t._image.componentsCount);n(o)})},i.prototype._copyTilesPixelsToOnePixelsArray=function(e,t,n){for(var s=e[0],o=t.right-t.left,l=t.bottom-t.top,c=new ImageData(o,l),d=4,p=o*d,u=0;u<e.length;++u){var i=e[u].left+e[u].width,g=e[u].top+e[u].height,f=r(t.left,e[u].left),m=r(t.top,e[u].top),x=a(t.right,i),h=a(t.bottom,g);if(f!==e[u].left||m!==e[u].top||x-f!==e[u].width||h-m!==e[u].height)throw'Unsupported tiles to copy';var y=f-t.left,I=m-t.top;this._copyTile(c.data,e[u],y*d+I*p,p,n)}return c},i.prototype._copyTile=function(e,t,n,i,r){var a=1,s=2,o=1,l=t.pixels||t.items;switch(void 0===r&&(r=l.length/(t.width*t.height)),r){case 1:a=0,s=0;break;case 3:o=3;break;case 4:o=4;break;default:throw'Unsupported components count '+r;}for(var c=n,d=0,p=0,u;p<t.height;++p){u=c;for(var g=0;g<t.width;++g)e[c+0]=l[d+0],e[c+1]=l[d+a],e[c+2]=l[d+s],e[c+3]=255,d+=o,c+=4;c=u+i}}},function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function i(e){m>=f.WARNINGS&&console.log('Warning: '+e)}function r(e){throw new Error(e)}function a(e,t){e||r(t)}function s(e){if(!e)return!1;switch(e.protocol){case'http:':case'https:':case'ftp:':case'mailto:':case'tel:':return!0;default:return!1;}}function o(e){a('string'==typeof e,'Invalid argument for stringToBytes');for(var t=e.length,n=new Uint8Array(t),r=0;r<t;++r)n[r]=255&e.charCodeAt(r);return n}function l(e){return void 0===e.length?(a(void 0!==e.byteLength),e.byteLength):e.length}var c=Math.max,d=Math.min,p=String.fromCharCode;Object.defineProperty(t,'__esModule',{value:!0});var u=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),g='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},f={ERRORS:0,WARNINGS:1,INFOS:5},m=f.WARNINGS,x=function(){function e(e,t){this.name='PasswordException',this.message=e,this.code=t}return e.prototype=new Error,e.constructor=e,e}(),h=function(){function e(e,t){this.name='UnknownErrorException',this.message=e,this.details=t}return e.prototype=new Error,e.constructor=e,e}(),y=function(){function e(e){this.name='InvalidPDFException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),I=function(){function e(e){this.name='MissingPDFException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),E=function(){function e(e,t){this.name='UnexpectedResponseException',this.message=e,this.status=t}return e.prototype=new Error,e.constructor=e,e}(),b=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name='FormatError',e.constructor=e,e}(),C=function(){function e(e){this.name='AbortException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),P=/\x00/g,T=['rgb(',0,',',0,',',0,')'],S=function(){function e(){n(this,e)}return u(e,null,[{key:'makeCssRgb',value:function(e,t,n){return T[1]=e,T[3]=t,T[5]=n,T.join('')}},{key:'transform',value:function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}},{key:'applyTransform',value:function(e,t){var n=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[n,i]}},{key:'applyInverseTransform',value:function(e,t){var n=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[i,r]}},{key:'getAxialAlignedBoundingBox',value:function(t,n){var i=e.applyTransform(t,n),r=e.applyTransform(t.slice(2,4),n),a=e.applyTransform([t[0],t[3]],n),s=e.applyTransform([t[2],t[1]],n);return[d(i[0],r[0],a[0],s[0]),d(i[1],r[1],a[1],s[1]),c(i[0],r[0],a[0],s[0]),c(i[1],r[1],a[1],s[1])]}},{key:'inverseTransform',value:function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}},{key:'apply3dTransform',value:function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]}},{key:'singularValueDecompose2dScale',value:function(e){var t=Math.sqrt,n=[e[0],e[2],e[1],e[3]],i=e[0]*n[0]+e[1]*n[2],r=e[0]*n[1]+e[1]*n[3],a=e[2]*n[0]+e[3]*n[2],s=e[2]*n[1]+e[3]*n[3],o=(i+s)/2,l=t((i+s)*(i+s)-4*(i*s-a*r))/2;return[t(o+l||1),t(o-l||1)]}},{key:'normalizeRect',value:function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}},{key:'intersect',value:function(t,n){function i(e,t){return e-t}var r=[t[0],t[2],n[0],n[2]].sort(i),a=[t[1],t[3],n[1],n[3]].sort(i),s=[];if(t=e.normalizeRect(t),n=e.normalizeRect(n),r[0]===t[0]&&r[1]===n[0]||r[0]===n[0]&&r[1]===t[0])s[0]=r[1],s[2]=r[2];else return null;if(a[0]===t[1]&&a[1]===n[1]||a[0]===n[1]&&a[1]===t[1])s[1]=a[1],s[3]=a[2];else return null;return s}}]),e}(),v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364],L=function(){var e='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';return function(t,n){var r=2<arguments.length&&arguments[2]!==void 0&&arguments[2];if(!r&&URL.createObjectURL){var a=new Blob([t],{type:n});return URL.createObjectURL(a)}for(var s='data:'+n+';base64,',o=0,i=t.length;o<i;o+=3){var l=255&t[o],c=255&t[o+1],d=255&t[o+2],p=o+1<i?(15&c)<<2|d>>6:64,u=o+2<i?63&d:64;s+=e[l>>2]+e[(3&l)<<4|c>>4]+e[p]+e[u]}return s}}();t.FONT_IDENTITY_MATRIX=[0.001,0,0,0.001,0,0],t.IDENTITY_MATRIX=[1,0,0,1,0,0],t.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},t.VerbosityLevel=f,t.UNSUPPORTED_FEATURES={unknown:'unknown',forms:'forms',javaScript:'javaScript',smask:'smask',shadingPattern:'shadingPattern',font:'font'},t.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},t.AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},t.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},t.AnnotationMarkedState={MARKED:'Marked',UNMARKED:'Unmarked'},t.AnnotationReplyType={GROUP:'Group',REPLY:'R'},t.AnnotationReviewState={ACCEPTED:'Accepted',REJECTED:'Rejected',CANCELLED:'Cancelled',COMPLETED:'Completed',NONE:'None'},t.AnnotationStateModelType={MARKED:'Marked',REVIEW:'Review'},t.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t.FontType={UNKNOWN:'UNKNOWN',TYPE1:'TYPE1',TYPE1C:'TYPE1C',CIDFONTTYPE0:'CIDFONTTYPE0',CIDFONTTYPE0C:'CIDFONTTYPE0C',TRUETYPE:'TRUETYPE',CIDFONTTYPE2:'CIDFONTTYPE2',TYPE3:'TYPE3',OPENTYPE:'OPENTYPE',TYPE0:'TYPE0',MMTYPE1:'MMTYPE1'},t.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},t.CMapCompressionType={NONE:0,BINARY:1,STREAM:2},t.AbortException=C,t.InvalidPDFException=y,t.MissingPDFException=I,t.NativeImageDecoding={NONE:'none',DECODE:'decode',DISPLAY:'display'},t.PasswordException=x,t.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},t.PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},t.StreamType={UNKNOWN:'UNKNOWN',FLATE:'FLATE',LZW:'LZW',DCT:'DCT',JPX:'JPX',JBIG:'JBIG',A85:'A85',AHX:'AHX',CCF:'CCF',RLX:'RLX'},t.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},t.UnexpectedResponseException=E,t.UnknownErrorException=h,t.Util=S,t.FormatError=b,t.arrayByteLength=l,t.arraysToBytes=function(e){var t=e.length;if(1===t&&e[0]instanceof Uint8Array)return e[0];for(var n=0,r=0;r<t;r++)n+=l(e[r]);for(var i=0,a=new Uint8Array(n),s=0,c;s<t;s++){c=e[s],c instanceof Uint8Array||('string'==typeof c?c=o(c):c=new Uint8Array(c));var d=c.byteLength;a.set(c,i),i+=d}return a},t.assert=a,t.bytesToString=function(e){a(null!==e&&'object'===('undefined'==typeof e?'undefined':g(e))&&e.length!==void 0,'Invalid argument for bytesToString');var t=e.length,n=8192;if(t<n)return p.apply(null,e);for(var r=[],s=0;s<t;s+=n){var i=d(s+n,t),o=e.subarray(s,i);r.push(p.apply(null,o))}return r.join('')},t.createPromiseCapability=function(){var e=Object.create(null),t=!1;return Object.defineProperty(e,'settled',{get:function(){return t}}),e.promise=new Promise(function(n,i){e.resolve=function(e){t=!0,n(e)},e.reject=function(e){t=!0,i(e)}}),e},t.createObjectURL=L,t.getVerbosityLevel=function(){return m},t.info=function(e){m>=f.INFOS&&console.log('Info: '+e)},t.isArrayBuffer=function(e){return'object'===('undefined'==typeof e?'undefined':g(e))&&null!==e&&e.byteLength!==void 0},t.isArrayEqual=function(e,t){return!(e.length!==t.length)&&e.every(function(e,n){return e===t[n]})},t.isBool=function(e){return'boolean'==typeof e},t.isEmptyObj=function(e){for(var t in e)return!1;return!0},t.isNum=function(e){return'number'==typeof e},t.isString=function(e){return'string'==typeof e},t.isSpace=function(e){return 32===e||9===e||13===e||10===e},t.isSameOrigin=function(e,t){var n;try{if(n=new URL(e),!n.origin||'null'===n.origin)return!1}catch(t){return!1}var i=new URL(t,n);return n.origin===i.origin},t.createValidAbsoluteUrl=function(e,t){if(!e)return null;try{var n=t?new URL(e,t):new URL(e);if(s(n))return n}catch(e){}return null},t.isLittleEndian=function(){var e=new Uint8Array(4);e[0]=1;var t=new Uint32Array(e.buffer,0,1);return 1===t[0]},t.isEvalSupported=function(){try{return new Function(''),!0}catch(t){return!1}},t.log2=function(e){return 0>=e?0:Math.ceil(Math.log2(e))},t.readInt8=function(e,t){return e[t]<<24>>24},t.readUint16=function(e,t){return e[t]<<8|e[t+1]},t.readUint32=function(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0},t.removeNullCharacters=function(e){return'string'==typeof e?e.replace(P,''):(i('The argument for removeNullCharacters must be a string.'),e)},t.ReadableStream=ReadableStream,t.URL=URL,t.setVerbosityLevel=function(e){Number.isInteger(e)&&(m=e)},t.shadow=function(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n},t.string32=function(e){return p(255&e>>24,255&e>>16,255&e>>8,255&e)},t.stringToBytes=o,t.stringToPDFString=function(e){var t=e.length,n=[];if('\xFE'===e[0]&&'\xFF'===e[1])for(var r=2;r<t;r+=2)n.push(p(e.charCodeAt(r)<<8|e.charCodeAt(r+1)));else for(var i=0,a;i<t;++i)a=v[e.charCodeAt(i)],n.push(a?p(a):e.charAt(i));return n.join('')},t.stringToUTF8String=function(e){return decodeURIComponent(escape(e))},t.utf8StringToString=function(e){return unescape(encodeURIComponent(e))},t.warn=i,t.unreachable=r},function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(t,'__esModule',{value:!0});var i=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}],a=function(){function e(t,i,r){n(this,e),this.data=t,this.bp=i,this.dataEnd=r,this.chigh=t[i],this.clow=0,this.byteIn(),this.chigh=65535&this.chigh<<7|127&this.clow>>9,this.clow=65535&this.clow<<7,this.ct-=7,this.a=32768}return i(e,[{key:'byteIn',value:function(){var e=this.data,t=this.bp;255===e[t]?143<e[t+1]?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t):(t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t),65535<this.clow&&(this.chigh+=this.clow>>16,this.clow&=65535)}},{key:'readBit',value:function(e,t){var n=e[t]>>1,i=1&e[t],s=r[n],o=s.qe,l=this.a-o,a;if(this.chigh<o)l<o?(l=o,a=i,n=s.nmps):(l=o,a=1^i,1===s.switchFlag&&(i=a),n=s.nlps);else{if(this.chigh-=o,0!=(32768&l))return this.a=l,i;l<o?(a=1^i,1===s.switchFlag&&(i=a),n=s.nlps):(a=i,n=s.nmps)}do 0===this.ct&&this.byteIn(),l<<=1,this.chigh=65535&this.chigh<<1|1&this.clow>>15,this.clow=65535&this.clow<<1,this.ct--;while(0==(32768&l));return this.a=l,e[t]=n<<1|i,a}}]),e}();t.ArithmeticDecoder=a},function(e,t,n){'use strict';function i(){this._contextPool=new s}var r=Math.max,a=Math.min;e.exports=i;var s=n(3);i.prototype.start=function(e){var t=this;return new Promise(function(n){for(var r=t._contextPool.image,a=t._contextPool.getContext(e.headersCodestream),s={left:e.offsetInRegion.offsetX,top:e.offsetInRegion.offsetY,right:e.offsetInRegion.offsetX+e.offsetInRegion.width,bottom:e.offsetInRegion.offsetY+e.offsetInRegion.height},o=e.imageTilesX,l=e.tilesBounds.maxTileXExclusive-e.tilesBounds.minTileX,c=e.tilesBounds.minTileX,d=e.tilesBounds.minTileY,p=0;p<e.precinctCoefficients.length;++p){var i=e.precinctCoefficients[p],u=i.key.tileIndex,g=Math.floor(u/o);r.setPrecinctCoefficients(a,i.coefficients,u%o-c+(g-d)*l,i.key.component,i.key.resolutionLevel,i.key.precinctIndexInComponentResolution)}r.decode(a,{regionToParse:s});var f=t._copyTilesPixelsToOnePixelsArray(r.tiles,s,r.componentsCount);n(f)})},i.prototype._copyTilesPixelsToOnePixelsArray=function(e,t,n){for(var s=e[0],o=t.right-t.left,l=t.bottom-t.top,c=new ImageData(o,l),d=4,p=o*d,u=0;u<e.length;++u){var i=e[u].left+e[u].width,g=e[u].top+e[u].height,f=r(t.left,e[u].left),m=r(t.top,e[u].top),x=a(t.right,i),h=a(t.bottom,g);if(f!==e[u].left||m!==e[u].top||x-f!==e[u].width||h-m!==e[u].height)throw'Unsupported tiles to copy';var y=f-t.left,I=m-t.top;this._copyTile(c.data,e[u],y*d+I*p,p,n)}return c},i.prototype._copyTile=function(e,t,n,i,r){var a=1,s=2,o=1,l=t.pixels||t.items;switch(void 0===r&&(r=l.length/(t.width*t.height)),r){case 1:a=0,s=0;break;case 3:o=3;break;case 4:o=4;break;default:throw'Unsupported components count '+r;}for(var c=n,d=0,p=0,u;p<t.height;++p){u=c;for(var g=0;g<t.width;++g)e[c+0]=l[d+0],e[c+1]=l[d+a],e[c+2]=l[d+s],e[c+3]=255,d+=o,c+=4;c=u+i}}},function(e,t,n){'use strict';function i(){this._contextPool=new r}e.exports=i;var r=n(3);i.prototype.start=function(e,t){var n=this;return new Promise(function(i){var r=n._contextPool.image,a=n._contextPool.getContext(e.headersCodestream);if(e.codeblocksData&&r.addPacketsData(a,e.codeblocksData),e.precinctCoefficients)for(var s=0,o;s<e.precinctCoefficients.length;++s)o=e.precinctCoefficients[s],r.setPrecinctCoefficients(a,o.coefficients,o.tileIndex,o.c,o.r,o.p);var l=r.decodePrecinctCoefficients(a,0,t.component,t.resolutionLevel,t.precinctIndexInComponentResolution);i({key:t,coefficients:l,minQuality:e.minQuality})})}}]);