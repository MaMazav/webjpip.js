var webjpip=function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=3)}([function(e){'use strict';e.exports.j2kMarkers={StartOfCodestream:[255,79],ImageAndTileSize:[255,81],CodingStyleDefault:[255,82],CodingStyleComponent:[255,83],QuantizationDefault:[255,92],ProgressionOrderChange:[255,95],PackedPacketHeadersInMainHeader:[255,96],PackedPacketHeadersInTileHeader:[255,97],StartOfTile:[255,144],StartOfData:[255,147],EndOfCodestream:[255,217],Comment:[255,100]},e.exports.j2kOffsets={MARKER_SIZE:2,LENGTH_FIELD_SIZE:2,NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER:38,REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER:6},e.exports.jpipEndOfResponseReasons={IMAGE_DONE:1,WINDOW_DONE:2,WINDOW_CHANGE:3,BYTE_LIMIT:4,QUALITY_LIMIT:5,SESSION_LIMIT:6,RESPONSE_LIMIT:7,NON_SPECIFIED:8},e.exports.j2kExceptions={UnsupportedFeatureException:function(e,t){return this.description=e+' (specified in section '+t+' of part 1: Core Coding System standard) is not supported yet',this.toString=function(){return'J2k UnsupportedFeatureException: '+this.description},this},ParseException:function(e){return this.description=e,this.toString=function(){return'J2k ParseException: '+this.description},this},IllegalDataException:function(e,t){return this.description=e+' (see section '+t+' of part 9: Interactivity tools, APIs and Protocols)',this.toString=function(){return'J2k IllegalDataException: '+this.description},this}},e.exports.jpipExceptions={UnsupportedFeatureException:function(e,t){return this.description=e+' (specified in section '+t+' of part 9: Interactivity tools, APIs and Protocols) is not supported yet',this.toString=function(){return'Jpip UnsupportedFeatureException: '+this.description},this},ParseException:function(e){return this.description=e,this.toString=function(){return'Jpip ParseException: '+this.description},this},IllegalDataException:function(e,t){return this.description=e+' (see section '+t+' of part 9: Interactivity tools, APIs and Protocols)',this.toString=function(){return'Jpip IllegalDataException: '+this.description},this},IllegalOperationException:function(e){return this.description=e,this.toString=function(){return'Jpip IllegalOperationException: '+this.description},this},ArgumentException:function(e,t,n){return this.description='Argument '+e+' has invalid value '+t+(void 0===n?'':' :'+n),this.toString=function(){return'Jpip ArgumentException: '+this.description},this},WrongStreamException:function(e,t){var n='JPP (JPIP Precinct)',i='JPT (JPIP Tile-part)';if(t){var r=n;n=i,i=r}return this.description='Stream type is '+i+', but '+e+' is allowed only in '+n+' stream',this.toString=function(){return'Jpip WrongStreamException: '+this.description},this},InternalErrorException:function(e){return this.description=e,this.toString=function(){return'Jpip InternalErrorException: '+this.description},this}},e.exports.j2kExceptions.UnsupportedFeatureException.Name='j2kExceptions.UnsupportedFeatureException',e.exports.j2kExceptions.ParseException.Name='j2kExceptions.ParseException',e.exports.j2kExceptions.IllegalDataException.Name='j2kExceptions.IllegalDataException',e.exports.jpipExceptions.UnsupportedFeatureException.Name='jpipExceptions.UnsupportedFeatureException',e.exports.jpipExceptions.ParseException.Name='jpipExceptions.ParseException',e.exports.jpipExceptions.IllegalDataException.Name='jpipExceptions.IllegalDataException',e.exports.jpipExceptions.IllegalOperationException.Name='jpipExceptions.IllegalOperationException',e.exports.jpipExceptions.ArgumentException.Name='jpipExceptions.ArgumentException',e.exports.jpipExceptions.WrongStreamException.Name='jpipExceptions.WrongStreamException',e.exports.jpipExceptions.InternalErrorException.Name='jpipExceptions.InternalErrorException'},function(e,t,n){'use strict';var r=Math.floor,s=Math.ceil,a=Math.max,o=Math.min;Object.defineProperty(t,'__esModule',{value:!0}),t.JpxImage=void 0;var l=n(43),i=n(44),d=function(){function e(e){this.message='JPX error: '+e}return e.prototype=new Error,e.prototype.name='JpxError',e.constructor=e,e}(),c=function(){function e(){this.failOnCorruptedImage=!1}function t(e,t){for(var n=t.subbands,r=0,i;r<e.subbandPrecincts.length;++r){var s='LL'!==t.subbands[r].type,l=e.subbandPrecincts[r].tbxMin_,c=e.subbandPrecincts[r].tbyMin_,d=e.subbandPrecincts[r].tbxMax_,p=e.subbandPrecincts[r].tbyMax_;s&&(l=2*(l-t.subbands[r].tbx0)+t.trx0,c=2*(c-t.subbands[r].tby0)+t.try0,d=2*(d-t.subbands[r].tbx0)+t.trx0,p=2*(p-t.subbands[r].tby0)+t.try0),0===r?i={x0:l,y0:c,x1:d,y1:p}:(i.x0=o(i.x0,l),i.y0=o(i.y0,c),i.x1=a(i.x1,d),i.y1=a(i.y1,p))}return i}function n(e,t){e.x0=s(t.XOsiz/e.XRsiz),e.x1=s(t.Xsiz/e.XRsiz),e.y0=s(t.YOsiz/e.YRsiz),e.y1=s(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function c(e,t){for(var n=e.SIZ,r=[],l=s((n.Xsiz-n.XTOsiz)/n.XTsiz),c=s((n.Ysiz-n.YTOsiz)/n.YTsiz),d=0,u;d<c;d++)for(var g=0;g<l;g++)u={},u.tx0=a(n.XTOsiz+g*n.XTsiz,n.XOsiz),u.ty0=a(n.YTOsiz+d*n.YTsiz,n.YOsiz),u.tx1=o(n.XTOsiz+(g+1)*n.XTsiz,n.Xsiz),u.ty1=o(n.YTOsiz+(d+1)*n.YTsiz,n.Ysiz),u.width=u.tx1-u.tx0,u.height=u.ty1-u.ty0,u.components=[],r.push(u);e.tiles=r;for(var p=n.Csiz,f=0,i;f<p;f++){i=t[f];for(var m=0,x=r.length,y;m<x;m++)y={},u=r[m],y.tcx0=s(u.tx0/i.XRsiz),y.tcy0=s(u.ty0/i.YRsiz),y.tcx1=s(u.tx1/i.XRsiz),y.tcy1=s(u.ty1/i.YRsiz),y.width=y.tcx1-y.tcx0,y.height=y.tcy1-y.tcy0,u.components[f]=y}}function p(e,t,n){var i=t.codingStyleParameters,r={};return i.entropyCoderWithCustomPrecincts?(r.PPx=i.precinctsSizes[n].PPx,r.PPy=i.precinctsSizes[n].PPy):(r.PPx=15,r.PPy=15),r.xcb_=0<n?o(i.xcb,r.PPx-1):o(i.xcb,r.PPx),r.ycb_=0<n?o(i.ycb,r.PPy-1):o(i.ycb,r.PPy),r}function u(e,t,n){var i=1<<n.PPx,a=1<<n.PPy,o=0===t.resLevel,l=1<<n.PPx+(o?0:-1),c=1<<n.PPy+(o?0:-1),d=t.trx1>t.trx0?s(t.trx1/i)-r(t.trx0/i):0,p=t.try1>t.try0?s(t.try1/a)-r(t.try0/a):0;t.precinctParameters={precinctWidth:i,precinctHeight:a,numprecinctswide:d,numprecinctshigh:p,numprecincts:d*p,precinctWidthInSubband:l,precinctHeightInSubband:c}}function g(e,t,n,s){var l=n.xcb_,c=n.ycb_,d=1<<l,p=1<<c,u=t.tbx0>>l,g=t.tby0>>c,f=t.tbx1+d-1>>l,m=t.tby1+p-1>>c,x=t.resolution.precinctParameters,y=[],h=[],E,I,b,C;for(I=g;I<m;I++)for(E=u;E<f;E++){b={cbx:E,cby:I,tbx0:d*E,tby0:p*I,tbx1:d*(E+1),tby1:p*(I+1)},b.tbx0_=a(t.tbx0,b.tbx0),b.tby0_=a(t.tby0,b.tby0),b.tbx1_=o(t.tbx1,b.tbx1),b.tby1_=o(t.tby1,b.tby1);var P=r((b.tbx0_-t.tbx0)/x.precinctWidthInSubband),T=r((b.tby0_-t.tby0)/x.precinctHeightInSubband);if(C=P+T*x.numprecinctswide,b.precinctNumber=C,b.subbandType=t.type,b.Lblock=3,!(b.tbx1_<=b.tbx0_||b.tby1_<=b.tby0_)){y.push(b);var S=h[C];void 0===S?h[C]=S={cbxMin:E,cbyMin:I,cbxMax:E,cbyMax:I,tbxMin_:b.tbx0_,tbxMax_:b.tbx1_,tbyMin_:b.tby0_,tbyMax_:b.tby1_,pixelsPrecinct:t.resolution.pixelsPrecincts[C]}:(E<S.cbxMin?(S.cbxMin=E,S.tbxMin_=b.tbx0_):E>S.cbxMax&&(S.cbxMax=E,S.tbxMax_=b.tbx1_),I<S.cbyMin?(S.cbyMin=I,S.tbyMin_=b.tby0_):I>S.cbyMax&&(S.cbyMax=I,S.tbyMax_=b.tby1_)),void 0===S.pixelsPrecinct&&(S.pixelsPrecinct={codeblocks:[],subbandPrecincts:[]},t.resolution.pixelsPrecincts[C]=S.pixelsPrecinct),b.precinct=S;var v=S.pixelsPrecinct;v.codeblocks.push(b),void 0===v.subbandPrecincts[s]&&(v.subbandPrecincts[s]=S)}}t.codeblockParameters={codeblockWidth:l,codeblockHeight:c,numcodeblockwide:f-u+1,numcodeblockhigh:m-g+1},t.codeblocks=y,t.subbandPrecincts=h}function f(e,t,n){return{layerNumber:n,codeblocks:e.pixelsPrecincts[t].codeblocks}}function m(e){for(var t=e.SIZ,n=e.currentTile.index,s=e.tiles[n],o=s.codingStyleDefaultParameters.layersCount,c=t.Csiz,p=0,u=0;u<c;u++)p=a(p,s.components[u].codingStyleParameters.decompositionLevelsCount);var g=0,l=0,r=0,i=0;this.nextPacket=function(){for(;g<o;g++){for(;l<=p;l++){for(;r<c;r++){var e=s.components[r];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[l],n=t.precinctParameters.numprecincts,a;i<n;)return a=f(t,i,g),i++,a;i=0}}r=0}l=0}throw new d('Out of packets')}}function x(e){for(var t=e.SIZ,n=e.currentTile.index,s=e.tiles[n],o=s.codingStyleDefaultParameters.layersCount,c=t.Csiz,p=0,u=0;u<c;u++)p=a(p,s.components[u].codingStyleParameters.decompositionLevelsCount);var g=0,r=0,l=0,i=0;this.nextPacket=function(){for(;g<=p;g++){for(;r<o;r++){for(;l<c;l++){var e=s.components[l];if(!(g>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[g],n=t.precinctParameters.numprecincts,a;i<n;)return a=f(t,i,r),i++,a;i=0}}l=0}r=0}throw new d('Out of packets')}}function y(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],s=i.codingStyleDefaultParameters.layersCount,o=t.Csiz,u=0,g,l,r,c;for(r=0;r<o;r++){var p=i.components[r];u=a(u,p.codingStyleParameters.decompositionLevelsCount)}var m=new Int32Array(u+1);for(l=0;l<=u;++l){var x=0;for(r=0;r<o;++r){var y=i.components[r].resolutions;l<y.length&&(x=a(x,y[l].precinctParameters.numprecincts))}m[l]=x}g=0,l=0,r=0,c=0,this.nextPacket=function(){for(;l<=u;l++){for(;c<m[l];c++){for(;r<o;r++){var e=i.components[r];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){var t=e.resolutions[l],n=t.precinctParameters.numprecincts;if(!(c>=n)){for(;g<s;){var a=f(t,c,g);return g++,a}g=0}}}r=0}c=0}throw new d('Out of packets')}}function h(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],s=i.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=b(i),p=o,u=0,l=0,r=0,c=0,g=0;this.nextPacket=function(){for(;g<p.maxNumHigh;g++){for(;c<p.maxNumWide;c++){for(;r<a;r++){for(var e=i.components[r],t=e.codingStyleParameters.decompositionLevelsCount;l<=t;l++){var n=e.resolutions[l],m=o.components[r].resolutions[l],x=I(c,g,m,p,n);if(null!==x){for(;u<s;){var y=f(n,x,u);return u++,y}u=0}}l=0}r=0}c=0}throw new d('Out of packets')}}function E(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],s=i.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=b(i),p=0,l=0,r=0,c=0,u=0;this.nextPacket=function(){for(;r<a;++r){for(var e=i.components[r],t=o.components[r],n=e.codingStyleParameters.decompositionLevelsCount;u<t.maxNumHigh;u++){for(;c<t.maxNumWide;c++){for(;l<=n;l++){var g=e.resolutions[l],m=t.resolutions[l],x=I(c,u,m,t,g);if(null!==x){for(;p<s;){var y=f(g,x,p);return p++,y}p=0}}l=0}c=0}u=0}throw new d('Out of packets')}}function I(e,t,n,i,r){var s=e*i.minWidth,a=t*i.minHeight;if(0!=s%n.width||0!=a%n.height)return null;var o=a/n.width*r.precinctParameters.numprecinctswide;return s/n.height+o}function b(e){for(var t=Number.MAX_VALUE,n=e.components.length,i=t,s=t,l=0,d=0,p=Array(n),u=0;u<n;u++){for(var c=e.components[u],g=c.codingStyleParameters.decompositionLevelsCount,f=Array(g+1),m=t,x=t,y=0,h=0,E=1,I=g;0<=I;--I){var r=c.resolutions[I],b=E*r.precinctParameters.precinctWidth,C=E*r.precinctParameters.precinctHeight;m=o(m,b),x=o(x,C),y=a(y,r.precinctParameters.numprecinctswide),h=a(h,r.precinctParameters.numprecinctshigh),f[I]={width:b,height:C},E<<=1}i=o(i,m),s=o(s,x),l=a(l,y),d=a(d,h),p[u]={resolutions:f,minWidth:m,minHeight:x,maxNumWide:y,maxNumHigh:h}}return{components:p,minWidth:i,minHeight:s,maxNumWide:l,maxNumHigh:d}}function C(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],a=t.Csiz,o=0;o<a;o++){for(var l=i.components[o],c=l.codingStyleParameters.decompositionLevelsCount,f=[],I=[],b=0,C=0;C<=c;C++){var r=p(e,l,C),P={},T=1<<c-C;P.trx0=s(l.tcx0/T),P.try0=s(l.tcy0/T),P.trx1=s(l.tcx1/T),P.try1=s(l.tcy1/T),P.resLevel=C,P.pixelsPrecincts=[],u(e,P,r),f.push(P);var S;if(0===C)S={},S.type='LL',S.tbx0=s(l.tcx0/T),S.tby0=s(l.tcy0/T),S.tbx1=s(l.tcx1/T),S.tby1=s(l.tcy1/T),S.resolution=P,S.indexInTileComponent=b++,g(e,S,r,0),I.push(S),P.subbands=[S];else{var v=1<<c-C+1,L=[];S={},S.type='HL',S.tbx0=s(l.tcx0/v-0.5),S.tby0=s(l.tcy0/v),S.tbx1=s(l.tcx1/v-0.5),S.tby1=s(l.tcy1/v),S.resolution=P,S.indexInTileComponent=b++,g(e,S,r,0),I.push(S),L.push(S),S={},S.type='LH',S.tbx0=s(l.tcx0/v),S.tby0=s(l.tcy0/v-0.5),S.tbx1=s(l.tcx1/v),S.tby1=s(l.tcy1/v-0.5),S.resolution=P,S.indexInTileComponent=b++,g(e,S,r,1),I.push(S),L.push(S),S={},S.type='HH',S.tbx0=s(l.tcx0/v-0.5),S.tby0=s(l.tcy0/v-0.5),S.tbx1=s(l.tcx1/v-0.5),S.tby1=s(l.tcy1/v-0.5),S.resolution=P,S.indexInTileComponent=b++,g(e,S,r,2),I.push(S),L.push(S),P.subbands=L}}l.resolutions=f,l.subbands=I}var O=i.codingStyleDefaultParameters.progressionOrder;switch(O){case 0:i.packetsIterator=new m(e);break;case 1:i.packetsIterator=new x(e);break;case 2:i.packetsIterator=new y(e);break;case 3:i.packetsIterator=new h(e);break;case 4:i.packetsIterator=new E(e);break;default:throw new d('Unsupported progression order '+O);}}function P(e,t,n,r){function s(e){for(;u<e;){var i=t[n+p];p++,g?(E=E<<7|i,u+=7,g=!1):(E=E<<8|i,u+=8),255===i&&(g=!0)}return u-=e,E>>>u&(1<<e)-1}function a(e){return 255===t[n+p-1]&&t[n+p]===e?(o(1),!0):255===t[n+p]&&t[n+p+1]===e&&(o(2),!0)}function o(e){p+=e}function c(){u=0,g&&(p++,g=!1)}function d(){if(0===s(1))return 1;if(0===s(1))return 2;var e=s(2);return 3>e?e+3:(e=s(5),31>e)?e+6:(e=s(7),e+37)}for(var p=0,u=0,g=!1,f=e.currentTile.index,m=e.tiles[f],x=e.COD.sopMarkerUsed,y=e.COD.ephMarkerUsed,h=m.packetsIterator,E;p<r;){c(),x&&a(145)&&o(4);var I=h.nextPacket();if(s(1)){for(var b=I.layerNumber,C=[],P=0,i=I.codeblocks.length,T;P<i;P++){T=I.codeblocks[P];var S=T.precinct,v=T.cbx-S.cbxMin,L=T.cby-S.cbyMin,O=!1,D=!1,A;if(void 0!==T.included)O=!!s(1);else{S=T.precinct;var _,j;if(void 0!==S.inclusionTree)_=S.inclusionTree;else{var N=S.cbxMax-S.cbxMin+1,F=S.cbyMax-S.cbyMin+1;_=new k(N,F,b),j=new R(N,F),S.inclusionTree=_,S.zeroBitPlanesTree=j}if(_.reset(v,L,b))for(;;)if(!s(1)){_.incrementValue(b);break}else if(A=!_.nextLevel(),A){T.included=!0,O=D=!0;break}}if(O){if(D){for(j=S.zeroBitPlanesTree,j.reset(v,L);;)if(!s(1))j.incrementValue();else if(A=!j.nextLevel(),A)break;T.zeroBitPlanes=j.value}for(var B=d();s(1);)T.Lblock++;var M=(0,l.log2)(B),w=(B<1<<M?M-1:M)+T.Lblock,q=s(w);C.push({codeblock:T,codingpasses:B,dataLength:q})}}for(c(),y&&a(146);0<C.length;){var X=C.shift();T=X.codeblock,void 0===T.data&&(T.data=[]),T.data.push({data:t,start:n+p,end:n+p+X.dataLength,codingpasses:X.codingpasses}),p+=X.dataLength}}}return p}function T(e,l,c,d,p,u,g,f){var m=f.x1-f.x0,x=f.y1-f.y0,y=new Float32Array(m*x),h={x0:0,x1:0,y0:0,y1:1},E;if(e.hasDecodedCoefficients){for(var I=!0,b=e.subbands,C='LL'!==b[0].type,P=0,T=e.pixelsPrecincts.length,S;P<T;++P){if(S=e.pixelsPrecincts[P],!S.decodedCoefficients){I=!1;continue}var v=t(S,e),L=a(v.x0,f.x0),R=a(v.y0,f.y0),k=o(v.x1,f.x1),A=o(v.y1,f.y1);if(!(L>=k||R>=A))for(var _=S.decodedCoefficients,N=k-L,F=v.x1-v.x0,B=m,M=L-v.x0+(R-v.y0)*F,w=L-f.x0+(R-f.y0)*B,q=R;q<A;++q)y.set(_.subarray(M,M+N),w),M+=F,w+=B}if(I)return y}for(var X=0,s=e.subbands.length;X<s;X++){var H=e.subbands[X],C='LL'!==H.type,E;C?(h.x0=(f.x0-e.trx0)/2+H.tbx0,h.y0=(f.y0-e.try0)/2+H.tby0,h.x1=(f.x1-e.trx0)/2+H.tbx0,h.y1=(f.y1-e.try0)/2+H.tby0,E=h):E=f;var Y='H'===H.type.charAt(0)?1:0,U='H'===H.type.charAt(1)?m:0,C='LL'!==H.type,W=C?2:1,z=m*W,Q={x0:0,y0:0,x1:0,y1:0},V,J;if(!c){V=l[0].mu;var K=H.resolution.resLevel;J=l[0].epsilon+(0<K?1-K:0)}else{var r=H.indexInTileComponent;V=l[r].mu,J=l[r].epsilon}for(var G=O[H.type],Z=u?1:Math.pow(2,d+G-J)*(1+V/2048),$=p+J-1,ee=0,te=H.codeblocks.length,ne;ee<te;++ee)if((ne=H.codeblocks[ee],void 0!==ne.data)&&!ne.precinct.pixelsPrecinct.decodedCoefficients&&(Q.x0=a(ne.tbx0_,E.x0),Q.y0=a(ne.tby0_,E.y0),Q.x1=o(ne.tbx1_,E.x1),Q.y1=o(ne.tby1_,E.y1),!(Q.x0>=Q.x1||Q.y0>=Q.y1))){var ie=(Q.x0-E.x0)*W+(Q.y0-E.y0)*z+(Y+U),re=ne.tbx1_-ne.tbx0_,se=ne.tby1_-ne.tby0_,ae,oe;ae=new D(re,se,ne.subbandType,ne.zeroBitPlanes,$),oe=2;var le=ne.data,ce=0,de=0,pe,j,ue;for(pe=0,j=le.length;pe<j;pe++)ue=le[pe],ce+=ue.end-ue.start,de+=ue.codingpasses;var ge=new Uint8Array(ce),fe=0;for(pe=0,j=le.length;pe<j;pe++){ue=le[pe];var me=ue.data.subarray(ue.start,ue.end);ge.set(me,fe),fe+=me.length}var xe=new i.ArithmeticDecoder(ge,0,ce);for(ae.setDecoder(xe),pe=0;pe<de;pe++)0===oe?ae.runSignificancePropagationPass():1===oe?ae.runMagnitudeRefinementPass():2===oe?(ae.runCleanupPass(),g&&ae.checkSegmentationSymbol()):void 0,oe=(oe+1)%3;for(var ye=ne.tbx0_-L+(ne.tby0_-R)*N,he=ae.coefficentsSign,Ee=ae.coefficentsMagnitude,Ie=ae.bitsDecoded,be=u?0:0.5,Ce=Q.x0-ne.tbx0_+(Q.y0-ne.tby0_)*re,Pe=ie,pe=Q.y0,P,Te,Se;pe<Q.y1;pe++){var fe=Ce,ve=Pe;for(Ce+=re,Pe+=z,P=Q.x0;P<Q.x1;P++)Te=Ee[fe],0!==Te&&(Te=(Te+be)*Z,0!==he[fe]&&(Te=-Te),Se=Ie[fe],y[ve]=u&&Se>=$?Te:Te*(1<<$-Se)),ye++,fe++,ve+=W;ye+=N-re}}}return y}function S(e,t,n){var l=t.components[n],c=l.codingStyleParameters,d=l.quantizationParameters,p=c.decompositionLevelsCount,u=d.SPqcds,g=d.scalarExpounded,f=d.guardBits,m=c.segmentationSymbolUsed,x=e.components[n].precision,y=c.reversibleTransformation,h=y?new j:new _,E;if(void 0!==e.regionToParse){var I=o(l.tcx1,e.regionToParse.right),b=o(l.tcy1,e.regionToParse.bottom);E={x0:a(0,e.regionToParse.left-l.tcx0),y0:a(0,e.regionToParse.top-l.tcy0),x1:I-l.tcx0,y1:b-l.tcy0}}for(var C=[],P={x0:0,y0:0,x1:0,y1:0},S=0;S<=p;S++){var i=l.resolutions[S],v=i.trx1-i.trx0,L=i.try1-i.try0,P;if(void 0===E)P.x0=i.trx0,P.y0=i.try0,P.x1=i.trx1,P.y1=i.try1;else{var O=1<<p-S,R=4;P.x0=s(E.x0/O)-R,P.y0=s(E.y0/O)-R,P.x1=s(E.x1/O)+R,P.y1=s(E.y1/O)+R,P.x0=2*r(P.x0/2)+i.trx0,P.y0=2*r(P.y0/2)+i.try0,P.x1=2*r(P.x1/2)+i.trx0,P.y1=2*r(P.y1/2)+i.try0,P.x0=a(P.x0,i.trx0),P.y0=a(P.y0,i.try0),P.x1=o(P.x1,i.trx1),P.y1=o(P.y1,i.try1)}var k=T(i,u,g,x,f,y,m,P),D={x0:P.x0-i.trx0,y0:P.y0-i.try0,x1:P.x1-i.trx0,y1:P.y1-i.try0};C.push({width:v,height:L,items:k,relativeRegionInLevel:D})}var A=h.calculate(C,l.tcx0,l.tcy0),N=A.relativeRegionInLevel,F=N.x1-N.x0,B=!1;if(void 0!==e.regionToParse&&(B=E.x0!==N.x0||E.y0!==N.y0||E.x1!==N.x1||E.y1!==N.y1),!B){var M=N.y1-N.y0;return{left:l.tcx0,top:l.tcy0,width:F,height:M,items:A.items}}for(var v=E.x1-E.x0,L=E.y1-E.y0,w=A.items,q=new Float32Array(v*L),X=E.y0-N.y0,H=E.x0-N.x0,Y=0,U=H+F*X,S=0,W;S<L;++S)W=U+v,q.set(w.subarray(U,W),Y),U+=F,Y+=v;return{left:l.tcx0+E.x0,top:l.tcy0+E.y0,width:v,height:L,items:q}}function v(e){for(var t=e.SIZ,n=e.components,r=t.Csiz,s=[],a=0,i=e.tiles.length,o;a<i;a++)if(o=e.tiles[a],!(void 0!==e.regionToParse&&(e.regionToParse.left>=o.tx1||e.regionToParse.top>=o.ty1||e.regionToParse.right<=o.tx0||e.regionToParse.bottom<=o.ty0))){var l=[],d;for(d=0;d<r;d++)l[d]=S(e,o,d);var c=l[0],p=new Uint8ClampedArray(c.items.length*r),u={left:c.left,top:c.top,width:c.width,height:c.height,items:p},f=0,m,x,y,h,E,I,b;if(o.codingStyleDefaultParameters.multipleComponentTransform){var C=4===r,P=l[0].items,T=l[1].items,v=l[2].items,L=C?l[3].items:null;m=n[0].precision-8,x=(128<<m)+0.5;var O=o.components[0],R=r-3;if(h=P.length,!O.codingStyleParameters.reversibleTransformation)for(y=0;y<h;y++,f+=R)E=P[y]+x,I=T[y],b=v[y],p[f++]=E+1.402*b>>m,p[f++]=E-0.34413*I-0.71414*b>>m,p[f++]=E+1.772*I>>m;else for(y=0;y<h;y++,f+=R){E=P[y]+x,I=T[y],b=v[y];var k=E-(b+I>>2);p[f++]=k+b>>m,p[f++]=k>>m,p[f++]=k+I>>m}if(C)for(y=0,f=3;y<h;y++,f+=4)p[f]=L[y]+x>>m}else for(d=0;d<r;d++){var g=l[d].items;for(m=n[d].precision-8,x=(128<<m)+0.5,(f=d,y=0,h=g.length);y<h;y++)p[f]=g[y]+x>>m,f+=r}s.push(u)}return s}function L(e,t){for(var n=e.SIZ,i=n.Csiz,r=e.tiles[t],s=0;s<i;s++){var a=r.components[s],o=e.currentTile.QCC[s]===void 0?e.currentTile.QCD:e.currentTile.QCC[s];a.quantizationParameters=o;var l=e.currentTile.COC[s]===void 0?e.currentTile.COD:e.currentTile.COC[s];a.codingStyleParameters=l}r.codingStyleDefaultParameters=e.currentTile.COD}var O={LL:0,LH:1,HL:1,HH:2};e.prototype={parse:function(e){var t=(0,l.readUint16)(e,0);if(65359===t)return void this.parseCodestream(e,0,e.length);for(var n=0,i=e.length;n<i;){var r=8,s=(0,l.readUint32)(e,n),a=(0,l.readUint32)(e,n+4);if(n+=r,1===s&&(s=4294967296*(0,l.readUint32)(e,n)+(0,l.readUint32)(e,n+4),n+=8,r+=8),0===s&&(s=i-n+r),s<r)throw new d('Invalid box field size');var o=s-r,c=!0;switch(a){case 1785737832:c=!1;break;case 1668246642:var p=e[n];if(1===p){var u=(0,l.readUint32)(e,n+3);switch(u){case 16:case 17:case 18:break;default:(0,l.warn)('Unknown colorspace '+u);}}else 2===p&&(0,l.info)('ICC profile not supported');break;case 1785737827:this.parseCodestream(e,n,n+o);break;case 1783636000:218793738!==(0,l.readUint32)(e,n)&&(0,l.warn)('Invalid JP2 signature');break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:var g=String.fromCharCode(255&a>>24,255&a>>16,255&a>>8,255&a);(0,l.warn)('Unsupported header type '+a+' ('+g+')');}c&&(n+=o)}},parseImageProperties:function(e){for(var t=e.getByte();0<=t;){var n=t;t=e.getByte();var i=n<<8|t;if(65361==i){e.skip(4);var r=e.getInt32()>>>0,s=e.getInt32()>>>0,a=e.getInt32()>>>0,o=e.getInt32()>>>0;e.skip(16);var l=e.getUint16();return this.width=r-a,this.height=s-o,this.componentsCount=l,void(this.bitsPerComponent=8)}}throw new d('No size marker found in JPX stream')},parseCodestream:function(e,t,r,s){var a={};s=s||{};var o=!!s.isOnlyParseHeaders,p=s.regionToParse;if(void 0!==p&&o)throw'JPX Error: options.regionToParse is uneffective if options.isOnlyParseHeaders = true';var u=!1;try{for(var g=t,f;g+1<r;){f=(0,l.readUint16)(e,g),g+=2;var m=0,x,y,h,E,I,b;switch(f){case 65359:a.mainHeader=!0;break;case 65497:break;case 65361:m=(0,l.readUint16)(e,g);var T={};T.Xsiz=(0,l.readUint32)(e,g+4),T.Ysiz=(0,l.readUint32)(e,g+8),T.XOsiz=(0,l.readUint32)(e,g+12),T.YOsiz=(0,l.readUint32)(e,g+16),T.XTsiz=(0,l.readUint32)(e,g+20),T.YTsiz=(0,l.readUint32)(e,g+24),T.XTOsiz=(0,l.readUint32)(e,g+28),T.YTOsiz=(0,l.readUint32)(e,g+32);var S=(0,l.readUint16)(e,g+36);T.Csiz=S;var v=[],O=!0;x=g+38;for(var R=0,i;R<S;R++)i={precision:(127&e[x])+1,isSigned:!!(128&e[x]),XRsiz:e[x+1],YRsiz:e[x+2]},x+=3,n(i,T),v.push(i),void 0!==p&&(O&=1===i.XRsiz&&1===i.YRsiz);if(a.SIZ=T,a.components=v,c(a,v),a.QCC=[],a.COC=[],!O)throw new Error('JPX Error: When regionToParse is used, component size other than 1 is not supported');break;case 65372:m=(0,l.readUint16)(e,g);var k={};switch(x=g+2,y=e[x++],31&y){case 0:E=8,I=!0;break;case 1:E=16,I=!1;break;case 2:E=16,I=!0;break;default:throw new Error('Invalid SQcd value '+y);}for(k.noQuantization=8===E,k.scalarExpounded=I,k.guardBits=y>>5,h=[];x<m+g;){var D={};8===E?(D.epsilon=e[x++]>>3,D.mu=0):(D.epsilon=e[x]>>3,D.mu=(7&e[x])<<8|e[x+1],x+=2),h.push(D)}k.SPqcds=h,a.mainHeader?a.QCD=k:(a.currentTile.QCD=k,a.currentTile.QCC=[]);break;case 65373:m=(0,l.readUint16)(e,g);var A={};x=g+2;var _;switch(257>a.SIZ.Csiz?_=e[x++]:(_=(0,l.readUint16)(e,x),x+=2),y=e[x++],31&y){case 0:E=8,I=!0;break;case 1:E=16,I=!1;break;case 2:E=16,I=!0;break;default:throw new Error('Invalid SQcd value '+y);}for(A.noQuantization=8===E,A.scalarExpounded=I,A.guardBits=y>>5,h=[];x<m+g;)D={},8===E?(D.epsilon=e[x++]>>3,D.mu=0):(D.epsilon=e[x]>>3,D.mu=(7&e[x])<<8|e[x+1],x+=2),h.push(D);A.SPqcds=h,a.mainHeader?a.QCC[_]=A:a.currentTile.QCC[_]=A;break;case 65362:m=(0,l.readUint16)(e,g);var j={};x=g+2;var N=e[x++];j.entropyCoderWithCustomPrecincts=!!(1&N),j.sopMarkerUsed=!!(2&N),j.ephMarkerUsed=!!(4&N),j.progressionOrder=e[x++],j.layersCount=(0,l.readUint16)(e,x),x+=2,j.multipleComponentTransform=e[x++],j.decompositionLevelsCount=e[x++],j.xcb=(15&e[x++])+2,j.ycb=(15&e[x++])+2;var F=e[x++];if(j.selectiveArithmeticCodingBypass=!!(1&F),j.resetContextProbabilities=!!(2&F),j.terminationOnEachCodingPass=!!(4&F),j.verticallyStripe=!!(8&F),j.predictableTermination=!!(16&F),j.segmentationSymbolUsed=!!(32&F),j.reversibleTransformation=e[x++],j.entropyCoderWithCustomPrecincts){for(var B=[],M;x<m+g;)M=e[x++],B.push({PPx:15&M,PPy:M>>4});j.precinctsSizes=B}var w=[];if(j.selectiveArithmeticCodingBypass&&w.push('selectiveArithmeticCodingBypass'),j.resetContextProbabilities&&w.push('resetContextProbabilities'),j.terminationOnEachCodingPass&&w.push('terminationOnEachCodingPass'),j.verticallyStripe&&w.push('verticallyStripe'),j.predictableTermination&&w.push('predictableTermination'),0<w.length)throw u=!0,new Error('Unsupported COD options ('+w.join(', ')+')');a.mainHeader?a.COD=j:(a.currentTile.COD=j,a.currentTile.COC=[]);break;case 65424:m=(0,l.readUint16)(e,g),b={},b.index=(0,l.readUint16)(e,g+2),b.length=(0,l.readUint32)(e,g+4),b.dataEnd=b.length+g-2,b.partIndex=e[g+8],b.partsCount=e[g+9],a.mainHeader=!1,0===b.partIndex&&(b.COD=a.COD,b.COC=a.COC.slice(0),b.QCD=a.QCD,b.QCC=a.QCC.slice(0)),a.currentTile=b;break;case 65427:b=a.currentTile,0===b.partIndex&&(L(a,b.index),C(a)),m=b.dataEnd-g,o||P(a,e,g,m);break;case 65365:case 65367:case 65368:case 65380:m=(0,l.readUint16)(e,g);break;case 65363:throw new Error('Codestream code 0xFF53 (COC) is not implemented');default:throw new Error('Unknown codestream code: '+f.toString(16));}g+=m}}catch(t){if(u||this.failOnCorruptedImage)throw new d(t.message);else(0,l.warn)('JPX: Trying to recover from: '+t.message)}return o||this.decode(a,s),this.width=a.SIZ.Xsiz-a.SIZ.XOsiz,this.height=a.SIZ.Ysiz-a.SIZ.YOsiz,this.componentsCount=a.SIZ.Csiz,a},addPacketsData:function(e,t){for(var n=0;n<t.packetDataOffsets.length;++n)for(var r=t.packetDataOffsets[n],s=e.tiles[r.tileIndex],a=s.components[r.c],o=a.resolutions[r.r],l=r.p,c=o.pixelsPrecincts[l].codeblocks,d=0;d<r.codeblockOffsets.length;++d){var i=r.codeblockOffsets[d],p=i.start===i.end;if(!p){var u=c[d];if(void 0===u.data&&(u.data=[]),void 0!==i.zeroBitPlanes){if(void 0===u.zeroBitPlanes&&(u.zeroBitPlanes=i.zeroBitPlanes),u.zeroBitPlanes!==i.zeroBitPlanes)throw'JPX Error: Unmatched zero bit planes';}else if(void 0===u.zeroBitPlanes)throw'JPX Error: zeroBitPlanes is unknown';u.included=!0,u.data.push({data:t.data,start:i.start,end:i.end,codingpasses:i.codingpasses})}}},decodePrecinctCoefficients:function(e,n,i,r,s){var a=e.tiles[n],o=a.components[i],l=o.resolutions[r],c=l.pixelsPrecincts[s],d=o.codingStyleParameters,p=o.quantizationParameters,u=p.SPqcds,g=p.scalarExpounded,f=p.guardBits,m=d.segmentationSymbolUsed,x=e.components[i].precision,y=d.reversibleTransformation,h=t(c,l),E=T(l,u,g,x,f,y,m,h);return E},setPrecinctCoefficients:function(e,t,n,i,r,s){var a=e.tiles[n],o=a.components[i],l=o.resolutions[r],c=l.pixelsPrecincts[s];c.decodedCoefficients=t,l.hasDecodedCoefficients=!0},decode:function(e,t){if(t!==void 0&&t.regionToParse!==void 0){var n=t.regionToParse;if(n.top===void 0||n.left===void 0||n.right===void 0||n.bottom===void 0)throw new Error('JPX Error: Either left, top, right or bottom are undefined in regionToParse');e.regionToParse=n}this.tiles=v(e),e.regionToParse=void 0}};var R=function(){function e(e,t){var n=(0,l.log2)(a(e,t))+1;this.levels=[];for(var r=0,i;r<n;r++)i={width:e,height:t,items:[]},this.levels.push(i),e=s(e/2),t=s(t/2)}return e.prototype={reset:function(e,t){for(var n=0,i=0,r;n<this.levels.length;){r=this.levels[n];var s=e+t*r.width;if(void 0!==r.items[s]){i=r.items[s];break}r.index=s,e>>=1,t>>=1,n++}n--,r=this.levels[n],r.items[r.index]=i,this.currentLevel=n,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return(e--,0>e)?(this.value=n,!1):(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),k=function(){function e(e,t,n){var r=(0,l.log2)(a(e,t))+1;this.levels=[];for(var o=0,i;o<r;o++){i=new Uint8Array(e*t);for(var c=0,d=i.length;c<d;c++)i[c]=n;var p={width:e,height:t,items:i};this.levels.push(p),e=s(e/2),t=s(t/2)}}return e.prototype={reset:function(e,t,n){for(var i=0;i<this.levels.length;){var r=this.levels[i],s=e+t*r.width;r.index=s;var a=r.items[s];if(255===a)break;if(a>n)return this.currentLevel=i,this.propagateValues(),!1;e>>=1,t>>=1,i++}return this.currentLevel=i-1,!0},incrementValue:function(e){var t=this.levels[this.currentLevel];t.items[t.index]=e+1,this.propagateValues()},propagateValues:function(){for(var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];0<=--e;)t=this.levels[e],t.items[t.index]=n},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return(t.items[t.index]=255,e--,!(0>e))&&(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),D=function(){function e(e,t,n,o,l){this.width=e,this.height=t,this.contextLabelTable='HH'===n?a:'HL'===n?s:r;var c=e*t;this.neighborsSignificance=new Uint8Array(c),this.coefficentsSign=new Uint8Array(c),this.coefficentsMagnitude=14<l?new Uint32Array(c):6<l?new Uint16Array(c):new Uint8Array(c),this.processingFlags=new Uint8Array(c);var d=new Uint8Array(c);if(0!==o)for(var p=0;p<c;p++)d[p]=o;this.bitsDecoded=d,this.reset()}var t=17,n=18,r=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),s=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),a=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);return e.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[t]=92,this.contexts[n]=6},setNeighborsSignificance:function(e,t,n){var r=this.neighborsSignificance,s=this.width,a=this.height,o=0<t,l=t+1<s,c;0<e&&(c=n-s,o&&(r[c-1]+=16),l&&(r[c+1]+=16),r[c]+=4),e+1<a&&(c=n+s,o&&(r[c-1]+=16),l&&(r[c+1]+=16),r[c]+=4),o&&(r[n-1]+=1),l&&(r[n+1]+=1),r[n]|=128},runSignificancePropagationPass:function(){for(var e=this.decoder,t=this.width,n=this.height,r=this.coefficentsMagnitude,s=this.coefficentsSign,a=this.neighborsSignificance,o=this.processingFlags,l=this.contexts,c=this.contextLabelTable,d=this.bitsDecoded,p=0;p<n;p+=4)for(var u=0,g;u<t;u++){g=p*t+u;for(var f=0,m;4>f&&(m=p+f,!(m>=n));f++,g+=t)if(o[g]&=-2,!r[g]&&a[g]){var i=c[a[g]],x=e.readBit(l,i);if(x){var y=this.decodeSignBit(m,u,g);s[g]=y,r[g]=1,this.setNeighborsSignificance(m,u,g),o[g]|=2}d[g]++,o[g]|=1}}},decodeSignBit:function(e,t,n){var i=this.width,r=this.height,s=this.coefficentsMagnitude,a=this.coefficentsSign,o,l,c,d,p,u;d=0<t&&0!==s[n-1],t+1<i&&0!==s[n+1]?(c=a[n+1],d?(l=a[n-1],o=1-c-l):o=1-c-c):d?(l=a[n-1],o=1-l-l):o=0;var g=3*o;return d=0<e&&0!==s[n-i],e+1<r&&0!==s[n+i]?(c=a[n+i],d?(l=a[n-i],o=1-c-l+g):o=1-c-c+g):d?(l=a[n-i],o=1-l-l+g):o=g,0<=o?(p=9+o,u=this.decoder.readBit(this.contexts,p)):(p=9-o,u=1^this.decoder.readBit(this.contexts,p)),u},runMagnitudeRefinementPass:function(){for(var e=this.decoder,t=this.width,n=this.height,i=this.coefficentsMagnitude,r=this.neighborsSignificance,s=this.contexts,a=this.bitsDecoded,l=this.processingFlags,c=1,d=2,p=t*n,u=0,g;u<p;u=g){g=o(p,u+4*t);for(var f=0;f<t;f++)for(var m=u+f;m<g;m+=t)if(i[m]&&0==(l[m]&c)){var x=16;if(0!=(l[m]&d)){l[m]^=d;var y=127&r[m];x=0==y?15:14}var h=e.readBit(s,x);i[m]=i[m]<<1|h,a[m]++,l[m]|=c}}},runCleanupPass:function(){for(var e=this.decoder,r=this.width,s=this.height,a=this.neighborsSignificance,l=this.coefficentsMagnitude,c=this.coefficentsSign,d=this.contexts,p=this.contextLabelTable,u=this.bitsDecoded,g=this.processingFlags,f=2,m=r,x=2*r,y=3*r,h=0,E;h<s;h=E){E=o(h+4,s);for(var I=h*r,b=h+3<s,C=0;C<r;C++){var P=I+C,T=b&&0===g[P]&&0===g[P+m]&&0===g[P+x]&&0===g[P+y]&&0===a[P]&&0===a[P+m]&&0===a[P+x]&&0===a[P+y],S=0,v=P,L=h,i;if(T){var O=e.readBit(d,n);if(!O){u[P]++,u[P+m]++,u[P+x]++,u[P+y]++;continue}S=e.readBit(d,t)<<1|e.readBit(d,t),0!=S&&(L=h+S,v+=S*r),i=this.decodeSignBit(L,C,v),c[v]=i,l[v]=1,this.setNeighborsSignificance(L,C,v),g[v]|=f,v=P;for(var R=h;R<=L;R++,v+=r)u[v]++;S++}for(L=h+S;L<E;L++,v+=r)if(!(l[v]||0!=(g[v]&1))){var k=p[a[v]],D=e.readBit(d,k);1===D&&(i=this.decodeSignBit(L,C,v),c[v]=i,l[v]=1,this.setNeighborsSignificance(L,C,v),g[v]|=f),u[v]++}}}},checkSegmentationSymbol:function(){var e=this.decoder,n=this.contexts,i=e.readBit(n,t)<<3|e.readBit(n,t)<<2|e.readBit(n,t)<<1|e.readBit(n,t);if(10!=i)throw new d('Invalid segmentation symbol')}},e}(),A=function(){function e(){}return e.prototype.calculate=function(e,t,n){for(var r=e[0],s=1,i=e.length;s<i;s++)r=this.iterate(r,e[s],t,n);return r},e.prototype.extend=function(e,t,n){var i=t-1,r=t+1,s=t+n-2,a=t+n;e[i--]=e[r++],e[a++]=e[s--],e[i--]=e[r++],e[a++]=e[s--],e[i--]=e[r++],e[a++]=e[s--],e[i]=e[r],e[a]=e[s]},e.prototype.iterate=function(e,t,n,r){var s=t.relativeRegionInLevel;if(2*e.relativeRegionInLevel.x0>s.x0||2*e.relativeRegionInLevel.y0>s.y0||2*e.relativeRegionInLevel.x1<s.x1||2*e.relativeRegionInLevel.y1<s.y1)throw new Error('JPX Error: region in LL is smaller than region in higher resolution level');if(0!=s.x0%2||0!=s.y0%2)throw new Error('JPX Error: region in HL/LH/HH subbands begins in odd coefficients');var a=e.items,c=s.x1-s.x0,d=s.y1-s.y0,p=e.relativeRegionInLevel.x1-e.relativeRegionInLevel.x0,g=s.x0/2-e.relativeRegionInLevel.x0,f=s.y0/2-e.relativeRegionInLevel.y0,m=t.items,x,i,y,h,l,u;for(x=0;x<d;x+=2)for(h=x*c,y=g+f*p+p*x/2,i=0;i<c;i+=2,y++,h+=2)m[h]=a[y];a=e.items=null;var E=4,I=new Float32Array(c+2*E);if(1!=c)for(u=0,y=0;u<d;u++,y+=c)I.set(m.subarray(y,y+c),E),this.extend(I,E,c),this.filter(I,E,c),m.set(I.subarray(E,E+c),y);else if(0!=(1&n))for(u=0,y=0;u<d;u++,y+=c)m[y]*=0.5;var C=16,P=[];for(x=0;x<C;x++)P.push(new Float32Array(d+2*E));var T=0,S;if(e=E+d,1!=d)for(l=0;l<c;l++){if(0==T){for(C=o(c-l,C),y=l,h=E;h<e;y+=c,h++)for(S=0;S<C;S++)P[S][h]=m[y+S];T=C}T--;var b=P[T];if(this.extend(b,E,d),this.filter(b,E,d),0===T)for(y=l-C+1,h=E;h<e;y+=c,h++)for(S=0;S<C;S++)m[y+S]=P[S][h]}else if(0!=(1&r))for(l=0;l<c;l++)m[l]*=0.5;return{relativeRegionInLevel:s,width:c,height:d,items:m}},e}(),_=function(){function e(){A.call(this)}return e.prototype=Object.create(A.prototype),e.prototype.filter=function(e,t,i){var r=i>>1;t|=0;var s=-1.586134342059924,a=-0.052980118572961,o=0.882911075530934,l=0.443506852043971,c=1.230174104914001,d,p,n,u;for(d=t-3,p=r+4;p--;d+=2)e[d]*=1/c;for(d=t-2,n=l*e[d-1],p=r+3;p--&&(u=l*e[d+1],e[d]=c*e[d]-n-u,p--);d+=2)d+=2,n=l*e[d+1],e[d]=c*e[d]-n-u;for(d=t-1,n=o*e[d-1],p=r+2;p--&&(u=o*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=o*e[d+1],e[d]-=n+u;for(d=t,n=a*e[d-1],p=r+1;p--&&(u=a*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=a*e[d+1],e[d]-=n+u;if(0!=r)for(d=t+1,n=s*e[d-1],p=r;p--&&(u=s*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=s*e[d+1],e[d]-=n+u},e}(),j=function(){function e(){A.call(this)}return e.prototype=Object.create(A.prototype),e.prototype.filter=function(e,t,i){var r=i>>1;t|=0;var s,a;for(s=t,a=r+1;a--;s+=2)e[s]-=e[s-1]+e[s+1]+2>>2;for(s=t+1,a=r;a--;s+=2)e[s]+=e[s-1]+e[s+1]>>1},e}();return e}();t.JpxImage=c},function(e,t,n){'use strict';var i=n(5),r=n(6),s=n(7),a=n(8),o=n(9),l=n(10),c=n(11),d=n(12),p=n(13),u=n(14),g=n(15),f=n(16),m=n(17),x=n(18),y=n(19),h=n(20),E=n(21),I=n(22),b=n(23),C=n(24),P=n(25),T=n(26),S=n(27),v=n(28),L=n(29),O=n(30),R=n(31),k=n(32),D=n(33),A=n(34),_=n(35),j=n(36),N=n(37),F=n(38),B=n(39),M=n(40),w=n(41),q={createChannel:function(e,t){return new o(e,t,q)},createCodestreamReconstructor:function(e,t,n){return new l(e,t,n)},createLevelCalculator:function(e){return new h(e)},createCodestreamStructure:function(e,t){return new c(e,q,t)},createComponentStructure:function(e,t){return new d(e,t)},createCompositeArray:function(e){return new p(e)},createDatabinParts:function(e,t){return new u(e,t,q)},createDatabinsSaver:function(e){return new g(e,q)},createFetcher:function(e,t){return new m(e,t,q)},createFetch:function(e,t,n){return new f(e,t,n)},createHeaderModifier:function(e,t){return new x(e,t)},createImageDataContext:function(e,t,n,i){return new y(e,t,n,i)},createMarkersParser:function(e){return new E(e,a,q)},createOffsetsCalculator:function(e,t){return new I(e,t)},createPacketsDataCollector:function(e,t){return new b(e,t,q)},createParamsCodestreamPart:function(e,t){return new C(e,t,q)},createParamsPrecinctIterator:function(e,t,n,i){return new P(e,t,n,i)},createPrecinctCodestreamPart:function(e,t,n,i,r,s,a){return new T(e,t,n,i,r,s,a)},createPrecinctsIteratorWaiter:function(e,t,n,i){return new S(e,t,n,i,q)},createQualityWaiter:function(e,t,n,i,r,s,a){return new v(e,t,n,i,r,s,a,q)},createRequestParamsModifier:function(e){return new L(e)},createRequest:function(e,t,n,i,r){return new O(e,a,t,n,i,r)},createSessionHelper:function(e,t,n,r){return new R(e,t,n,r,i)},createSession:function(e,t,n,i,r){return new k(e,t,n,i,r,setInterval,clearInterval,q)},createReconnectableRequester:function(e,t,n,i){return new D(e,t,n,i,q)},createStructureParser:function(e,t,n){return new A(e,t,a,n)},createTileStructure:function(e,t,n){return new _(e,t,q,n)},createBitstreamReader:function(e){return new j(e,r)},createTagTree:function(e,t,n){return new N(e,t,n,r)},createCodeblockLengthParser:function(e){return new F(e,r)},createSubbandLengthInPacketHeaderCalculator:function(e,t,n){return new B(e,t,n,s,r,q)},createPacketLengthCalculator:function(e,t,n,i,r){return new M(e,t,n,i,r,q)},createQualityLayersCache:function(e){return new w(e,q)}};e.exports=q},function(e,t,n){'use strict';var i=n(0);e.exports.JpipImage=n(4),e.exports.j2kExceptions=i.j2kExceptions,e.exports.jpipExceptions=i.jpipExceptions,e.exports.Internals={PdfjsJpxDecoderLegacy:n(42),PdfjsJpxPixelsDecoder:n(45),PdfjsJpxCoefficientsDecoder:n(46),jpipRuntimeFactory:n(2),jGlobals:i}},function(e,t,n){'use strict';function i(e){function t(e){function t(){f||(f=!0,g.unregister())}var n=P.modify(e.key),i=s.createParamsCodestreamPart(n.codestreamPartParams,y),r=0,a=[],l=[],d=0,u=!1,g;e.on('dependencyTaskData',function(e,t){var i=a[t.inClassIndex];if(!l[i]){if(e.minQuality!==n.progressiveness[0].minNumQualityLayers)throw'jpip error: Unexpected quality as min quality data';l[i]=e,++d}g.precinctQualityLayerReached(t.inClassIndex,e.minQuality)});var f=!1;e.on('statusUpdated',function(e){if(!f&&!e.isWaitingForWorkerResult&&e.terminatedDependsTasks===e.dependsTasks)throw'jpip error: Unexpected unended task without pending depend tasks'}),e.on('custom',function(e){'aborting'===e&&t()}),g=s.createQualityWaiter(i,n.progressiveness,e.key.maxQuality,function(){if(null==m&&(m=I.createHeadersCodestream(i),x=c(i,n.codestreamPartParams),h=y.getNumTilesX(),E=i.tilesBounds),!u){if(d<l.length)throw'webjpip error: Min quality layer data missing';u=!0,e.dataReady({headersCodestream:m,offsetInRegion:x,imageTilesX:h,tilesBounds:E,precinctCoefficients:l},o,!1)}1<g.getProgressiveStagesFinished()&&e.dataReady({headersCodestream:m,offsetInRegion:x,imageTilesX:h,tilesBounds:E,precinctCoefficients:e.dependTaskResults},o,!0),g.isDone()&&(t(),e.terminate())},y,p,function(t,i,s,o,l){a[o]=r++;var c=l.precinctPositionToIndexInComponentResolution(s);e.registerTaskDependency({taskType:'COEFFS',tileIndex:s.tileIndex,resolutionLevel:s.resolutionLevel,precinctX:s.precinctX,precinctY:s.precinctY,component:s.component,maxQuality:n.codestreamPartParams.quality,inClassIndex:o,precinctIndexInComponentResolution:c,progressiveness:n.progressiveness})}),g.register();var m=null,x=null,h,E}function n(e){function t(t){if(r!==t)throw'webjpip error: Unexpected context in data event';a=!0;var i=r.getProgressiveStagesFinished();if(!o){o=!0;var s=r.getFetchedData(e.key.progressiveness[0].minNumQualityLayers);e.dataReady(s,l,!1)}if(1<i){var c=r.getFetchedData();e.dataReady(c,l,!0)}if(r.isDone()){if(!a)throw'webjpip error: Coefficients task without data';n(),e.terminate()}}function n(){c||(c=!0,r.dispose())}var i=s.createPrecinctCodestreamPart(d(),y.getTileStructure(e.key.tileIndex),e.key.tileIndex,e.key.component,e.key.resolutionLevel,e.key.precinctX,e.key.precinctY);e.on('custom',function(e){'aborting'===e&&n()});var r=s.createImageDataContext(C,i,e.key.maxQuality,e.key.progressiveness),a=!1,o=!1,c=!1;r.on('data',t),0<r.getProgressiveStagesFinished()&&t(r)}function c(e,t){if(t){var n=e.getTileIterator();if(!n.tryAdvance())throw new a.jpipExceptions.InternalErrorException('Empty codestreamPart in JpipImageDataContext');var i=n.tileIndex,r=y.getTileLeft(i,e.level),s=y.getTileTop(i,e.level);return{offsetX:t.minX-r,offsetY:t.minY-s,width:t.maxXExclusive-t.minX,height:t.maxYExclusive-t.minY}}return{offsetX:0,offsetY:0,width:y.getImageWidth(),height:y.getImageHeight()}}function d(){return null==S&&(S=s.createLevelCalculator(T)),S}var p=s.createDatabinsSaver(!1),u=p.getMainHeaderDatabin(),g=s.createMarkersParser(u),f=s.createOffsetsCalculator(u,g),m=s.createStructureParser(p,g,f),x='RPCL',y=s.createCodestreamStructure(m,x),h=s.createQualityLayersCache(y),E=s.createHeaderModifier(f,x),I=s.createCodestreamReconstructor(p,E,h),b=s.createPacketsDataCollector(p,h),C={reconstructor:I,packetsDataCollector:b,qualityLayersCache:h,codestreamStructure:y,databinsSaver:p,jpipFactory:s},P=s.createRequestParamsModifier(y),T=null,S=null,v=s.createFetcher(p,e);this.opened=function(e){T=e.getImageParams()},this.getLevelCalculator=d,this.getDecoderWorkersInputRetreiver=function(){return this},this.getFetcher=function(){return v},this.getWorkerTypeOptions=function(e){switch(e){case o:return{ctorName:'webjpip.Internals.PdfjsJpxPixelsDecoder',ctorArgs:[],scriptsToImport:[r(new Error)],pathToTransferablesInPromiseResult:[[0,'data','buffer']]};case l:return{ctorName:'webjpip.Internals.PdfjsJpxCoefficientsDecoder',ctorArgs:[],scriptsToImport:[r(new Error)],transferables:[[0,'headersCodestream','buffer'],[0,'codeblocksData','data','buffer']],pathToTransferablesInPromiseResult:[[0,'coefficients','buffer']]};default:throw'webjpip error: Unexpected worker type in getWorkerTypeOptions '+e;}},this.getKeyAsString=function(e){if('COEFFS'===e.taskType)return'C:'+e.inClassIndex;var t=P.modify(e),n=t.codestreamPartParams;return'P:xmin'+n.minX+'ymin'+n.minY+'xmax'+n.maxXExclusive+'ymax'+n.maxYExclusive+'r'+n.level+'q'+n.quality},this.taskStarted=function(e){'COEFFS'===e.key.taskType?n(e):t(e)};i.useLegacy&&(this.getWorkerTypeOptions=function(){return{ctorName:'webjpip.Internals.PdfjsJpxDecoderLegacy',ctorArgs:[],scriptsToImport:[r(new Error)],transferables:[[0,'headersCodestream','buffer'],[0,'codeblocksData','data','buffer']],pathToTransferablesInPromiseResult:[[]]}},this.getKeyAsString=function(e){return JSON.stringify(e)},this.taskStarted=function(e){function t(t){if(r!==t)throw'webjpip error: Unexpected context in data event';var n=r.getFetchedData();n.offsetInRegion=a,e.dataReady(n,!0),r.isDone()&&(e.terminate(),r.dispose())}var n=P.modify(e.key),i=s.createParamsCodestreamPart(n.codestreamPartParams,y),r=s.createImageDataContext(C,i,n.codestreamPartParams.quality,n.progressiveness),a=c(i,n.codestreamPartParams);r.on('data',t),r.hasData()&&t(r)})}function r(e){var t=e.stack.trim(),n=c.exec(t);if(n&&''!==n[2])return n[2];if(n=d.exec(t),n&&''!==n[1])return n[1];if(n=p.exec(t),n&&''!==n[1])return n[1];if(void 0!==e.fileName)return e.fileName;throw'webjpip.js: Could not get current script URL'}var s=n(2),a=n(0);e.exports=i;var o=1,l=2;i.toggleLegacy=function(){i.useLegacy=!i.useLegacy};var c=/at (|[^ ]+ \()([^ ]+):\d+:\d+/,d=new RegExp(/.+@(.*?):\d+:\d+/),p=new RegExp(/.+\/(.*?):\d+(:\d+)*$/)},function(e,t,n){'use strict';var i=n(0);e.exports={request:function(e,t,n,r){function s(){if(!l){if(4!==a.readyState){if(void 0===r||null===a.response||3>a.readyState)return;var e=a.response.byteLength,i=e-c;if(i<r)return;c=e}else if(l=!0,200!==a.status||null===a.response)return void n(a);o||t(a,l)}}var a=new XMLHttpRequest,o=void 0===t,l=!1,c=0;if(a.open('GET',e,!o),a.onreadystatechange=s,o||(a.mozResponseType=a.responseType='arraybuffer'),void 0!==r&&(a.setRequestHeader('X-Content-Type-Options','nosniff'),a.onprogress=s),a.send(null),o&&!l)throw new i.jpipExceptions.InternalErrorException('synchronous ajax call was not finished synchronously');return a}}},function(e,t,n){'use strict';var i=n(0);e.exports={createTransaction:function(){function e(e){if(!n.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot terminate an already terminated transaction');t=e?2:3}var t=1,n={get isAborted(){return 3==t},get isActive(){return 1==t},commit:function(){e(!0)},abort:function(){e(!1)}};return n},createTransactionalObject:function(e,t){function n(e){if(!e.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot use terminated transaction to access objects');if(e!==a&&a.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot simultanously access transactional object from two active transactions')}var r=null,s=e,a={isActive:!1,isAborted:!0},o=t?function(e){return e}:function(e){var t=JSON.parse(JSON.stringify(e));return t};return{getValue:function(e){return(n(e),a===e)?r:(a.isAborted?r=o(s):s=o(r),a=e,r)},setValue:function(e,t){return n(e),a===e?void(r=t):void(!a.isAborted&&(s=o(r)),a=e,r=t)}}}}},function(e){'use strict';e.exports=function(){var e=function(){var e=Array(17);return e[0]=0,e[1]=0,e[2]=1,e[3]=0,e[4]=4,e[5]=3,e[6]=2,e[7]=1,e[8]=0,e[9]=6,e[10]=5,e[11]=4,e[12]=3,e[13]=2,e[14]=1,e[15]=0,e[16]=0,e}(),t=function(){var e=Array(17);return e[0]=1,e[1]=2,e[2]=3,e[3]=5,e[4]=6,e[5]=22,e[6]=30,e[7]=34,e[8]=36,e[9]=37,e[10]=101,e[11]=133,e[12]=149,e[13]=157,e[14]=161,e[15]=163,e[16]=164,e}();return{parse:function(n){var i=n.countOnesAndShiftUntilFirstZeroBit(16);if(null===i)return null;var r=e[i],s=n.shiftBits(r);if(null===s)return null;var a=t[i];return s+a}}}()},function(e,t,n){'use strict';var i=n(0),r={LSB_MASK:1,BIT_4_MASK:16,BITS_56_MASK:96,MSB_MASK:128,LSB_7_MASK:127,parseNumberInVbas:function(e,t,n){var i=r,s=t,a;if(n){a=e[s]&(1<<n)-1}else a=e[s]&i.LSB_7_MASK;for(;!!(e[s]&i.MSB_MASK);)++s,a<<=7,a|=e[s]&i.LSB_7_MASK;return{endOffset:s+1,number:a}},parseMessageHeader:function(e,t,n){var s=r,a=(e[t]&s.BITS_56_MASK)>>>5;if(0==a)throw new i.jpipExceptions.ParseException('Failed parsing message header (A.2.1): prohibited existance class and csn bits 00');var o=!!(e[t]&s.BIT_4_MASK),l=s.parseNumberInVbas(e,t,4),c=l.number,d=l.endOffset,p=0;if(!!(2&a)){var u=s.parseNumberInVbas(e,d);p=u.number,d=u.endOffset}else n&&(p=n.classId);var g=0;if(3==a){var f=s.parseNumberInVbas(e,d);g=f.number,d=f.endOffset}else n&&(g=n.codestreamIndex);var m=s.parseNumberInVbas(e,d),x=m.number;d=m.endOffset;var y=s.parseNumberInVbas(e,d),h=y.number;d=y.endOffset;var E=!!(p&s.LSB_MASK),I;if(E){var b=s.parseNumberInVbas(e,d);I=b.number,d=b.endOffset}var C={isLastByteInDatabin:o,inClassId:c,bodyStart:d,classId:p,codestreamIndex:g,messageOffsetFromDatabinStart:x,messageBodyLength:h};return E&&(C.aux=I),C},getInt32:function(e,t){var n=16777216*e[t],i=e[t+1]<<16,r=e[t+2]<<8,s=e[t+3];return n+i+r+s},getInt16:function(e,t){var n=e[t]<<8,i=e[t+1];return n+i}};e.exports=r},function(e,t,n){'use strict';var r=n(0);e.exports=function(e,t,n){function i(){var e=p.length+d.length;return e}function s(e){var n=t.getDataRequestUrl(),i=t.getTargetId();'0'!==i&&(n+='&tid='+i);var r=null!==l;if(r){var s=u&&e;n+=s?'&wait=no':'&wait=yes'}return n}function a(e,n){var i=s(!0),r=t.getCodestreamStructure(),a=r.getLevelWidth(e.level),o=r.getLevelHeight(e.level),l=e.maxXExclusive-e.minX,c=e.maxYExclusive-e.minY;return i+='&fsiz='+a+','+o+',closest&rsiz='+l+','+c+'&roff='+e.minX+','+e.minY,'max'!==n&&(i+='&layers='+n),i}var o=this,l=null,c=0,d=[],p=[],u=!1;this.requestData=function(s,c,g,f){if(!u){var m=i();if(m>=e)throw new r.jpipExceptions.InternalErrorException('Channel has too many requests not responded yet')}var x=a(s,f),y=n.createRequest(t,o,x,c,g);return null!=l||0===p.length?(p.push(y),y.startRequest()):u?d=[y]:d.push(y),y},this.sendMinimalRequest=function(e){if(null==l&&0<p.length)throw new r.jpipExceptions.InternalErrorException('Minimal requests should be used for first request or keep alive message. Keep alive requires an already initialized channel, and first request requires to not have any previous request');var i=s(),a=n.createRequest(t,o,i,e);p.push(a),a.startRequest()},this.getIsDedicatedForMovableRequest=function(){return u},this.dedicateForMovableRequest=function(){if(u)throw new r.jpipExceptions.InternalErrorException('Channel already dedicated for movable request');u=!0},this.getChannelId=function(){return l},this.setChannelId=function(e){if(null!==e){l=e;var t=d;d=[];for(var n=0;n<t.length;++n)p.push(t[n]),t[n].startRequest()}},this.nextRequestId=function(){return++c},this.getRequestsWaitingForResponse=function(){return p},this.getAllQueuedRequestCount=i,this.requestEnded=function(e,n){for(var s=p,a=!1,c=0;c<s.length;++c)if(s[c]===n){s[c]=s[s.length-1],s.length-=1,a=!0;break}if(!a)throw new r.jpipExceptions.InternalErrorException('channel.requestsWaitingForResponse inconsistency');if(t.requestEnded(e,o),null===l&&0<d.length){var i=d.shift();p.push(i),i.startRequest()}},this.isAllOldRequestsEnded=function(e){for(var t=0;t<p.length;++t)if(p[t].lastRequestId<=e)return!1;return!0}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function r(e,t,n,r){var a=s(g,e,t,n,r);if(null===a)return null;var o=new Uint8Array(a),l=s(o,e,t,n,r);if(l===a)return o;if(null===l)return null;throw new i.jpipExceptions.InternalErrorException('JpipCodestreamReconstructor: Unmatched actualLength '+l+' and calculatedLength '+a)}function s(e,n,r,s,l){var c=a(e,n.level);if(null===c)return null;for(var d=0,u=n.getTileIterator();u.tryAdvance();){var g=u.tileIndex,f=o(e,c,d++,u,n.level,r,s,l);if(c+=f,null===f)return null}var m=p(e,c,i.j2kMarkers.EndOfCodestream);return c+=m,t.modifyImageSize(e,n.fullTilesSize),null===e?null:c}function a(n,r){if(e.getIsJpipTilePartStream())throw new i.jpipExceptions.UnsupportedFeatureException('reconstruction of codestream from JPT (Jpip Tile-part) stream','A.3.4');var s=e.getMainHeaderDatabin(),a=s.copyBytes(n,0,{forceCopyAllRange:!0});if(null===a)return null;var o=t.modifyMainOrTileHeader(n,s,0,r);return a+=o,o=d(n,a),a+=o,a}function o(n,i,r,s,a,o,d,p){var u=s.tileIndex,g=i,f=e.getTileHeaderDatabin(u),m=l(n,i,f,r,a);if(null===m)return null;if(i=m.endTileHeaderOffset,!p){var x=c(n,i,s,o,d);if(i+=x,null===x)return null}var y=i,h=y-m.startOfTileHeaderOffset;t.modifyInt32(n,m.headerAndDataLengthPlaceholderOffset,h);return y-g}function l(e,n,r,s,a){var o=n,l=p(e,n,i.j2kMarkers.StartOfTile);n+=l;l=p(e,n,[0,10]),n+=l;l=p(e,n,[s>>>8,255&s]),n+=l;var c=n;l=p(e,n,[0,0,0,0]),n+=l;l=p(e,n,[0]),n+=l;l=p(e,n,[1]),n+=l;var d=n;if(l=r.copyBytes(e,n,{forceCopyAllRange:!0}),n+=l,null===l)return null;var u=[,,],g=r.getDatabinLengthIfKnown();r.copyBytes(u,0,{databinStartOffset:g-2});var f=u[0]===i.j2kMarkers.StartOfData[0]&&u[1]===i.j2kMarkers.StartOfData[1];f||(l=p(e,n,i.j2kMarkers.StartOfData),n+=l);var m=t.modifyMainOrTileHeader(e,r,d,a);n+=m;var x={startOfTileHeaderOffset:o,headerAndDataLengthPlaceholderOffset:c,endTileHeaderOffset:n};return x}function c(t,r,s,a,o){var l=s.tileStructure.getNumQualityLayers(),c=0;'max'===a&&(a=l);for(var d=s.createPrecinctIterator(!0);d.tryAdvance();){var p=l;if(d.isInCodestreamPart){var u=s.tileStructure.precinctPositionToInClassIndex(d),g=e.getPrecinctDatabin(u),f=n.getQualityLayerOffset(g,o,d),m=f.endOffset;if(p=l-f.numQualityLayers,f.numQualityLayers<a)return null;var x=g.copyBytes(t,r,{forceCopyAllRange:!0,maxLengthToCopy:m});null===x&&(x=0,p=l),c+=x,r+=x}if(!t.isDummyBufferForLengthCalculation)for(var y=0;y<p;++y)t[r++]=0;c+=p}return c}function d(e,t){var n=t;u(e,t++,255),u(e,t++,100),u(e,t++,0),u(e,t++,9),u(e,t++,77),u(e,t++,97),u(e,t++,109),u(e,t++,97),u(e,t++,122),u(e,t++,97),u(e,t++,118);var i=t-n;return i}function p(e,t,n){if(!e.isDummyBufferForLengthCalculation)for(var r=0;r<n.length;++r)e[r+t]=n[r];return n.length}function u(e,t,n){e.isDummyBufferForLengthCalculation||(e[t]=n)}var g={isDummyBufferForLengthCalculation:!0};this.createCodestream=function(e,t,n){return r(e,t,n)},this.createHeadersCodestream=function(e){var t=1;return r(e,t,t,!0)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function r(e,t,n){if(0>t||t>=n)throw new i.jpipExceptions.ArgumentException(e,t,e+' is expected to be between 0 and '+n-1)}function s(t){if(!u){var n=e.parseDefaultTileParams();u=[,,,];for(var i=0;3>i;++i){u[i]=[,,,];for(var r=0,s;3>r;++r)s={horizontalEdgeType:i,verticalEdgeType:r},u[i][r]=a(n,s)}}var o=u[t.horizontalEdgeType],l=o[t.verticalEdgeType];return l}function a(e,r){o();var s=JSON.parse(JSON.stringify(e));s.tileSize=p.getTileSize(r),s.defaultComponentParams.scaleX=1,s.defaultComponentParams.scaleY=1;for(var a=0;a<s.paramsPerComponent.length;++a)s.paramsPerComponent[a].scaleX=d.componentsScaleX[a],s.paramsPerComponent[a].scaleY=d.componentsScaleY[a];var i=t.createTileStructure(s,l,n);return i}function o(){d||(d=e.parseCodestreamStructure(),p=t.createLevelCalculator(d))}var l=this,c=[],d,p,u;return this.getSizesParams=function(){return o(),d},this.getNumTilesX=function(){o();var e=p.getNumTilesX();return e},this.getNumTilesY=function(){o();var e=p.getNumTilesY();return e},this.getNumComponents=function(){return o(),d.numComponents},this.getImageWidth=function(){o();var e=p.getLevelWidth();return e},this.getImageHeight=function(){o();var e=p.getLevelHeight();return e},this.getLevelWidth=function(e){o();var t=p.getLevelWidth(e);return t},this.getLevelHeight=function(e){o();var t=p.getLevelHeight(e);return t},this.getTileWidth=function(e){o();var t=p.getTileWidth(e);return t},this.getTileHeight=function(e){o();var t=p.getTileHeight(e);return t},this.getFirstTileOffsetX=function(){o();var e=p.getFirstTileOffsetX();return e},this.getFirstTileOffsetY=function(){o();var e=p.getFirstTileOffsetY();return e},this.getTileLeft=function(e,t){o();var n=e%p.getNumTilesX();if(0==n)return 0;var i=(n-1)*p.getTileWidth(t)+p.getFirstTileWidth(t);return i},this.getTileTop=function(e,t){o();var n=Math.floor(e/p.getNumTilesX());if(0===n)return 0;var i=(n-1)*p.getTileHeight(t)+p.getFirstTileHeight(t);return i},this.getDefaultTileStructure=function(){o();var e=s({horizontalEdgeType:p.EDGE_TYPE_NO_EDGE,verticalEdgeType:p.EDGE_TYPE_NO_EDGE});return e},this.getTileStructure=function(t){o();var n=p.getNumTilesX()*p.getNumTilesY()-1;if(0>t||t>n)throw new i.jpipExceptions.ArgumentException('tileId',t,'Expected value between 0 and '+n);var r=p.isEdgeTileId(t);if(void 0===c[t]){var l=e.parseOverridenTileParams(t);c[t]=l?a(l,r):null}if(c[t])return c[t];var d=s(r);return d},this.tilePositionToInClassIndex=function(e){o();var t=p.getNumTilesX(),n=p.getNumTilesY();r('tilePosition.tileX',e.tileX,t),r('tilePosition.tileY',e.tileY,n);var i=e.tileX+e.tileY*t;return i},this.tileInClassIndexToPosition=function(e){o();var t=p.getNumTilesX(),n=p.getNumTilesY();r('inClassIndex',e,t*n);var i=e%t;return{tileX:i,tileY:(e-i)/t}},this.getTilesFromPixels=function(e){return o(),p.getTilesFromPixels(e)},this.getSizeOfTiles=function(e){o();var t=p.getSizeOfTiles(e);return t},this}},function(e,t,n){'use strict';var i=Math.floor,r=Math.ceil,s=n(0);e.exports=function(e,t){function n(e,t,n){var i=o(n),s=t[n],a=r(e/i/s);return a}function a(e,t,n,i,s){var a=o(e.resolutionLevel),l=r(s/a),c=t*i[e.resolutionLevel],d=Math.min(i[e.resolutionLevel],l-c),p=0===e.resolutionLevel?1:2,u=r(d/p),g=p*r(u/n);return 1==d%n&&0<e.resolutionLevel&&--g,g}function o(t){var n=e.numResolutionLevels-t-1;return 1<<n}var l,c;(function(){if(1!==e.scaleX||1!==e.scaleY)throw new s.j2kExceptions.UnsupportedFeatureException('Non 1 component scale','A.5.1');l=i(t.getTileWidth()/e.scaleX),c=i(t.getTileHeight()/e.scaleY)})(),this.getComponentScaleX=function(){return e.scaleX},this.getComponentScaleY=function(){return e.scaleY},this.getNumResolutionLevels=function(){return e.numResolutionLevels},this.getPrecinctWidth=function(t){var n=e.precinctWidthPerLevel[t];return n},this.getPrecinctHeight=function(t){var n=e.precinctHeightPerLevel[t];return n},this.getMaxCodeblockWidth=function(){var t=e.maxCodeblockWidth;return t},this.getMaxCodeblockHeight=function(){var t=e.maxCodeblockHeight;return t},this.getNumCodeblocksXInPrecinct=function(t){var n=a(t,t.precinctX,e.maxCodeblockWidth,e.precinctWidthPerLevel,l);return n},this.getNumCodeblocksYInPrecinct=function(t){var n=a(t,t.precinctY,e.maxCodeblockHeight,e.precinctHeightPerLevel,c);return n},this.getNumPrecinctsX=function(t){var i=n(l,e.precinctWidthPerLevel,t);return i},this.getNumPrecinctsY=function(t){var i=n(c,e.precinctHeightPerLevel,t);return i}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e){function t(t,n){if(t===void 0||n===void 0)throw new i.jpipExceptions.InternalErrorException('minOffset or maxOffset is undefined for CompositeArray.copyToArray');if(t<e)throw new i.jpipExceptions.InternalErrorException('minOffset ('+t+') must be smaller than CompositeArray offset ('+e+')');if(n>e+a)throw new i.jpipExceptions.InternalErrorException('maxOffset ('+n+') must be larger than CompositeArray end offset ('+e+a+')')}function n(t,n){var s=Math.max(e,t),o=e+a;if(void 0!==n&&(o=Math.min(o,n)),s>=o){return{internalIteratorData:{isEndOfRange:!0}}}var l={subArray:null,offset:-1,internalIteratorData:{end:o,currentSubArray:null,currentInternalPartOffset:null,nextInternalPartOffset:e,currentInternalPartIndex:-1,isEndOfRange:!1}},c=!1;do{if(c)throw new i.jpipExceptions.InternalErrorException('Iterator reached to the end although no data has been iterated');c=!r(l)}while(s>=l.internalIteratorData.nextInternalPartOffset);var d=s-l.internalIteratorData.currentInternalPartOffset;return l.internalIteratorData.currentSubArray=l.internalIteratorData.currentSubArray.subarray(d),l.internalIteratorData.currentInternalPartOffset=s,l}function r(e){var t=e.internalIteratorData;if(t.isEndOfRange)return!1;if(e.subArray=t.currentSubArray,e.offset=t.currentInternalPartOffset,++t.currentInternalPartIndex,t.nextInternalPartOffset>=t.end)return t.isEndOfRange=!0,!0;s(t.currentInternalPartIndex),t.currentSubArray=o[t.currentInternalPartIndex],t.currentInternalPartOffset=t.nextInternalPartOffset;var n=o[t.currentInternalPartIndex].length;t.nextInternalPartOffset=t.currentInternalPartOffset+n;var i=t.end-t.currentInternalPartOffset,r=i<t.currentSubArray.length;return r&&(t.currentSubArray=t.currentSubArray.subarray(0,i)),!0}function s(e){if(e>=o.length)throw new i.jpipExceptions.InternalErrorException('CompositeArray: end of part has reached. Check end calculation')}var a=0,o=[];this.getLength=function(){return a},this.getOffset=function(){return e},this.pushSubArray=function(e){o.push(e),a+=e.length},this.copyToOtherAtTheEnd=function(e,i,s){t(i,s);for(var a=n(i,s);r(a);)e.pushSubArray(a.subArray)},this.copyToTypedArray=function(e,i,s,a){t(s,a);for(var o=n(s,a);r(o);){var l=o.offset-i;e.set(o.subArray,l)}},this.copyToArray=function(e,i,s,a){t(s,a);for(var o=n(s,a);r(o);)for(var l=o.offset-i,c=0;c<o.subArray.length;++c)e[l++]=o.subArray[c]},this.copyToOther=function(t){if(t.getOffset()>e)throw new i.jpipExceptions.InternalErrorException('CompositeArray: Trying to copy part into a latter part');var s=t.getOffset()+t.getLength(),o=e+a<=s;if(!o){var l=s,c=n(l);if(!r(c))throw new i.jpipExceptions.InternalErrorException('CompositeArray: Could not merge parts');var d=l;do{if(c.offset!==d)throw new i.jpipExceptions.InternalErrorException('CompositeArray: Non-continuous value of rangeToCopy.offset. Expected: '+d+', Actual: '+c.offset);t.pushSubArray(c.subArray),d+=c.subArray.length}while(r(c))}}}},function(e){'use strict';var t=Math.min;e.exports=function(e,n,r){function i(e,t){var n=!1,i=0,r;if(void 0!==t&&(n=!!t.forceCopyAllRange,i=t.databinStartOffset,r=t.maxLengthToCopy,void 0===i&&(i=0)),void 0===e&&(e=0),0===r)return{resultWithoutCopy:0};if(null!==d&&i>=d)return{resultWithoutCopy:!!r&&n?null:0};var a=o(i);if(a===c.length)return{resultWithoutCopy:n?null:0};if(n){var l=s(i,r,a);if(!l)return{resultWithoutCopy:null}}var p={databinStartOffset:i,maxLengthToCopy:r,resultStartOffset:e};return p}function s(e,t,n){if(c[n].getOffset()>e)return!1;if(t){var i=e-c[n].getOffset(),r=c[n].getLength()-i;return r>=t}if(null===d||n<c.length-1)return!1;var s=c[c.length-1],a=s.getOffset()+s.getLength(),o=a===d;return o}function a(e,n,r){var s;if(void 0!==n)s=e+n;else{var a=c[c.length-1];s=a.getOffset()+a.getLength()}for(var o=null,l=0;l<c.length&&!(c[l].getOffset()>=s);++l){var i=Math.max(e,c[l].getOffset()),d=t(s,c[l].getOffset()+c[l].getLength());r(c[l],i,d),o=c[l]}if(null===o)return 0;var p=t(o.getOffset()+o.getLength(),s);return p-e}function o(e){var t;for(t=0;t<c.length&&!(c[t].getOffset()+c[t].getLength()>e);++t);return t}var l=this,c=[],d=null,p=0,u=[];return this.getDatabinLengthIfKnown=function(){return d},this.getLoadedBytes=function(){return p},this.isAllDatabinLoaded=function(){var e;switch(c.length){case 0:e=0===d;break;case 1:e=0===c[0].getOffset()&&c[0].getLength()===d;break;default:e=!1;}return e},this.getCachedData=function(e){var t=u[e];return void 0===t&&(t={},u[e]=t),t},this.getClassId=function(){return e},this.getInClassId=function(){return n},this.copyToCompositeArray=function(e,t){var n=i(0,t);if(void 0!==n.resultWithoutCopy)return n.resultWithoutCopy;var r=a(n.databinStartOffset,n.maxLengthToCopy,function(t,n,i){t.copyToOtherAtTheEnd(e,n,i)});return r},this.copyBytes=function(e,t,n){var r=i(t,n);if(void 0!==r.resultWithoutCopy)return r.resultWithoutCopy;var s=r.databinStartOffset-r.resultStartOffset,o=e.isDummyBufferForLengthCalculation?function(){}:function(t,n,i){t.copyToArray(e,s,n,i)},l=a(r.databinStartOffset,r.maxLengthToCopy,o);return l},this.getExistingRanges=function(){for(var e=Array(c.length),t=0;t<c.length;++t)e[t]={start:c[t].getOffset(),length:c[t].getLength()};return e},this.addData=function(e,t){if(e.isLastByteInDatabin&&(d=e.messageOffsetFromDatabinStart+e.messageBodyLength),0!==e.messageBodyLength){var n=r.createCompositeArray(e.messageOffsetFromDatabinStart),s=e.bodyStart+e.messageBodyLength;n.pushSubArray(t.subarray(e.bodyStart,s));var a=o(e.messageOffsetFromDatabinStart),l=a;if(0<a){var u=c[a-1],g=u.getOffset()+u.getLength();g===e.messageOffsetFromDatabinStart&&--l}if(l>=c.length)return c.push(n),void(p+=e.messageBodyLength);var f=c[l],m=e.messageOffsetFromDatabinStart+e.messageBodyLength;if(f.getOffset()>m){for(var x=c.length;x>l;--x)c[x]=c[x-1];return c[l]=n,void(p+=e.messageBodyLength)}var i=f.getLength(),y=f.getOffset()>e.messageOffsetFromDatabinStart;y&&(c[l]=n,n=f,f=c[l]),n.copyToOther(f);var h=f.getOffset()+f.getLength(),E;for(E=l;E<c.length-1&&!(h<c[E+1].getOffset());++E)i+=c[E+1].getLength();var I=E-l;if(0<I){c[E].copyToOther(f);for(var b=l+1;b<c.length-I;++b)c[b]=c[b+I];c.length-=I}p+=f.getLength()-i}},this}},function(e,t,n){'use strict';var r=n(0);e.exports=function(e,t){function n(e,t){if(0!==e.inClassId)throw new r.jpipExceptions.IllegalDataException('Main header data-bin with in-class index other than zero is not valid','A.3.5');var n=y.getLoadedBytes();y.addData(e,t);var i=y.getLoadedBytes()-n;m+=i,x+=i}function s(){}function a(n,i,s,a,o){if(a!==e)throw new r.jpipExceptions.WrongStreamException('databin of type '+o,e);var l=n.databins[s];return l||(l=t.createDatabinParts(i,s),n.databins[s]=l),l}function i(){return{databins:[],listeners:[],databinsWithListeners:[]}}var o=0,l=1,c=2,d=4,p=5,u=[],g=[],f=[],m=0,x=0;u[c]=i(),u[o]=i(),u[l]=u[o],f[c]=!0,f[o]=!0,f[l]=!0,u[d]=i(),u[p]=u[d],g[d]=!0,g[p]=!0;var y=t.createDatabinParts(6,0);return this.getIsJpipTilePartStream=function(){return e},this.getLoadedBytes=function(){return m},this.getMainHeaderDatabin=function(){return y},this.getTileHeaderDatabin=function(e){var t=a(u[c],c,e,!1,'tileHeader');return t},this.getPrecinctDatabin=function(e){var t=a(u[o],o,e,!1,'precinct');return t},this.getTileDatabin=function(e){var t=a(u[d],d,e,!0,'tilePart');return t},this.addEventListener=function(e,t,n,i){if('dataArrived'!==t)throw new r.jpipExceptions.InternalErrorException('Unsupported event: '+t);var s=e.getClassId(),a=e.getInClassId(),o=u[s];if(e!==o.databins[a])throw new r.jpipExceptions.InternalErrorException('Unmatched databin with class-ID='+s+' and in-class-ID='+a);void 0===o.listeners[a]&&(o.listeners[a]=[]),0===o.listeners[a].length&&(x+=e.getLoadedBytes()),o.listeners[a].push({listener:n,listenerThis:i,isRegistered:!0}),o.databinsWithListeners[a]=e},this.removeEventListener=function(e,t,n){if('dataArrived'!==t)throw new r.jpipExceptions.InternalErrorException('Unsupported event: '+t);var s=e.getClassId(),a=e.getInClassId(),o=u[s],l=o.listeners[a];if(e!==o.databins[a]||e!==o.databinsWithListeners[a])throw new r.jpipExceptions.InternalErrorException('Unmatched databin with class-ID='+s+' and in-class-ID='+a);for(var c=0;c<l.length;++c)if(l[c].listener===n)return l[c].isRegistered=!0,l[c]=l[l.length-1],l.length-=1,void(0===l.length&&(delete o.databinsWithListeners[a],x-=e.getLoadedBytes()));throw new r.jpipExceptions.InternalErrorException('Could not unregister listener from databin')},this.cleanupUnregisteredDatabins=function(){for(var e=0;e<u.length;++e)if(void 0!==u[e]){var t=u[e].databinsWithListeners;u[e].databins=t.slice()}m=x},this.saveData=function(e,t){if(0!==e.codestreamIndex)throw new r.jpipExceptions.UnsupportedFeatureException('Non zero Csn (Code Stream Index)','A.2.2');switch(e.classId){case 6:n(e,t);break;case 8:s(e,t);break;default:var o=u[e.classId];if(void 0===o)break;var l=!!g[e.classId],c=a(o,e.classId,e.inClassId,l,'<class ID '+e.classId+'>'),d=c.getLoadedBytes();c.addData(e,t);var p=c.getLoadedBytes()-d;m+=p;var f=o.listeners,y=f[e.inClassId];if(void 0!==y&&0<y.length){x+=p;for(var h=y.slice(),E=0,i;E<h.length;++E)i=h[E],i.isRegistered&&i.listener.call(i.listenerThis,c)}}},this}},function(e,t,n){'use strict';e.exports=function(e,t,n){function r(){if(g>=n.length)throw new i.jpipExceptions.IllegalOperationException('Unexpected requestData() after fetch done');if(null!=c&&null===l)throw new i.jpipExceptions.IllegalOperationException('Cannot resume already-active-fetch');if(d)throw new i.jpipExceptions.IllegalOperationException('Cannot resume already-terminated-fetch');setTimeout(function(){g>=n.length||null!=c||d||(u=p?g:n.length-1,c=t.requestData(o,s,a,n[u].minNumQualityLayers,l))})}function s(t,i){c=null;i&&(g=u,g>=n.length&&e.done())}function a(){}var o=null,l=null,c=null,d=!1,p=!1,u=0,g=0;this.setDedicatedChannelHandle=function(e){l=e},this.move=function(e){if(null===l&&null!=o)throw new i.jpipExceptions.IllegalOperationException('Cannot move non movable fetch');o=e,r()},this.resume=function(){r()},this.stop=function(){if(null==c){if(d)throw new i.jpipExceptions.IllegalOperationException('Cannot stop already terminated fetch');throw new i.jpipExceptions.IllegalOperationException('Cannot stop already stopped fetch')}return l||(t.stopRequestAsync(c),c=null),e.stopped()},this.terminate=function(){if(l)throw new i.jpipExceptions.IllegalOperationException('Unexpected terminate event on movable fetch');if(d)throw new i.jpipExceptions.IllegalOperationException('Double terminate event');c=null,d=!0},this.isProgressiveChanged=function(e){p=e,l&&null!=c&&(c=null,r())}};var i=n(0)},function(e,t,n){'use strict';n(0);e.exports=function(e,t,n){function i(e,t){var i=n.createFetch(e,g,t);return e.on('isProgressiveChanged',i.isProgressiveChanged),e.on('terminate',i.terminate),e.on('stop',i.stop),e.on('resume',i.resum),i}t=t||{};var r=null,s=null,a=t.maxChannelsInSession||1,o=t.maxRequestsWaitingForResponseInChannel||1,l=e.getMainHeaderDatabin(),c=n.createMarkersParser(l),d=n.createOffsetsCalculator(l,c),p=n.createStructureParser(e,c,d),u=n.createCodestreamStructure(p,'RPCL'),g=n.createReconnectableRequester(a,o,u,e),f=n.createRequestParamsModifier(u);return g.setStatusCallback(function(e){var t=null;null!==e.exception&&(t=e.exception.toString());var n={isReady:e.isReady,exception:t};if(!r||!n.isReady&&!n.exception){if(n.exception)try{console.error('JpipFetcher.requesterStatusCallback got unexpected exception: '+n.exception)}catch(t){}return}var i=r,a=s;if(r=null,s=null,!n.isReady)return void a(n.exception);var o=u.getSizesParams(),l=JSON.parse(JSON.stringify(o)),c=u.getDefaultTileStructure(),d=c.getDefaultComponentStructure();l.imageLevel=0,l.lowestQuality=1,l.highestQuality=c.getNumQualityLayers(),l.numResolutionLevelsForLimittedViewer=d.getNumResolutionLevels(),i(l)}),this.open=function(e){return new Promise(function(t,n){r=t,s=n,g.open(e)})},this.close=function(){return new Promise(function(e){g.close(e)})},this.on=function(){},this.startFetch=function(e,t){var n=f.modify(t),r=i(e,n.progressiveness);r.move(n.codestreamPartParams)},this.startMovableFetch=function(e,t){var n=f.modify(t),r=i(e,n.progressiveness),s=g.dedicateChannelForMovableRequest();r.setDedicatedChannelHandle(s),e.on('move',r.move),r.move(n.codestreamPartParams)},this.reconnect=function(){g.reconnect()},this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(t,n,i){var r=e.getCodingStyleOffset(n);if(null!==r){t[i+r+5]=a}}function r(e,t,n){if(0===t.length)return 0;if(!e.isDummyBufferForLengthCalculation)for(var r=0;r<t.length;++r){var i=n+t[r].markerSegmentLengthOffset,s=(e[i]<<8)+e[i+1],a=s-t[r].length;e[i]=a>>>8,e[i+1]=255&a}for(var o=n+t[0].start,l=o,c=0;c<t.length;++c){l+=t[c].length;for(var d=c+1<t.length?n+t[c+1].start:e.length;l<d;++l)e[o]=e[l],++o}var p=l-o;return p}function s(e,t,n){e.isDummyBufferForLengthCalculation||(e[t++]=n>>>24,e[t++]=255&n>>>16,e[t++]=255&n>>>8,e[t++]=255&n)}var a=function(e){switch(e){case'LRCP':return 0;case'RLCP':return 1;case'RPCL':return 2;case'PCRL':return 3;case'CPRL':return 4;default:throw new i.j2kExceptions.IllegalDataException('Progression order of '+e,'A.6.1, table A.16');}}(t);this.modifyMainOrTileHeader=function(t,i,s,a){if(t.isDummyBufferForLengthCalculation||n(t,i,s),void 0===a)return 0;var o=e.getRangesOfBestResolutionLevelsData(i,a);if(null!==o.numDecompositionLevelsOffset&&!t.isDummyBufferForLengthCalculation){var l=s+o.numDecompositionLevelsOffset;t[l]-=a}var c=r(t,o.ranges,s);return-c},this.modifyImageSize=function(t,n){if(!t.isDummyBufferForLengthCalculation){var r=e.getImageAndTileSizeOffset(),a=r+i.j2kOffsets.REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER,o=a+8,l=a+16,c=a+24;s(t,a,n.regionWidth),s(t,a+4,n.regionHeight),s(t,l,n.tileWidth),s(t,l+4,n.tileHeight),s(t,o,0),s(t,o+4,0),s(t,c,0),s(t,c+4,0)}},this.modifyInt32=s}},function(e,t,n){'use strict';function i(e,t,n,i){this._codestreamPart=t,this._maxQuality=n,this._reconstructor=e.reconstructor,this._packetsDataCollector=e.packetsDataCollector,this._qualityLayersCache=e.qualityLayersCache,this._codestreamStructure=e.codestreamStructure,this._databinsSaver=e.databinsSaver,this._jpipFactory=e.jpipFactory,this._maxQualityPerPrecinct=[],this._registeredPrecinctDatabins=[],this._dataListeners=[],this._isDisposed=!1,this._isProgressive=!0,this._precinctDataArrivedBound=this._precinctDataArrived.bind(this),this._listener=this._jpipFactory.createQualityWaiter(this._codestreamPart,i,this._maxQuality,this._qualityLayerReachedCallback.bind(this),this._codestreamStructure,this._databinsSaver,this._startTrackPrecinct.bind(this)),this._listener.register()}var r=n(0);e.exports=i,i.prototype.getProgressiveStagesFinished=function(){return this._ensureNotDisposed(),this._listener.getProgressiveStagesFinished()},i.prototype.getFetchedData=function(e){if(this._ensureNotDisposed(),0===this.getProgressiveStagesFinished())throw'JpipImageDataContext error: cannot call getFetchedData before getProgressiveStagesFinished() > 0';var t=this._listener.getQualityReached();if(e){if(e>t)throw'JpipImageDataContext error: getFetchedData called with quality higher than already reached';t=e}var n=this._packetsDataCollector.getAllCodeblocksData(this._codestreamPart,t,e),i=this._getCodestream(!0);if(null===n.codeblocksData)throw new r.jpipExceptions.InternalErrorException('Could not collect codeblocks although progressiveness stage has been reached');if(null===i)throw new r.jpipExceptions.InternalErrorException('Could not reconstruct codestream although progressiveness stage has been reached');return{headersCodestream:i,codeblocksData:n.codeblocksData,minQuality:t}},i.prototype.getFetchedDataAsCodestream=function(){return this._getCodestream(!1)},i.prototype.on=function(e,t){if(this._ensureNotDisposed(),'data'!==e)throw'JpipImageDataContext error: Unexpected event '+e;this._dataListeners.push(t)},i.prototype.isDone=function(){return this._ensureNotDisposed(),this._listener.isDone()},i.prototype.dispose=function(){this._ensureNotDisposed(),this._isDisposed=!0,this._listener.unregister(),this._listener=null;for(var e=0,t;e<this._registeredPrecinctDatabins.length;++e)t=this._registeredPrecinctDatabins[e],this._databinsSaver.removeEventListener(t,'dataArrived',this._precinctDataArrivedBound)},i.prototype.setIsProgressive=function(e){this._ensureNotDisposed();var t=this._isProgressive;if(this._isProgressive=e,!t&&e&&0<this.getProgressiveStagesFinished())for(var n=0;n<this._dataListeners.length;++n)this._dataListeners[n](this)},i.prototype._getCodestream=function(e){this._ensureNotDisposed();var t=this._listener.getQualityReached(),n;if(n=e?this._reconstructor.createHeadersCodestream(this._codestreamPart):this._reconstructor.createCodestream(this._codestreamPart,t,this._maxQuality),null===n)throw new r.jpipExceptions.InternalErrorException('Could not reconstruct codestream although progressiveness stage has been reached');return n},i.prototype._startTrackPrecinct=function(e,t,n){var i=e.getInClassId();this._maxQualityPerPrecinct[i]=t,this._registeredPrecinctDatabins.push(e),this._databinsSaver.addEventListener(e,'dataArrived',this._precinctDataArrivedBound),this._precinctDataArrived(e,n)},i.prototype._precinctDataArrived=function(e,t){var n=e.getInClassId(),i=this._maxQualityPerPrecinct[n],r=this._qualityLayersCache.getQualityLayerOffset(e,i,t);this._listener.precinctQualityLayerReached(n,r.numQualityLayers)},i.prototype._qualityLayerReachedCallback=function(){if(this._isProgressive||this._listener.isDone())for(var e=0;e<this._dataListeners.length;++e)this._dataListeners[e](this)},i.prototype._ensureNotDisposed=function(){if(this._isDisposed)throw new r.jpipExceptions.IllegalOperationException('Cannot use ImageDataContext after disposed')}},function(e,t,n){'use strict';var i=Math.floor,r=Math.ceil,s=Math.max,a=Math.min,o=n(0),l=0.6931471805599453;e.exports=function(e){function t(e){var t=e.level,i=m(t),r=x(t),s=e.minTileX+e.minTileY*p(),a=e.maxTileXExclusive-1+(e.maxTileYExclusive-1)*p(),o=d(s),l=d(a),c=n(o,t),u=n(l,t),g=c.width,f=c.height,y=e.maxTileXExclusive-e.minTileX,h=e.maxTileYExclusive-e.minTileY;return 1<y&&(g+=u.width,g+=i*(y-2)),1<h&&(f+=u.height,f+=r*(h-2)),{regionWidth:g,regionHeight:f,tileWidth:i,tileHeight:r}}function n(e,t){var n=c(e.horizontalEdgeType,E,g,m),i=c(e.verticalEdgeType,I,f,x);if(void 0!==t){var s=1<<t;n=r(n/s),i=r(i/s)}return{width:n,height:i}}function c(e,t,n,i){var r;switch(e){case C:r=t();break;case P:var s=i(),a=n()-t();r=a%s,0===r&&(r=s);break;case b:r=i();break;default:throw new o.jpipExceptions.InternalErrorException('Unexpected edge type: '+e);}return r}function d(e){var t=p(),n=u(),r=e%t,s=i(e/t);if(s>n||0>r||0>s)throw new o.jpipExceptions.InternalErrorException('Tile index '+e+' is not in range');var a=0==r?C:r==t-1?P:b,l=0===s?C:s===n-1?P:b;return{horizontalEdgeType:a,verticalEdgeType:l}}function p(){var t=r(e.imageWidth/e.tileWidth);return t}function u(){var t=r(e.imageHeight/e.tileHeight);return t}function g(n){if(void 0===n)return e.imageWidth;var i=t({minTileX:0,maxTileXExclusive:p(),minTileY:0,maxTileYExclusive:1,level:n});return i.regionWidth}function f(n){if(void 0===n)return e.imageHeight;var i=t({minTileX:0,maxTileXExclusive:1,minTileY:0,maxTileYExclusive:u(),level:n});return i.regionHeight}function m(t){if(void 0===t)return e.tileWidth;var n=r(e.tileWidth/(1<<t));return n}function x(t){if(void 0===t)return e.tileHeight;var n=r(e.tileHeight/(1<<t));return n}function y(){return e.firstTileOffsetX}function h(){return e.firstTileOffsetY}function E(e){var t=m()-y(),n=g();t>n&&(t=n);var i=r(t/(1<<e));return i}function I(e){var t=x()-h(),n=f();t>n&&(t=n);var i=r(t/(1<<e));return i}var b=0,C=1,P=2;return this.EDGE_TYPE_NO_EDGE=b,this.EDGE_TYPE_FIRST=C,this.EDGE_TYPE_LAST=P,this.getTilesFromPixels=function(e){var t=e.level,n=m(t),o=x(t),l=E(t),c=I(t),d=e.minX,g=e.minY,f=e.maxXExclusive,y=e.maxYExclusive,h=s(0,1+(d-l)/n),b=s(0,1+(g-c)/o),C=a(p(),1+(f-l)/n),P=a(u(),1+(y-c)/o),T={level:t,minTileX:i(h),minTileY:i(b),maxTileXExclusive:r(C),maxTileYExclusive:r(P)};return T},this.getNumTilesX=p,this.getNumTilesY=u,this.getTileWidth=m,this.getTileHeight=x,this.getFirstTileOffsetX=y,this.getFirstTileOffsetY=h,this.getFirstTileWidth=E,this.getFirstTileHeight=I,this.isEdgeTileId=d,this.getTileSize=n,this.getLevelWidth=g,this.getLevelHeight=f,this.getImageLevel=function(){return 0},this.getLevel=function(t){var n=Math.log;if(void 0===e.numResolutionLevelsForLimittedViewer)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';var i=n((t.maxXExclusive-t.minX)/t.screenWidth)/l,o=n((t.maxYExclusive-t.minY)/t.screenHeight)/l,c=r(s(i,o));return c=s(0,a(e.numResolutionLevelsForLimittedViewer-1,c)),c},this.getNumResolutionLevelsForLimittedViewer=function(){if(void 0===e.numResolutionLevelsForLimittedViewer)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';return e.numResolutionLevelsForLimittedViewer},this.getLowestQuality=function(){return 1},this.getHighestQuality=function(){if(void 0===e.highestQuality)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';return e.highestQuality},this.getSizeOfTiles=t,this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(e,t,n){var i=e[n]===t[0]&&e[n+1]===t[1];return i}function r(e,t){var n=s(e,!0),i=l(t,'Predefined marker in jGlobals.j2kMarkers'),r=n.markerToOffset[i];return void 0===r?null:r}function s(t,r){var s=t.getCachedData(c);if(void 0===s.markerToOffset&&(s.isParsedAllMarkers=!1,s.lastOffsetParsed=0,s.markerToOffset={},s.databin=t),s.isParsedAllMarkers)return s;var l=[],d=!0;if(t===e&&0===s.lastOffsetParsed){var p=t.copyBytes(l,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE});if(null===p)d=!1;else if(!n(l,i.j2kMarkers.StartOfCodestream,0))throw new i.j2kExceptions.IllegalDataException('SOC (Start Of Codestream) is not found where expected to be','A.4.1');s.lastOffsetParsed=2}return d&&a(s),o(s,r),s}function a(e){for(var n=e.lastOffsetParsed,r=[],s=e.databin.copyBytes(r,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE+i.j2kOffsets.LENGTH_FIELD_SIZE,databinStartOffset:n});null!==s;){var a=l(r,'offset '+n+' of databin with class ID = '+e.databin.getClassId()+' and in class ID = '+e.databin.getInClassId());e.markerToOffset[a.toString()]=n;var o=t.getInt16(r,i.j2kOffsets.MARKER_SIZE);n+=o+i.j2kOffsets.MARKER_SIZE,s=e.databin.copyBytes(r,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE+i.j2kOffsets.LENGTH_FIELD_SIZE,databinStartOffset:n})}e.lastOffsetParsed=n}function o(t,r){var s=t.databin.getDatabinLengthIfKnown();if(t.isParsedAllMarkers=t.lastOffsetParsed===s,!t.isParsedAllMarkers&&t.databin!==e){var a=[],o=t.databin.copyBytes(a,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE,databinStartOffset:t.lastOffsetParsed});null!==o&&n(a,0,i.j2kMarkers.StartOfData)&&(t.lastOffsetParsed+=i.j2kOffsets.MARKER_SIZE,t.isParsedAllMarkers=!0)}if(r&&!t.isParsedAllMarkers)throw new i.jpipExceptions.InternalErrorException('data-bin with class ID = '+t.databin.getClassId()+' and in class ID = '+t.databin.getInClassId()+' was not recieved yet')}function l(e,t){if(255!==e[0])throw new i.j2kExceptions.IllegalDataException('Expected marker in '+t,'A');var n=e[1].toString(16);return n}var c='markers';this.getMandatoryMarkerOffsetInDatabin=function(e,t,n,s){var a=r(e,t);if(null===a)throw new i.j2kExceptions.IllegalDataException(n+' is not found where expected to be',s);return a},this.checkSupportedMarkers=function(e,t,n){n=!!n;for(var r=s(e,!0),a={},o=0,c;o<t.length;++o)c=l(t[o],'jpipMarkersParser.supportedMarkers['+o+']'),a[c]=!0;for(var d in r.markerToOffset){var p=!!a[d];if(p!==n)throw new i.j2kExceptions.UnsupportedFeatureException('Unsupported marker found: '+d,'unknown')}},this.getMarkerOffsetInDatabin=r,this.isMarker=n}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(e,t){var n=l(e,t);if(null===n)return null;var r=n+i.j2kOffsets.MARKER_SIZE,s=c(e,8,r),a=s[2],o=!(1&a),d=7,p=s[d],u=o?null:n+14;return{codingStyleDefaultOffset:n,isDefaultPrecinctSize:o,isStartOfPacketMarkerAllowed:!!(2&a),isEndPacketHeaderMarkerAllowed:!!(4&a),numResolutionLevels:p+1,precinctSizesOffset:u,numDecompositionLevelsOffset:r+d}}function r(e,t,n){if(!(null===t||t.isDefaultPrecinctSize)){var r=t.numResolutionLevels-n,s=t.precinctSizesOffset+r,a=t.codingStyleDefaultOffset+i.j2kOffsets.MARKER_SIZE;e.push({markerSegmentLengthOffset:a,start:s,length:n})}}function s(e,t){var n=c(e,1,t+4),r=31&n[0],s;switch(r){case 0:s=1;break;case 1:s=0;break;case 2:s=2;break;default:throw new i.j2kExceptions.IllegalDataException('Quantization style of '+r,'A.6.4');}return s}function a(e,n,r,a){var o=t.getMarkerOffsetInDatabin(n,i.j2kMarkers.QuantizationDefault);if(null!==o){var l=s(n,o);if(0!==l){var c=r.numResolutionLevels-a,d=o+i.j2kOffsets.MARKER_SIZE;e.push({markerSegmentLengthOffset:d,start:o+5+(1+3*(c-1))*l,length:3*a*l})}}}function o(e){var n=t.getMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleComponent);if(null!==n)throw new i.j2kExceptions.UnsupportedFeatureException('COC Marker (Coding Style Component)','A.6.2')}function l(e,n){o(e);var r;return r=n?t.getMandatoryMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleDefault,'COD (Coding style Default)','A.6.1'):t.getMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleDefault),r}function c(e,t,n){var r=[],s=e.copyBytes(r,0,{forceCopyAllRange:!0,maxLengthToCopy:t,databinStartOffset:n});if(null===s)throw new i.jpipExceptions.InternalErrorException('Header data-bin has not yet recieved '+t+' bytes starting from offset '+n);return r}var d=[i.j2kMarkers.ImageAndTileSize,i.j2kMarkers.CodingStyleDefault,i.j2kMarkers.QuantizationDefault,i.j2kMarkers.Comment];this.getCodingStyleOffset=l,this.getCodingStyleBaseParams=n,this.getImageAndTileSizeOffset=function(){var n=t.getMandatoryMarkerOffsetInDatabin(e,i.j2kMarkers.ImageAndTileSize,'Image and Tile Size (SIZ)','A.5.1');return n},this.getRangesOfBestResolutionLevelsData=function(s,o){t.checkSupportedMarkers(s,d,!0);var l=null,c=n(s,!1),p=c;null===c?p=n(e,!0):l=c.numDecompositionLevelsOffset;var u=p.numResolutionLevels;if(u<=o)throw new i.jpipExceptions.InternalErrorException('numResolutionLevels ('+o+') <= COD.numResolutionLevels ('+u+')');var g=[];r(g,c,o),a(g,s,p,o);var f={ranges:g,numDecompositionLevelsOffset:l};return f}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function r(t,r,a,o){for(var l=0,c=t.getTileIterator(),d={packetDataOffsets:[],data:n.createCompositeArray(0),allRelevantBytesLoaded:0};c.tryAdvance();){var p=c.createPrecinctIterator(),u=c.tileStructure.getNumQualityLayers();if(void 0!==a&&'max'!==a&&(u=Math.min(u,a)),'max'===r)t.minNumQualityLayers=u;else if(r>u)throw new i.jpipExceptions.InternalErrorException('minQuality is larger than quality');for(;p.tryAdvance();){if(!p.isInCodestreamPart)throw new i.jpipExceptions.InternalErrorException('Unexpected precinct not in codestream part');var g=c.tileStructure.precinctPositionToInClassIndex(p),f=e.getPrecinctDatabin(g),m=o[g];void 0===m&&(m={layerPerCodeblock:[]},o[g]=m);var x=s(d,l,c.tileStructure,p,f,m,u);if(x<r)return null}++l}var y=new Uint8Array(d.data.getLength());return d.data.copyToTypedArray(y,0,0,d.data.getLength()),d.data=y,d}function s(e,n,r,s,a,o,l){var c,d;for(c=0;c<l;++c){var p=t.getPacketOffsetsByCodeblockIndex(a,c,s);if(null===p)break;d=p.headerStartOffset+p.headerLength;for(var u=p.codeblockBodyLengthByIndex.length,g=Array(u),f=!1,m=0,i;m<u;++m){if(i=o.layerPerCodeblock[m],void 0===i)i={layer:-1},o.layerPerCodeblock[m]=i;else if(i.layer>=c)continue;var x=p.codeblockBodyLengthByIndex[m],y=e.data.getLength(),h=a.copyToCompositeArray(e.data,{databinStartOffset:d,maxLengthToCopy:x.codeblockBodyLengthBytes,forceCopyAllRange:!0});if(h!==x.codeblockBodyLengthBytes){g.length=m,f=!0;break}i.layer=c,g[m]={start:y,end:y+x.codeblockBodyLengthBytes,codingpasses:x.codingPasses,zeroBitPlanes:x.zeroBitPlanes},d+=x.codeblockBodyLengthBytes}var E=r.precinctPositionToIndexInComponentResolution(s),I={tileIndex:n,r:s.resolutionLevel,p:E,c:s.component,l:c,codeblockOffsets:g};if(e.packetDataOffsets.push(I),f)break}return e.allRelevantBytesLoaded+=d,c}this.getAllCodeblocksData=function(e,t,n){var i=[],s=r(e,t,n,i);return{codeblocksData:s,alreadyReturnedCodeblocks:i}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function r(e){if(!e.isStarted)return s(),e.isStarted=!0,e.currentX=a.minTileX,e.currentY=a.minTileY,!0;if(e.currentY>=a.maxTileYExclusive)throw new i.jpipExceptions.InternalErrorException('Cannot advance tile iterator after end');if(++e.currentX,e.currentX<a.maxTileXExclusive)return!0;e.currentX=a.minTileX,++e.currentY;var t=e.currentY<a.maxTileYExclusive;return t}function s(){null!=a||(e?a=t.getTilesFromPixels(e):a={level:0,minTileX:0,minTileY:0,maxTileXExclusive:t.getNumTilesX(),maxTileYExclusive:t.getNumTilesY()})}var a=null,o=null;Object.defineProperty(this,'level',{get:function(){return e?e.level:0}}),Object.defineProperty(this,'fullTilesSize',{get:function(){return null==o&&(s(),o=t.getSizeOfTiles(a)),o}}),Object.defineProperty(this,'tilesBounds',{get:function(){return s(),a}}),this.getTileIterator=function(){var s={isStarted:!1,currentX:-1,currentY:-1},a={get tileIndex(){if(!s.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var e=t.getNumTilesX(),n=s.currentY*e,r=n+s.currentX;return r},get tileStructure(){if(!s.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var e=a.tileIndex,n=t.getTileStructure(e);return n},createPrecinctIterator:function(r){if(!s.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var o=a.tileIndex;return n.createParamsPrecinctIterator(t,o,e,r)},tryAdvance:function(){var e=r(s);return e}};return a}}},function(e,t,n){'use strict';var i=Math.floor,r=Math.ceil,s=Math.max,a=Math.min,o=n(0);e.exports=function(e,t,n,l){function c(){if(C=e.getTileStructure(t),!!n&&void 0!==n.level){var i=C.getMinNumResolutionLevelsOverComponents();if(i<=n.level)throw new o.jpipExceptions.InternalErrorException('Cannot advance resolution: level='+n.level+' but should be smaller than '+i)}if(I=d(),!l&&null!==I){var r=I[0][0];f=r.minPrecinctX,m=r.minPrecinctY}b=C.getProgressionOrder()}function d(){if(!n)return null;for(var o=e.getNumComponents(),l=Array(o),c=n.level||0,d=e.getTileLeft(t,c),p=e.getTileTop(t,c),u=n.minX-d,g=n.minY-p,f=n.maxXExclusive-d,m=n.maxYExclusive-p,x=0;x<o;++x){for(var y=C.getComponentStructure(x),h=y.getNumResolutionLevels(),E=h-c,I=y.getNumResolutionLevels(),b=Array(h),P=0;P<E;++P){var T=y.getComponentScaleX(),S=y.getComponentScaleY(),v=E-P-1,L=T<<v,O=S<<v,R=4,k=i(u/L)-R,D=i(g/O)-R,A=r(f/L)+R,_=r(m/O)+R,j=y.getPrecinctWidth(P)*T,N=y.getPrecinctHeight(P)*S,F=i(k/j),B=i(D/N),M=r(A/j),w=r(_/N),q=y.getNumPrecinctsX(P),X=y.getNumPrecinctsY(P);b[P]={minPrecinctX:s(0,F),minPrecinctY:s(0,B),maxPrecinctXExclusive:a(M,q),maxPrecinctYExclusive:a(w,X)}}l[x]=b}return l}function p(t,i){var r=C.getComponentStructure(g);switch(b[t]){case'R':var s=r.getNumResolutionLevels();return!!n&&n.level&&(s-=n.level),++x,x%=s,x;case'C':return++g,g%=e.getNumComponents(),g;case'P':var a,l,c,d;if(null!==i){var p=i[g],u=p[x];a=u.minPrecinctX,l=u.minPrecinctY,c=u.maxPrecinctXExclusive,d=u.maxPrecinctYExclusive}else a=0,l=0,c=r.getNumPrecinctsX(x),d=r.getNumPrecinctsY(x);return(f-=a-1,f%=c-a,f+=a,f!=a)?f-a:(m-=l-1,m%=d-l,m+=l,m-l);case'L':throw new o.jpipExceptions.InternalErrorException('Advancing L is not supported in JPIP');default:throw new o.jpipExceptions.InternalErrorException('Unexpected letter in progression order: '+b[t]);}}var u=!1,g=0,f=f,m=m,x=0,y=!0,h=-1,E=-1,I=null,b,C;return Object.defineProperty(this,'tileIndex',{get:function(){return t}}),Object.defineProperty(this,'component',{get:function(){return g}}),Object.defineProperty(this,'precinctX',{get:function(){return f}}),Object.defineProperty(this,'precinctY',{get:function(){return m}}),Object.defineProperty(this,'resolutionLevel',{get:function(){return x}}),Object.defineProperty(this,'isInCodestreamPart',{get:function(){return y}}),this.tryAdvance=function(){if(!u)return c(),u=!0,!0;var e=!0,t=l?null:I,n=!1;h=-1,E=-1;for(var r=2,i;0<=r&&(i=p(r,t),e=0===i,!!e);--r)'P'!==b[r]||l||(n=!0);if(e)return!1;if(null==I)return y=!0,!0;var s=I[g],a=s[x];return n&&(f=a.minPrecinctX,m=a.minPrecinctY),y=f>=a.minPrecinctX&&m>=a.minPrecinctY&&f<a.maxPrecinctXExclusive&&m<a.maxPrecinctYExclusive,!0},this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r,s,a,o){function l(e,t){if(0===t)throw new i.jpipExceptions.InternalErrorException('Cannot use '+e+' iterator before started');else if(1<t)throw new i.jpipExceptions.InternalErrorException('Cannot use '+e+' iterator after ended')}var c=null,d=null,p=function(){var e=t.getComponentStructure(r),n=e.getNumResolutionLevels();return n-s-1}();Object.defineProperty(this,'level',{get:function(){return p}}),Object.defineProperty(this,'fullTilesSize',{get:function(){if(null==c){var t=this.tilesBounds;c=e.getSizeOfTiles(t)}return c}}),Object.defineProperty(this,'tilesBounds',{get:function(){if(null==d){var t=e.getNumTilesX(),i=n%t,r=Math.floor(n/t);d={level:p,minTileX:i,minTileY:r,maxTileXExclusive:i+1,maxTileYExclusive:r+1}}return d}}),this.getTileIterator=function(){var e=0;return{get tileIndex(){return l('tile',e),n},get tileStructure(){return l('tile',e),t},tryAdvance:function(){if(2<e)throw new i.jpipExceptions.InternalErrorException('Cannot advance tile iterator after ended');return++e,2>e},createPrecinctIterator:function(t){if(l('tile',e),t)throw new i.jpipExceptions.InternalErrorException('Precinct iterator of single precinct part cannot iterate precincts out of part');var c=0;return{get tileIndex(){return l('precinct',c),n},get component(){return l('precinct',c),r},get precinctX(){return l('precinct',c),a},get precinctY(){return l('precinct',c),o},get resolutionLevel(){return l('precinct',c),s},get isInCodestreamPart(){return l('precinct',c),!0},tryAdvance:function(){if(1<c)throw new i.jpipExceptions.InternalErrorException('Cannot advance precinct iterator after ended');return++c,2>c}}}}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r){function s(e){if(e.isAllDatabinLoaded()){var n=e.getInClassId(),s=d[n];if(!s.isAlreadyLoaded){s.isAlreadyLoaded=!0,--a;for(var o=t.getTileStructure(n),l=s.precinctIterator;l.tryAdvance();){if(!l.isInCodestreamPart)throw new i.jpipExceptions.InternalErrorException('Unexpected precinct not in codestream part');r(l,o)}}}}var a=0,o=!1,l=!1,c=[],d=[];this.isAllTileHeadersLoaded=function(){return 0==a},this.register=function(){if(o)throw new i.jpipExceptions.InternalErrorException('JpipQualityWaiter already registered');o=!0,++a;for(var t=e.getTileIterator();t.tryAdvance();){var r=t.tileIndex,l=n.getTileHeaderDatabin(r);c.push(l);var p=l.getInClassId();d[p]={precinctIterator:t.createPrecinctIterator(),isAlreadyLoaded:!1},n.addEventListener(l,'dataArrived',s),++a,s(l)}--a},this.unregister=function(){if(!o)throw new i.jpipExceptions.InternalErrorException('JpipQualityWaiter not registered');if(!l){l=!0;for(var e=0;e<c.length;++e)n.removeEventListener(c[e],'dataArrived',s)}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r,s,a,o,l){function c(e,t){var n=m[e];n?(--x[n.qualityReached],n.isUpdated=n.qualityReached!==t,n.qualityReached=t):(n={qualityReached:t,isUpdated:0<t},m[e]=n);var i=x[t]||0;return x[t]=i+1,n}function d(){if(!(0<x[p]||'max'===p||u>=t.length||!y.isAllTileHeadersLoaded())){if(f)throw new i.jpipExceptions.InternalErrorException('Request already done but callback is called');var e=x.length,n;do{if(++p,p>=e){p='max';break}n=0<x[p]}while(!n);var s=t[u].minNumQualityLayers;if(!(p<s)){for('max'===p&&(u=t.length);u<t.length;){var a=t[u].minNumQualityLayers;if('max'===a||a>p)break;++u}f=u===t.length,r()}}}var p=0,u=0,g=!1,f=!1,m=[],x=[],y=l.createPrecinctsIteratorWaiter(e,s,a,function(e,t){var n=t.precinctPositionToInClassIndex(e),r=a.getPrecinctDatabin(n),s=c(n,0);if(s.qualityInTile!==void 0)throw new i.jpipExceptions.InternalErrorException('Precinct was iterated twice in codestream part');var l=t.getNumQualityLayers();s.qualityInTile=l,o(r,l,e,n,t),g&&d()});this.register=function(){y.register(),g=!0,d()},this.unregister=function(){y.unregister()},this.precinctQualityLayerReached=function(e,t){var n=c(e,t);n.isUpdated&&(n.isUpdated=!1,d())},this.getProgressiveStagesFinished=function(){return u},this.isDone=function(){return f},this.getQualityReached=function(){if(0==u)throw new i.jpipExceptions.IllegalOperationException('Cannot create codestream before first progressiveness stage has been reached');var e=t[u-1].minNumQualityLayers;return e}}},function(e,t,n){'use strict';var r=n(0);e.exports=function(e){function t(e,t,n){for(var a=Array(e.length),o=0,i;o<e.length;++o){if(i=e[o].minNumQualityLayers,'max'!==i){if(void 0!==t&&i>t)throw new r.jpipExceptions.ArgumentException('progressiveness['+o+'].minNumQualityLayers',i,'minNumQualityLayers is bigger than fetchParams.quality');i=s(i,n,'progressiveness['+o+'].minNumQualityLayers')}a[o]={minNumQualityLayers:i}}return a}function n(t){var n=[],r=e.getDefaultTileStructure(),s=r.getNumQualityLayers(),a='max';void 0!==t&&(s=Math.min(s,t),a=s);for(var o=4>s?s-1:3,l=1;l<o;++l)n.push({minNumQualityLayers:l});var c=Math.round(s/2);return c>o&&('max'===a||c<a)&&n.push({minNumQualityLayers:c}),n.push({minNumQualityLayers:a}),n}function i(t){var n=s(t.level,'level',void 0,!0),i=s(t.quality,'quality',void 0,!0),a=s(t.minX,'minX'),o=s(t.minY,'minY'),l=s(t.maxXExclusive,'maxXExclusive'),c=s(t.maxYExclusive,'maxYExclusive'),d=e.getLevelWidth(n),p=e.getLevelHeight(n);if(0>a||l>d||0>o||c>p||a>=l||o>=c)throw new r.jpipExceptions.ArgumentException('codestreamPartParams',t);return{minX:a,minY:o,maxXExclusive:l,maxYExclusive:c,level:n,quality:i}}function s(e,t,n,i){if(e===void 0&&(n!==void 0||i))return n;var s=+e;if(isNaN(s)||s!==Math.floor(s))throw new r.jpipExceptions.ArgumentException(t,e);return s}this.modify=function(e,s){var a=i(e);s=s||{};var o=s.useCachedDataOnly,l=s.disableProgressiveness,c;if(s.progressiveness!==void 0){if(o||l)throw new r.jpipExceptions.ArgumentException('options.progressiveness',s.progressiveness,'options contradiction: cannot accept both progressivenessand useCachedDataOnly/disableProgressiveness options');c=t(s.progressiveness,a.quality,'quality')}else if(o)c=[{minNumQualityLayers:0}];else if(l){var d=a.quality,p=d===void 0?'max':d;c=[{minNumQualityLayers:p}]}else c=n(a.quality);return{codestreamPartParams:a,progressiveness:c}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(t,e,n,r,s,a){function o(e,i){var r=!1;try{var s=c(e,i);if(s===m)return;r=s===f}catch(n){r=!0,t.onException(n)}try{r||t.waitForConcurrentRequestsToEnd(x),n.requestEnded(e,x),r&&!h&&a!==void 0&&a(),t.checkConcurrentRequestsFinished()}catch(n){t.onException(n)}}function l(e){n.requestEnded(e,x),t.checkConcurrentRequestsFinished(),a!==void 0&&a()}function c(e,r){if(!r)throw new i.jpipExceptions.InternalErrorException('AJAX callback called although response is not done yet and chunked encoding is not enabled');var s=t.getCreatedChannelId(e);null===s?null===n.getChannelId()&&t.onException(new i.jpipExceptions.IllegalDataException('Cannot extract cid from cnew response','D.2.3')):null===n.getChannelId()?n.setChannelId(s):t.onException(new i.jpipExceptions.IllegalDataException('Channel created although was not requested','D.2.3'));var a=u(e);if(null===a)return f;var o=p(e,a);return o}function d(){I=n.nextRequestId();var e=r+'&len='+E+'&qid='+I;E*=2;var i=null===n.getChannelId();if(i){e+='&cnew=http';var s=t.getFirstChannel();null!==s&&(e+='&cid='+s.getChannelId())}else e+='&cid='+n.getChannelId();t.sendAjax(e,o,l)}function p(e,n){var r=f,s=new Uint8Array(e.response);if(n>s.length-2||0!==s[n])throw new i.jpipExceptions.IllegalDataException('Could not find End Of Response (EOR) code at the end of response','D.3');switch(s[n+1]){case i.jpipEndOfResponseReasons.IMAGE_DONE:case i.jpipEndOfResponseReasons.WINDOW_DONE:case i.jpipEndOfResponseReasons.QUALITY_LIMIT:r=g;break;case i.jpipEndOfResponseReasons.WINDOW_CHANGE:if(!h)throw new i.jpipExceptions.IllegalOperationException('Server response was terminated due to newer request issued on same channel. That may be an internal webjpip.js error - Check that movable requests are well maintained');break;case i.jpipEndOfResponseReasons.BYTE_LIMIT:case i.jpipEndOfResponseReasons.RESPONSE_LIMIT:h||(d(),r=m);break;case i.jpipEndOfResponseReasons.SESSION_LIMIT:t.onException(new i.jpipExceptions.IllegalOperationException('Server resources associated with the session is limitted, no further requests should be issued to this session'));break;case i.jpipEndOfResponseReasons.NON_SPECIFIED:t.onException(new i.jpipExceptions.IllegalOperationException('Server error terminated response with no reason specified'));break;default:t.onException(new i.jpipExceptions.IllegalDataException('Server responded with illegal End Of Response (EOR) code: '+s[n+1]));}return r}function u(n){try{for(var i=new Uint8Array(n.response),r=0,s;r<i.length&&!(0===i[r]);){var a=e.parseMessageHeader(i,r,s);if(a.bodyStart+a.messageBodyLength>i.length)return r;t.getDatabinsSaver().saveData(a,i),r=a.bodyStart+a.messageBodyLength,s=a}return r}catch(n){return t.onException(n),null}}var g=1,f=2,m=3,x=this,y=!1,h=!1,E=10*1024,I;this.startRequest=function(){if(y)throw new i.jpipExceptions.InternalErrorException('startRequest called twice');else if(h)throw new i.jpipExceptions.InternalErrorException('request was already stopped');y=!0,t.requestStarted(),d()},this.stopRequestAsync=function(){h=!0},this.getLastRequestId=function(){if(!y)throw new i.jpipExceptions.InternalErrorException('Unexpected call to getLastRequestId on inactive request');return I},this.callCallbackAfterConcurrentRequestsFinished=function(){s(x,!0)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r,s){function a(e){var t=new i.jpipExceptions.InternalErrorException('Bad jpip server response (status = '+e.status+')');o(t)}function o(e){e===void 0&&(e=null),null!==l&&l({isReady:f,exception:e})}var l=null,c=null,d=[],p=null,u=0,g=[],f=!1,m=t||'0';this.onException=function(e){o(e)},this.getIsReady=function(){return f},this.setIsReady=function(e){f=e,o()},this.getCodestreamStructure=function(){return n},this.getDatabinsSaver=function(){return r},this.getDataRequestUrl=function(){return e},this.getTargetId=function(){return m},this.getFirstChannel=function(){return p},this.setStatusCallback=function(e){l=e},this.setRequestEndedCallback=function(e){c=e},this.requestStarted=function(){++u},this.requestEnded=function(e,t){--u;var n=e.getResponseHeader('JPIP-tid');if(''!==n&&null!==n)if('0'===m)m=n;else if(m!==n)throw new i.jpipExceptions.IllegalDataException('Server returned unmatched target ID');null==p&&(p=t);var r=t.getIsDedicatedForMovableRequest()?null:t;null!==c&&c(r)},this.getActiveRequestsCount=function(){return u},this.channelCreated=function(e){d.push(e)},this.getCreatedChannelId=function(e){var t=e.getResponseHeader('JPIP-cnew');if(!t)return null;for(var n=t.split(','),r=0,i;r<n.length;++r)if(i=n[r].split('='),'cid'===i[0])return i[1];return null},this.waitForConcurrentRequestsToEnd=function(e){for(var t=[],n=0;n<d.length;++n){var i=d[n].getRequestsWaitingForResponse(),r=i.length;if(0!==r){for(var s=i[0].getLastRequestId(),a=1;a<i.length;++a)s=Math.max(s,i[a].getLastRequestId());t.push({channel:d[n],requestId:s})}}g.push({request:e,concurrentRequests:t})},this.checkConcurrentRequestsFinished=function(){for(var e=g.length-1;0<=e;--e){for(var t=g[e].concurrentRequests,n=t.length-1,i;0<=n;--n)i=t[n],i.channel.isAllOldRequestsEnded(i.requestId)&&(t[n]=t[t.length-1],t.length-=1);if(!(0<t.length)){var r=g[e].request,s=r.callback;g[e]=g[g.length-1],g.length-=1,r.callCallbackAfterConcurrentRequestsFinished()}}},this.sendAjax=function(e,t,n){var i;i=n?function(e){a(e),n(e)}:a,s.request(e,t,i)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r,s,a,o,l){function c(){null!=P&&o(P),h.setIsReady(!1),h.sendAjax(v,y)}function d(e){++C;var n=l.createChannel(t,h);return h.channelCreated(n),e||b.push(n),n}function p(e,t){for(var n=null,r=e+1,s=0,i,a;s<b.length&&(a=b[s].getAllQueuedRequestCount(),a<r&&(n=b[s],i=s,r=a),0!==a);++s);return t&&null!==n?(b[i]=b[b.length-1],b.length-=1,n):n}function u(){var e=s.getMainHeaderDatabin();if(!e.isAllDatabinLoaded())throw new i.jpipExceptions.IllegalDataException('Main header was not loaded on session creation');var t=h.getFirstChannel(),n=t.getChannelId();return v=T+'&cclose=*&cid='+n,x?void c():void(null===n||(P=a(g,m),h.setIsReady(!0)))}function g(){if(!(0<h.getActiveRequestsCount())){var e=h.getFirstChannel();e.sendMinimalRequest(function(){})}}function f(){if(null===h||!h.getIsReady())throw new i.jpipExceptions.InternalErrorException('Cannot perform this operation when the session is not ready')}var m=30*1e3,x=!1,y=null,h=null,E=null,I=null,b=[],C=0,P=null,T,S,v;this.open=function(e){if(null!=h)throw new i.jpipExceptions.InternalErrorException('session.open() should be called only once');var t=0>e.indexOf('?')?'?':'&';T=e+t+'type='+(s.getIsJpipTilePartStream()?'jpt-stream':'jpp-stream'),S=T+'&stream=0',h=l.createSessionHelper(S,n,r,s),null!=E&&h.setStatusCallback(E),null!=I&&h.setRequestEndedCallback(I);var a=d();a.sendMinimalRequest(u)},this.getTargetId=function(){return f(),h.getTargetId()},this.getIsReady=function(){var e=null!==h&&h.getIsReady();return e},this.setStatusCallback=function(e){E=e,null!==h&&h.setStatusCallback(e)},this.setRequestEndedCallback=function(e){I=e,null!==h&&h.setRequestEndedCallback(e)},this.hasActiveRequests=function(){f();var e=0<h.getActiveRequestsCount();return e},this.tryGetChannel=function(n){f();var i=C<e,r=i||n?0:t-1,s=p(r,n);return null===s&&i&&(s=d(n)),n&&null!==s&&s.dedicateForMovableRequest(),s},this.close=function(e){if(0==C)throw new i.jpipExceptions.InternalErrorException('Cannot close session before open');if(x)throw new i.jpipExceptions.InternalErrorException('Cannot close session twice');x=!0,y=e,v!=void 0&&c()}}},function(e,t,n){'use strict';var r=n(0);e.exports=function(e,t,n,i,s,a){function o(){if(null!==S)throw new r.jpipExceptions.IllegalOperationException('Previous session still not established');return null==h?void(i.cleanupUnregisteredDatabins(),l()):void(null!==P&&P({isReady:!0,exception:'Previous session that should be closed still alive.Maybe old requestContexts have not beed closed. Reconnect will not be done'}))}function l(){var r;null!=y&&(r=y.getTargetId()),S=s.createSession(e,t,r,n,i),S.setStatusCallback(d),S.open(E)}function c(e){var t=y.tryGetChannel(!0);if(null===t)throw new r.jpipExceptions.IllegalOperationException('Too many concurrent requests. Limit the use of dedicated (movable) requests, enlarge maxChannelsInSession or wait for requests to finish and avoid create new ones');if(!t.getIsDedicatedForMovableRequest())throw new r.jpipExceptions.InternalErrorException('getIsDedicatedForMovableRequest inconsistency');e.internalDedicatedChannel=t}function d(e){if(null===S||e.isReady!==S.getIsReady())throw new r.jpipExceptions.InternalErrorException('Unexpected statusCallback when not registered to session or inconsistent isReady');if(e.isReady){if(null!=h)throw new r.jpipExceptions.InternalErrorException('sessionWaitingForDisconnect should be null');h=y,y=S,S=null,null!=h&&(h.setStatusCallback(null),!m()&&h.setRequestEndedCallback(m)),y.setStatusCallback(P),y.setRequestEndedCallback(f);for(var t=0;t<C.length;++t)c(C[t])}null!==P&&P(e)}function p(e){null!==e&&(++I,e.close(u))}function u(){--I,0==I&&T!==void 0&&T()}function g(){if(null===y)throw new r.jpipExceptions.InternalErrorException('This operation is forbidden when session is not ready')}function f(e){var t=null;if(i.getLoadedBytes()>x&&o(),null!==e){if(e.getIsDedicatedForMovableRequest())throw new r.jpipExceptions.InternalErrorException('Expected non-movable channel as channelFreed');do{if(0===b.length){t=null;break}if(t=b.shift(),null!==t.internalRequest)throw new r.jpipExceptions.InternalErrorException('Request was already sent but still in queue')}while(t.isEnded);null!==t&&(t.internalRequest=e.requestData(t.codestreamPartParams,t.callback,t.failureCallback,t.numQualityLayers))}}function m(){var e=!h.hasActiveRequests();return e&&(h.close(),h=null),e}var x=a||10*1048576,y=null,h=null,E=null,I=0,b=[],C=[],P=null,T=null,S;this.getIsReady=function(){return null!=y&&y.getIsReady()},this.open=function(e){if(e===void 0||null===e)throw new r.jpipExceptions.ArgumentException('baseUrl',e);if(null!=E)throw new r.jpipExceptions.IllegalOperationException('Image was already opened');E=e,l()},this.close=function(e){if(null!=T)throw new r.jpipExceptions.IllegalOperationException('closed twice');T=e,I=1,p(y),p(S),p(h),u()},this.setStatusCallback=function(e){P=e,null!=y&&y.setStatusCallback(e)},this.dedicateChannelForMovableRequest=function(){g();var e={internalDedicatedChannel:null};return C.push(e),c(e),e},this.requestData=function(e,t,n,i,s){g();var a={isEnded:!1,internalRequest:null,codestreamPartParams:e,callback:t,failureCallback:n,numQualityLayers:i},o=!!s,l;if(o)l=s.internalDedicatedChannel;else{if(l=y.tryGetChannel(),null===l)return b.push(a),a;if(l.getIsDedicatedForMovableRequest())throw new r.jpipExceptions.InternalErrorException('Expected non-movable channel')}if(l.getIsDedicatedForMovableRequest()!==o)throw new r.jpipExceptions.InternalErrorException('getIsDedicatedForMovableRequest inconsistency');return a.internalRequest=l.requestData(e,t,n,i),a},this.stopRequestAsync=function(e){e.isEnded=!0,null!==e.internalRequest&&e.internalRequest.stopRequestAsync()},this.reconnect=o}},function(e,t,n){'use strict';var r=Math.pow,s=n(0);e.exports=function(e,t,n,a){function i(c,d){var p=a.getCodingStyleBaseParams(c,d);if(null===p)return null;var u=e.getMainHeaderDatabin(),g=a.getImageAndTileSizeOffset(),f=g+s.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER,m=l(u,2,f),x=n.getInt16(m,0),y=t.getMarkerOffsetInDatabin(c,s.j2kMarkers.PackedPacketHeadersInTileHeader),h=t.getMarkerOffsetInDatabin(u,s.j2kMarkers.PackedPacketHeadersInMainHeader),E=p.codingStyleDefaultOffset+6,I=l(c,6,E),b=n.getInt16(I,0),C=o(I,4),P=o(I,5),T=Array(p.numResolutionLevels),S=Array(p.numResolutionLevels),v=null;if(!p.isDefaultPrecinctSize){var L=p.numResolutionLevels;v=l(c,L,p.precinctSizesOffset)}for(var O=32768,R=0;R<p.numResolutionLevels;++R){if(p.isDefaultPrecinctSize){T[R]=O,S[R]=O;continue}var i=R,k=v[i];T[R]=1*r(2,15&k),S[R]=1*r(2,k>>>4)}for(var D=Array(x),A=0;A<x;++A)D[A]={maxCodeblockWidth:C,maxCodeblockHeight:P,numResolutionLevels:p.numResolutionLevels,precinctWidthPerLevel:T,precinctHeightPerLevel:S};var _={maxCodeblockWidth:C,maxCodeblockHeight:P,numResolutionLevels:p.numResolutionLevels,precinctWidthPerLevel:T,precinctHeightPerLevel:S},j={numQualityLayers:b,isPacketHeadersNearData:null===y&&null===h,isStartOfPacketMarkerAllowed:p.isStartOfPacketMarkerAllowed,isEndPacketHeaderMarkerAllowed:p.isEndPacketHeaderMarkerAllowed,paramsPerComponent:D,defaultComponentParams:_};return j}function o(e,t){var n=e[t],i=2+(15&n);if(10<i)throw new s.j2kExceptions.IllegalDataException('Illegal codeblock width exponent '+i,'A.6.1, Table A.18');return 1<<i}function l(e,t,n){var i=[],r=e.copyBytes(i,0,{forceCopyAllRange:!0,maxLengthToCopy:t,databinStartOffset:n});if(null===r)throw new s.jpipExceptions.InternalErrorException('Header data-bin has not yet recieved '+t+' bytes starting from offset '+n);return i}this.parseCodestreamStructure=function(){for(var t=e.getMainHeaderDatabin(),r=a.getImageAndTileSizeOffset(),o=l(t,38,r+s.j2kOffsets.MARKER_SIZE+s.j2kOffsets.LENGTH_FIELD_SIZE),c=s.j2kOffsets.REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER-(s.j2kOffsets.MARKER_SIZE+s.j2kOffsets.LENGTH_FIELD_SIZE),d=s.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER-(s.j2kOffsets.MARKER_SIZE+s.j2kOffsets.LENGTH_FIELD_SIZE),p=n.getInt32(o,c),u=n.getInt32(o,c+4),g=n.getInt32(o,10),f=n.getInt32(o,14),m=n.getInt32(o,18),x=n.getInt32(o,22),y=n.getInt32(o,26),h=n.getInt32(o,30),E=n.getInt16(o,d),I=r+s.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER+2,b=l(t,3*E,I),C=Array(E),P=Array(E),T=0;T<E;++T)C[T]=b[3*T+1],P[T]=b[3*T+2];return{numComponents:E,componentsScaleX:C,componentsScaleY:P,imageWidth:p-y,imageHeight:u-h,tileWidth:m,tileHeight:x,firstTileOffsetX:y,firstTileOffsetY:h}},this.parseDefaultTileParams=function(){var t=e.getMainHeaderDatabin(),n=i(t,!0);return n},this.parseOverridenTileParams=function(t){var n=e.getTileHeaderDatabin(t),r=i(n,!1);return r}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r){function s(e,t,n){if(0>t||t>=n)throw new i.jpipExceptions.ArgumentException(e,t,e+' is expected to be between 0 and '+n-1)}function a(e,t,n,i,r){var s=n(e),a=i(e),o=r(e);if(s>=a||o>=a)return!0;return 0==s%o||0==o%s}var o,l,d,p;this.getProgressionOrder=function(){return r},this.getDefaultComponentStructure=function(){return o},this.getComponentStructure=function(e){return l[e]},this.getTileWidth=function(){return e.tileSize.width},this.getTileHeight=function(){return e.tileSize.height},this.getNumQualityLayers=function(){return e.numQualityLayers},this.getIsPacketHeaderNearData=function(){return e.isPacketHeadersNearData},this.getIsStartOfPacketMarkerAllowed=function(){return e.isStartOfPacketMarkerAllowed},this.getIsEndPacketHeaderMarkerAllowed=function(){return e.isEndPacketHeaderMarkerAllowed},this.getMinNumResolutionLevelsOverComponents=function(){return p},this.precinctInClassIndexToPosition=function(e){if(0>e)throw new i.jpipExceptions.ArgumentException('inClassIndex',e,'Invalid negative in-class index of precinct');var n=t.getNumTilesX()*t.getNumTilesY(),r=t.getNumComponents(),s=e%n,a=(e-s)/n,o=a%r,c=l[o],p=c.getNumResolutionLevels(),u=(a-o)/r,g=0,f;for(f=1;f<p;++f){var m=d[o][f];if(m>u)break;g=m}--f;var x=u-g,y=c.getNumPrecinctsX(f),h=c.getNumPrecinctsY(f),E=x%y,I=(x-E)/y;if(I>=h)throw new i.jpipExceptions.ArgumentException('inClassIndex',e,'Invalid in-class index of precinct');var b={tileIndex:s,component:o,precinctX:E,precinctY:I,resolutionLevel:f};return b},this.precinctPositionToInClassIndex=function(e){var n=t.getNumComponents();s('precinctPosition.component',e.component,n);var i=l[e.component],r=i.getNumResolutionLevels();s('precinctPosition.resolutionLevel',e.resolutionLevel,r);var a=t.getNumTilesX()*t.getNumTilesY(),o=i.getNumPrecinctsX(e.resolutionLevel),c=i.getNumPrecinctsY(e.resolutionLevel);s('precinctPosition.precinctX',e.precinctX,o),s('precinctPosition.precinctY',e.precinctY,c),s('precinctPosition.tileIndex',e.tileIndex,a);var p=e.precinctX+e.precinctY*o,u=d[e.component][e.resolutionLevel],g=e.component+(p+u)*t.getNumComponents(),f=e.tileIndex+g*t.getNumTilesX()*t.getNumTilesY();return f},this.precinctPositionToIndexInComponentResolution=function(e){var t=l[e.component],n=t.getNumPrecinctsX(e.resolutionLevel),i=e.precinctX+e.precinctY*n;return i},o=n.createComponentStructure(e.defaultComponentParams,this),l=Array(t.getNumComponents());for(var c=0;c<t.getNumComponents();++c)l[c]=n.createComponentStructure(e.paramsPerComponent[c],this);return function(){d=Array(n);var n=t.getNumComponents(),s=e.defaultComponentParams;p=s.numResolutionLevels;for(var o=!0,u=!0,g=0,c;g<n;++g){c=e.paramsPerComponent[g],p=Math.min(p,c.numResolutionLevels),d[g]=Array(c.numResolutionLevels);for(var f=l[g],m=0,x=f.getNumPrecinctsX(g),y=f.getNumPrecinctsY(g),h=0;h<c.numResolutionLevels;++h){d[g][h]=m;var r=f.getNumPrecinctsX(h),E=f.getNumPrecinctsY(h);m+=r*E,(s.precinctWidthPerLevel[h]!==c.precinctWidthPerLevel[h]||s.precinctHeightPerLevel[h]!==c.precinctHeightPerLevel[h])&&(o=!1);var I=a(h,c.numResolutionLevels,f.getPrecinctWidth,t.getLevelWidth,t.getTileWidth),b=a(h,c.numResolutionLevels,f.getPrecinctWidth,t.getLevelWidth,t.getTileWidth);u&=I&&b}}if(!o)throw new i.j2kExceptions.UnsupportedFeatureException('Special Coding Style for Component (COC)','A.6.2');if(!u)throw new i.j2kExceptions.UnsupportedFeatureException('Precinct TopLeft which is not matched to tile TopLeft','B.6')}(),function(e){if(4!==e.length)throw new i.j2kExceptions.IllegalDataException('Illegal progression order '+e+': unexpected length');if('L'!==e[3])throw new i.jpipExceptions.IllegalDataException('Illegal target progression order of '+e,'A.3.2.1');var t=0<=e.indexOf('P'),n=0<=e.indexOf('C'),r=0<=e.indexOf('R');if(!t||!n||!r)throw new i.j2kExceptions.IllegalDataException('Illegal progression order '+e+': missing letter');if('RPCL'!==e)throw new i.j2kExceptions.UnsupportedFeatureException('Progression order of '+e,'A.6.1')}(r),this}},function(e,t,n){'use strict';var i=Math.min,r=n(0);e.exports=function(){function e(e,r,a,o){var l=0,c=o,d;do{if(!n(e,r))return null;var p=a?~r.currentByte:r.currentByte,u=i(s[p],r.validBitsInCurrentByte+1),g=u-1;if(c!==void 0){if(u>c){t(r,c),l+=c;break}c-=g}l+=g,d=u<=r.validBitsInCurrentByte,d?t(r,u):r.validBitsInCurrentByte=0}while(!d);return l}function t(e,t){e.validBitsInCurrentByte-=t,0<e.validBitsInCurrentByte&&(e.currentByte=255&e.currentByte<<t)}function n(e,t){if(0<t.validBitsInCurrentByte)return!0;var n=t.isSkipNextByte?2:1,i=[],s=e.copyBytes(i,0,{forceCopyAllRange:!0,databinStartOffset:t.nextOffsetToParse,maxLengthToCopy:n});if(s!==n)return!1;var a=t.originalByteWithoutShift;if(t.currentByte=i[n-1],t.validBitsInCurrentByte=8,t.originalByteWithoutShift=t.currentByte,255===a){if(0!=(128&i[0]))throw new r.j2kExceptions.IllegalDataException('Expected 0 bit after 0xFF byte','B.10.1');t.isSkipNextByte||(t.currentByte<<=1,t.validBitsInCurrentByte=7)}return t.isSkipNextByte=!1,t.nextOffsetToParse+=n,!0}var s=function(){var e=Array(255);e[0]=9,e[1]=8,e[2]=7,e[3]=7;var t;for(t=4;7>=t;++t)e[t]=6;for(t=8;15>=t;++t)e[t]=5;for(t=16;31>=t;++t)e[t]=4;for(t=32;63>=t;++t)e[t]=3;for(t=64;127>=t;++t)e[t]=2;for(t=128;255>=t;++t)e[t]=1;for(t=0;255>=t;++t)e[t-256]=e[t];return e}();return function(s,a){var o=a.createTransactionalObject({nextOffsetToParse:0,validBitsInCurrentByte:0,originalByteWithoutShift:null,currentByte:null,isSkipNextByte:!1}),l=null;Object.defineProperty(this,'activeTransaction',{get:function(){if(null==l||!l.isActive)throw new r.jpipExceptions.InternalErrorException('No active transaction in bitstreamReader');return l}}),Object.defineProperty(this,'bitsCounter',{get:function(){var e=o.getValue(l);if(n(s,e),e.isSkipNextByte)throw new r.jpipExceptions.InternalErrorException('Unexpected state of bitstreamReader: When 0xFF encountered, tryValidateCurrentByte should skip the whole byte  after shiftRemainingBitsInByte and clear isSkipNextByte. However the flag is still set');var t=8*e.nextOffsetToParse-e.validBitsInCurrentByte;return t}}),Object.defineProperty(this,'databinOffset',{get:function(){var e=o.getValue(l);if(e.isSkipNextByte)return e.nextOffsetToParse+1;if(0!=e.validBitsInCurrentByte%8||255===e.originalByteWithoutShift)throw new r.jpipExceptions.InternalErrorException('Cannot calculate databin offset when bitstreamReader  is in the middle of the byte');return e.nextOffsetToParse-e.validBitsInCurrentByte/8},set:function(e){var t=o.getValue(l);t.validBitsInCurrentByte=0,t.isSkipNextByte=!1,t.originalByteWithoutShift=null,t.nextOffsetToParse=e}}),this.startNewTransaction=function(){if(null!=l&&l.isActive)throw new r.jpipExceptions.InternalErrorException('Cannot start new transaction in bitstreamReader while another transaction is active');l=a.createTransaction()},this.shiftRemainingBitsInByte=function(){var e=o.getValue(l);e.isSkipNextByte=255===e.originalByteWithoutShift,e.validBitsInCurrentByte=Math.floor(e.validBitsInCurrentByte/8)},this.shiftBit=function(){var t=o.getValue(l);if(!n(s,t))return null;var i=e(s,t,!0,1);return i},this.countZerosAndShiftUntilFirstOneBit=function(t){var n=o.getValue(l),i=e(s,n,!1,t);return i},this.countOnesAndShiftUntilFirstZeroBit=function(t){var n=o.getValue(l),i=e(s,n,!0,t);return i},this.shiftBits=function(e){for(var r=0,a=o.getValue(l),c=e;0<c;){if(!n(s,a))return null;var d=i(a.validBitsInCurrentByte,c),p=a.currentByte>>8-d;r=(r<<d)+p,t(a,d),c-=d}return r}}}()},function(e,t,n){'use strict';var i=Math.floor,r=Math.ceil,s=n(0);e.exports=function(e,t,n,a){function o(t,n){var r=0,a=null;return function(){if(null===r)throw new s.jpipExceptions.InternalErrorException('Iterated too deep in tag tree');if(r===u.length)return r=null,null;var o=u.length-r-1,c=i(t>>o),d=i(n>>o),p=u[r].width*d+c,g=u[r].content[p];void 0===g&&(g=l(r,p));var f=g.getValue(e.activeTransaction);return null!=a&&a.minimalPossibleValue>f.minimalPossibleValue&&(f.minimalPossibleValue=a.minimalPossibleValue),a=f,++r,f}}function l(e,t){var n=a.createTransactionalObject({minimalPossibleValue:0,isFinalValue:!1});return u[e].content[t]=n,n}function c(){var t=p.getValue(e.activeTransaction);return t}function d(){p.setValue(e.activeTransaction,!0)}var p=a.createTransactionalObject(!1,!0),u;(function(){u=[];for(var e=t,i=n;1<=e||1<=i;){e=r(e),i=r(i);var s=e*i;u.unshift({width:e,height:i,content:Array(s)}),e/=2,i/=2}l(0,0)})(),this.setMinimalValueIfNotReadBits=function(t){if(!c()){var n=u[0].content[0],i=n.getValue(e.activeTransaction);i.minimalPossibleValue=t}},this.isSmallerThanOrEqualsTo=function(t,n,i){d();for(var r=o(t,n),a=r(),l;null!==a;){if(a.minimalPossibleValue>i)return!1;if(!a.isFinalValue){var c=i-a.minimalPossibleValue+1,p=e.countZerosAndShiftUntilFirstOneBit(c);if(null===p)return null;a.minimalPossibleValue+=p,p<c&&(a.isFinalValue=!0)}l=a,a=r()}var u=l.minimalPossibleValue<=i;if(u&&!l.isFinalValue)throw new s.jpipExceptions.InternalErrorException('Wrong parsing in TagTree.isSmallerThanOrEqualsTo: not sure if value is smaller than asked');return u},this.getValue=function(t,n){var i=o(t,n),r=i(),s;for(d();null!==r;){if(!r.isFinalValue){var a=e.countZerosAndShiftUntilFirstOneBit();if(null===a)return null;r.minimalPossibleValue+=a,r.isFinalValue=!0}s=r,r=i()}return s.minimalPossibleValue}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(){var e=function(){for(var e=164,t=Array(e),n=1,r=2,s=0;n<=e;){for(var a=n;a<r;++a)t[a]=s;n*=2,r*=2,++s}return t}();return function(t,n){var r=n.createTransactionalObject({lBlockValue:3});this.parse=function(n){var s=t.countOnesAndShiftUntilFirstZeroBit();if(null===s)return null;var a=r.getValue(t.activeTransaction);a.lBlockValue+=s;var o=e[n];if(o===void 0)throw new i.jpipExceptions.InternalErrorException('Unexpected value of coding passes '+n+'. Expected positive integer <= 164');var l=a.lBlockValue+o,c=t.shiftBits(l);return c}}}()},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,r,s,a){function o(t){var n=u.getValue(e.activeTransaction);if(n>=t+1)throw new i.jpipExceptions.InternalErrorException('Unexpected quality layer to parse')}function l(){if(null==d){d=Array(t),p=Array(t);for(var i=0;i<t;++i){d[i]=Array(n),p[i]=Array(n);for(var r=0;r<n;++r)d[i][r]=a.createCodeblockLengthParser(e,s),p[i][r]=s.createTransactionalObject({isIncluded:!1})}}}function c(t,n,i){var s=p[t][n].getValue(e.activeTransaction),a;if(a=s.isIncluded?e.shiftBit():g.isSmallerThanOrEqualsTo(t,n,i),null===a)return null;if(!a)return{codeblockBodyLengthBytes:0,codingPasses:0};var o=null;if(!s.isIncluded&&(o=f.getValue(t,n),null===o))return null;var l=r.parse(e);if(null===l)return null;var c=d[t][n],u=c.parse(l);if(null===u)return null;s.isIncluded=!0;var m={codeblockBodyLengthBytes:u,codingPasses:l};return null!==o&&(m.zeroBitPlanes=o),m}var d=null,p=null,u=s.createTransactionalObject(0,!0),g=a.createTagTree(e,t,n),f=a.createTagTree(e,t,n);this.calculateSubbandLength=function(i){o(i),l(),g.setMinimalValueIfNotReadBits(i);for(var r=0,s=0,a=Array(t*n),d=0;d<n;++d)for(var p=0,f;p<t;++p){if(f=c(p,d,i),null===f)return null;a[s++]=f,r+=f.codeblockBodyLengthBytes}return u.setValue(e.activeTransaction,i+1),{codeblockBodyLengthByIndex:a,overallBodyLengthBytes:r}}}},function(e,t,n){'use strict';var r=Math.floor,s=Math.ceil,i=n(0);e.exports=function(e,t,n,a,o,l){function c(e){for(;m.length<e;){x.startNewTransaction();var t=d(m.length);if(null===t)return void x.activeTransaction.abort();m.push(t),x.activeTransaction.commit()}}function d(e){var t;if(0<e){var n=m[e-1];t=n.headerStartOffset+n.headerLength+n.overallBodyLengthBytes}else t=a;if(x.databinOffset=t,I&&b){var i=g(145);if(null===i)return null;if(i){x.databinOffset+=6}}var r=x.shiftBit();if(null===r)return null;if(!r)return x.shiftRemainingBitsInByte(),{headerStartOffset:t,headerLength:1,codeblockBodyLengthByIndex:[],overallBodyLengthBytes:0};var s=p(e);if(null===s)return null;var o=x.databinOffset;return s.headerLength=o-t,s.headerStartOffset=t,s}function p(e){for(var t=0,n=null,i=0;i<P.length;++i){var r=P[i],s=r.calculateSubbandLength(e);if(null===s)return null;n=null==n?s.codeblockBodyLengthByIndex:n.concat(s.codeblockBodyLengthByIndex),t+=s.overallBodyLengthBytes}if(x.shiftRemainingBitsInByte(),C){var a=g(146);if(null===a)return null;if(a){x.databinOffset+=2}}return{codeblockBodyLengthByIndex:n,overallBodyLengthBytes:t}}function u(e){var t=Math.min(e,m.length);if(0===t)return{endOffset:a,numQualityLayers:0};var n=m[t-1],i=n.headerStartOffset+n.headerLength+n.overallBodyLengthBytes;return{endOffset:i,numQualityLayers:t}}function g(e){var t=[,,],i=n.copyBytes(t,0,{databinStartOffset:x.databinOffset,maxLengthToCopy:2,forceCopyAllRange:!1});switch(i){case 2:var r=255===t[0]&&t[1]===e;return r;case 1:return!(255!==t[0])&&null;default:return null;}}function f(){if(!I)throw new i.jpipExceptions.UnsupportedFeatureException('PPM or PPT','A.7.4 and A.7.5')}var m=[],x=l.createBitstreamReader(n),y=t.getNumCodeblocksXInPrecinct(o),h=t.getNumCodeblocksYInPrecinct(o),E=e.getNumQualityLayers(),I=e.getIsPacketHeaderNearData(),b=e.getIsStartOfPacketMarkerAllowed(),C=e.getIsEndPacketHeaderMarkerAllowed(),P=function(){for(var e=0===o.resolutionLevel?1:3,t=[],n=0;n<e;++n){var i,a;(0===o.resolutionLevel?(i=y,a=h):(i=1===n?s(y/2):r(y/2),a=0===n?s(h/2):r(h/2)),0!==i&&0!==a)&&t.push(l.createSubbandLengthInPacketHeaderCalculator(x,i,a))}return t}();this.calculateEndOffsetOfLastFullPacket=function(e){var t;if(!(e===void 0||e>=E))t=e;else if(!n.isAllDatabinLoaded())t=E;else{var i=n.getDatabinLengthIfKnown();return{endOffset:i,numQualityLayers:E}}f(),c(t);var r=u(t);return r},this.getPacketOffsetsByCodeblockIndex=function(e){return f(),c(e+1),m.length<=e?null:m[e]}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(n,s){var a=n.getCachedData(r);if(void 0!==a.calculator)return a.calculator;if(void 0===s)throw new i.jpipExceptions.InternalErrorException('precinctPosition should be given on the first time of using QualityLayersCache on this precinct');var o=e.getTileStructure(s.tileIndex),l=o.getComponentStructure(s.component);return a.calculator=t.createPacketLengthCalculator(o,l,n,0,s),a.calculator}var r='packetLengthCalculator';this.getPacketOffsetsByCodeblockIndex=function(e,t,i){var r=n(e,i),s=r.getPacketOffsetsByCodeblockIndex(t);return s},this.getQualityLayerOffset=function(e,t,i){var r=e.getExistingRanges(),s=n(e,i),a;1>r.length||0<r[0].start?(a=0,t=0):a=r[0].start+r[0].length;for(var o=s.calculateEndOffsetOfLastFullPacket(t);a<o.endOffset;){var l=o.numQualityLayers-1;o=s.calculateEndOffsetOfLastFullPacket(l)}return o}}},function(e,t,n){'use strict';function i(){this._image=new a.JpxImage}var r=Math.max,s=Math.min,a=n(1);e.exports=i;n(0);i.prototype.start=function(e){var t=this;return new Promise(function(n){var r={left:e.offsetInRegion.offsetX,top:e.offsetInRegion.offsetY,right:e.offsetInRegion.offsetX+e.offsetInRegion.width,bottom:e.offsetInRegion.offsetY+e.offsetInRegion.height},s=t._image.parseCodestream(e.headersCodestream,0,e.headersCodestream.length,{isOnlyParseHeaders:!0});if(e.codeblocksData&&t._image.addPacketsData(s,e.codeblocksData),e.precinctCoefficients)for(var a=0,i;a<e.precinctCoefficients.length;++a)i=e.precinctCoefficients[a],t._image.setPrecinctCoefficients(s,i.coefficients,i.tileIndex,i.c,i.r,i.p);t._image.decode(s,{regionToParse:r});var o=t._copyTilesPixelsToOnePixelsArray(t._image.tiles,r,t._image.componentsCount);n(o)})},i.prototype._copyTilesPixelsToOnePixelsArray=function(e,t,n){for(var a=e[0],o=t.right-t.left,l=t.bottom-t.top,c=new ImageData(o,l),d=4,p=o*d,u=0;u<e.length;++u){var i=e[u].left+e[u].width,g=e[u].top+e[u].height,f=r(t.left,e[u].left),m=r(t.top,e[u].top),x=s(t.right,i),y=s(t.bottom,g);if(f!==e[u].left||m!==e[u].top||x-f!==e[u].width||y-m!==e[u].height)throw'Unsupported tiles to copy';var h=f-t.left,E=m-t.top;this._copyTile(c.data,e[u],h*d+E*p,p,n)}return c},i.prototype._copyTile=function(e,t,n,i,r){var s=1,a=2,o=1,l=t.pixels||t.items;switch(void 0===r&&(r=l.length/(t.width*t.height)),r){case 1:s=0,a=0;break;case 3:o=3;break;case 4:o=4;break;default:throw'Unsupported components count '+r;}for(var c=n,d=0,p=0,u;p<t.height;++p){u=c;for(var g=0;g<t.width;++g)e[c+0]=l[d+0],e[c+1]=l[d+s],e[c+2]=l[d+a],e[c+3]=255,d+=o,c+=4;c=u+i}}},function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function i(e){m>=f.WARNINGS&&console.log('Warning: '+e)}function r(e){throw new Error(e)}function s(e,t){e||r(t)}function a(e){if(!e)return!1;switch(e.protocol){case'http:':case'https:':case'ftp:':case'mailto:':case'tel:':return!0;default:return!1;}}function o(e){s('string'==typeof e,'Invalid argument for stringToBytes');for(var t=e.length,n=new Uint8Array(t),r=0;r<t;++r)n[r]=255&e.charCodeAt(r);return n}function l(e){return void 0===e.length?(s(void 0!==e.byteLength),e.byteLength):e.length}var c=Math.max,d=Math.min,p=String.fromCharCode;Object.defineProperty(t,'__esModule',{value:!0});var u=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),g='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},f={ERRORS:0,WARNINGS:1,INFOS:5},m=f.WARNINGS,x=function(){function e(e,t){this.name='PasswordException',this.message=e,this.code=t}return e.prototype=new Error,e.constructor=e,e}(),y=function(){function e(e,t){this.name='UnknownErrorException',this.message=e,this.details=t}return e.prototype=new Error,e.constructor=e,e}(),h=function(){function e(e){this.name='InvalidPDFException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),E=function(){function e(e){this.name='MissingPDFException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),I=function(){function e(e,t){this.name='UnexpectedResponseException',this.message=e,this.status=t}return e.prototype=new Error,e.constructor=e,e}(),b=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name='FormatError',e.constructor=e,e}(),C=function(){function e(e){this.name='AbortException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),P=/\x00/g,T=['rgb(',0,',',0,',',0,')'],S=function(){function e(){n(this,e)}return u(e,null,[{key:'makeCssRgb',value:function(e,t,n){return T[1]=e,T[3]=t,T[5]=n,T.join('')}},{key:'transform',value:function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}},{key:'applyTransform',value:function(e,t){var n=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[n,i]}},{key:'applyInverseTransform',value:function(e,t){var n=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[i,r]}},{key:'getAxialAlignedBoundingBox',value:function(t,n){var i=e.applyTransform(t,n),r=e.applyTransform(t.slice(2,4),n),s=e.applyTransform([t[0],t[3]],n),a=e.applyTransform([t[2],t[1]],n);return[d(i[0],r[0],s[0],a[0]),d(i[1],r[1],s[1],a[1]),c(i[0],r[0],s[0],a[0]),c(i[1],r[1],s[1],a[1])]}},{key:'inverseTransform',value:function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}},{key:'apply3dTransform',value:function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]}},{key:'singularValueDecompose2dScale',value:function(e){var t=Math.sqrt,n=[e[0],e[2],e[1],e[3]],i=e[0]*n[0]+e[1]*n[2],r=e[0]*n[1]+e[1]*n[3],s=e[2]*n[0]+e[3]*n[2],a=e[2]*n[1]+e[3]*n[3],o=(i+a)/2,l=t((i+a)*(i+a)-4*(i*a-s*r))/2;return[t(o+l||1),t(o-l||1)]}},{key:'normalizeRect',value:function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}},{key:'intersect',value:function(t,n){function i(e,t){return e-t}var r=[t[0],t[2],n[0],n[2]].sort(i),s=[t[1],t[3],n[1],n[3]].sort(i),a=[];if(t=e.normalizeRect(t),n=e.normalizeRect(n),r[0]===t[0]&&r[1]===n[0]||r[0]===n[0]&&r[1]===t[0])a[0]=r[1],a[2]=r[2];else return null;if(s[0]===t[1]&&s[1]===n[1]||s[0]===n[1]&&s[1]===t[1])a[1]=s[1],a[3]=s[2];else return null;return a}}]),e}(),v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364],L=function(){var e='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';return function(t,n){var r=2<arguments.length&&arguments[2]!==void 0&&arguments[2];if(!r&&URL.createObjectURL){var s=new Blob([t],{type:n});return URL.createObjectURL(s)}for(var a='data:'+n+';base64,',o=0,i=t.length;o<i;o+=3){var l=255&t[o],c=255&t[o+1],d=255&t[o+2],p=o+1<i?(15&c)<<2|d>>6:64,u=o+2<i?63&d:64;a+=e[l>>2]+e[(3&l)<<4|c>>4]+e[p]+e[u]}return a}}();t.FONT_IDENTITY_MATRIX=[0.001,0,0,0.001,0,0],t.IDENTITY_MATRIX=[1,0,0,1,0,0],t.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},t.VerbosityLevel=f,t.UNSUPPORTED_FEATURES={unknown:'unknown',forms:'forms',javaScript:'javaScript',smask:'smask',shadingPattern:'shadingPattern',font:'font'},t.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},t.AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},t.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},t.AnnotationMarkedState={MARKED:'Marked',UNMARKED:'Unmarked'},t.AnnotationReplyType={GROUP:'Group',REPLY:'R'},t.AnnotationReviewState={ACCEPTED:'Accepted',REJECTED:'Rejected',CANCELLED:'Cancelled',COMPLETED:'Completed',NONE:'None'},t.AnnotationStateModelType={MARKED:'Marked',REVIEW:'Review'},t.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t.FontType={UNKNOWN:'UNKNOWN',TYPE1:'TYPE1',TYPE1C:'TYPE1C',CIDFONTTYPE0:'CIDFONTTYPE0',CIDFONTTYPE0C:'CIDFONTTYPE0C',TRUETYPE:'TRUETYPE',CIDFONTTYPE2:'CIDFONTTYPE2',TYPE3:'TYPE3',OPENTYPE:'OPENTYPE',TYPE0:'TYPE0',MMTYPE1:'MMTYPE1'},t.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},t.CMapCompressionType={NONE:0,BINARY:1,STREAM:2},t.AbortException=C,t.InvalidPDFException=h,t.MissingPDFException=E,t.NativeImageDecoding={NONE:'none',DECODE:'decode',DISPLAY:'display'},t.PasswordException=x,t.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},t.PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},t.StreamType={UNKNOWN:'UNKNOWN',FLATE:'FLATE',LZW:'LZW',DCT:'DCT',JPX:'JPX',JBIG:'JBIG',A85:'A85',AHX:'AHX',CCF:'CCF',RLX:'RLX'},t.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},t.UnexpectedResponseException=I,t.UnknownErrorException=y,t.Util=S,t.FormatError=b,t.arrayByteLength=l,t.arraysToBytes=function(e){var t=e.length;if(1===t&&e[0]instanceof Uint8Array)return e[0];for(var n=0,r=0;r<t;r++)n+=l(e[r]);for(var i=0,s=new Uint8Array(n),a=0,c;a<t;a++){c=e[a],c instanceof Uint8Array||('string'==typeof c?c=o(c):c=new Uint8Array(c));var d=c.byteLength;s.set(c,i),i+=d}return s},t.assert=s,t.bytesToString=function(e){s(null!==e&&'object'===('undefined'==typeof e?'undefined':g(e))&&e.length!==void 0,'Invalid argument for bytesToString');var t=e.length,n=8192;if(t<n)return p.apply(null,e);for(var r=[],a=0;a<t;a+=n){var i=d(a+n,t),o=e.subarray(a,i);r.push(p.apply(null,o))}return r.join('')},t.createPromiseCapability=function(){var e=Object.create(null),t=!1;return Object.defineProperty(e,'settled',{get:function(){return t}}),e.promise=new Promise(function(n,i){e.resolve=function(e){t=!0,n(e)},e.reject=function(e){t=!0,i(e)}}),e},t.createObjectURL=L,t.getVerbosityLevel=function(){return m},t.info=function(e){m>=f.INFOS&&console.log('Info: '+e)},t.isArrayBuffer=function(e){return'object'===('undefined'==typeof e?'undefined':g(e))&&null!==e&&e.byteLength!==void 0},t.isArrayEqual=function(e,t){return!(e.length!==t.length)&&e.every(function(e,n){return e===t[n]})},t.isBool=function(e){return'boolean'==typeof e},t.isEmptyObj=function(e){for(var t in e)return!1;return!0},t.isNum=function(e){return'number'==typeof e},t.isString=function(e){return'string'==typeof e},t.isSpace=function(e){return 32===e||9===e||13===e||10===e},t.isSameOrigin=function(e,t){var n;try{if(n=new URL(e),!n.origin||'null'===n.origin)return!1}catch(t){return!1}var i=new URL(t,n);return n.origin===i.origin},t.createValidAbsoluteUrl=function(e,t){if(!e)return null;try{var n=t?new URL(e,t):new URL(e);if(a(n))return n}catch(e){}return null},t.isLittleEndian=function(){var e=new Uint8Array(4);e[0]=1;var t=new Uint32Array(e.buffer,0,1);return 1===t[0]},t.isEvalSupported=function(){try{return new Function(''),!0}catch(t){return!1}},t.log2=function(e){return 0>=e?0:Math.ceil(Math.log2(e))},t.readInt8=function(e,t){return e[t]<<24>>24},t.readUint16=function(e,t){return e[t]<<8|e[t+1]},t.readUint32=function(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0},t.removeNullCharacters=function(e){return'string'==typeof e?e.replace(P,''):(i('The argument for removeNullCharacters must be a string.'),e)},t.ReadableStream=ReadableStream,t.URL=URL,t.setVerbosityLevel=function(e){Number.isInteger(e)&&(m=e)},t.shadow=function(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n},t.string32=function(e){return p(255&e>>24,255&e>>16,255&e>>8,255&e)},t.stringToBytes=o,t.stringToPDFString=function(e){var t=e.length,n=[];if('\xFE'===e[0]&&'\xFF'===e[1])for(var r=2;r<t;r+=2)n.push(p(e.charCodeAt(r)<<8|e.charCodeAt(r+1)));else for(var i=0,s;i<t;++i)s=v[e.charCodeAt(i)],n.push(s?p(s):e.charAt(i));return n.join('')},t.stringToUTF8String=function(e){return decodeURIComponent(escape(e))},t.utf8StringToString=function(e){return unescape(encodeURIComponent(e))},t.warn=i,t.unreachable=r},function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(t,'__esModule',{value:!0});var i=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}],s=function(){function e(t,i,r){n(this,e),this.data=t,this.bp=i,this.dataEnd=r,this.chigh=t[i],this.clow=0,this.byteIn(),this.chigh=65535&this.chigh<<7|127&this.clow>>9,this.clow=65535&this.clow<<7,this.ct-=7,this.a=32768}return i(e,[{key:'byteIn',value:function(){var e=this.data,t=this.bp;255===e[t]?143<e[t+1]?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t):(t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t),65535<this.clow&&(this.chigh+=this.clow>>16,this.clow&=65535)}},{key:'readBit',value:function(e,t){var n=e[t]>>1,i=1&e[t],s=r[n],o=s.qe,l=this.a-o,a;if(this.chigh<o)l<o?(l=o,a=i,n=s.nmps):(l=o,a=1^i,1===s.switchFlag&&(i=a),n=s.nlps);else{if(this.chigh-=o,0!=(32768&l))return this.a=l,i;l<o?(a=1^i,1===s.switchFlag&&(i=a),n=s.nlps):(a=i,n=s.nmps)}do 0===this.ct&&this.byteIn(),l<<=1,this.chigh=65535&this.chigh<<1|1&this.clow>>15,this.clow=65535&this.clow<<1,this.ct--;while(0==(32768&l));return this.a=l,e[t]=n<<1|i,a}}]),e}();t.ArithmeticDecoder=s},function(e,t,n){'use strict';function i(){this._image=new a.JpxImage}var r=Math.max,s=Math.min,a=n(1);e.exports=i;n(0);i.prototype.start=function(e){var t=this;return new Promise(function(n){for(var r={left:e.offsetInRegion.offsetX,top:e.offsetInRegion.offsetY,right:e.offsetInRegion.offsetX+e.offsetInRegion.width,bottom:e.offsetInRegion.offsetY+e.offsetInRegion.height},s=t._image.parseCodestream(e.headersCodestream,0,e.headersCodestream.length,{isOnlyParseHeaders:!0}),a=e.imageTilesX,o=e.tilesBounds.maxTileXExclusive-e.tilesBounds.minTileX,l=e.tilesBounds.minTileX,c=e.tilesBounds.minTileY,d=0;d<e.precinctCoefficients.length;++d){var i=e.precinctCoefficients[d],p=i.key.tileIndex,u=Math.floor(p/a);t._image.setPrecinctCoefficients(s,i.coefficients,p%a-l+(u-c)*o,i.key.component,i.key.resolutionLevel,i.key.precinctIndexInComponentResolution)}t._image.decode(s,{regionToParse:r});var g=t._copyTilesPixelsToOnePixelsArray(t._image.tiles,r,t._image.componentsCount);n(g)})},i.prototype._copyTilesPixelsToOnePixelsArray=function(e,t,n){for(var a=e[0],o=t.right-t.left,l=t.bottom-t.top,c=new ImageData(o,l),d=4,p=o*d,u=0;u<e.length;++u){var i=e[u].left+e[u].width,g=e[u].top+e[u].height,f=r(t.left,e[u].left),m=r(t.top,e[u].top),x=s(t.right,i),y=s(t.bottom,g);if(f!==e[u].left||m!==e[u].top||x-f!==e[u].width||y-m!==e[u].height)throw'Unsupported tiles to copy';var h=f-t.left,E=m-t.top;this._copyTile(c.data,e[u],h*d+E*p,p,n)}return c},i.prototype._copyTile=function(e,t,n,i,r){var s=1,a=2,o=1,l=t.pixels||t.items;switch(void 0===r&&(r=l.length/(t.width*t.height)),r){case 1:s=0,a=0;break;case 3:o=3;break;case 4:o=4;break;default:throw'Unsupported components count '+r;}for(var c=n,d=0,p=0,u;p<t.height;++p){u=c;for(var g=0;g<t.width;++g)e[c+0]=l[d+0],e[c+1]=l[d+s],e[c+2]=l[d+a],e[c+3]=255,d+=o,c+=4;c=u+i}}},function(e,t,n){'use strict';function i(){this._image=new r.JpxImage}var r=n(1);e.exports=i;n(0);i.prototype.start=function(e,t){var n=this;return new Promise(function(r){var s=n._image.parseCodestream(e.headersCodestream,0,e.headersCodestream.length,{isOnlyParseHeaders:!0});if(e.codeblocksData&&n._image.addPacketsData(s,e.codeblocksData),e.precinctCoefficients)for(var a=0,i;a<e.precinctCoefficients.length;++a)i=e.precinctCoefficients[a],n._image.setPrecinctCoefficients(s,i.coefficients,i.tileIndex,i.c,i.r,i.p);var o=n._image.decodePrecinctCoefficients(s,0,t.component,t.resolutionLevel,t.precinctIndexInComponentResolution);r({key:t,coefficients:o,minQuality:e.minQuality})})}}]);