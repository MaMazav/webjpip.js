var webjpip=function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=3)}([function(e){'use strict';e.exports.j2kMarkers={StartOfCodestream:[255,79],ImageAndTileSize:[255,81],CodingStyleDefault:[255,82],CodingStyleComponent:[255,83],QuantizationDefault:[255,92],ProgressionOrderChange:[255,95],PackedPacketHeadersInMainHeader:[255,96],PackedPacketHeadersInTileHeader:[255,97],StartOfTile:[255,144],StartOfData:[255,147],EndOfCodestream:[255,217],Comment:[255,100]},e.exports.j2kOffsets={MARKER_SIZE:2,LENGTH_FIELD_SIZE:2,NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER:38,REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER:6},e.exports.jpipEndOfResponseReasons={IMAGE_DONE:1,WINDOW_DONE:2,WINDOW_CHANGE:3,BYTE_LIMIT:4,QUALITY_LIMIT:5,SESSION_LIMIT:6,RESPONSE_LIMIT:7,NON_SPECIFIED:8},e.exports.j2kExceptions={UnsupportedFeatureException:function(e,t){return this.description=e+' (specified in section '+t+' of part 1: Core Coding System standard) is not supported yet',this.toString=function(){return'J2k UnsupportedFeatureException: '+this.description},this},ParseException:function(e){return this.description=e,this.toString=function(){return'J2k ParseException: '+this.description},this},IllegalDataException:function(e,t){return this.description=e+' (see section '+t+' of part 9: Interactivity tools, APIs and Protocols)',this.toString=function(){return'J2k IllegalDataException: '+this.description},this}},e.exports.jpipExceptions={UnsupportedFeatureException:function(e,t){return this.description=e+' (specified in section '+t+' of part 9: Interactivity tools, APIs and Protocols) is not supported yet',this.toString=function(){return'Jpip UnsupportedFeatureException: '+this.description},this},ParseException:function(e){return this.description=e,this.toString=function(){return'Jpip ParseException: '+this.description},this},IllegalDataException:function(e,t){return this.description=e+' (see section '+t+' of part 9: Interactivity tools, APIs and Protocols)',this.toString=function(){return'Jpip IllegalDataException: '+this.description},this},IllegalOperationException:function(e){return this.description=e,this.toString=function(){return'Jpip IllegalOperationException: '+this.description},this},ArgumentException:function(e,t,n){return this.description='Argument '+e+' has invalid value '+t+(void 0===n?'':' :'+n),this.toString=function(){return'Jpip ArgumentException: '+this.description},this},WrongStreamException:function(e,t){var n='JPP (JPIP Precinct)',i='JPT (JPIP Tile-part)';if(t){var s=n;n=i,i=s}return this.description='Stream type is '+i+', but '+e+' is allowed only in '+n+' stream',this.toString=function(){return'Jpip WrongStreamException: '+this.description},this},InternalErrorException:function(e){return this.description=e,this.toString=function(){return'Jpip InternalErrorException: '+this.description},this}},e.exports.j2kExceptions.UnsupportedFeatureException.Name='j2kExceptions.UnsupportedFeatureException',e.exports.j2kExceptions.ParseException.Name='j2kExceptions.ParseException',e.exports.j2kExceptions.IllegalDataException.Name='j2kExceptions.IllegalDataException',e.exports.jpipExceptions.UnsupportedFeatureException.Name='jpipExceptions.UnsupportedFeatureException',e.exports.jpipExceptions.ParseException.Name='jpipExceptions.ParseException',e.exports.jpipExceptions.IllegalDataException.Name='jpipExceptions.IllegalDataException',e.exports.jpipExceptions.IllegalOperationException.Name='jpipExceptions.IllegalOperationException',e.exports.jpipExceptions.ArgumentException.Name='jpipExceptions.ArgumentException',e.exports.jpipExceptions.WrongStreamException.Name='jpipExceptions.WrongStreamException',e.exports.jpipExceptions.InternalErrorException.Name='jpipExceptions.InternalErrorException'},function(e,t,n){'use strict';var s=Math.floor,a=Math.ceil,o=Math.max,d=Math.min;Object.defineProperty(t,'__esModule',{value:!0}),t.JpxImage=void 0;var r=n(43),i=n(45),u=function(){function e(e){this.message='JPX error: '+e}return e.prototype=new Error,e.prototype.name='JpxError',e.constructor=e,e}(),l=function(){function e(){this.failOnCorruptedImage=!1}function t(e,t){for(var n=t.subbands,s=0,i;s<e.subbandPrecincts.length;++s){var r='LL'!==t.subbands[s].type,a=e.subbandPrecincts[s].tbxMin_,l=e.subbandPrecincts[s].tbyMin_,c=e.subbandPrecincts[s].tbxMax_,p=e.subbandPrecincts[s].tbyMax_;r&&(a=2*(a-t.subbands[s].tbx0)+t.trx0,l=2*(l-t.subbands[s].tby0)+t.try0,c=2*(c-t.subbands[s].tbx0)+t.trx0,p=2*(p-t.subbands[s].tby0)+t.try0),0===s?i={x0:a,y0:l,x1:c,y1:p}:(i.x0=d(i.x0,a),i.y0=d(i.y0,l),i.x1=o(i.x1,c),i.y1=o(i.y1,p))}return i}function n(e,t){e.x0=a(t.XOsiz/e.XRsiz),e.x1=a(t.Xsiz/e.XRsiz),e.y0=a(t.YOsiz/e.YRsiz),e.y1=a(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function l(e,t){for(var n=e.SIZ,s=[],r=a((n.Xsiz-n.XTOsiz)/n.XTsiz),l=a((n.Ysiz-n.YTOsiz)/n.YTsiz),c=0,u;c<l;c++)for(var g=0;g<r;g++)u={},u.tx0=o(n.XTOsiz+g*n.XTsiz,n.XOsiz),u.ty0=o(n.YTOsiz+c*n.YTsiz,n.YOsiz),u.tx1=d(n.XTOsiz+(g+1)*n.XTsiz,n.Xsiz),u.ty1=d(n.YTOsiz+(c+1)*n.YTsiz,n.Ysiz),u.width=u.tx1-u.tx0,u.height=u.ty1-u.ty0,u.components=[],s.push(u);e.tiles=s;for(var p=n.Csiz,m=0,i;m<p;m++){i=t[m];for(var f=0,x=s.length,h;f<x;f++)h={},u=s[f],h.tcx0=a(u.tx0/i.XRsiz),h.tcy0=a(u.ty0/i.YRsiz),h.tcx1=a(u.tx1/i.XRsiz),h.tcy1=a(u.ty1/i.YRsiz),h.width=h.tcx1-h.tcx0,h.height=h.tcy1-h.tcy0,u.components[m]=h}}function c(e,t,n){var i=t.codingStyleParameters,s={};return i.entropyCoderWithCustomPrecincts?(s.PPx=i.precinctsSizes[n].PPx,s.PPy=i.precinctsSizes[n].PPy):(s.PPx=15,s.PPy=15),s.xcb_=0<n?d(i.xcb,s.PPx-1):d(i.xcb,s.PPx),s.ycb_=0<n?d(i.ycb,s.PPy-1):d(i.ycb,s.PPy),s}function p(e,t,n){var i=1<<n.PPx,r=1<<n.PPy,o=0===t.resLevel,l=1<<n.PPx+(o?0:-1),c=1<<n.PPy+(o?0:-1),d=t.trx1>t.trx0?a(t.trx1/i)-s(t.trx0/i):0,p=t.try1>t.try0?a(t.try1/r)-s(t.try0/r):0;t.precinctParameters={precinctWidth:i,precinctHeight:r,numprecinctswide:d,numprecinctshigh:p,numprecincts:d*p,precinctWidthInSubband:l,precinctHeightInSubband:c}}function g(e,t,n,r){var a=n.xcb_,l=n.ycb_,c=1<<a,p=1<<l,u=t.tbx0>>a,g=t.tby0>>l,m=t.tbx1+c-1>>a,f=t.tby1+p-1>>l,x=t.resolution.precinctParameters,h=[],y=[],I,E,b,C;for(E=g;E<f;E++)for(I=u;I<m;I++){b={cbx:I,cby:E,tbx0:c*I,tby0:p*E,tbx1:c*(I+1),tby1:p*(E+1)},b.tbx0_=o(t.tbx0,b.tbx0),b.tby0_=o(t.tby0,b.tby0),b.tbx1_=d(t.tbx1,b.tbx1),b.tby1_=d(t.tby1,b.tby1);var P=s((b.tbx0_-t.tbx0)/x.precinctWidthInSubband),T=s((b.tby0_-t.tby0)/x.precinctHeightInSubband);if(C=P+T*x.numprecinctswide,b.precinctNumber=C,b.subbandType=t.type,b.Lblock=3,!(b.tbx1_<=b.tbx0_||b.tby1_<=b.tby0_)){h.push(b);var S=y[C];void 0===S?y[C]=S={cbxMin:I,cbyMin:E,cbxMax:I,cbyMax:E,tbxMin_:b.tbx0_,tbxMax_:b.tbx1_,tbyMin_:b.tby0_,tbyMax_:b.tby1_,pixelsPrecinct:t.resolution.pixelsPrecincts[C]}:(I<S.cbxMin?(S.cbxMin=I,S.tbxMin_=b.tbx0_):I>S.cbxMax&&(S.cbxMax=I,S.tbxMax_=b.tbx1_),E<S.cbyMin?(S.cbyMin=E,S.tbyMin_=b.tby0_):E>S.cbyMax&&(S.cbyMax=E,S.tbyMax_=b.tby1_)),void 0===S.pixelsPrecinct&&(S.pixelsPrecinct={codeblocks:[],subbandPrecincts:[]},t.resolution.pixelsPrecincts[C]=S.pixelsPrecinct),b.precinct=S;var v=S.pixelsPrecinct;v.codeblocks.push(b),void 0===v.subbandPrecincts[r]&&(v.subbandPrecincts[r]=S)}}t.codeblockParameters={codeblockWidth:a,codeblockHeight:l,numcodeblockwide:m-u+1,numcodeblockhigh:f-g+1},t.codeblocks=h,t.subbandPrecincts=y}function m(e,t,n){return{layerNumber:n,codeblocks:e.pixelsPrecincts[t].codeblocks}}function f(e){for(var t=e.SIZ,n=e.currentTile.index,s=e.tiles[n],a=s.codingStyleDefaultParameters.layersCount,c=t.Csiz,d=0,p=0;p<c;p++)d=o(d,s.components[p].codingStyleParameters.decompositionLevelsCount);var g=0,l=0,r=0,i=0;this.nextPacket=function(){for(;g<a;g++){for(;l<=d;l++){for(;r<c;r++){var e=s.components[r];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[l],n=t.precinctParameters.numprecincts,o;i<n;)return o=m(t,i,g),i++,o;i=0}}r=0}l=0}throw new u('Out of packets')}}function x(e){for(var t=e.SIZ,n=e.currentTile.index,s=e.tiles[n],a=s.codingStyleDefaultParameters.layersCount,c=t.Csiz,d=0,p=0;p<c;p++)d=o(d,s.components[p].codingStyleParameters.decompositionLevelsCount);var g=0,r=0,l=0,i=0;this.nextPacket=function(){for(;g<=d;g++){for(;r<a;r++){for(;l<c;l++){var e=s.components[l];if(!(g>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[g],n=t.precinctParameters.numprecincts,o;i<n;)return o=m(t,i,r),i++,o;i=0}}l=0}r=0}throw new u('Out of packets')}}function h(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],s=i.codingStyleDefaultParameters.layersCount,a=t.Csiz,d=0,g,l,r,c;for(r=0;r<a;r++){var p=i.components[r];d=o(d,p.codingStyleParameters.decompositionLevelsCount)}var f=new Int32Array(d+1);for(l=0;l<=d;++l){var x=0;for(r=0;r<a;++r){var h=i.components[r].resolutions;l<h.length&&(x=o(x,h[l].precinctParameters.numprecincts))}f[l]=x}g=0,l=0,r=0,c=0,this.nextPacket=function(){for(;l<=d;l++){for(;c<f[l];c++){for(;r<a;r++){var e=i.components[r];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){var t=e.resolutions[l],n=t.precinctParameters.numprecincts;if(!(c>=n)){for(;g<s;){var o=m(t,c,g);return g++,o}g=0}}}r=0}c=0}throw new u('Out of packets')}}function y(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],s=i.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=b(i),d=o,p=0,l=0,r=0,c=0,g=0;this.nextPacket=function(){for(;g<d.maxNumHigh;g++){for(;c<d.maxNumWide;c++){for(;r<a;r++){for(var e=i.components[r],t=e.codingStyleParameters.decompositionLevelsCount;l<=t;l++){var n=e.resolutions[l],f=o.components[r].resolutions[l],x=E(c,g,f,d,n);if(null!==x){for(;p<s;){var h=m(n,x,p);return p++,h}p=0}}l=0}r=0}c=0}throw new u('Out of packets')}}function I(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],s=i.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=b(i),d=0,l=0,r=0,c=0,p=0;this.nextPacket=function(){for(;r<a;++r){for(var e=i.components[r],t=o.components[r],n=e.codingStyleParameters.decompositionLevelsCount;p<t.maxNumHigh;p++){for(;c<t.maxNumWide;c++){for(;l<=n;l++){var g=e.resolutions[l],f=t.resolutions[l],x=E(c,p,f,t,g);if(null!==x){for(;d<s;){var h=m(g,x,d);return d++,h}d=0}}l=0}c=0}p=0}throw new u('Out of packets')}}function E(e,t,n,i,s){var r=e*i.minWidth,a=t*i.minHeight;if(0!=r%n.width||0!=a%n.height)return null;var o=a/n.width*s.precinctParameters.numprecinctswide;return r/n.height+o}function b(e){for(var t=Number.MAX_VALUE,n=e.components.length,i=t,s=t,a=0,l=0,p=Array(n),u=0;u<n;u++){for(var c=e.components[u],g=c.codingStyleParameters.decompositionLevelsCount,m=Array(g+1),f=t,x=t,h=0,y=0,I=1,E=g;0<=E;--E){var r=c.resolutions[E],b=I*r.precinctParameters.precinctWidth,C=I*r.precinctParameters.precinctHeight;f=d(f,b),x=d(x,C),h=o(h,r.precinctParameters.numprecinctswide),y=o(y,r.precinctParameters.numprecinctshigh),m[E]={width:b,height:C},I<<=1}i=d(i,f),s=d(s,x),a=o(a,h),l=o(l,y),p[u]={resolutions:m,minWidth:f,minHeight:x,maxNumWide:h,maxNumHigh:y}}return{components:p,minWidth:i,minHeight:s,maxNumWide:a,maxNumHigh:l}}function C(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],s=t.Csiz,o=0;o<s;o++){for(var l=i.components[o],d=l.codingStyleParameters.decompositionLevelsCount,m=[],E=[],b=0,C=0;C<=d;C++){var r=c(e,l,C),P={},T=1<<d-C;P.trx0=a(l.tcx0/T),P.try0=a(l.tcy0/T),P.trx1=a(l.tcx1/T),P.try1=a(l.tcy1/T),P.resLevel=C,P.pixelsPrecincts=[],p(e,P,r),m.push(P);var S;if(0===C)S={},S.type='LL',S.tbx0=a(l.tcx0/T),S.tby0=a(l.tcy0/T),S.tbx1=a(l.tcx1/T),S.tby1=a(l.tcy1/T),S.resolution=P,S.indexInTileComponent=b++,g(e,S,r,0),E.push(S),P.subbands=[S];else{var v=1<<d-C+1,L=[];S={},S.type='HL',S.tbx0=a(l.tcx0/v-0.5),S.tby0=a(l.tcy0/v),S.tbx1=a(l.tcx1/v-0.5),S.tby1=a(l.tcy1/v),S.resolution=P,S.indexInTileComponent=b++,g(e,S,r,0),E.push(S),L.push(S),S={},S.type='LH',S.tbx0=a(l.tcx0/v),S.tby0=a(l.tcy0/v-0.5),S.tbx1=a(l.tcx1/v),S.tby1=a(l.tcy1/v-0.5),S.resolution=P,S.indexInTileComponent=b++,g(e,S,r,1),E.push(S),L.push(S),S={},S.type='HH',S.tbx0=a(l.tcx0/v-0.5),S.tby0=a(l.tcy0/v-0.5),S.tbx1=a(l.tcx1/v-0.5),S.tby1=a(l.tcy1/v-0.5),S.resolution=P,S.indexInTileComponent=b++,g(e,S,r,2),E.push(S),L.push(S),P.subbands=L}}l.resolutions=m,l.subbands=E}var O=i.codingStyleDefaultParameters.progressionOrder;switch(O){case 0:i.packetsIterator=new f(e);break;case 1:i.packetsIterator=new x(e);break;case 2:i.packetsIterator=new h(e);break;case 3:i.packetsIterator=new y(e);break;case 4:i.packetsIterator=new I(e);break;default:throw new u('Unsupported progression order '+O);}}function P(e,t,n,s){function a(e){for(;u<e;){var i=t[n+p];p++,g?(I=I<<7|i,u+=7,g=!1):(I=I<<8|i,u+=8),255===i&&(g=!0)}return u-=e,I>>>u&(1<<e)-1}function o(e){return 255===t[n+p-1]&&t[n+p]===e?(l(1),!0):255===t[n+p]&&t[n+p+1]===e&&(l(2),!0)}function l(e){p+=e}function c(){u=0,g&&(p++,g=!1)}function d(){if(0===a(1))return 1;if(0===a(1))return 2;var e=a(2);return 3>e?e+3:(e=a(5),31>e)?e+6:(e=a(7),e+37)}for(var p=0,u=0,g=!1,m=e.currentTile.index,f=e.tiles[m],x=e.COD.sopMarkerUsed,h=e.COD.ephMarkerUsed,y=f.packetsIterator,I;p<s;){c(),x&&o(145)&&l(4);var E=y.nextPacket();if(a(1)){for(var b=E.layerNumber,C=[],P=0,i=E.codeblocks.length,T;P<i;P++){T=E.codeblocks[P];var S=T.precinct,v=T.cbx-S.cbxMin,L=T.cby-S.cbyMin,O=!1,D=!1,A;if(void 0!==T.included)O=!!a(1);else{S=T.precinct;var _,j;if(void 0!==S.inclusionTree)_=S.inclusionTree;else{var N=S.cbxMax-S.cbxMin+1,F=S.cbyMax-S.cbyMin+1;_=new R(N,F,b),j=new k(N,F),S.inclusionTree=_,S.zeroBitPlanesTree=j}if(_.reset(v,L,b))for(;;)if(!a(1)){_.incrementValue(b);break}else if(A=!_.nextLevel(),A){T.included=!0,O=D=!0;break}}if(O){if(D){for(j=S.zeroBitPlanesTree,j.reset(v,L);;)if(!a(1))j.incrementValue();else if(A=!j.nextLevel(),A)break;T.zeroBitPlanes=j.value}for(var B=d();a(1);)T.Lblock++;var M=(0,r.log2)(B),w=(B<1<<M?M-1:M)+T.Lblock,q=a(w);C.push({codeblock:T,codingpasses:B,dataLength:q})}}for(c(),h&&o(146);0<C.length;){var X=C.shift();T=X.codeblock,void 0===T.data&&(T.data=[]),T.data.push({data:t,start:n+p,end:n+p+X.dataLength,codingpasses:X.codingpasses}),p+=X.dataLength}}}return p}function T(e,a,l,c,p,u,g,m){var f=m.x1-m.x0,x=m.y1-m.y0,h=new Float32Array(f*x),y={x0:0,x1:0,y0:0,y1:1},I;if(e.hasDecodedCoefficients){for(var E=!0,b=e.subbands,C='LL'!==b[0].type,P=0,T=e.pixelsPrecincts.length,S;P<T;++P){if(S=e.pixelsPrecincts[P],!S.decodedCoefficients){E=!1;continue}var v=t(S,e),L=o(v.x0,m.x0),k=o(v.y0,m.y0),R=d(v.x1,m.x1),A=d(v.y1,m.y1);if(!(L>=R||k>=A))for(var _=S.decodedCoefficients,N=R-L,F=v.x1-v.x0,B=f,M=L-v.x0+(k-v.y0)*F,w=L-m.x0+(k-m.y0)*B,q=k;q<A;++q)h.set(_.subarray(M,M+N),w),M+=F,w+=B}if(E)return h}for(var X=0,s=e.subbands.length;X<s;X++){var H=e.subbands[X],C='LL'!==H.type,I;C?(y.x0=(m.x0-e.trx0)/2+H.tbx0,y.y0=(m.y0-e.try0)/2+H.tby0,y.x1=(m.x1-e.trx0)/2+H.tbx0,y.y1=(m.y1-e.try0)/2+H.tby0,I=y):I=m;var Y='H'===H.type.charAt(0)?1:0,U='H'===H.type.charAt(1)?f:0,C='LL'!==H.type,z=C?2:1,W=f*z,Q={x0:0,y0:0,x1:0,y1:0},V,J;if(!l){V=a[0].mu;var K=H.resolution.resLevel;J=a[0].epsilon+(0<K?1-K:0)}else{var r=H.indexInTileComponent;V=a[r].mu,J=a[r].epsilon}for(var Z=O[H.type],G=u?1:Math.pow(2,c+Z-J)*(1+V/2048),$=p+J-1,ee=0,te=H.codeblocks.length,ne;ee<te;++ee)if((ne=H.codeblocks[ee],void 0!==ne.data)&&!ne.precinct.pixelsPrecinct.decodedCoefficients&&(Q.x0=o(ne.tbx0_,I.x0),Q.y0=o(ne.tby0_,I.y0),Q.x1=d(ne.tbx1_,I.x1),Q.y1=d(ne.tby1_,I.y1),!(Q.x0>=Q.x1||Q.y0>=Q.y1))){var ie=(Q.x0-I.x0)*z+(Q.y0-I.y0)*W+(Y+U),se=ne.tbx1_-ne.tbx0_,re=ne.tby1_-ne.tby0_,ae,oe;ae=new D(se,re,ne.subbandType,ne.zeroBitPlanes,$),oe=2;var le=ne.data,ce=0,de=0,pe,j,ue;for(pe=0,j=le.length;pe<j;pe++)ue=le[pe],ce+=ue.end-ue.start,de+=ue.codingpasses;var ge=new Uint8Array(ce),me=0;for(pe=0,j=le.length;pe<j;pe++){ue=le[pe];var fe=ue.data.subarray(ue.start,ue.end);ge.set(fe,me),me+=fe.length}var xe=new i.ArithmeticDecoder(ge,0,ce);for(ae.setDecoder(xe),pe=0;pe<de;pe++)0===oe?ae.runSignificancePropagationPass():1===oe?ae.runMagnitudeRefinementPass():2===oe?(ae.runCleanupPass(),g&&ae.checkSegmentationSymbol()):void 0,oe=(oe+1)%3;for(var he=ne.tbx0_-L+(ne.tby0_-k)*N,ye=ae.coefficentsSign,Ie=ae.coefficentsMagnitude,Ee=ae.bitsDecoded,be=u?0:0.5,Ce=Q.x0-ne.tbx0_+(Q.y0-ne.tby0_)*se,Pe=ie,pe=Q.y0,P,Te,Se;pe<Q.y1;pe++){var me=Ce,ve=Pe;for(Ce+=se,Pe+=W,P=Q.x0;P<Q.x1;P++)Te=Ie[me],0!==Te&&(Te=(Te+be)*G,0!==ye[me]&&(Te=-Te),Se=Ee[me],h[ve]=u&&Se>=$?Te:Te*(1<<$-Se)),he++,me++,ve+=z;he+=N-se}}}return h}function S(e,t,n){var r=t.components[n],l=r.codingStyleParameters,c=r.quantizationParameters,p=l.decompositionLevelsCount,u=c.SPqcds,g=c.scalarExpounded,m=c.guardBits,f=l.segmentationSymbolUsed,x=e.components[n].precision,h=l.reversibleTransformation,y=h?new j:new _,I;if(void 0!==e.regionToParse){var E=d(r.tcx1,e.regionToParse.right),b=d(r.tcy1,e.regionToParse.bottom);I={x0:o(0,e.regionToParse.left-r.tcx0),y0:o(0,e.regionToParse.top-r.tcy0),x1:E-r.tcx0,y1:b-r.tcy0}}for(var C=[],P={x0:0,y0:0,x1:0,y1:0},S=0;S<=p;S++){var i=r.resolutions[S],v=i.trx1-i.trx0,L=i.try1-i.try0,P;if(void 0===I)P.x0=i.trx0,P.y0=i.try0,P.x1=i.trx1,P.y1=i.try1;else{var O=1<<p-S,k=4;P.x0=a(I.x0/O)-k,P.y0=a(I.y0/O)-k,P.x1=a(I.x1/O)+k,P.y1=a(I.y1/O)+k,P.x0=2*s(P.x0/2)+i.trx0,P.y0=2*s(P.y0/2)+i.try0,P.x1=2*s(P.x1/2)+i.trx0,P.y1=2*s(P.y1/2)+i.try0,P.x0=o(P.x0,i.trx0),P.y0=o(P.y0,i.try0),P.x1=d(P.x1,i.trx1),P.y1=d(P.y1,i.try1)}var R=T(i,u,g,x,m,h,f,P),D={x0:P.x0-i.trx0,y0:P.y0-i.try0,x1:P.x1-i.trx0,y1:P.y1-i.try0};C.push({width:v,height:L,items:R,relativeRegionInLevel:D})}var A=y.calculate(C,r.tcx0,r.tcy0),N=A.relativeRegionInLevel,F=N.x1-N.x0,B=!1;if(void 0!==e.regionToParse&&(B=I.x0!==N.x0||I.y0!==N.y0||I.x1!==N.x1||I.y1!==N.y1),!B){var M=N.y1-N.y0;return{left:r.tcx0,top:r.tcy0,width:F,height:M,items:A.items}}for(var v=I.x1-I.x0,L=I.y1-I.y0,w=A.items,q=new Float32Array(v*L),X=I.y0-N.y0,H=I.x0-N.x0,Y=0,U=H+F*X,S=0,z;S<L;++S)z=U+v,q.set(w.subarray(U,z),Y),U+=F,Y+=v;return{left:r.tcx0+I.x0,top:r.tcy0+I.y0,width:v,height:L,items:q}}function v(e){for(var t=e.SIZ,n=e.components,s=t.Csiz,r=[],a=0,i=e.tiles.length,o;a<i;a++)if(o=e.tiles[a],!(void 0!==e.regionToParse&&(e.regionToParse.left>=o.tx1||e.regionToParse.top>=o.ty1||e.regionToParse.right<=o.tx0||e.regionToParse.bottom<=o.ty0))){var l=[],d;for(d=0;d<s;d++)l[d]=S(e,o,d);var c=l[0],p=new Uint8ClampedArray(c.items.length*s),u={left:c.left,top:c.top,width:c.width,height:c.height,items:p},m=0,f,x,h,y,I,E,b;if(o.codingStyleDefaultParameters.multipleComponentTransform){var C=4===s,P=l[0].items,T=l[1].items,v=l[2].items,L=C?l[3].items:null;f=n[0].precision-8,x=(128<<f)+0.5;var O=o.components[0],k=s-3;if(y=P.length,!O.codingStyleParameters.reversibleTransformation)for(h=0;h<y;h++,m+=k)I=P[h]+x,E=T[h],b=v[h],p[m++]=I+1.402*b>>f,p[m++]=I-0.34413*E-0.71414*b>>f,p[m++]=I+1.772*E>>f;else for(h=0;h<y;h++,m+=k){I=P[h]+x,E=T[h],b=v[h];var R=I-(b+E>>2);p[m++]=R+b>>f,p[m++]=R>>f,p[m++]=R+E>>f}if(C)for(h=0,m=3;h<y;h++,m+=4)p[m]=L[h]+x>>f}else for(d=0;d<s;d++){var g=l[d].items;for(f=n[d].precision-8,x=(128<<f)+0.5,(m=d,h=0,y=g.length);h<y;h++)p[m]=g[h]+x>>f,m+=s}r.push(u)}return r}function L(e,t){for(var n=e.SIZ,i=n.Csiz,s=e.tiles[t],r=0;r<i;r++){var a=s.components[r],o=e.currentTile.QCC[r]===void 0?e.currentTile.QCD:e.currentTile.QCC[r];a.quantizationParameters=o;var l=e.currentTile.COC[r]===void 0?e.currentTile.COD:e.currentTile.COC[r];a.codingStyleParameters=l}s.codingStyleDefaultParameters=e.currentTile.COD}var O={LL:0,LH:1,HL:1,HH:2};e.prototype={parse:function(e){var t=(0,r.readUint16)(e,0);if(65359===t)return void this.parseCodestream(e,0,e.length);for(var n=0,i=e.length;n<i;){var s=8,a=(0,r.readUint32)(e,n),o=(0,r.readUint32)(e,n+4);if(n+=s,1===a&&(a=4294967296*(0,r.readUint32)(e,n)+(0,r.readUint32)(e,n+4),n+=8,s+=8),0===a&&(a=i-n+s),a<s)throw new u('Invalid box field size');var l=a-s,c=!0;switch(o){case 1785737832:c=!1;break;case 1668246642:var d=e[n];if(1===d){var p=(0,r.readUint32)(e,n+3);switch(p){case 16:case 17:case 18:break;default:(0,r.warn)('Unknown colorspace '+p);}}else 2===d&&(0,r.info)('ICC profile not supported');break;case 1785737827:this.parseCodestream(e,n,n+l);break;case 1783636000:218793738!==(0,r.readUint32)(e,n)&&(0,r.warn)('Invalid JP2 signature');break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:var g=String.fromCharCode(255&o>>24,255&o>>16,255&o>>8,255&o);(0,r.warn)('Unsupported header type '+o+' ('+g+')');}c&&(n+=l)}},parseImageProperties:function(e){for(var t=e.getByte();0<=t;){var n=t;t=e.getByte();var i=n<<8|t;if(65361==i){e.skip(4);var s=e.getInt32()>>>0,r=e.getInt32()>>>0,a=e.getInt32()>>>0,o=e.getInt32()>>>0;e.skip(16);var l=e.getUint16();return this.width=s-a,this.height=r-o,this.componentsCount=l,void(this.bitsPerComponent=8)}}throw new u('No size marker found in JPX stream')},parseCodestream:function(e,t,s,a){var o={};a=a||{};var c=!!a.isOnlyParseHeaders,d=a.regionToParse;if(void 0!==d&&c)throw'JPX Error: options.regionToParse is uneffective if options.isOnlyParseHeaders = true';var p=!1;try{for(var g=t,m;g+1<s;){m=(0,r.readUint16)(e,g),g+=2;var f=0,x,h,y,I,E,b;switch(m){case 65359:o.mainHeader=!0;break;case 65497:break;case 65361:f=(0,r.readUint16)(e,g);var T={};T.Xsiz=(0,r.readUint32)(e,g+4),T.Ysiz=(0,r.readUint32)(e,g+8),T.XOsiz=(0,r.readUint32)(e,g+12),T.YOsiz=(0,r.readUint32)(e,g+16),T.XTsiz=(0,r.readUint32)(e,g+20),T.YTsiz=(0,r.readUint32)(e,g+24),T.XTOsiz=(0,r.readUint32)(e,g+28),T.YTOsiz=(0,r.readUint32)(e,g+32);var S=(0,r.readUint16)(e,g+36);T.Csiz=S;var v=[],O=!0;x=g+38;for(var k=0,i;k<S;k++)i={precision:(127&e[x])+1,isSigned:!!(128&e[x]),XRsiz:e[x+1],YRsiz:e[x+2]},x+=3,n(i,T),v.push(i),void 0!==d&&(O&=1===i.XRsiz&&1===i.YRsiz);if(o.SIZ=T,o.components=v,l(o,v),o.QCC=[],o.COC=[],!O)throw new Error('JPX Error: When regionToParse is used, component size other than 1 is not supported');break;case 65372:f=(0,r.readUint16)(e,g);var R={};switch(x=g+2,h=e[x++],31&h){case 0:I=8,E=!0;break;case 1:I=16,E=!1;break;case 2:I=16,E=!0;break;default:throw new Error('Invalid SQcd value '+h);}for(R.noQuantization=8===I,R.scalarExpounded=E,R.guardBits=h>>5,y=[];x<f+g;){var D={};8===I?(D.epsilon=e[x++]>>3,D.mu=0):(D.epsilon=e[x]>>3,D.mu=(7&e[x])<<8|e[x+1],x+=2),y.push(D)}R.SPqcds=y,o.mainHeader?o.QCD=R:(o.currentTile.QCD=R,o.currentTile.QCC=[]);break;case 65373:f=(0,r.readUint16)(e,g);var A={};x=g+2;var _;switch(257>o.SIZ.Csiz?_=e[x++]:(_=(0,r.readUint16)(e,x),x+=2),h=e[x++],31&h){case 0:I=8,E=!0;break;case 1:I=16,E=!1;break;case 2:I=16,E=!0;break;default:throw new Error('Invalid SQcd value '+h);}for(A.noQuantization=8===I,A.scalarExpounded=E,A.guardBits=h>>5,y=[];x<f+g;)D={},8===I?(D.epsilon=e[x++]>>3,D.mu=0):(D.epsilon=e[x]>>3,D.mu=(7&e[x])<<8|e[x+1],x+=2),y.push(D);A.SPqcds=y,o.mainHeader?o.QCC[_]=A:o.currentTile.QCC[_]=A;break;case 65362:f=(0,r.readUint16)(e,g);var j={};x=g+2;var N=e[x++];j.entropyCoderWithCustomPrecincts=!!(1&N),j.sopMarkerUsed=!!(2&N),j.ephMarkerUsed=!!(4&N),j.progressionOrder=e[x++],j.layersCount=(0,r.readUint16)(e,x),x+=2,j.multipleComponentTransform=e[x++],j.decompositionLevelsCount=e[x++],j.xcb=(15&e[x++])+2,j.ycb=(15&e[x++])+2;var F=e[x++];if(j.selectiveArithmeticCodingBypass=!!(1&F),j.resetContextProbabilities=!!(2&F),j.terminationOnEachCodingPass=!!(4&F),j.verticalyStripe=!!(8&F),j.predictableTermination=!!(16&F),j.segmentationSymbolUsed=!!(32&F),j.reversibleTransformation=e[x++],j.entropyCoderWithCustomPrecincts){for(var B=[],M;x<f+g;)M=e[x++],B.push({PPx:15&M,PPy:M>>4});j.precinctsSizes=B}var w=[];if(j.selectiveArithmeticCodingBypass&&w.push('selectiveArithmeticCodingBypass'),j.resetContextProbabilities&&w.push('resetContextProbabilities'),j.terminationOnEachCodingPass&&w.push('terminationOnEachCodingPass'),j.verticalyStripe&&w.push('verticalyStripe'),j.predictableTermination&&w.push('predictableTermination'),0<w.length)throw p=!0,new Error('Unsupported COD options ('+w.join(', ')+')');o.mainHeader?o.COD=j:(o.currentTile.COD=j,o.currentTile.COC=[]);break;case 65424:f=(0,r.readUint16)(e,g),b={},b.index=(0,r.readUint16)(e,g+2),b.length=(0,r.readUint32)(e,g+4),b.dataEnd=b.length+g-2,b.partIndex=e[g+8],b.partsCount=e[g+9],o.mainHeader=!1,0===b.partIndex&&(b.COD=o.COD,b.COC=o.COC.slice(0),b.QCD=o.QCD,b.QCC=o.QCC.slice(0)),o.currentTile=b;break;case 65427:b=o.currentTile,0===b.partIndex&&(L(o,b.index),C(o)),f=b.dataEnd-g,c||P(o,e,g,f);break;case 65365:case 65367:case 65368:case 65380:f=(0,r.readUint16)(e,g);break;case 65363:throw new Error('Codestream code 0xFF53 (COC) is not implemented');default:throw new Error('Unknown codestream code: '+m.toString(16));}g+=f}}catch(t){if(p||this.failOnCorruptedImage)throw new u(t.message);else(0,r.warn)('JPX: Trying to recover from: '+t.message)}return c||this.decode(o,a),this.width=o.SIZ.Xsiz-o.SIZ.XOsiz,this.height=o.SIZ.Ysiz-o.SIZ.YOsiz,this.componentsCount=o.SIZ.Csiz,o},addPacketsData:function(e,t){for(var n=0;n<t.packetDataOffsets.length;++n)for(var s=t.packetDataOffsets[n],r=e.tiles[s.tileIndex],a=r.components[s.c],o=a.resolutions[s.r],l=s.p,c=o.pixelsPrecincts[l].codeblocks,d=0;d<s.codeblockOffsets.length;++d){var i=s.codeblockOffsets[d],p=i.start===i.end;if(!p){var u=c[d];if(void 0===u.data&&(u.data=[]),void 0!==i.zeroBitPlanes){if(void 0===u.zeroBitPlanes&&(u.zeroBitPlanes=i.zeroBitPlanes),u.zeroBitPlanes!==i.zeroBitPlanes)throw'JPX Error: Unmatched zero bit planes';}else if(void 0===u.zeroBitPlanes)throw'JPX Error: zeroBitPlanes is unknown';u.included=!0,u.data.push({data:t.data,start:i.start,end:i.end,codingpasses:i.codingpasses})}}},decodePrecinctCoefficients:function(e,n,i,s,r){var a=e.tiles[n],o=a.components[i],l=o.resolutions[s],c=l.pixelsPrecincts[r],d=o.codingStyleParameters,p=o.quantizationParameters,u=p.SPqcds,g=p.scalarExpounded,m=p.guardBits,f=d.segmentationSymbolUsed,x=e.components[i].precision,h=d.reversibleTransformation,y=t(c,l),I=T(l,u,g,x,m,h,f,y);return I},setPrecinctCoefficients:function(e,t,n,i,s,r){var a=e.tiles[n],o=a.components[i],l=o.resolutions[s],c=l.pixelsPrecincts[r];c.decodedCoefficients=t,l.hasDecodedCoefficients=!0},decode:function(e,t){if(t!==void 0&&t.regionToParse!==void 0){var n=t.regionToParse;if(n.top===void 0||n.left===void 0||n.right===void 0||n.bottom===void 0)throw new Error('JPX Error: Either left, top, right or bottom are undefined in regionToParse');e.regionToParse=n}this.tiles=v(e),e.regionToParse=void 0}};var k=function(){function e(e,t){var n=(0,r.log2)(o(e,t))+1;this.levels=[];for(var s=0,i;s<n;s++)i={width:e,height:t,items:[]},this.levels.push(i),e=a(e/2),t=a(t/2)}return e.prototype={reset:function(e,t){for(var n=0,i=0,s;n<this.levels.length;){s=this.levels[n];var r=e+t*s.width;if(void 0!==s.items[r]){i=s.items[r];break}s.index=r,e>>=1,t>>=1,n++}n--,s=this.levels[n],s.items[s.index]=i,this.currentLevel=n,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return(e--,0>e)?(this.value=n,!1):(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),R=function(){function e(e,t,n){var s=(0,r.log2)(o(e,t))+1;this.levels=[];for(var l=0,i;l<s;l++){i=new Uint8Array(e*t);for(var c=0,d=i.length;c<d;c++)i[c]=n;var p={width:e,height:t,items:i};this.levels.push(p),e=a(e/2),t=a(t/2)}}return e.prototype={reset:function(e,t,n){for(var i=0;i<this.levels.length;){var s=this.levels[i],r=e+t*s.width;s.index=r;var a=s.items[r];if(255===a)break;if(a>n)return this.currentLevel=i,this.propagateValues(),!1;e>>=1,t>>=1,i++}return this.currentLevel=i-1,!0},incrementValue:function(e){var t=this.levels[this.currentLevel];t.items[t.index]=e+1,this.propagateValues()},propagateValues:function(){for(var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];0<=--e;)t=this.levels[e],t.items[t.index]=n},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return(t.items[t.index]=255,e--,!(0>e))&&(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),D=function(){function e(e,t,n,o,l){this.width=e,this.height=t,this.contextLabelTable='HH'===n?a:'HL'===n?r:s;var c=e*t;this.neighborsSignificance=new Uint8Array(c),this.coefficentsSign=new Uint8Array(c),this.coefficentsMagnitude=14<l?new Uint32Array(c):6<l?new Uint16Array(c):new Uint8Array(c),this.processingFlags=new Uint8Array(c);var d=new Uint8Array(c);if(0!==o)for(var p=0;p<c;p++)d[p]=o;this.bitsDecoded=d,this.reset()}var t=17,n=18,s=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),r=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),a=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);return e.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[t]=92,this.contexts[n]=6},setNeighborsSignificance:function(e,t,n){var s=this.neighborsSignificance,r=this.width,a=this.height,o=0<t,l=t+1<r,c;0<e&&(c=n-r,o&&(s[c-1]+=16),l&&(s[c+1]+=16),s[c]+=4),e+1<a&&(c=n+r,o&&(s[c-1]+=16),l&&(s[c+1]+=16),s[c]+=4),o&&(s[n-1]+=1),l&&(s[n+1]+=1),s[n]|=128},runSignificancePropagationPass:function(){for(var e=this.decoder,t=this.width,n=this.height,s=this.coefficentsMagnitude,r=this.coefficentsSign,a=this.neighborsSignificance,o=this.processingFlags,l=this.contexts,c=this.contextLabelTable,d=this.bitsDecoded,p=0;p<n;p+=4)for(var u=0,g;u<t;u++){g=p*t+u;for(var m=0,f;4>m&&(f=p+m,!(f>=n));m++,g+=t)if(o[g]&=-2,!s[g]&&a[g]){var i=c[a[g]],x=e.readBit(l,i);if(x){var h=this.decodeSignBit(f,u,g);r[g]=h,s[g]=1,this.setNeighborsSignificance(f,u,g),o[g]|=2}d[g]++,o[g]|=1}}},decodeSignBit:function(e,t,n){var i=this.width,s=this.height,r=this.coefficentsMagnitude,a=this.coefficentsSign,o,l,c,d,p,u;d=0<t&&0!==r[n-1],t+1<i&&0!==r[n+1]?(c=a[n+1],d?(l=a[n-1],o=1-c-l):o=1-c-c):d?(l=a[n-1],o=1-l-l):o=0;var g=3*o;return d=0<e&&0!==r[n-i],e+1<s&&0!==r[n+i]?(c=a[n+i],d?(l=a[n-i],o=1-c-l+g):o=1-c-c+g):d?(l=a[n-i],o=1-l-l+g):o=g,0<=o?(p=9+o,u=this.decoder.readBit(this.contexts,p)):(p=9-o,u=1^this.decoder.readBit(this.contexts,p)),u},runMagnitudeRefinementPass:function(){for(var e=this.decoder,t=this.width,n=this.height,i=this.coefficentsMagnitude,s=this.neighborsSignificance,r=this.contexts,a=this.bitsDecoded,o=this.processingFlags,l=1,c=2,p=t*n,u=0,g;u<p;u=g){g=d(p,u+4*t);for(var m=0;m<t;m++)for(var f=u+m;f<g;f+=t)if(i[f]&&0==(o[f]&l)){var x=16;if(0!=(o[f]&c)){o[f]^=c;var h=127&s[f];x=0==h?15:14}var y=e.readBit(r,x);i[f]=i[f]<<1|y,a[f]++,o[f]|=l}}},runCleanupPass:function(){for(var e=this.decoder,s=this.width,r=this.height,a=this.neighborsSignificance,o=this.coefficentsMagnitude,l=this.coefficentsSign,c=this.contexts,p=this.contextLabelTable,u=this.bitsDecoded,g=this.processingFlags,m=2,f=s,x=2*s,h=3*s,y=0,I;y<r;y=I){I=d(y+4,r);for(var E=y*s,b=y+3<r,C=0;C<s;C++){var P=E+C,T=b&&0===g[P]&&0===g[P+f]&&0===g[P+x]&&0===g[P+h]&&0===a[P]&&0===a[P+f]&&0===a[P+x]&&0===a[P+h],S=0,v=P,L=y,i;if(T){var O=e.readBit(c,n);if(!O){u[P]++,u[P+f]++,u[P+x]++,u[P+h]++;continue}S=e.readBit(c,t)<<1|e.readBit(c,t),0!=S&&(L=y+S,v+=S*s),i=this.decodeSignBit(L,C,v),l[v]=i,o[v]=1,this.setNeighborsSignificance(L,C,v),g[v]|=m,v=P;for(var k=y;k<=L;k++,v+=s)u[v]++;S++}for(L=y+S;L<I;L++,v+=s)if(!(o[v]||0!=(g[v]&1))){var R=p[a[v]],D=e.readBit(c,R);1===D&&(i=this.decodeSignBit(L,C,v),l[v]=i,o[v]=1,this.setNeighborsSignificance(L,C,v),g[v]|=m),u[v]++}}}},checkSegmentationSymbol:function(){var e=this.decoder,n=this.contexts,i=e.readBit(n,t)<<3|e.readBit(n,t)<<2|e.readBit(n,t)<<1|e.readBit(n,t);if(10!=i)throw new u('Invalid segmentation symbol')}},e}(),A=function(){function e(){}return e.prototype.calculate=function(e,t,n){for(var s=e[0],r=1,i=e.length;r<i;r++)s=this.iterate(s,e[r],t,n);return s},e.prototype.extend=function(e,t,n){var i=t-1,s=t+1,r=t+n-2,a=t+n;e[i--]=e[s++],e[a++]=e[r--],e[i--]=e[s++],e[a++]=e[r--],e[i--]=e[s++],e[a++]=e[r--],e[i]=e[s],e[a]=e[r]},e.prototype.iterate=function(e,t,n,s){var r=t.relativeRegionInLevel;if(2*e.relativeRegionInLevel.x0>r.x0||2*e.relativeRegionInLevel.y0>r.y0||2*e.relativeRegionInLevel.x1<r.x1||2*e.relativeRegionInLevel.y1<r.y1)throw new Error('JPX Error: region in LL is smaller than region in higher resolution level');if(0!=r.x0%2||0!=r.y0%2)throw new Error('JPX Error: region in HL/LH/HH subbands begins in odd coefficients');var a=e.items,o=r.x1-r.x0,c=r.y1-r.y0,p=e.relativeRegionInLevel.x1-e.relativeRegionInLevel.x0,g=r.x0/2-e.relativeRegionInLevel.x0,m=r.y0/2-e.relativeRegionInLevel.y0,f=t.items,x,i,h,y,l,u;for(x=0;x<c;x+=2)for(y=x*o,h=g+m*p+p*x/2,i=0;i<o;i+=2,h++,y+=2)f[y]=a[h];a=e.items=null;var I=4,E=new Float32Array(o+2*I);if(1!=o)for(u=0,h=0;u<c;u++,h+=o)E.set(f.subarray(h,h+o),I),this.extend(E,I,o),this.filter(E,I,o),f.set(E.subarray(I,I+o),h);else if(0!=(1&n))for(u=0,h=0;u<c;u++,h+=o)f[h]*=0.5;var C=16,P=[];for(x=0;x<C;x++)P.push(new Float32Array(c+2*I));var T=0,S;if(e=I+c,1!=c)for(l=0;l<o;l++){if(0==T){for(C=d(o-l,C),h=l,y=I;y<e;h+=o,y++)for(S=0;S<C;S++)P[S][y]=f[h+S];T=C}T--;var b=P[T];if(this.extend(b,I,c),this.filter(b,I,c),0===T)for(h=l-C+1,y=I;y<e;h+=o,y++)for(S=0;S<C;S++)f[h+S]=P[S][y]}else if(0!=(1&s))for(l=0;l<o;l++)f[l]*=0.5;return{relativeRegionInLevel:r,width:o,height:c,items:f}},e}(),_=function(){function e(){A.call(this)}return e.prototype=Object.create(A.prototype),e.prototype.filter=function(e,t,i){var s=i>>1;t|=0;var r=-1.586134342059924,a=-0.052980118572961,o=0.882911075530934,l=0.443506852043971,c=1.230174104914001,d,p,n,u;for(d=t-3,p=s+4;p--;d+=2)e[d]*=1/c;for(d=t-2,n=l*e[d-1],p=s+3;p--&&(u=l*e[d+1],e[d]=c*e[d]-n-u,p--);d+=2)d+=2,n=l*e[d+1],e[d]=c*e[d]-n-u;for(d=t-1,n=o*e[d-1],p=s+2;p--&&(u=o*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=o*e[d+1],e[d]-=n+u;for(d=t,n=a*e[d-1],p=s+1;p--&&(u=a*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=a*e[d+1],e[d]-=n+u;if(0!=s)for(d=t+1,n=r*e[d-1],p=s;p--&&(u=r*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=r*e[d+1],e[d]-=n+u},e}(),j=function(){function e(){A.call(this)}return e.prototype=Object.create(A.prototype),e.prototype.filter=function(e,t,i){var s=i>>1;t|=0;var r,a;for(r=t,a=s+1;a--;r+=2)e[r]-=e[r-1]+e[r+1]+2>>2;for(r=t+1,a=s;a--;r+=2)e[r]+=e[r-1]+e[r+1]>>1},e}();return e}();t.JpxImage=l},function(e,t,n){'use strict';var i=n(5),s=n(6),r=n(7),a=n(8),o=n(9),l=n(10),c=n(11),d=n(12),p=n(13),u=n(14),g=n(15),m=n(16),f=n(17),x=n(18),h=n(19),y=n(20),I=n(21),E=n(22),b=n(23),C=n(24),P=n(25),T=n(26),S=n(27),v=n(28),L=n(29),O=n(30),k=n(31),R=n(32),D=n(33),A=n(34),_=n(35),j=n(36),N=n(37),F=n(38),B=n(39),M=n(40),w=n(41),q={createChannel:function(e,t){return new o(e,t,q)},createCodestreamReconstructor:function(e,t,n){return new l(e,t,n)},createLevelCalculator:function(e){return new y(e)},createCodestreamStructure:function(e,t){return new c(e,q,t)},createComponentStructure:function(e,t){return new d(e,t)},createCompositeArray:function(e){return new p(e)},createDatabinParts:function(e,t){return new u(e,t,q)},createDatabinsSaver:function(e){return new g(e,q)},createFetcher:function(e,t){return new f(e,t,q)},createFetch:function(e,t,n){return new m(e,t,n)},createHeaderModifier:function(e,t){return new x(e,t)},createImageDataContext:function(e,t,n,i){return new h(e,t,n,i)},createMarkersParser:function(e){return new I(e,a,q)},createOffsetsCalculator:function(e,t){return new E(e,t)},createPacketsDataCollector:function(e,t){return new b(e,t,q)},createParamsCodestreamPart:function(e,t){return new C(e,t,q)},createParamsPrecinctIterator:function(e,t,n,i){return new P(e,t,n,i)},createPrecinctCodestreamPart:function(e,t,n,i,s,r,a){return new T(e,t,n,i,s,r,a)},createPrecinctsIteratorWaiter:function(e,t,n,i){return new S(e,t,n,i,q)},createQualityWaiter:function(e,t,n,i,s,r,a){return new v(e,t,n,i,s,r,a,q)},createRequestParamsModifier:function(e){return new L(e)},createRequest:function(e,t,n,i,s){return new O(e,a,t,n,i,s)},createSessionHelper:function(e,t,n,s){return new k(e,t,n,s,i)},createSession:function(e,t,n,i,s){return new R(e,t,n,i,s,setInterval,clearInterval,q)},createReconnectableRequester:function(e,t,n,i){return new D(e,t,n,i,q)},createStructureParser:function(e,t,n){return new A(e,t,a,n)},createTileStructure:function(e,t,n){return new _(e,t,q,n)},createBitstreamReader:function(e){return new j(e,s)},createTagTree:function(e,t,n){return new N(e,t,n,s)},createCodeblockLengthParser:function(e){return new F(e,s)},createSubbandLengthInPacketHeaderCalculator:function(e,t,n){return new B(e,t,n,r,s,q)},createPacketLengthCalculator:function(e,t,n,i,s){return new M(e,t,n,i,s,q)},createQualityLayersCache:function(e){return new w(e,q)}};e.exports=q},function(e,t,n){'use strict';var i=n(0);e.exports.JpipImage=n(4),e.exports.j2kExceptions=i.j2kExceptions,e.exports.jpipExceptions=i.jpipExceptions,e.exports.Internals={PdfjsJpxDecoderLegacy:n(42),PdfjsJpxPixelsDecoder:n(46),PdfjsJpxCoefficientsDecoder:n(47),jpipRuntimeFactory:n(2),jGlobals:i}},function(e,t,n){'use strict';function i(e){function t(e){function t(){m||(m=!0,g.unregister())}var n=P.modify(e.key),i=r.createParamsCodestreamPart(n.codestreamPartParams,h),s=0,a=[],l=[],d=0,u=!1,g;e.on('dependencyTaskData',function(e,t){var i=a[t.inClassIndex];if(!l[i]){if(e.minQuality!==n.progressiveness[0].minNumQualityLayers)throw'jpip error: Unexpected quality as min quality data';l[i]=e,++d}g.precinctQualityLayerReached(t.inClassIndex,e.minQuality)});var m=!1;e.on('statusUpdated',function(e){if(!m&&!e.isWaitingForWorkerResult&&e.terminatedDependsTasks===e.dependsTasks)throw'jpip error: Unexpected unended task without pending depend tasks'}),e.on('custom',function(e){'aborting'===e&&t()}),g=r.createQualityWaiter(i,n.progressiveness,e.key.maxQuality,function(){if(null==f&&(f=E.createHeadersCodestream(i),x=c(i,n.codestreamPartParams),y=h.getNumTilesX(),I=i.tilesBounds),!u){if(d<l.length)throw'webjpip error: Min quality layer data missing';u=!0,e.dataReady({headersCodestream:f,offsetInRegion:x,imageTilesX:y,tilesBounds:I,precinctCoefficients:l},o,!1)}1<g.getProgressiveStagesFinished()&&e.dataReady({headersCodestream:f,offsetInRegion:x,imageTilesX:y,tilesBounds:I,precinctCoefficients:e.dependTaskResults},o,!0),g.isDone()&&(t(),e.terminate())},h,p,function(t,i,r,o,l){a[o]=s++;var c=l.precinctPositionToIndexInComponentResolution(r);e.registerTaskDependency({taskType:'COEFFS',tileIndex:r.tileIndex,resolutionLevel:r.resolutionLevel,precinctX:r.precinctX,precinctY:r.precinctY,component:r.component,maxQuality:n.codestreamPartParams.quality,inClassIndex:o,precinctIndexInComponentResolution:c,progressiveness:n.progressiveness})}),g.register();var f=null,x=null,y,I}function n(e){function t(t){if(s!==t)throw'webjpip error: Unexpected context in data event';a=!0;var i=s.getProgressiveStagesFinished();if(!o){o=!0;var r=s.getFetchedData(e.key.progressiveness[0].minNumQualityLayers);e.dataReady(r,l,!1)}if(1<i){var c=s.getFetchedData();e.dataReady(c,l,!0)}if(s.isDone()){if(!a)throw'webjpip error: Coefficients task without data';n(),e.terminate()}}function n(){c||(c=!0,s.dispose())}var i=r.createPrecinctCodestreamPart(d(),h.getTileStructure(e.key.tileIndex),e.key.tileIndex,e.key.component,e.key.resolutionLevel,e.key.precinctX,e.key.precinctY);e.on('custom',function(e){'aborting'===e&&n()});var s=r.createImageDataContext(C,i,e.key.maxQuality,e.key.progressiveness),a=!1,o=!1,c=!1;s.on('data',t),0<s.getProgressiveStagesFinished()&&t(s)}function c(e,t){if(t){var n=e.getTileIterator();if(!n.tryAdvance())throw new a.jpipExceptions.InternalErrorException('Empty codestreamPart in JpipImageDataContext');var i=n.tileIndex,s=h.getTileLeft(i,e.level),r=h.getTileTop(i,e.level);return{offsetX:t.minX-s,offsetY:t.minY-r,width:t.maxXExclusive-t.minX,height:t.maxYExclusive-t.minY}}return{offsetX:0,offsetY:0,width:h.getImageWidth(),height:h.getImageHeight()}}function d(){return null==S&&(S=r.createLevelCalculator(T)),S}var p=r.createDatabinsSaver(!1),u=p.getMainHeaderDatabin(),g=r.createMarkersParser(u),m=r.createOffsetsCalculator(u,g),f=r.createStructureParser(p,g,m),x='RPCL',h=r.createCodestreamStructure(f,x),y=r.createQualityLayersCache(h),I=r.createHeaderModifier(m,x),E=r.createCodestreamReconstructor(p,I,y),b=r.createPacketsDataCollector(p,y),C={reconstructor:E,packetsDataCollector:b,qualityLayersCache:y,codestreamStructure:h,databinsSaver:p,jpipFactory:r},P=r.createRequestParamsModifier(h),T=null,S=null,v=r.createFetcher(p,e);this.opened=function(e){T=e.getImageParams()},this.getLevelCalculator=d,this.getDecoderWorkersInputRetreiver=function(){return this},this.getFetcher=function(){return v},this.getWorkerTypeOptions=function(e){switch(e){case o:return{ctorName:'webjpip.Internals.PdfjsJpxPixelsDecoder',ctorArgs:[],scriptsToImport:[s(new Error)],pathToTransferablesInPromiseResult:[[0,'data','buffer']]};case l:return{ctorName:'webjpip.Internals.PdfjsJpxCoefficientsDecoder',ctorArgs:[],scriptsToImport:[s(new Error)],transferables:[[0,'headersCodestream','buffer'],[0,'codeblocksData','data','buffer']],pathToTransferablesInPromiseResult:[[0,'coefficients','buffer']]};default:throw'webjpip error: Unexpected worker type in getWorkerTypeOptions '+e;}},this.getKeyAsString=function(e){if('COEFFS'===e.taskType)return'C:'+e.inClassIndex;var t=P.modify(e),n=t.codestreamPartParams;return'P:xmin'+n.minX+'ymin'+n.minY+'xmax'+n.maxXExclusive+'ymax'+n.maxYExclusive+'r'+n.level+'q'+n.quality},this.taskStarted=function(e){'COEFFS'===e.key.taskType?n(e):t(e)};i.useLegacy&&(this.getWorkerTypeOptions=function(){return{ctorName:'webjpip.Internals.PdfjsJpxDecoderLegacy',ctorArgs:[],scriptsToImport:[s(new Error)],transferables:[[0,'headersCodestream','buffer'],[0,'codeblocksData','data','buffer']],pathToTransferablesInPromiseResult:[[]]}},this.getKeyAsString=function(e){return JSON.stringify(e)},this.taskStarted=function(e){function t(t){if(s!==t)throw'webjpip error: Unexpected context in data event';var n=s.getFetchedData();n.offsetInRegion=a,e.dataReady(n,!0),s.isDone()&&(e.terminate(),s.dispose())}var n=P.modify(e.key),i=r.createParamsCodestreamPart(n.codestreamPartParams,h),s=r.createImageDataContext(C,i,n.codestreamPartParams.quality,n.progressiveness),a=c(i,n.codestreamPartParams);s.on('data',t),s.hasData()&&t(s)})}function s(e){var t=e.stack.trim(),n=c.exec(t);if(n&&''!==n[2])return n[2];if(n=d.exec(t),n&&''!==n[1])return n[1];if(n=p.exec(t),n&&''!==n[1])return n[1];if(void 0!==e.fileName)return e.fileName;throw'webjpip.js: Could not get current script URL'}var r=n(2),a=n(0);e.exports=i;var o=1,l=2;i.toggleLegacy=function(){i.useLegacy=!i.useLegacy};var c=/at (|[^ ]+ \()([^ ]+):\d+:\d+/,d=new RegExp(/.+@(.*?):\d+:\d+/),p=new RegExp(/.+\/(.*?):\d+(:\d+)*$/)},function(e,t,n){'use strict';var i=n(0);e.exports={request:function(e,t,n,s){function r(){if(!l){if(4!==a.readyState){if(void 0===s||null===a.response||3>a.readyState)return;var e=a.response.byteLength,i=e-c;if(i<s)return;c=e}else if(l=!0,200!==a.status||null===a.response)return void n(a);o||t(a,l)}}var a=new XMLHttpRequest,o=void 0===t,l=!1,c=0;if(a.open('GET',e,!o),a.onreadystatechange=r,o||(a.mozResponseType=a.responseType='arraybuffer'),void 0!==s&&(a.setRequestHeader('X-Content-Type-Options','nosniff'),a.onprogress=r),a.send(null),o&&!l)throw new i.jpipExceptions.InternalErrorException('synchronous ajax call was not finished synchronously');return a}}},function(e,t,n){'use strict';var i=n(0);e.exports={createTransaction:function(){function e(e){if(!n.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot terminate an already terminated transaction');t=e?2:3}var t=1,n={get isAborted(){return 3==t},get isActive(){return 1==t},commit:function(){e(!0)},abort:function(){e(!1)}};return n},createTransactionalObject:function(e,t){function n(e){if(!e.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot use terminated transaction to access objects');if(e!==a&&a.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot simultanously access transactional object from two active transactions')}var s=null,r=e,a={isActive:!1,isAborted:!0},o=t?function(e){return e}:function(e){var t=JSON.parse(JSON.stringify(e));return t};return{getValue:function(e){return(n(e),a===e)?s:(a.isAborted?s=o(r):r=o(s),a=e,s)},setValue:function(e,t){return n(e),a===e?void(s=t):void(!a.isAborted&&(r=o(s)),a=e,s=t)}}}}},function(e){'use strict';e.exports=function(){var e=function(){var e=Array(17);return e[0]=0,e[1]=0,e[2]=1,e[3]=0,e[4]=4,e[5]=3,e[6]=2,e[7]=1,e[8]=0,e[9]=6,e[10]=5,e[11]=4,e[12]=3,e[13]=2,e[14]=1,e[15]=0,e[16]=0,e}(),t=function(){var e=Array(17);return e[0]=1,e[1]=2,e[2]=3,e[3]=5,e[4]=6,e[5]=22,e[6]=30,e[7]=34,e[8]=36,e[9]=37,e[10]=101,e[11]=133,e[12]=149,e[13]=157,e[14]=161,e[15]=163,e[16]=164,e}();return{parse:function(n){var i=n.countOnesAndShiftUntilFirstZeroBit(16);if(null===i)return null;var s=e[i],r=n.shiftBits(s);if(null===r)return null;var a=t[i];return r+a}}}()},function(e,t,n){'use strict';var i=n(0),s={LSB_MASK:1,BIT_4_MASK:16,BITS_56_MASK:96,MSB_MASK:128,LSB_7_MASK:127,parseNumberInVbas:function(e,t,n){var i=s,r=t,a;if(n){a=e[r]&(1<<n)-1}else a=e[r]&i.LSB_7_MASK;for(;!!(e[r]&i.MSB_MASK);)++r,a<<=7,a|=e[r]&i.LSB_7_MASK;return{endOffset:r+1,number:a}},parseMessageHeader:function(e,t,n){var r=s,a=(e[t]&r.BITS_56_MASK)>>>5;if(0==a)throw new i.jpipExceptions.ParseException('Failed parsing message header (A.2.1): prohibited existance class and csn bits 00');var o=!!(e[t]&r.BIT_4_MASK),l=r.parseNumberInVbas(e,t,4),c=l.number,d=l.endOffset,p=0;if(!!(2&a)){var u=r.parseNumberInVbas(e,d);p=u.number,d=u.endOffset}else n&&(p=n.classId);var g=0;if(3==a){var m=r.parseNumberInVbas(e,d);g=m.number,d=m.endOffset}else n&&(g=n.codestreamIndex);var f=r.parseNumberInVbas(e,d),x=f.number;d=f.endOffset;var h=r.parseNumberInVbas(e,d),y=h.number;d=h.endOffset;var I=!!(p&r.LSB_MASK),E;if(I){var b=r.parseNumberInVbas(e,d);E=b.number,d=b.endOffset}var C={isLastByteInDatabin:o,inClassId:c,bodyStart:d,classId:p,codestreamIndex:g,messageOffsetFromDatabinStart:x,messageBodyLength:y};return I&&(C.aux=E),C},getInt32:function(e,t){var n=16777216*e[t],i=e[t+1]<<16,s=e[t+2]<<8,r=e[t+3];return n+i+s+r},getInt16:function(e,t){var n=e[t]<<8,i=e[t+1];return n+i}};e.exports=s},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n){function i(){var e=p.length+d.length;return e}function r(e){var n=t.getDataRequestUrl(),i=t.getTargetId();'0'!==i&&(n+='&tid='+i);var s=null!==l;if(s){var r=u&&e;n+=r?'&wait=no':'&wait=yes'}return n}function a(e,n){var i=r(!0),s=t.getCodestreamStructure(),a=s.getLevelWidth(e.level),o=s.getLevelHeight(e.level),l=e.maxXExclusive-e.minX,c=e.maxYExclusive-e.minY;return i+='&fsiz='+a+','+o+',closest&rsiz='+l+','+c+'&roff='+e.minX+','+e.minY,'max'!==n&&(i+='&layers='+n),i}var o=this,l=null,c=0,d=[],p=[],u=!1;this.requestData=function(r,c,g,m){if(!u){var f=i();if(f>=e)throw new s.jpipExceptions.InternalErrorException('Channel has too many requests not responded yet')}var x=a(r,m),h=n.createRequest(t,o,x,c,g);return null!=l||0===p.length?(p.push(h),h.startRequest()):u?d=[h]:d.push(h),h},this.sendMinimalRequest=function(e){if(null==l&&0<p.length)throw new s.jpipExceptions.InternalErrorException('Minimal requests should be used for first request or keep alive message. Keep alive requires an already initialized channel, and first request requires to not have any previous request');var i=r(),a=n.createRequest(t,o,i,e);p.push(a),a.startRequest()},this.getIsDedicatedForMovableRequest=function(){return u},this.dedicateForMovableRequest=function(){if(u)throw new s.jpipExceptions.InternalErrorException('Channel already dedicated for movable request');u=!0},this.getChannelId=function(){return l},this.setChannelId=function(e){if(null!==e){l=e;var t=d;d=[];for(var n=0;n<t.length;++n)p.push(t[n]),t[n].startRequest()}},this.nextRequestId=function(){return++c},this.getRequestsWaitingForResponse=function(){return p},this.getAllQueuedRequestCount=i,this.requestEnded=function(e,n){for(var r=p,a=!1,c=0;c<r.length;++c)if(r[c]===n){r[c]=r[r.length-1],r.length-=1,a=!0;break}if(!a)throw new s.jpipExceptions.InternalErrorException('channel.requestsWaitingForResponse inconsistency');if(t.requestEnded(e,o),null===l&&0<d.length){var i=d.shift();p.push(i),i.startRequest()}},this.isAllOldRequestsEnded=function(e){for(var t=0;t<p.length;++t)if(p[t].lastRequestId<=e)return!1;return!0}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function s(e,t,n,s){var a=r(g,e,t,n,s);if(null===a)return null;var o=new Uint8Array(a),l=r(o,e,t,n,s);if(l===a)return o;if(null===l)return null;throw new i.jpipExceptions.InternalErrorException('JpipCodestreamReconstructor: Unmatched actualLength '+l+' and calculatedLength '+a)}function r(e,n,s,r,l){var c=a(e,n.level);if(null===c)return null;for(var d=0,u=n.getTileIterator();u.tryAdvance();){var g=u.tileIndex,m=o(e,c,d++,u,n.level,s,r,l);if(c+=m,null===m)return null}var f=p(e,c,i.j2kMarkers.EndOfCodestream);return c+=f,t.modifyImageSize(e,n.fullTilesSize),null===e?null:c}function a(n,s){if(e.getIsJpipTilePartStream())throw new i.jpipExceptions.UnsupportedFeatureException('reconstruction of codestream from JPT (Jpip Tile-part) stream','A.3.4');var r=e.getMainHeaderDatabin(),a=r.copyBytes(n,0,{forceCopyAllRange:!0});if(null===a)return null;var o=t.modifyMainOrTileHeader(n,r,0,s);return a+=o,o=d(n,a),a+=o,a}function o(n,i,s,r,a,o,d,p){var u=r.tileIndex,g=i,m=e.getTileHeaderDatabin(u),f=l(n,i,m,s,a);if(null===f)return null;if(i=f.endTileHeaderOffset,!p){var x=c(n,i,r,o,d);if(i+=x,null===x)return null}var h=i,y=h-f.startOfTileHeaderOffset;t.modifyInt32(n,f.headerAndDataLengthPlaceholderOffset,y);return h-g}function l(e,n,s,r,a){var o=n,l=p(e,n,i.j2kMarkers.StartOfTile);n+=l;l=p(e,n,[0,10]),n+=l;l=p(e,n,[r>>>8,255&r]),n+=l;var c=n;l=p(e,n,[0,0,0,0]),n+=l;l=p(e,n,[0]),n+=l;l=p(e,n,[1]),n+=l;var d=n;if(l=s.copyBytes(e,n,{forceCopyAllRange:!0}),n+=l,null===l)return null;var u=[,,],g=s.getDatabinLengthIfKnown();s.copyBytes(u,0,{databinStartOffset:g-2});var m=u[0]===i.j2kMarkers.StartOfData[0]&&u[1]===i.j2kMarkers.StartOfData[1];m||(l=p(e,n,i.j2kMarkers.StartOfData),n+=l);var f=t.modifyMainOrTileHeader(e,s,d,a);n+=f;var x={startOfTileHeaderOffset:o,headerAndDataLengthPlaceholderOffset:c,endTileHeaderOffset:n};return x}function c(t,s,r,a,o){var l=r.tileStructure.getNumQualityLayers(),c=0;'max'===a&&(a=l);for(var d=r.createPrecinctIterator(!0);d.tryAdvance();){var p=l;if(d.isInCodestreamPart){var u=r.tileStructure.precinctPositionToInClassIndex(d),g=e.getPrecinctDatabin(u),m=n.getQualityLayerOffset(g,o,d),f=m.endOffset;if(p=l-m.numQualityLayers,m.numQualityLayers<a)return null;var x=g.copyBytes(t,s,{forceCopyAllRange:!0,maxLengthToCopy:f});null===x&&(x=0,p=l),c+=x,s+=x}if(!t.isDummyBufferForLengthCalculation)for(var h=0;h<p;++h)t[s++]=0;c+=p}return c}function d(e,t){var n=t;u(e,t++,255),u(e,t++,100),u(e,t++,0),u(e,t++,9),u(e,t++,77),u(e,t++,97),u(e,t++,109),u(e,t++,97),u(e,t++,122),u(e,t++,97),u(e,t++,118);var i=t-n;return i}function p(e,t,n){if(!e.isDummyBufferForLengthCalculation)for(var s=0;s<n.length;++s)e[s+t]=n[s];return n.length}function u(e,t,n){e.isDummyBufferForLengthCalculation||(e[t]=n)}var g={isDummyBufferForLengthCalculation:!0};this.createCodestream=function(e,t,n){return s(e,t,n)},this.createHeadersCodestream=function(e){var t=1;return s(e,t,t,!0)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function s(e,t,n){if(0>t||t>=n)throw new i.jpipExceptions.ArgumentException(e,t,e+' is expected to be between 0 and '+n-1)}function r(t){if(!u){var n=e.parseDefaultTileParams();u=[,,,];for(var i=0;3>i;++i){u[i]=[,,,];for(var s=0,r;3>s;++s)r={horizontalEdgeType:i,verticalEdgeType:s},u[i][s]=a(n,r)}}var o=u[t.horizontalEdgeType],l=o[t.verticalEdgeType];return l}function a(e,s){o();var r=JSON.parse(JSON.stringify(e));r.tileSize=p.getTileSize(s),r.defaultComponentParams.scaleX=1,r.defaultComponentParams.scaleY=1;for(var a=0;a<r.paramsPerComponent.length;++a)r.paramsPerComponent[a].scaleX=d.componentsScaleX[a],r.paramsPerComponent[a].scaleY=d.componentsScaleY[a];var i=t.createTileStructure(r,l,n);return i}function o(){d||(d=e.parseCodestreamStructure(),p=t.createLevelCalculator(d))}var l=this,c=[],d,p,u;return this.getSizesParams=function(){return o(),d},this.getNumTilesX=function(){o();var e=p.getNumTilesX();return e},this.getNumTilesY=function(){o();var e=p.getNumTilesY();return e},this.getNumComponents=function(){return o(),d.numComponents},this.getImageWidth=function(){o();var e=p.getLevelWidth();return e},this.getImageHeight=function(){o();var e=p.getLevelHeight();return e},this.getLevelWidth=function(e){o();var t=p.getLevelWidth(e);return t},this.getLevelHeight=function(e){o();var t=p.getLevelHeight(e);return t},this.getTileWidth=function(e){o();var t=p.getTileWidth(e);return t},this.getTileHeight=function(e){o();var t=p.getTileHeight(e);return t},this.getFirstTileOffsetX=function(){o();var e=p.getFirstTileOffsetX();return e},this.getFirstTileOffsetY=function(){o();var e=p.getFirstTileOffsetY();return e},this.getTileLeft=function(e,t){o();var n=e%p.getNumTilesX();if(0==n)return 0;var i=(n-1)*p.getTileWidth(t)+p.getFirstTileWidth(t);return i},this.getTileTop=function(e,t){o();var n=Math.floor(e/p.getNumTilesX());if(0===n)return 0;var i=(n-1)*p.getTileHeight(t)+p.getFirstTileHeight(t);return i},this.getDefaultTileStructure=function(){o();var e=r({horizontalEdgeType:p.EDGE_TYPE_NO_EDGE,verticalEdgeType:p.EDGE_TYPE_NO_EDGE});return e},this.getTileStructure=function(t){o();var n=p.getNumTilesX()*p.getNumTilesY()-1;if(0>t||t>n)throw new i.jpipExceptions.ArgumentException('tileId',t,'Expected value between 0 and '+n);var s=p.isEdgeTileId(t);if(void 0===c[t]){var l=e.parseOverridenTileParams(t);c[t]=l?a(l,s):null}if(c[t])return c[t];var d=r(s);return d},this.tilePositionToInClassIndex=function(e){o();var t=p.getNumTilesX(),n=p.getNumTilesY();s('tilePosition.tileX',e.tileX,t),s('tilePosition.tileY',e.tileY,n);var i=e.tileX+e.tileY*t;return i},this.tileInClassIndexToPosition=function(e){o();var t=p.getNumTilesX(),n=p.getNumTilesY();s('inClassIndex',e,t*n);var i=e%t;return{tileX:i,tileY:(e-i)/t}},this.getTilesFromPixels=function(e){return o(),p.getTilesFromPixels(e)},this.getSizeOfTiles=function(e){o();var t=p.getSizeOfTiles(e);return t},this}},function(e,t,n){'use strict';var i=Math.floor,s=Math.ceil,r=n(0);e.exports=function(e,t){function n(e,t,n){var i=o(n),r=t[n],a=s(e/i/r);return a}function a(e,t,n,i,r){var a=o(e.resolutionLevel),l=s(r/a),c=t*i[e.resolutionLevel],d=Math.min(i[e.resolutionLevel],l-c),p=0===e.resolutionLevel?1:2,u=s(d/p),g=p*s(u/n);return 1==d%n&&0<e.resolutionLevel&&--g,g}function o(t){var n=e.numResolutionLevels-t-1;return 1<<n}var l,c;(function(){if(1!==e.scaleX||1!==e.scaleY)throw new r.j2kExceptions.UnsupportedFeatureException('Non 1 component scale','A.5.1');l=i(t.getTileWidth()/e.scaleX),c=i(t.getTileHeight()/e.scaleY)})(),this.getComponentScaleX=function(){return e.scaleX},this.getComponentScaleY=function(){return e.scaleY},this.getNumResolutionLevels=function(){return e.numResolutionLevels},this.getPrecinctWidth=function(t){var n=e.precinctWidthPerLevel[t];return n},this.getPrecinctHeight=function(t){var n=e.precinctHeightPerLevel[t];return n},this.getMaxCodeblockWidth=function(){var t=e.maxCodeblockWidth;return t},this.getMaxCodeblockHeight=function(){var t=e.maxCodeblockHeight;return t},this.getNumCodeblocksXInPrecinct=function(t){var n=a(t,t.precinctX,e.maxCodeblockWidth,e.precinctWidthPerLevel,l);return n},this.getNumCodeblocksYInPrecinct=function(t){var n=a(t,t.precinctY,e.maxCodeblockHeight,e.precinctHeightPerLevel,c);return n},this.getNumPrecinctsX=function(t){var i=n(l,e.precinctWidthPerLevel,t);return i},this.getNumPrecinctsY=function(t){var i=n(c,e.precinctHeightPerLevel,t);return i}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e){function t(t,n){if(t===void 0||n===void 0)throw new i.jpipExceptions.InternalErrorException('minOffset or maxOffset is undefined for CompositeArray.copyToArray');if(t<e)throw new i.jpipExceptions.InternalErrorException('minOffset ('+t+') must be smaller than CompositeArray offset ('+e+')');if(n>e+a)throw new i.jpipExceptions.InternalErrorException('maxOffset ('+n+') must be larger than CompositeArray end offset ('+e+a+')')}function n(t,n){var r=Math.max(e,t),o=e+a;if(void 0!==n&&(o=Math.min(o,n)),r>=o){return{internalIteratorData:{isEndOfRange:!0}}}var l={subArray:null,offset:-1,internalIteratorData:{end:o,currentSubArray:null,currentInternalPartOffset:null,nextInternalPartOffset:e,currentInternalPartIndex:-1,isEndOfRange:!1}},c=!1;do{if(c)throw new i.jpipExceptions.InternalErrorException('Iterator reached to the end although no data has been iterated');c=!s(l)}while(r>=l.internalIteratorData.nextInternalPartOffset);var d=r-l.internalIteratorData.currentInternalPartOffset;return l.internalIteratorData.currentSubArray=l.internalIteratorData.currentSubArray.subarray(d),l.internalIteratorData.currentInternalPartOffset=r,l}function s(e){var t=e.internalIteratorData;if(t.isEndOfRange)return!1;if(e.subArray=t.currentSubArray,e.offset=t.currentInternalPartOffset,++t.currentInternalPartIndex,t.nextInternalPartOffset>=t.end)return t.isEndOfRange=!0,!0;r(t.currentInternalPartIndex),t.currentSubArray=o[t.currentInternalPartIndex],t.currentInternalPartOffset=t.nextInternalPartOffset;var n=o[t.currentInternalPartIndex].length;t.nextInternalPartOffset=t.currentInternalPartOffset+n;var i=t.end-t.currentInternalPartOffset,s=i<t.currentSubArray.length;return s&&(t.currentSubArray=t.currentSubArray.subarray(0,i)),!0}function r(e){if(e>=o.length)throw new i.jpipExceptions.InternalErrorException('CompositeArray: end of part has reached. Check end calculation')}var a=0,o=[];this.getLength=function(){return a},this.getOffset=function(){return e},this.pushSubArray=function(e){o.push(e),a+=e.length},this.copyToOtherAtTheEnd=function(e,i,r){t(i,r);for(var a=n(i,r);s(a);)e.pushSubArray(a.subArray)},this.copyToTypedArray=function(e,i,r,a){t(r,a);for(var o=n(r,a);s(o);){var l=o.offset-i;e.set(o.subArray,l)}},this.copyToArray=function(e,i,r,a){t(r,a);for(var o=n(r,a);s(o);)for(var l=o.offset-i,c=0;c<o.subArray.length;++c)e[l++]=o.subArray[c]},this.copyToOther=function(t){if(t.getOffset()>e)throw new i.jpipExceptions.InternalErrorException('CompositeArray: Trying to copy part into a latter part');var r=t.getOffset()+t.getLength(),o=e+a<=r;if(!o){var l=r,c=n(l);if(!s(c))throw new i.jpipExceptions.InternalErrorException('CompositeArray: Could not merge parts');var d=l;do{if(c.offset!==d)throw new i.jpipExceptions.InternalErrorException('CompositeArray: Non-continuous value of rangeToCopy.offset. Expected: '+d+', Actual: '+c.offset);t.pushSubArray(c.subArray),d+=c.subArray.length}while(s(c))}}}},function(e){'use strict';var t=Math.min;e.exports=function(e,n,s){function i(e,t){var n=!1,i=0,s;if(void 0!==t&&(n=!!t.forceCopyAllRange,i=t.databinStartOffset,s=t.maxLengthToCopy,void 0===i&&(i=0)),void 0===e&&(e=0),0===s)return{resultWithoutCopy:0};if(null!==d&&i>=d)return{resultWithoutCopy:!!s&&n?null:0};var a=o(i);if(a===c.length)return{resultWithoutCopy:n?null:0};if(n){var l=r(i,s,a);if(!l)return{resultWithoutCopy:null}}var p={databinStartOffset:i,maxLengthToCopy:s,resultStartOffset:e};return p}function r(e,t,n){if(c[n].getOffset()>e)return!1;if(t){var i=e-c[n].getOffset(),s=c[n].getLength()-i;return s>=t}if(null===d||n<c.length-1)return!1;var r=c[c.length-1],a=r.getOffset()+r.getLength(),o=a===d;return o}function a(e,n,s){var r;if(void 0!==n)r=e+n;else{var a=c[c.length-1];r=a.getOffset()+a.getLength()}for(var o=null,l=0;l<c.length&&!(c[l].getOffset()>=r);++l){var i=Math.max(e,c[l].getOffset()),d=t(r,c[l].getOffset()+c[l].getLength());s(c[l],i,d),o=c[l]}if(null===o)return 0;var p=t(o.getOffset()+o.getLength(),r);return p-e}function o(e){var t;for(t=0;t<c.length&&!(c[t].getOffset()+c[t].getLength()>e);++t);return t}var l=this,c=[],d=null,p=0,u=[];return this.getDatabinLengthIfKnown=function(){return d},this.getLoadedBytes=function(){return p},this.isAllDatabinLoaded=function(){var e;switch(c.length){case 0:e=0===d;break;case 1:e=0===c[0].getOffset()&&c[0].getLength()===d;break;default:e=!1;}return e},this.getCachedData=function(e){var t=u[e];return void 0===t&&(t={},u[e]=t),t},this.getClassId=function(){return e},this.getInClassId=function(){return n},this.copyToCompositeArray=function(e,t){var n=i(0,t);if(void 0!==n.resultWithoutCopy)return n.resultWithoutCopy;var s=a(n.databinStartOffset,n.maxLengthToCopy,function(t,n,i){t.copyToOtherAtTheEnd(e,n,i)});return s},this.copyBytes=function(e,t,n){var s=i(t,n);if(void 0!==s.resultWithoutCopy)return s.resultWithoutCopy;var r=s.databinStartOffset-s.resultStartOffset,o=e.isDummyBufferForLengthCalculation?function(){}:function(t,n,i){t.copyToArray(e,r,n,i)},l=a(s.databinStartOffset,s.maxLengthToCopy,o);return l},this.getExistingRanges=function(){for(var e=Array(c.length),t=0;t<c.length;++t)e[t]={start:c[t].getOffset(),length:c[t].getLength()};return e},this.addData=function(e,t){if(e.isLastByteInDatabin&&(d=e.messageOffsetFromDatabinStart+e.messageBodyLength),0!==e.messageBodyLength){var n=s.createCompositeArray(e.messageOffsetFromDatabinStart),r=e.bodyStart+e.messageBodyLength;n.pushSubArray(t.subarray(e.bodyStart,r));var a=o(e.messageOffsetFromDatabinStart),l=a;if(0<a){var u=c[a-1],g=u.getOffset()+u.getLength();g===e.messageOffsetFromDatabinStart&&--l}if(l>=c.length)return c.push(n),void(p+=e.messageBodyLength);var m=c[l],f=e.messageOffsetFromDatabinStart+e.messageBodyLength;if(m.getOffset()>f){for(var x=c.length;x>l;--x)c[x]=c[x-1];return c[l]=n,void(p+=e.messageBodyLength)}var i=m.getLength(),h=m.getOffset()>e.messageOffsetFromDatabinStart;h&&(c[l]=n,n=m,m=c[l]),n.copyToOther(m);var y=m.getOffset()+m.getLength(),I;for(I=l;I<c.length-1&&!(y<c[I+1].getOffset());++I)i+=c[I+1].getLength();var E=I-l;if(0<E){c[I].copyToOther(m);for(var b=l+1;b<c.length-E;++b)c[b]=c[b+E];c.length-=E}p+=m.getLength()-i}},this}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t){function n(e,t){if(0!==e.inClassId)throw new s.jpipExceptions.IllegalDataException('Main header data-bin with in-class index other than zero is not valid','A.3.5');var n=h.getLoadedBytes();h.addData(e,t);var i=h.getLoadedBytes()-n;f+=i,x+=i}function r(){}function a(n,i,r,a,o){if(a!==e)throw new s.jpipExceptions.WrongStreamException('databin of type '+o,e);var l=n.databins[r];return l||(l=t.createDatabinParts(i,r),n.databins[r]=l),l}function i(){return{databins:[],listeners:[],databinsWithListeners:[]}}var o=0,l=1,c=2,d=4,p=5,u=[],g=[],m=[],f=0,x=0;u[c]=i(),u[o]=i(),u[l]=u[o],m[c]=!0,m[o]=!0,m[l]=!0,u[d]=i(),u[p]=u[d],g[d]=!0,g[p]=!0;var h=t.createDatabinParts(6,0);return this.getIsJpipTilePartStream=function(){return e},this.getLoadedBytes=function(){return f},this.getMainHeaderDatabin=function(){return h},this.getTileHeaderDatabin=function(e){var t=a(u[c],c,e,!1,'tileHeader');return t},this.getPrecinctDatabin=function(e){var t=a(u[o],o,e,!1,'precinct');return t},this.getTileDatabin=function(e){var t=a(u[d],d,e,!0,'tilePart');return t},this.addEventListener=function(e,t,n,i){if('dataArrived'!==t)throw new s.jpipExceptions.InternalErrorException('Unsupported event: '+t);var r=e.getClassId(),a=e.getInClassId(),o=u[r];if(e!==o.databins[a])throw new s.jpipExceptions.InternalErrorException('Unmatched databin with class-ID='+r+' and in-class-ID='+a);void 0===o.listeners[a]&&(o.listeners[a]=[]),0===o.listeners[a].length&&(x+=e.getLoadedBytes()),o.listeners[a].push({listener:n,listenerThis:i,isRegistered:!0}),o.databinsWithListeners[a]=e},this.removeEventListener=function(e,t,n){if('dataArrived'!==t)throw new s.jpipExceptions.InternalErrorException('Unsupported event: '+t);var r=e.getClassId(),a=e.getInClassId(),o=u[r],l=o.listeners[a];if(e!==o.databins[a]||e!==o.databinsWithListeners[a])throw new s.jpipExceptions.InternalErrorException('Unmatched databin with class-ID='+r+' and in-class-ID='+a);for(var c=0;c<l.length;++c)if(l[c].listener===n)return l[c].isRegistered=!0,l[c]=l[l.length-1],l.length-=1,void(0===l.length&&(delete o.databinsWithListeners[a],x-=e.getLoadedBytes()));throw new s.jpipExceptions.InternalErrorException('Could not unregister listener from databin')},this.cleanupUnregisteredDatabins=function(){for(var e=0;e<u.length;++e)if(void 0!==u[e]){var t=u[e].databinsWithListeners;u[e].databins=t.slice()}f=x},this.saveData=function(e,t){if(0!==e.codestreamIndex)throw new s.jpipExceptions.UnsupportedFeatureException('Non zero Csn (Code Stream Index)','A.2.2');switch(e.classId){case 6:n(e,t);break;case 8:r(e,t);break;default:var o=u[e.classId];if(void 0===o)break;var l=!!g[e.classId],c=a(o,e.classId,e.inClassId,l,'<class ID '+e.classId+'>'),d=c.getLoadedBytes();c.addData(e,t);var p=c.getLoadedBytes()-d;f+=p;var m=o.listeners,h=m[e.inClassId];if(void 0!==h&&0<h.length){x+=p;for(var y=h.slice(),I=0,i;I<y.length;++I)i=y[I],i.isRegistered&&i.listener.call(i.listenerThis,c)}}},this}},function(e,t,n){'use strict';e.exports=function(e,t,n){function s(){if(g>=n.length)throw new i.jpipExceptions.IllegalOperationException('Unexpected requestData() after fetch done');if(null!=c&&null===l)throw new i.jpipExceptions.IllegalOperationException('Cannot resume already-active-fetch');if(d)throw new i.jpipExceptions.IllegalOperationException('Cannot resume already-terminated-fetch');setTimeout(function(){g>=n.length||null!=c||d||(u=p?g:n.length-1,c=t.requestData(o,r,a,n[u].minNumQualityLayers,l))})}function r(t,i){c=null;i&&(g=u,g>=n.length&&e.done())}function a(){}var o=null,l=null,c=null,d=!1,p=!1,u=0,g=0;this.setDedicatedChannelHandle=function(e){l=e},this.move=function(e){if(null===l&&null!=o)throw new i.jpipExceptions.IllegalOperationException('Cannot move non movable fetch');o=e,s()},this.resume=function(){s()},this.stop=function(){if(null==c){if(d)throw new i.jpipExceptions.IllegalOperationException('Cannot stop already terminated fetch');throw new i.jpipExceptions.IllegalOperationException('Cannot stop already stopped fetch')}return l||(t.stopRequestAsync(c),c=null),e.stopped()},this.terminate=function(){if(l)throw new i.jpipExceptions.IllegalOperationException('Unexpected terminate event on movable fetch');if(d)throw new i.jpipExceptions.IllegalOperationException('Double terminate event');c=null,d=!0},this.isProgressiveChanged=function(e){p=e,l&&null!=c&&(c=null,s())}};var i=n(0)},function(e,t,n){'use strict';n(0);e.exports=function(e,t,n){function i(e,t){var i=n.createFetch(e,g,t);return e.on('isProgressiveChanged',i.isProgressiveChanged),e.on('terminate',i.terminate),e.on('stop',i.stop),e.on('resume',i.resum),i}t=t||{};var s=null,r=null,a=t.maxChannelsInSession||1,o=t.maxRequestsWaitingForResponseInChannel||1,l=e.getMainHeaderDatabin(),c=n.createMarkersParser(l),d=n.createOffsetsCalculator(l,c),p=n.createStructureParser(e,c,d),u=n.createCodestreamStructure(p,'RPCL'),g=n.createReconnectableRequester(a,o,u,e),m=n.createRequestParamsModifier(u);return g.setStatusCallback(function(e){var t=null;null!==e.exception&&(t=e.exception.toString());var n={isReady:e.isReady,exception:t};if(!s||!n.isReady&&!n.exception){if(n.exception)try{console.error('JpipFetcher.requesterStatusCallback got unexpected exception: '+n.exception)}catch(t){}return}var i=s,a=r;if(s=null,r=null,!n.isReady)return void a(n.exception);var o=u.getSizesParams(),l=JSON.parse(JSON.stringify(o)),c=u.getDefaultTileStructure(),d=c.getDefaultComponentStructure();l.imageLevel=0,l.lowestQuality=1,l.highestQuality=c.getNumQualityLayers(),l.numResolutionLevelsForLimittedViewer=d.getNumResolutionLevels(),i(l)}),this.open=function(e){return new Promise(function(t,n){s=t,r=n,g.open(e)})},this.close=function(){return new Promise(function(e){g.close(e)})},this.on=function(){},this.startFetch=function(e,t){var n=m.modify(t),s=i(e,n.progressiveness);s.move(n.codestreamPartParams)},this.startMovableFetch=function(e,t){var n=m.modify(t),s=i(e,n.progressiveness),r=g.dedicateChannelForMovableRequest();s.setDedicatedChannelHandle(r),e.on('move',s.move),s.move(n.codestreamPartParams)},this.reconnect=function(){g.reconnect()},this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(t,n,i){var s=e.getCodingStyleOffset(n);if(null!==s){t[i+s+5]=a}}function s(e,t,n){if(0===t.length)return 0;if(!e.isDummyBufferForLengthCalculation)for(var s=0;s<t.length;++s){var i=n+t[s].markerSegmentLengthOffset,r=(e[i]<<8)+e[i+1],a=r-t[s].length;e[i]=a>>>8,e[i+1]=255&a}for(var o=n+t[0].start,l=o,c=0;c<t.length;++c){l+=t[c].length;for(var d=c+1<t.length?n+t[c+1].start:e.length;l<d;++l)e[o]=e[l],++o}var p=l-o;return p}function r(e,t,n){e.isDummyBufferForLengthCalculation||(e[t++]=n>>>24,e[t++]=255&n>>>16,e[t++]=255&n>>>8,e[t++]=255&n)}var a=function(e){switch(e){case'LRCP':return 0;case'RLCP':return 1;case'RPCL':return 2;case'PCRL':return 3;case'CPRL':return 4;default:throw new i.j2kExceptions.IllegalDataException('Progression order of '+e,'A.6.1, table A.16');}}(t);this.modifyMainOrTileHeader=function(t,i,r,a){if(t.isDummyBufferForLengthCalculation||n(t,i,r),void 0===a)return 0;var o=e.getRangesOfBestResolutionLevelsData(i,a);if(null!==o.numDecompositionLevelsOffset&&!t.isDummyBufferForLengthCalculation){var l=r+o.numDecompositionLevelsOffset;t[l]-=a}var c=s(t,o.ranges,r);return-c},this.modifyImageSize=function(t,n){if(!t.isDummyBufferForLengthCalculation){var s=e.getImageAndTileSizeOffset(),a=s+i.j2kOffsets.REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER,o=a+8,l=a+16,c=a+24;r(t,a,n.regionWidth),r(t,a+4,n.regionHeight),r(t,l,n.tileWidth),r(t,l+4,n.tileHeight),r(t,o,0),r(t,o+4,0),r(t,c,0),r(t,c+4,0)}},this.modifyInt32=r}},function(e,t,n){'use strict';function i(e,t,n,i){this._codestreamPart=t,this._maxQuality=n,this._reconstructor=e.reconstructor,this._packetsDataCollector=e.packetsDataCollector,this._qualityLayersCache=e.qualityLayersCache,this._codestreamStructure=e.codestreamStructure,this._databinsSaver=e.databinsSaver,this._jpipFactory=e.jpipFactory,this._maxQualityPerPrecinct=[],this._registeredPrecinctDatabins=[],this._dataListeners=[],this._isDisposed=!1,this._isProgressive=!0,this._precinctDataArrivedBound=this._precinctDataArrived.bind(this),this._listener=this._jpipFactory.createQualityWaiter(this._codestreamPart,i,this._maxQuality,this._qualityLayerReachedCallback.bind(this),this._codestreamStructure,this._databinsSaver,this._startTrackPrecinct.bind(this)),this._listener.register()}var s=n(0);e.exports=i,i.prototype.getProgressiveStagesFinished=function(){return this._ensureNotDisposed(),this._listener.getProgressiveStagesFinished()},i.prototype.getFetchedData=function(e){if(this._ensureNotDisposed(),0===this.getProgressiveStagesFinished())throw'JpipImageDataContext error: cannot call getFetchedData before getProgressiveStagesFinished() > 0';var t=this._listener.getQualityReached();if(e){if(e>t)throw'JpipImageDataContext error: getFetchedData called with quality higher than already reached';t=e}var n=this._packetsDataCollector.getAllCodeblocksData(this._codestreamPart,t,e),i=this._getCodestream(!0);if(null===n.codeblocksData)throw new s.jpipExceptions.InternalErrorException('Could not collect codeblocks although progressiveness stage has been reached');if(null===i)throw new s.jpipExceptions.InternalErrorException('Could not reconstruct codestream although progressiveness stage has been reached');return{headersCodestream:i,codeblocksData:n.codeblocksData,minQuality:t}},i.prototype.getFetchedDataAsCodestream=function(){return this._getCodestream(!1)},i.prototype.on=function(e,t){if(this._ensureNotDisposed(),'data'!==e)throw'JpipImageDataContext error: Unexpected event '+e;this._dataListeners.push(t)},i.prototype.isDone=function(){return this._ensureNotDisposed(),this._listener.isDone()},i.prototype.dispose=function(){this._ensureNotDisposed(),this._isDisposed=!0,this._listener.unregister(),this._listener=null;for(var e=0,t;e<this._registeredPrecinctDatabins.length;++e)t=this._registeredPrecinctDatabins[e],this._databinsSaver.removeEventListener(t,'dataArrived',this._precinctDataArrivedBound)},i.prototype.setIsProgressive=function(e){this._ensureNotDisposed();var t=this._isProgressive;if(this._isProgressive=e,!t&&e&&0<this.getProgressiveStagesFinished())for(var n=0;n<this._dataListeners.length;++n)this._dataListeners[n](this)},i.prototype._getCodestream=function(e){this._ensureNotDisposed();var t=this._listener.getQualityReached(),n;if(n=e?this._reconstructor.createHeadersCodestream(this._codestreamPart):this._reconstructor.createCodestream(this._codestreamPart,t,this._maxQuality),null===n)throw new s.jpipExceptions.InternalErrorException('Could not reconstruct codestream although progressiveness stage has been reached');return n},i.prototype._startTrackPrecinct=function(e,t,n){var i=e.getInClassId();this._maxQualityPerPrecinct[i]=t,this._registeredPrecinctDatabins.push(e),this._databinsSaver.addEventListener(e,'dataArrived',this._precinctDataArrivedBound),this._precinctDataArrived(e,n)},i.prototype._precinctDataArrived=function(e,t){var n=e.getInClassId(),i=this._maxQualityPerPrecinct[n],s=this._qualityLayersCache.getQualityLayerOffset(e,i,t);this._listener.precinctQualityLayerReached(n,s.numQualityLayers)},i.prototype._qualityLayerReachedCallback=function(){if(this._isProgressive||this._listener.isDone())for(var e=0;e<this._dataListeners.length;++e)this._dataListeners[e](this)},i.prototype._ensureNotDisposed=function(){if(this._isDisposed)throw new s.jpipExceptions.IllegalOperationException('Cannot use ImageDataContext after disposed')}},function(e,t,n){'use strict';var i=Math.floor,s=Math.ceil,r=Math.max,a=Math.min,o=n(0),l=0.6931471805599453;e.exports=function(e){function t(e){var t=e.level,i=f(t),s=x(t),r=e.minTileX+e.minTileY*p(),a=e.maxTileXExclusive-1+(e.maxTileYExclusive-1)*p(),o=d(r),l=d(a),c=n(o,t),u=n(l,t),g=c.width,m=c.height,h=e.maxTileXExclusive-e.minTileX,y=e.maxTileYExclusive-e.minTileY;return 1<h&&(g+=u.width,g+=i*(h-2)),1<y&&(m+=u.height,m+=s*(y-2)),{regionWidth:g,regionHeight:m,tileWidth:i,tileHeight:s}}function n(e,t){var n=c(e.horizontalEdgeType,I,g,f),i=c(e.verticalEdgeType,E,m,x);if(void 0!==t){var r=1<<t;n=s(n/r),i=s(i/r)}return{width:n,height:i}}function c(e,t,n,i){var s;switch(e){case C:s=t();break;case P:var r=i(),a=n()-t();s=a%r,0===s&&(s=r);break;case b:s=i();break;default:throw new o.jpipExceptions.InternalErrorException('Unexpected edge type: '+e);}return s}function d(e){var t=p(),n=u(),s=e%t,r=i(e/t);if(r>n||0>s||0>r)throw new o.jpipExceptions.InternalErrorException('Tile index '+e+' is not in range');var a=0==s?C:s==t-1?P:b,l=0===r?C:r===n-1?P:b;return{horizontalEdgeType:a,verticalEdgeType:l}}function p(){var t=s(e.imageWidth/e.tileWidth);return t}function u(){var t=s(e.imageHeight/e.tileHeight);return t}function g(n){if(void 0===n)return e.imageWidth;var i=t({minTileX:0,maxTileXExclusive:p(),minTileY:0,maxTileYExclusive:1,level:n});return i.regionWidth}function m(n){if(void 0===n)return e.imageHeight;var i=t({minTileX:0,maxTileXExclusive:1,minTileY:0,maxTileYExclusive:u(),level:n});return i.regionHeight}function f(t){if(void 0===t)return e.tileWidth;var n=s(e.tileWidth/(1<<t));return n}function x(t){if(void 0===t)return e.tileHeight;var n=s(e.tileHeight/(1<<t));return n}function h(){return e.firstTileOffsetX}function y(){return e.firstTileOffsetY}function I(e){var t=f()-h(),n=g();t>n&&(t=n);var i=s(t/(1<<e));return i}function E(e){var t=x()-y(),n=m();t>n&&(t=n);var i=s(t/(1<<e));return i}var b=0,C=1,P=2;return this.EDGE_TYPE_NO_EDGE=b,this.EDGE_TYPE_FIRST=C,this.EDGE_TYPE_LAST=P,this.getTilesFromPixels=function(e){var t=e.level,n=f(t),o=x(t),l=I(t),c=E(t),d=e.minX,g=e.minY,m=e.maxXExclusive,h=e.maxYExclusive,y=r(0,1+(d-l)/n),b=r(0,1+(g-c)/o),C=a(p(),1+(m-l)/n),P=a(u(),1+(h-c)/o),T={level:t,minTileX:i(y),minTileY:i(b),maxTileXExclusive:s(C),maxTileYExclusive:s(P)};return T},this.getNumTilesX=p,this.getNumTilesY=u,this.getTileWidth=f,this.getTileHeight=x,this.getFirstTileOffsetX=h,this.getFirstTileOffsetY=y,this.getFirstTileWidth=I,this.getFirstTileHeight=E,this.isEdgeTileId=d,this.getTileSize=n,this.getLevelWidth=g,this.getLevelHeight=m,this.getImageLevel=function(){return 0},this.getLevel=function(t){var n=Math.log;if(void 0===e.numResolutionLevelsForLimittedViewer)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';var i=n((t.maxXExclusive-t.minX)/t.screenWidth)/l,o=n((t.maxYExclusive-t.minY)/t.screenHeight)/l,c=s(r(i,o));return c=r(0,a(e.numResolutionLevelsForLimittedViewer-1,c)),c},this.getNumResolutionLevelsForLimittedViewer=function(){if(void 0===e.numResolutionLevelsForLimittedViewer)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';return e.numResolutionLevelsForLimittedViewer},this.getLowestQuality=function(){return 1},this.getHighestQuality=function(){if(void 0===e.highestQuality)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';return e.highestQuality},this.getSizeOfTiles=t,this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(e,t,n){var i=e[n]===t[0]&&e[n+1]===t[1];return i}function s(e,t){var n=r(e,!0),i=l(t,'Predefined marker in jGlobals.j2kMarkers'),s=n.markerToOffset[i];return void 0===s?null:s}function r(t,s){var r=t.getCachedData(c);if(void 0===r.markerToOffset&&(r.isParsedAllMarkers=!1,r.lastOffsetParsed=0,r.markerToOffset={},r.databin=t),r.isParsedAllMarkers)return r;var l=[],d=!0;if(t===e&&0===r.lastOffsetParsed){var p=t.copyBytes(l,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE});if(null===p)d=!1;else if(!n(l,i.j2kMarkers.StartOfCodestream,0))throw new i.j2kExceptions.IllegalDataException('SOC (Start Of Codestream) is not found where expected to be','A.4.1');r.lastOffsetParsed=2}return d&&a(r),o(r,s),r}function a(e){for(var n=e.lastOffsetParsed,s=[],r=e.databin.copyBytes(s,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE+i.j2kOffsets.LENGTH_FIELD_SIZE,databinStartOffset:n});null!==r;){var a=l(s,'offset '+n+' of databin with class ID = '+e.databin.getClassId()+' and in class ID = '+e.databin.getInClassId());e.markerToOffset[a.toString()]=n;var o=t.getInt16(s,i.j2kOffsets.MARKER_SIZE);n+=o+i.j2kOffsets.MARKER_SIZE,r=e.databin.copyBytes(s,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE+i.j2kOffsets.LENGTH_FIELD_SIZE,databinStartOffset:n})}e.lastOffsetParsed=n}function o(t,s){var r=t.databin.getDatabinLengthIfKnown();if(t.isParsedAllMarkers=t.lastOffsetParsed===r,!t.isParsedAllMarkers&&t.databin!==e){var a=[],o=t.databin.copyBytes(a,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE,databinStartOffset:t.lastOffsetParsed});null!==o&&n(a,0,i.j2kMarkers.StartOfData)&&(t.lastOffsetParsed+=i.j2kOffsets.MARKER_SIZE,t.isParsedAllMarkers=!0)}if(s&&!t.isParsedAllMarkers)throw new i.jpipExceptions.InternalErrorException('data-bin with class ID = '+t.databin.getClassId()+' and in class ID = '+t.databin.getInClassId()+' was not recieved yet')}function l(e,t){if(255!==e[0])throw new i.j2kExceptions.IllegalDataException('Expected marker in '+t,'A');var n=e[1].toString(16);return n}var c='markers';this.getMandatoryMarkerOffsetInDatabin=function(e,t,n,r){var a=s(e,t);if(null===a)throw new i.j2kExceptions.IllegalDataException(n+' is not found where expected to be',r);return a},this.checkSupportedMarkers=function(e,t,n){n=!!n;for(var s=r(e,!0),a={},o=0,c;o<t.length;++o)c=l(t[o],'jpipMarkersParser.supportedMarkers['+o+']'),a[c]=!0;for(var d in s.markerToOffset){var p=!!a[d];if(p!==n)throw new i.j2kExceptions.UnsupportedFeatureException('Unsupported marker found: '+d,'unknown')}},this.getMarkerOffsetInDatabin=s,this.isMarker=n}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(e,t){var n=l(e,t);if(null===n)return null;var s=n+i.j2kOffsets.MARKER_SIZE,r=c(e,8,s),a=r[2],o=!(1&a),d=7,p=r[d],u=o?null:n+14;return{codingStyleDefaultOffset:n,isDefaultPrecinctSize:o,isStartOfPacketMarkerAllowed:!!(2&a),isEndPacketHeaderMarkerAllowed:!!(4&a),numResolutionLevels:p+1,precinctSizesOffset:u,numDecompositionLevelsOffset:s+d}}function s(e,t,n){if(!(null===t||t.isDefaultPrecinctSize)){var s=t.numResolutionLevels-n,r=t.precinctSizesOffset+s,a=t.codingStyleDefaultOffset+i.j2kOffsets.MARKER_SIZE;e.push({markerSegmentLengthOffset:a,start:r,length:n})}}function r(e,t){var n=c(e,1,t+4),s=31&n[0],r;switch(s){case 0:r=1;break;case 1:r=0;break;case 2:r=2;break;default:throw new i.j2kExceptions.IllegalDataException('Quantization style of '+s,'A.6.4');}return r}function a(e,n,s,a){var o=t.getMarkerOffsetInDatabin(n,i.j2kMarkers.QuantizationDefault);if(null!==o){var l=r(n,o);if(0!==l){var c=s.numResolutionLevels-a,d=o+i.j2kOffsets.MARKER_SIZE;e.push({markerSegmentLengthOffset:d,start:o+5+(1+3*(c-1))*l,length:3*a*l})}}}function o(e){var n=t.getMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleComponent);if(null!==n)throw new i.j2kExceptions.UnsupportedFeatureException('COC Marker (Coding Style Component)','A.6.2')}function l(e,n){o(e);var s;return s=n?t.getMandatoryMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleDefault,'COD (Coding style Default)','A.6.1'):t.getMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleDefault),s}function c(e,t,n){var s=[],r=e.copyBytes(s,0,{forceCopyAllRange:!0,maxLengthToCopy:t,databinStartOffset:n});if(null===r)throw new i.jpipExceptions.InternalErrorException('Header data-bin has not yet recieved '+t+' bytes starting from offset '+n);return s}var d=[i.j2kMarkers.ImageAndTileSize,i.j2kMarkers.CodingStyleDefault,i.j2kMarkers.QuantizationDefault,i.j2kMarkers.Comment];this.getCodingStyleOffset=l,this.getCodingStyleBaseParams=n,this.getImageAndTileSizeOffset=function(){var n=t.getMandatoryMarkerOffsetInDatabin(e,i.j2kMarkers.ImageAndTileSize,'Image and Tile Size (SIZ)','A.5.1');return n},this.getRangesOfBestResolutionLevelsData=function(r,o){t.checkSupportedMarkers(r,d,!0);var l=null,c=n(r,!1),p=c;null===c?p=n(e,!0):l=c.numDecompositionLevelsOffset;var u=p.numResolutionLevels;if(u<=o)throw new i.jpipExceptions.InternalErrorException('numResolutionLevels ('+o+') <= COD.numResolutionLevels ('+u+')');var g=[];s(g,c,o),a(g,r,p,o);var m={ranges:g,numDecompositionLevelsOffset:l};return m}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function s(t,s,a,o){for(var l=0,c=t.getTileIterator(),d={packetDataOffsets:[],data:n.createCompositeArray(0),allRelevantBytesLoaded:0};c.tryAdvance();){var p=c.createPrecinctIterator(),u=c.tileStructure.getNumQualityLayers();if(void 0!==a&&'max'!==a&&(u=Math.min(u,a)),'max'===s)t.minNumQualityLayers=u;else if(s>u)throw new i.jpipExceptions.InternalErrorException('minQuality is larger than quality');for(;p.tryAdvance();){if(!p.isInCodestreamPart)throw new i.jpipExceptions.InternalErrorException('Unexpected precinct not in codestream part');var g=c.tileStructure.precinctPositionToInClassIndex(p),m=e.getPrecinctDatabin(g),f=o[g];void 0===f&&(f={layerPerCodeblock:[]},o[g]=f);var x=r(d,l,c.tileStructure,p,m,f,u);if(x<s)return null}++l}var h=new Uint8Array(d.data.getLength());return d.data.copyToTypedArray(h,0,0,d.data.getLength()),d.data=h,d}function r(e,n,s,r,a,o,l){var c,d;for(c=0;c<l;++c){var p=t.getPacketOffsetsByCodeblockIndex(a,c,r);if(null===p)break;d=p.headerStartOffset+p.headerLength;for(var u=p.codeblockBodyLengthByIndex.length,g=Array(u),m=!1,f=0,i;f<u;++f){if(i=o.layerPerCodeblock[f],void 0===i)i={layer:-1},o.layerPerCodeblock[f]=i;else if(i.layer>=c)continue;var x=p.codeblockBodyLengthByIndex[f],h=e.data.getLength(),y=a.copyToCompositeArray(e.data,{databinStartOffset:d,maxLengthToCopy:x.codeblockBodyLengthBytes,forceCopyAllRange:!0});if(y!==x.codeblockBodyLengthBytes){g.length=f,m=!0;break}i.layer=c,g[f]={start:h,end:h+x.codeblockBodyLengthBytes,codingpasses:x.codingPasses,zeroBitPlanes:x.zeroBitPlanes},d+=x.codeblockBodyLengthBytes}var I=s.precinctPositionToIndexInComponentResolution(r),E={tileIndex:n,r:r.resolutionLevel,p:I,c:r.component,l:c,codeblockOffsets:g};if(e.packetDataOffsets.push(E),m)break}return e.allRelevantBytesLoaded+=d,c}this.getAllCodeblocksData=function(e,t,n){var i=[],r=s(e,t,n,i);return{codeblocksData:r,alreadyReturnedCodeblocks:i}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function s(e){if(!e.isStarted)return r(),e.isStarted=!0,e.currentX=a.minTileX,e.currentY=a.minTileY,!0;if(e.currentY>=a.maxTileYExclusive)throw new i.jpipExceptions.InternalErrorException('Cannot advance tile iterator after end');if(++e.currentX,e.currentX<a.maxTileXExclusive)return!0;e.currentX=a.minTileX,++e.currentY;var t=e.currentY<a.maxTileYExclusive;return t}function r(){null!=a||(e?a=t.getTilesFromPixels(e):a={level:0,minTileX:0,minTileY:0,maxTileXExclusive:t.getNumTilesX(),maxTileYExclusive:t.getNumTilesY()})}var a=null,o=null;Object.defineProperty(this,'level',{get:function(){return e?e.level:0}}),Object.defineProperty(this,'fullTilesSize',{get:function(){return null==o&&(r(),o=t.getSizeOfTiles(a)),o}}),Object.defineProperty(this,'tilesBounds',{get:function(){return r(),a}}),this.getTileIterator=function(){var r={isStarted:!1,currentX:-1,currentY:-1},a={get tileIndex(){if(!r.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var e=t.getNumTilesX(),n=r.currentY*e,s=n+r.currentX;return s},get tileStructure(){if(!r.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var e=a.tileIndex,n=t.getTileStructure(e);return n},createPrecinctIterator:function(s){if(!r.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var o=a.tileIndex;return n.createParamsPrecinctIterator(t,o,e,s)},tryAdvance:function(){var e=s(r);return e}};return a}}},function(e,t,n){'use strict';var i=Math.floor,s=Math.ceil,r=Math.max,a=Math.min,o=n(0);e.exports=function(e,t,n,l){function c(){if(C=e.getTileStructure(t),!!n&&void 0!==n.level){var i=C.getMinNumResolutionLevelsOverComponents();if(i<=n.level)throw new o.jpipExceptions.InternalErrorException('Cannot advance resolution: level='+n.level+' but should be smaller than '+i)}if(E=d(),!l&&null!==E){var s=E[0][0];m=s.minPrecinctX,f=s.minPrecinctY}b=C.getProgressionOrder()}function d(){if(!n)return null;for(var o=e.getNumComponents(),l=Array(o),c=n.level||0,d=e.getTileLeft(t,c),p=e.getTileTop(t,c),u=n.minX-d,g=n.minY-p,m=n.maxXExclusive-d,f=n.maxYExclusive-p,x=0;x<o;++x){for(var h=C.getComponentStructure(x),y=h.getNumResolutionLevels(),I=y-c,E=h.getNumResolutionLevels(),b=Array(y),P=0;P<I;++P){var T=h.getComponentScaleX(),S=h.getComponentScaleY(),v=I-P-1,L=T<<v,O=S<<v,k=4,R=i(u/L)-k,D=i(g/O)-k,A=s(m/L)+k,_=s(f/O)+k,j=h.getPrecinctWidth(P)*T,N=h.getPrecinctHeight(P)*S,F=i(R/j),B=i(D/N),M=s(A/j),w=s(_/N),q=h.getNumPrecinctsX(P),X=h.getNumPrecinctsY(P);b[P]={minPrecinctX:r(0,F),minPrecinctY:r(0,B),maxPrecinctXExclusive:a(M,q),maxPrecinctYExclusive:a(w,X)}}l[x]=b}return l}function p(t,i){var s=C.getComponentStructure(g);switch(b[t]){case'R':var r=s.getNumResolutionLevels();return!!n&&n.level&&(r-=n.level),++x,x%=r,x;case'C':return++g,g%=e.getNumComponents(),g;case'P':var a,l,c,d;if(null!==i){var p=i[g],u=p[x];a=u.minPrecinctX,l=u.minPrecinctY,c=u.maxPrecinctXExclusive,d=u.maxPrecinctYExclusive}else a=0,l=0,c=s.getNumPrecinctsX(x),d=s.getNumPrecinctsY(x);return(m-=a-1,m%=c-a,m+=a,m!=a)?m-a:(f-=l-1,f%=d-l,f+=l,f-l);case'L':throw new o.jpipExceptions.InternalErrorException('Advancing L is not supported in JPIP');default:throw new o.jpipExceptions.InternalErrorException('Unexpected letter in progression order: '+b[t]);}}var u=!1,g=0,m=m,f=f,x=0,h=!0,y=-1,I=-1,E=null,b,C;return Object.defineProperty(this,'tileIndex',{get:function(){return t}}),Object.defineProperty(this,'component',{get:function(){return g}}),Object.defineProperty(this,'precinctX',{get:function(){return m}}),Object.defineProperty(this,'precinctY',{get:function(){return f}}),Object.defineProperty(this,'resolutionLevel',{get:function(){return x}}),Object.defineProperty(this,'isInCodestreamPart',{get:function(){return h}}),this.tryAdvance=function(){if(!u)return c(),u=!0,!0;var e=!0,t=l?null:E,n=!1;y=-1,I=-1;for(var s=2,i;0<=s&&(i=p(s,t),e=0===i,!!e);--s)'P'!==b[s]||l||(n=!0);if(e)return!1;if(null==E)return h=!0,!0;var r=E[g],a=r[x];return n&&(m=a.minPrecinctX,f=a.minPrecinctY),h=m>=a.minPrecinctX&&f>=a.minPrecinctY&&m<a.maxPrecinctXExclusive&&f<a.maxPrecinctYExclusive,!0},this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,s,r,a,o){function l(e,t){if(0===t)throw new i.jpipExceptions.InternalErrorException('Cannot use '+e+' iterator before started');else if(1<t)throw new i.jpipExceptions.InternalErrorException('Cannot use '+e+' iterator after ended')}var c=null,d=null,p=function(){var e=t.getComponentStructure(s),n=e.getNumResolutionLevels();return n-r-1}();Object.defineProperty(this,'level',{get:function(){return p}}),Object.defineProperty(this,'fullTilesSize',{get:function(){if(null==c){var t=this.tilesBounds;c=e.getSizeOfTiles(t)}return c}}),Object.defineProperty(this,'tilesBounds',{get:function(){if(null==d){var t=e.getNumTilesX(),i=n%t,s=Math.floor(n/t);d={level:p,minTileX:i,minTileY:s,maxTileXExclusive:i+1,maxTileYExclusive:s+1}}return d}}),this.getTileIterator=function(){var e=0;return{get tileIndex(){return l('tile',e),n},get tileStructure(){return l('tile',e),t},tryAdvance:function(){if(2<e)throw new i.jpipExceptions.InternalErrorException('Cannot advance tile iterator after ended');return++e,2>e},createPrecinctIterator:function(t){if(l('tile',e),t)throw new i.jpipExceptions.InternalErrorException('Precinct iterator of single precinct part cannot iterate precincts out of part');var c=0;return{get tileIndex(){return l('precinct',c),n},get component(){return l('precinct',c),s},get precinctX(){return l('precinct',c),a},get precinctY(){return l('precinct',c),o},get resolutionLevel(){return l('precinct',c),r},get isInCodestreamPart(){return l('precinct',c),!0},tryAdvance:function(){if(1<c)throw new i.jpipExceptions.InternalErrorException('Cannot advance precinct iterator after ended');return++c,2>c}}}}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,s){function r(e){if(e.isAllDatabinLoaded()){var n=e.getInClassId(),r=d[n];if(!r.isAlreadyLoaded){r.isAlreadyLoaded=!0,--a;for(var o=t.getTileStructure(n),l=r.precinctIterator;l.tryAdvance();){if(!l.isInCodestreamPart)throw new i.jpipExceptions.InternalErrorException('Unexpected precinct not in codestream part');s(l,o)}}}}var a=0,o=!1,l=!1,c=[],d=[];this.isAllTileHeadersLoaded=function(){return 0==a},this.register=function(){if(o)throw new i.jpipExceptions.InternalErrorException('JpipQualityWaiter already registered');o=!0,++a;for(var t=e.getTileIterator();t.tryAdvance();){var s=t.tileIndex,l=n.getTileHeaderDatabin(s);c.push(l);var p=l.getInClassId();d[p]={precinctIterator:t.createPrecinctIterator(),isAlreadyLoaded:!1},n.addEventListener(l,'dataArrived',r),++a,r(l)}--a},this.unregister=function(){if(!o)throw new i.jpipExceptions.InternalErrorException('JpipQualityWaiter not registered');if(!l){l=!0;for(var e=0;e<c.length;++e)n.removeEventListener(c[e],'dataArrived',r)}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,s,r,a,o,l){function c(e,t){var n=f[e];n?(--x[n.qualityReached],n.isUpdated=n.qualityReached!==t,n.qualityReached=t):(n={qualityReached:t,isUpdated:0<t},f[e]=n);var i=x[t]||0;return x[t]=i+1,n}function d(){if(!(0<x[p]||'max'===p||u>=t.length||!h.isAllTileHeadersLoaded())){if(m)throw new i.jpipExceptions.InternalErrorException('Request already done but callback is called');var e=x.length,n;do{if(++p,p>=e){p='max';break}n=0<x[p]}while(!n);var r=t[u].minNumQualityLayers;if(!(p<r)){for('max'===p&&(u=t.length);u<t.length;){var a=t[u].minNumQualityLayers;if('max'===a||a>p)break;++u}m=u===t.length,s()}}}var p=0,u=0,g=!1,m=!1,f=[],x=[],h=l.createPrecinctsIteratorWaiter(e,r,a,function(e,t){var n=t.precinctPositionToInClassIndex(e),s=a.getPrecinctDatabin(n),r=c(n,0);if(r.qualityInTile!==void 0)throw new i.jpipExceptions.InternalErrorException('Precinct was iterated twice in codestream part');var l=t.getNumQualityLayers();r.qualityInTile=l,o(s,l,e,n,t),g&&d()});this.register=function(){h.register(),g=!0,d()},this.unregister=function(){h.unregister()},this.precinctQualityLayerReached=function(e,t){var n=c(e,t);n.isUpdated&&(n.isUpdated=!1,d())},this.getProgressiveStagesFinished=function(){return u},this.isDone=function(){return m},this.getQualityReached=function(){if(0==u)throw new i.jpipExceptions.IllegalOperationException('Cannot create codestream before first progressiveness stage has been reached');var e=t[u-1].minNumQualityLayers;return e}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e){function t(e,t,n){for(var a=Array(e.length),o=0,i;o<e.length;++o){if(i=e[o].minNumQualityLayers,'max'!==i){if(void 0!==t&&i>t)throw new s.jpipExceptions.ArgumentException('progressiveness['+o+'].minNumQualityLayers',i,'minNumQualityLayers is bigger than fetchParams.quality');i=r(i,n,'progressiveness['+o+'].minNumQualityLayers')}a[o]={minNumQualityLayers:i}}return a}function n(t){var n=[],s=e.getDefaultTileStructure(),r=s.getNumQualityLayers(),a='max';void 0!==t&&(r=Math.min(r,t),a=r);for(var o=4>r?r-1:3,l=1;l<o;++l)n.push({minNumQualityLayers:l});var c=Math.round(r/2);return c>o&&('max'===a||c<a)&&n.push({minNumQualityLayers:c}),n.push({minNumQualityLayers:a}),n}function i(t){var n=r(t.level,'level',void 0,!0),i=r(t.quality,'quality',void 0,!0),a=r(t.minX,'minX'),o=r(t.minY,'minY'),l=r(t.maxXExclusive,'maxXExclusive'),c=r(t.maxYExclusive,'maxYExclusive'),d=e.getLevelWidth(n),p=e.getLevelHeight(n);if(0>a||l>d||0>o||c>p||a>=l||o>=c)throw new s.jpipExceptions.ArgumentException('codestreamPartParams',t);return{minX:a,minY:o,maxXExclusive:l,maxYExclusive:c,level:n,quality:i}}function r(e,t,n,i){if(e===void 0&&(n!==void 0||i))return n;var r=+e;if(isNaN(r)||r!==Math.floor(r))throw new s.jpipExceptions.ArgumentException(t,e);return r}this.modify=function(e,r){var a=i(e);r=r||{};var o=r.useCachedDataOnly,l=r.disableProgressiveness,c;if(r.progressiveness!==void 0){if(o||l)throw new s.jpipExceptions.ArgumentException('options.progressiveness',r.progressiveness,'options contradiction: cannot accept both progressivenessand useCachedDataOnly/disableProgressiveness options');c=t(r.progressiveness,a.quality,'quality')}else if(o)c=[{minNumQualityLayers:0}];else if(l){var d=a.quality,p=d===void 0?'max':d;c=[{minNumQualityLayers:p}]}else c=n(a.quality);return{codestreamPartParams:a,progressiveness:c}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(t,e,n,s,r,a){function o(e,i){var s=!1;try{var r=c(e,i);if(r===f)return;s=r===m}catch(n){s=!0,t.onException(n)}try{s||t.waitForConcurrentRequestsToEnd(x),n.requestEnded(e,x),s&&!y&&a!==void 0&&a(),t.checkConcurrentRequestsFinished()}catch(n){t.onException(n)}}function l(e){n.requestEnded(e,x),t.checkConcurrentRequestsFinished(),a!==void 0&&a()}function c(e,s){if(!s)throw new i.jpipExceptions.InternalErrorException('AJAX callback called although response is not done yet and chunked encoding is not enabled');var r=t.getCreatedChannelId(e);null===r?null===n.getChannelId()&&t.onException(new i.jpipExceptions.IllegalDataException('Cannot extract cid from cnew response','D.2.3')):null===n.getChannelId()?n.setChannelId(r):t.onException(new i.jpipExceptions.IllegalDataException('Channel created although was not requested','D.2.3'));var a=u(e);if(null===a)return m;var o=p(e,a);return o}function d(){E=n.nextRequestId();var e=s+'&len='+I+'&qid='+E;I*=2;var i=null===n.getChannelId();if(i){e+='&cnew=http';var r=t.getFirstChannel();null!==r&&(e+='&cid='+r.getChannelId())}else e+='&cid='+n.getChannelId();t.sendAjax(e,o,l)}function p(e,n){var s=m,r=new Uint8Array(e.response);if(n>r.length-2||0!==r[n])throw new i.jpipExceptions.IllegalDataException('Could not find End Of Response (EOR) code at the end of response','D.3');switch(r[n+1]){case i.jpipEndOfResponseReasons.IMAGE_DONE:case i.jpipEndOfResponseReasons.WINDOW_DONE:case i.jpipEndOfResponseReasons.QUALITY_LIMIT:s=g;break;case i.jpipEndOfResponseReasons.WINDOW_CHANGE:if(!y)throw new i.jpipExceptions.IllegalOperationException('Server response was terminated due to newer request issued on same channel. That may be an internal webjpip.js error - Check that movable requests are well maintained');break;case i.jpipEndOfResponseReasons.BYTE_LIMIT:case i.jpipEndOfResponseReasons.RESPONSE_LIMIT:y||(d(),s=f);break;case i.jpipEndOfResponseReasons.SESSION_LIMIT:t.onException(new i.jpipExceptions.IllegalOperationException('Server resources associated with the session is limitted, no further requests should be issued to this session'));break;case i.jpipEndOfResponseReasons.NON_SPECIFIED:t.onException(new i.jpipExceptions.IllegalOperationException('Server error terminated response with no reason specified'));break;default:t.onException(new i.jpipExceptions.IllegalDataException('Server responded with illegal End Of Response (EOR) code: '+r[n+1]));}return s}function u(n){try{for(var i=new Uint8Array(n.response),s=0,r;s<i.length&&!(0===i[s]);){var a=e.parseMessageHeader(i,s,r);if(a.bodyStart+a.messageBodyLength>i.length)return s;t.getDatabinsSaver().saveData(a,i),s=a.bodyStart+a.messageBodyLength,r=a}return s}catch(n){return t.onException(n),null}}var g=1,m=2,f=3,x=this,h=!1,y=!1,I=10*1024,E;this.startRequest=function(){if(h)throw new i.jpipExceptions.InternalErrorException('startRequest called twice');else if(y)throw new i.jpipExceptions.InternalErrorException('request was already stopped');h=!0,t.requestStarted(),d()},this.stopRequestAsync=function(){y=!0},this.getLastRequestId=function(){if(!h)throw new i.jpipExceptions.InternalErrorException('Unexpected call to getLastRequestId on inactive request');return E},this.callCallbackAfterConcurrentRequestsFinished=function(){r(x,!0)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,s,r){function a(e){var t=new i.jpipExceptions.InternalErrorException('Bad jpip server response (status = '+e.status+')');o(t)}function o(e){e===void 0&&(e=null),null!==l&&l({isReady:m,exception:e})}var l=null,c=null,d=[],p=null,u=0,g=[],m=!1,f=t||'0';this.onException=function(e){o(e)},this.getIsReady=function(){return m},this.setIsReady=function(e){m=e,o()},this.getCodestreamStructure=function(){return n},this.getDatabinsSaver=function(){return s},this.getDataRequestUrl=function(){return e},this.getTargetId=function(){return f},this.getFirstChannel=function(){return p},this.setStatusCallback=function(e){l=e},this.setRequestEndedCallback=function(e){c=e},this.requestStarted=function(){++u},this.requestEnded=function(e,t){--u;var n=e.getResponseHeader('JPIP-tid');if(''!==n&&null!==n)if('0'===f)f=n;else if(f!==n)throw new i.jpipExceptions.IllegalDataException('Server returned unmatched target ID');null==p&&(p=t);var s=t.getIsDedicatedForMovableRequest()?null:t;null!==c&&c(s)},this.getActiveRequestsCount=function(){return u},this.channelCreated=function(e){d.push(e)},this.getCreatedChannelId=function(e){var t=e.getResponseHeader('JPIP-cnew');if(!t)return null;for(var n=t.split(','),s=0,i;s<n.length;++s)if(i=n[s].split('='),'cid'===i[0])return i[1];return null},this.waitForConcurrentRequestsToEnd=function(e){for(var t=[],n=0;n<d.length;++n){var i=d[n].getRequestsWaitingForResponse(),s=i.length;if(0!==s){for(var r=i[0].getLastRequestId(),a=1;a<i.length;++a)r=Math.max(r,i[a].getLastRequestId());t.push({channel:d[n],requestId:r})}}g.push({request:e,concurrentRequests:t})},this.checkConcurrentRequestsFinished=function(){for(var e=g.length-1;0<=e;--e){for(var t=g[e].concurrentRequests,n=t.length-1,i;0<=n;--n)i=t[n],i.channel.isAllOldRequestsEnded(i.requestId)&&(t[n]=t[t.length-1],t.length-=1);if(!(0<t.length)){var s=g[e].request,r=s.callback;g[e]=g[g.length-1],g.length-=1,s.callCallbackAfterConcurrentRequestsFinished()}}},this.sendAjax=function(e,t,n){var i;i=n?function(e){a(e),n(e)}:a,r.request(e,t,i)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,s,r,a,o,l){function c(){null!=P&&o(P),y.setIsReady(!1),y.sendAjax(v,h)}function d(e){++C;var n=l.createChannel(t,y);return y.channelCreated(n),e||b.push(n),n}function p(e,t){for(var n=null,s=e+1,r=0,i,a;r<b.length&&(a=b[r].getAllQueuedRequestCount(),a<s&&(n=b[r],i=r,s=a),0!==a);++r);return t&&null!==n?(b[i]=b[b.length-1],b.length-=1,n):n}function u(){var e=r.getMainHeaderDatabin();if(!e.isAllDatabinLoaded())throw new i.jpipExceptions.IllegalDataException('Main header was not loaded on session creation');var t=y.getFirstChannel(),n=t.getChannelId();return v=T+'&cclose=*&cid='+n,x?void c():void(null===n||(P=a(g,f),y.setIsReady(!0)))}function g(){if(!(0<y.getActiveRequestsCount())){var e=y.getFirstChannel();e.sendMinimalRequest(function(){})}}function m(){if(null===y||!y.getIsReady())throw new i.jpipExceptions.InternalErrorException('Cannot perform this operation when the session is not ready')}var f=30*1e3,x=!1,h=null,y=null,I=null,E=null,b=[],C=0,P=null,T,S,v;this.open=function(e){if(null!=y)throw new i.jpipExceptions.InternalErrorException('session.open() should be called only once');var t=0>e.indexOf('?')?'?':'&';T=e+t+'type='+(r.getIsJpipTilePartStream()?'jpt-stream':'jpp-stream'),S=T+'&stream=0',y=l.createSessionHelper(S,n,s,r),null!=I&&y.setStatusCallback(I),null!=E&&y.setRequestEndedCallback(E);var a=d();a.sendMinimalRequest(u)},this.getTargetId=function(){return m(),y.getTargetId()},this.getIsReady=function(){var e=null!==y&&y.getIsReady();return e},this.setStatusCallback=function(e){I=e,null!==y&&y.setStatusCallback(e)},this.setRequestEndedCallback=function(e){E=e,null!==y&&y.setRequestEndedCallback(e)},this.hasActiveRequests=function(){m();var e=0<y.getActiveRequestsCount();return e},this.tryGetChannel=function(n){m();var i=C<e,s=i||n?0:t-1,r=p(s,n);return null===r&&i&&(r=d(n)),n&&null!==r&&r.dedicateForMovableRequest(),r},this.close=function(e){if(0==C)throw new i.jpipExceptions.InternalErrorException('Cannot close session before open');if(x)throw new i.jpipExceptions.InternalErrorException('Cannot close session twice');x=!0,h=e,v!=void 0&&c()}}},function(e,t,n){'use strict';var s=n(0);e.exports=function(e,t,n,i,r,a){function o(){if(null!==S)throw new s.jpipExceptions.IllegalOperationException('Previous session still not established');return null==y?void(i.cleanupUnregisteredDatabins(),l()):void(null!==P&&P({isReady:!0,exception:'Previous session that should be closed still alive.Maybe old requestContexts have not beed closed. Reconnect will not be done'}))}function l(){var s;null!=h&&(s=h.getTargetId()),S=r.createSession(e,t,s,n,i),S.setStatusCallback(d),S.open(I)}function c(e){var t=h.tryGetChannel(!0);if(null===t)throw new s.jpipExceptions.IllegalOperationException('Too many concurrent requests. Limit the use of dedicated (movable) requests, enlarge maxChannelsInSession or wait for requests to finish and avoid create new ones');if(!t.getIsDedicatedForMovableRequest())throw new s.jpipExceptions.InternalErrorException('getIsDedicatedForMovableRequest inconsistency');e.internalDedicatedChannel=t}function d(e){if(null===S||e.isReady!==S.getIsReady())throw new s.jpipExceptions.InternalErrorException('Unexpected statusCallback when not registered to session or inconsistent isReady');if(e.isReady){if(null!=y)throw new s.jpipExceptions.InternalErrorException('sessionWaitingForDisconnect should be null');y=h,h=S,S=null,null!=y&&(y.setStatusCallback(null),!f()&&y.setRequestEndedCallback(f)),h.setStatusCallback(P),h.setRequestEndedCallback(m);for(var t=0;t<C.length;++t)c(C[t])}null!==P&&P(e)}function p(e){null!==e&&(++E,e.close(u))}function u(){--E,0==E&&T!==void 0&&T()}function g(){if(null===h)throw new s.jpipExceptions.InternalErrorException('This operation is forbidden when session is not ready')}function m(e){var t=null;if(i.getLoadedBytes()>x&&o(),null!==e){if(e.getIsDedicatedForMovableRequest())throw new s.jpipExceptions.InternalErrorException('Expected non-movable channel as channelFreed');do{if(0===b.length){t=null;break}if(t=b.shift(),null!==t.internalRequest)throw new s.jpipExceptions.InternalErrorException('Request was already sent but still in queue')}while(t.isEnded);null!==t&&(t.internalRequest=e.requestData(t.codestreamPartParams,t.callback,t.failureCallback,t.numQualityLayers))}}function f(){var e=!y.hasActiveRequests();return e&&(y.close(),y=null),e}var x=a||10*1048576,h=null,y=null,I=null,E=0,b=[],C=[],P=null,T=null,S;this.getIsReady=function(){return null!=h&&h.getIsReady()},this.open=function(e){if(e===void 0||null===e)throw new s.jpipExceptions.ArgumentException('baseUrl',e);if(null!=I)throw new s.jpipExceptions.IllegalOperationException('Image was already opened');I=e,l()},this.close=function(e){if(null!=T)throw new s.jpipExceptions.IllegalOperationException('closed twice');T=e,E=1,p(h),p(S),p(y),u()},this.setStatusCallback=function(e){P=e,null!=h&&h.setStatusCallback(e)},this.dedicateChannelForMovableRequest=function(){g();var e={internalDedicatedChannel:null};return C.push(e),c(e),e},this.requestData=function(e,t,n,i,r){g();var a={isEnded:!1,internalRequest:null,codestreamPartParams:e,callback:t,failureCallback:n,numQualityLayers:i},o=!!r,l;if(o)l=r.internalDedicatedChannel;else{if(l=h.tryGetChannel(),null===l)return b.push(a),a;if(l.getIsDedicatedForMovableRequest())throw new s.jpipExceptions.InternalErrorException('Expected non-movable channel')}if(l.getIsDedicatedForMovableRequest()!==o)throw new s.jpipExceptions.InternalErrorException('getIsDedicatedForMovableRequest inconsistency');return a.internalRequest=l.requestData(e,t,n,i),a},this.stopRequestAsync=function(e){e.isEnded=!0,null!==e.internalRequest&&e.internalRequest.stopRequestAsync()},this.reconnect=o}},function(e,t,n){'use strict';var s=Math.pow,r=n(0);e.exports=function(e,t,n,a){function i(c,d){var p=a.getCodingStyleBaseParams(c,d);if(null===p)return null;var u=e.getMainHeaderDatabin(),g=a.getImageAndTileSizeOffset(),m=g+r.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER,f=l(u,2,m),x=n.getInt16(f,0),h=t.getMarkerOffsetInDatabin(c,r.j2kMarkers.PackedPacketHeadersInTileHeader),y=t.getMarkerOffsetInDatabin(u,r.j2kMarkers.PackedPacketHeadersInMainHeader),I=p.codingStyleDefaultOffset+6,E=l(c,6,I),b=n.getInt16(E,0),C=o(E,4),P=o(E,5),T=Array(p.numResolutionLevels),S=Array(p.numResolutionLevels),v=null;if(!p.isDefaultPrecinctSize){var L=p.numResolutionLevels;v=l(c,L,p.precinctSizesOffset)}for(var O=32768,k=0;k<p.numResolutionLevels;++k){if(p.isDefaultPrecinctSize){T[k]=O,S[k]=O;continue}var i=k,R=v[i];T[k]=1*s(2,15&R),S[k]=1*s(2,R>>>4)}for(var D=Array(x),A=0;A<x;++A)D[A]={maxCodeblockWidth:C,maxCodeblockHeight:P,numResolutionLevels:p.numResolutionLevels,precinctWidthPerLevel:T,precinctHeightPerLevel:S};var _={maxCodeblockWidth:C,maxCodeblockHeight:P,numResolutionLevels:p.numResolutionLevels,precinctWidthPerLevel:T,precinctHeightPerLevel:S},j={numQualityLayers:b,isPacketHeadersNearData:null===h&&null===y,isStartOfPacketMarkerAllowed:p.isStartOfPacketMarkerAllowed,isEndPacketHeaderMarkerAllowed:p.isEndPacketHeaderMarkerAllowed,paramsPerComponent:D,defaultComponentParams:_};return j}function o(e,t){var n=e[t],i=2+(15&n);if(10<i)throw new r.j2kExceptions.IllegalDataException('Illegal codeblock width exponent '+i,'A.6.1, Table A.18');return 1<<i}function l(e,t,n){var i=[],s=e.copyBytes(i,0,{forceCopyAllRange:!0,maxLengthToCopy:t,databinStartOffset:n});if(null===s)throw new r.jpipExceptions.InternalErrorException('Header data-bin has not yet recieved '+t+' bytes starting from offset '+n);return i}this.parseCodestreamStructure=function(){for(var t=e.getMainHeaderDatabin(),s=a.getImageAndTileSizeOffset(),o=l(t,38,s+r.j2kOffsets.MARKER_SIZE+r.j2kOffsets.LENGTH_FIELD_SIZE),c=r.j2kOffsets.REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER-(r.j2kOffsets.MARKER_SIZE+r.j2kOffsets.LENGTH_FIELD_SIZE),d=r.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER-(r.j2kOffsets.MARKER_SIZE+r.j2kOffsets.LENGTH_FIELD_SIZE),p=n.getInt32(o,c),u=n.getInt32(o,c+4),g=n.getInt32(o,10),m=n.getInt32(o,14),f=n.getInt32(o,18),x=n.getInt32(o,22),h=n.getInt32(o,26),y=n.getInt32(o,30),I=n.getInt16(o,d),E=s+r.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER+2,b=l(t,3*I,E),C=Array(I),P=Array(I),T=0;T<I;++T)C[T]=b[3*T+1],P[T]=b[3*T+2];return{numComponents:I,componentsScaleX:C,componentsScaleY:P,imageWidth:p-h,imageHeight:u-y,tileWidth:f,tileHeight:x,firstTileOffsetX:h,firstTileOffsetY:y}},this.parseDefaultTileParams=function(){var t=e.getMainHeaderDatabin(),n=i(t,!0);return n},this.parseOverridenTileParams=function(t){var n=e.getTileHeaderDatabin(t),s=i(n,!1);return s}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,s){function r(e,t,n){if(0>t||t>=n)throw new i.jpipExceptions.ArgumentException(e,t,e+' is expected to be between 0 and '+n-1)}function a(e,t,n,i,s){var r=n(e),a=i(e),o=s(e);if(r>=a||o>=a)return!0;return 0==r%o||0==o%r}var o,l,d,p;this.getProgressionOrder=function(){return s},this.getDefaultComponentStructure=function(){return o},this.getComponentStructure=function(e){return l[e]},this.getTileWidth=function(){return e.tileSize.width},this.getTileHeight=function(){return e.tileSize.height},this.getNumQualityLayers=function(){return e.numQualityLayers},this.getIsPacketHeaderNearData=function(){return e.isPacketHeadersNearData},this.getIsStartOfPacketMarkerAllowed=function(){return e.isStartOfPacketMarkerAllowed},this.getIsEndPacketHeaderMarkerAllowed=function(){return e.isEndPacketHeaderMarkerAllowed},this.getMinNumResolutionLevelsOverComponents=function(){return p},this.precinctInClassIndexToPosition=function(e){if(0>e)throw new i.jpipExceptions.ArgumentException('inClassIndex',e,'Invalid negative in-class index of precinct');var n=t.getNumTilesX()*t.getNumTilesY(),s=t.getNumComponents(),r=e%n,a=(e-r)/n,o=a%s,c=l[o],p=c.getNumResolutionLevels(),u=(a-o)/s,g=0,m;for(m=1;m<p;++m){var f=d[o][m];if(f>u)break;g=f}--m;var x=u-g,h=c.getNumPrecinctsX(m),y=c.getNumPrecinctsY(m),I=x%h,E=(x-I)/h;if(E>=y)throw new i.jpipExceptions.ArgumentException('inClassIndex',e,'Invalid in-class index of precinct');var b={tileIndex:r,component:o,precinctX:I,precinctY:E,resolutionLevel:m};return b},this.precinctPositionToInClassIndex=function(e){var n=t.getNumComponents();r('precinctPosition.component',e.component,n);var i=l[e.component],s=i.getNumResolutionLevels();r('precinctPosition.resolutionLevel',e.resolutionLevel,s);var a=t.getNumTilesX()*t.getNumTilesY(),o=i.getNumPrecinctsX(e.resolutionLevel),c=i.getNumPrecinctsY(e.resolutionLevel);r('precinctPosition.precinctX',e.precinctX,o),r('precinctPosition.precinctY',e.precinctY,c),r('precinctPosition.tileIndex',e.tileIndex,a);var p=e.precinctX+e.precinctY*o,u=d[e.component][e.resolutionLevel],g=e.component+(p+u)*t.getNumComponents(),m=e.tileIndex+g*t.getNumTilesX()*t.getNumTilesY();return m},this.precinctPositionToIndexInComponentResolution=function(e){var t=l[e.component],n=t.getNumPrecinctsX(e.resolutionLevel),i=e.precinctX+e.precinctY*n;return i},o=n.createComponentStructure(e.defaultComponentParams,this),l=Array(t.getNumComponents());for(var c=0;c<t.getNumComponents();++c)l[c]=n.createComponentStructure(e.paramsPerComponent[c],this);return function(){d=Array(n);var n=t.getNumComponents(),s=e.defaultComponentParams;p=s.numResolutionLevels;for(var o=!0,u=!0,g=0,c;g<n;++g){c=e.paramsPerComponent[g],p=Math.min(p,c.numResolutionLevels),d[g]=Array(c.numResolutionLevels);for(var m=l[g],f=0,x=m.getNumPrecinctsX(g),h=m.getNumPrecinctsY(g),y=0;y<c.numResolutionLevels;++y){d[g][y]=f;var r=m.getNumPrecinctsX(y),I=m.getNumPrecinctsY(y);f+=r*I,(s.precinctWidthPerLevel[y]!==c.precinctWidthPerLevel[y]||s.precinctHeightPerLevel[y]!==c.precinctHeightPerLevel[y])&&(o=!1);var E=a(y,c.numResolutionLevels,m.getPrecinctWidth,t.getLevelWidth,t.getTileWidth),b=a(y,c.numResolutionLevels,m.getPrecinctWidth,t.getLevelWidth,t.getTileWidth);u&=E&&b}}if(!o)throw new i.j2kExceptions.UnsupportedFeatureException('Special Coding Style for Component (COC)','A.6.2');if(!u)throw new i.j2kExceptions.UnsupportedFeatureException('Precinct TopLeft which is not matched to tile TopLeft','B.6')}(),function(e){if(4!==e.length)throw new i.j2kExceptions.IllegalDataException('Illegal progression order '+e+': unexpected length');if('L'!==e[3])throw new i.jpipExceptions.IllegalDataException('Illegal target progression order of '+e,'A.3.2.1');var t=0<=e.indexOf('P'),n=0<=e.indexOf('C'),s=0<=e.indexOf('R');if(!t||!n||!s)throw new i.j2kExceptions.IllegalDataException('Illegal progression order '+e+': missing letter');if('RPCL'!==e)throw new i.j2kExceptions.UnsupportedFeatureException('Progression order of '+e,'A.6.1')}(s),this}},function(e,t,n){'use strict';var i=Math.min,s=n(0);e.exports=function(){function e(e,s,a,o){var l=0,c=o,d;do{if(!n(e,s))return null;var p=a?~s.currentByte:s.currentByte,u=i(r[p],s.validBitsInCurrentByte+1),g=u-1;if(c!==void 0){if(u>c){t(s,c),l+=c;break}c-=g}l+=g,d=u<=s.validBitsInCurrentByte,d?t(s,u):s.validBitsInCurrentByte=0}while(!d);return l}function t(e,t){e.validBitsInCurrentByte-=t,0<e.validBitsInCurrentByte&&(e.currentByte=255&e.currentByte<<t)}function n(e,t){if(0<t.validBitsInCurrentByte)return!0;var n=t.isSkipNextByte?2:1,i=[],r=e.copyBytes(i,0,{forceCopyAllRange:!0,databinStartOffset:t.nextOffsetToParse,maxLengthToCopy:n});if(r!==n)return!1;var a=t.originalByteWithoutShift;if(t.currentByte=i[n-1],t.validBitsInCurrentByte=8,t.originalByteWithoutShift=t.currentByte,255===a){if(0!=(128&i[0]))throw new s.j2kExceptions.IllegalDataException('Expected 0 bit after 0xFF byte','B.10.1');t.isSkipNextByte||(t.currentByte<<=1,t.validBitsInCurrentByte=7)}return t.isSkipNextByte=!1,t.nextOffsetToParse+=n,!0}var r=function(){var e=Array(255);e[0]=9,e[1]=8,e[2]=7,e[3]=7;var t;for(t=4;7>=t;++t)e[t]=6;for(t=8;15>=t;++t)e[t]=5;for(t=16;31>=t;++t)e[t]=4;for(t=32;63>=t;++t)e[t]=3;for(t=64;127>=t;++t)e[t]=2;for(t=128;255>=t;++t)e[t]=1;for(t=0;255>=t;++t)e[t-256]=e[t];return e}();return function(r,a){var o=a.createTransactionalObject({nextOffsetToParse:0,validBitsInCurrentByte:0,originalByteWithoutShift:null,currentByte:null,isSkipNextByte:!1}),l=null;Object.defineProperty(this,'activeTransaction',{get:function(){if(null==l||!l.isActive)throw new s.jpipExceptions.InternalErrorException('No active transaction in bitstreamReader');return l}}),Object.defineProperty(this,'bitsCounter',{get:function(){var e=o.getValue(l);if(n(r,e),e.isSkipNextByte)throw new s.jpipExceptions.InternalErrorException('Unexpected state of bitstreamReader: When 0xFF encountered, tryValidateCurrentByte should skip the whole byte  after shiftRemainingBitsInByte and clear isSkipNextByte. However the flag is still set');var t=8*e.nextOffsetToParse-e.validBitsInCurrentByte;return t}}),Object.defineProperty(this,'databinOffset',{get:function(){var e=o.getValue(l);if(e.isSkipNextByte)return e.nextOffsetToParse+1;if(0!=e.validBitsInCurrentByte%8||255===e.originalByteWithoutShift)throw new s.jpipExceptions.InternalErrorException('Cannot calculate databin offset when bitstreamReader  is in the middle of the byte');return e.nextOffsetToParse-e.validBitsInCurrentByte/8},set:function(e){var t=o.getValue(l);t.validBitsInCurrentByte=0,t.isSkipNextByte=!1,t.originalByteWithoutShift=null,t.nextOffsetToParse=e}}),this.startNewTransaction=function(){if(null!=l&&l.isActive)throw new s.jpipExceptions.InternalErrorException('Cannot start new transaction in bitstreamReader while another transaction is active');l=a.createTransaction()},this.shiftRemainingBitsInByte=function(){var e=o.getValue(l);e.isSkipNextByte=255===e.originalByteWithoutShift,e.validBitsInCurrentByte=Math.floor(e.validBitsInCurrentByte/8)},this.shiftBit=function(){var t=o.getValue(l);if(!n(r,t))return null;var i=e(r,t,!0,1);return i},this.countZerosAndShiftUntilFirstOneBit=function(t){var n=o.getValue(l),i=e(r,n,!1,t);return i},this.countOnesAndShiftUntilFirstZeroBit=function(t){var n=o.getValue(l),i=e(r,n,!0,t);return i},this.shiftBits=function(e){for(var s=0,a=o.getValue(l),c=e;0<c;){if(!n(r,a))return null;var d=i(a.validBitsInCurrentByte,c),p=a.currentByte>>8-d;s=(s<<d)+p,t(a,d),c-=d}return s}}}()},function(e,t,n){'use strict';var i=Math.floor,s=Math.ceil,r=n(0);e.exports=function(e,t,n,a){function o(t,n){var s=0,a=null;return function(){if(null===s)throw new r.jpipExceptions.InternalErrorException('Iterated too deep in tag tree');if(s===u.length)return s=null,null;var o=u.length-s-1,c=i(t>>o),d=i(n>>o),p=u[s].width*d+c,g=u[s].content[p];void 0===g&&(g=l(s,p));var m=g.getValue(e.activeTransaction);return null!=a&&a.minimalPossibleValue>m.minimalPossibleValue&&(m.minimalPossibleValue=a.minimalPossibleValue),a=m,++s,m}}function l(e,t){var n=a.createTransactionalObject({minimalPossibleValue:0,isFinalValue:!1});return u[e].content[t]=n,n}function c(){var t=p.getValue(e.activeTransaction);return t}function d(){p.setValue(e.activeTransaction,!0)}var p=a.createTransactionalObject(!1,!0),u;(function(){u=[];for(var e=t,i=n;1<=e||1<=i;){e=s(e),i=s(i);var r=e*i;u.unshift({width:e,height:i,content:Array(r)}),e/=2,i/=2}l(0,0)})(),this.setMinimalValueIfNotReadBits=function(t){if(!c()){var n=u[0].content[0],i=n.getValue(e.activeTransaction);i.minimalPossibleValue=t}},this.isSmallerThanOrEqualsTo=function(t,n,i){d();for(var s=o(t,n),a=s(),l;null!==a;){if(a.minimalPossibleValue>i)return!1;if(!a.isFinalValue){var c=i-a.minimalPossibleValue+1,p=e.countZerosAndShiftUntilFirstOneBit(c);if(null===p)return null;a.minimalPossibleValue+=p,p<c&&(a.isFinalValue=!0)}l=a,a=s()}var u=l.minimalPossibleValue<=i;if(u&&!l.isFinalValue)throw new r.jpipExceptions.InternalErrorException('Wrong parsing in TagTree.isSmallerThanOrEqualsTo: not sure if value is smaller than asked');return u},this.getValue=function(t,n){var i=o(t,n),s=i(),r;for(d();null!==s;){if(!s.isFinalValue){var a=e.countZerosAndShiftUntilFirstOneBit();if(null===a)return null;s.minimalPossibleValue+=a,s.isFinalValue=!0}r=s,s=i()}return r.minimalPossibleValue}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(){var e=function(){for(var e=164,t=Array(e),n=1,s=2,r=0;n<=e;){for(var a=n;a<s;++a)t[a]=r;n*=2,s*=2,++r}return t}();return function(t,n){var s=n.createTransactionalObject({lBlockValue:3});this.parse=function(n){var r=t.countOnesAndShiftUntilFirstZeroBit();if(null===r)return null;var a=s.getValue(t.activeTransaction);a.lBlockValue+=r;var o=e[n];if(o===void 0)throw new i.jpipExceptions.InternalErrorException('Unexpected value of coding passes '+n+'. Expected positive integer <= 164');var l=a.lBlockValue+o,c=t.shiftBits(l);return c}}}()},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,s,r,a){function o(t){var n=u.getValue(e.activeTransaction);if(n>=t+1)throw new i.jpipExceptions.InternalErrorException('Unexpected quality layer to parse')}function l(){if(null==d){d=Array(t),p=Array(t);for(var i=0;i<t;++i){d[i]=Array(n),p[i]=Array(n);for(var s=0;s<n;++s)d[i][s]=a.createCodeblockLengthParser(e,r),p[i][s]=r.createTransactionalObject({isIncluded:!1})}}}function c(t,n,i){var r=p[t][n].getValue(e.activeTransaction),a;if(a=r.isIncluded?e.shiftBit():g.isSmallerThanOrEqualsTo(t,n,i),null===a)return null;if(!a)return{codeblockBodyLengthBytes:0,codingPasses:0};var o=null;if(!r.isIncluded&&(o=m.getValue(t,n),null===o))return null;var l=s.parse(e);if(null===l)return null;var c=d[t][n],u=c.parse(l);if(null===u)return null;r.isIncluded=!0;var f={codeblockBodyLengthBytes:u,codingPasses:l};return null!==o&&(f.zeroBitPlanes=o),f}var d=null,p=null,u=r.createTransactionalObject(0,!0),g=a.createTagTree(e,t,n),m=a.createTagTree(e,t,n);this.calculateSubbandLength=function(i){o(i),l(),g.setMinimalValueIfNotReadBits(i);for(var s=0,r=0,a=Array(t*n),d=0;d<n;++d)for(var p=0,m;p<t;++p){if(m=c(p,d,i),null===m)return null;a[r++]=m,s+=m.codeblockBodyLengthBytes}return u.setValue(e.activeTransaction,i+1),{codeblockBodyLengthByIndex:a,overallBodyLengthBytes:s}}}},function(e,t,n){'use strict';var s=Math.floor,r=Math.ceil,i=n(0);e.exports=function(e,t,n,a,o,l){function c(e){for(;f.length<e;){x.startNewTransaction();var t=d(f.length);if(null===t)return void x.activeTransaction.abort();f.push(t),x.activeTransaction.commit()}}function d(e){var t;if(0<e){var n=f[e-1];t=n.headerStartOffset+n.headerLength+n.overallBodyLengthBytes}else t=a;if(x.databinOffset=t,E&&b){var i=g(145);if(null===i)return null;if(i){x.databinOffset+=6}}var s=x.shiftBit();if(null===s)return null;if(!s)return x.shiftRemainingBitsInByte(),{headerStartOffset:t,headerLength:1,codeblockBodyLengthByIndex:[],overallBodyLengthBytes:0};var r=p(e);if(null===r)return null;var o=x.databinOffset;return r.headerLength=o-t,r.headerStartOffset=t,r}function p(e){for(var t=0,n=null,i=0;i<P.length;++i){var s=P[i],r=s.calculateSubbandLength(e);if(null===r)return null;n=null==n?r.codeblockBodyLengthByIndex:n.concat(r.codeblockBodyLengthByIndex),t+=r.overallBodyLengthBytes}if(x.shiftRemainingBitsInByte(),C){var a=g(146);if(null===a)return null;if(a){x.databinOffset+=2}}return{codeblockBodyLengthByIndex:n,overallBodyLengthBytes:t}}function u(e){var t=Math.min(e,f.length);if(0===t)return{endOffset:a,numQualityLayers:0};var n=f[t-1],i=n.headerStartOffset+n.headerLength+n.overallBodyLengthBytes;return{endOffset:i,numQualityLayers:t}}function g(e){var t=[,,],i=n.copyBytes(t,0,{databinStartOffset:x.databinOffset,maxLengthToCopy:2,forceCopyAllRange:!1});switch(i){case 2:var s=255===t[0]&&t[1]===e;return s;case 1:return!(255!==t[0])&&null;default:return null;}}function m(){if(!E)throw new i.jpipExceptions.UnsupportedFeatureException('PPM or PPT','A.7.4 and A.7.5')}var f=[],x=l.createBitstreamReader(n),h=t.getNumCodeblocksXInPrecinct(o),y=t.getNumCodeblocksYInPrecinct(o),I=e.getNumQualityLayers(),E=e.getIsPacketHeaderNearData(),b=e.getIsStartOfPacketMarkerAllowed(),C=e.getIsEndPacketHeaderMarkerAllowed(),P=function(){for(var e=0===o.resolutionLevel?1:3,t=[],n=0;n<e;++n){var i,a;(0===o.resolutionLevel?(i=h,a=y):(i=1===n?r(h/2):s(h/2),a=0===n?r(y/2):s(y/2)),0!==i&&0!==a)&&t.push(l.createSubbandLengthInPacketHeaderCalculator(x,i,a))}return t}();this.calculateEndOffsetOfLastFullPacket=function(e){var t;if(!(e===void 0||e>=I))t=e;else if(!n.isAllDatabinLoaded())t=I;else{var i=n.getDatabinLengthIfKnown();return{endOffset:i,numQualityLayers:I}}m(),c(t);var s=u(t);return s},this.getPacketOffsetsByCodeblockIndex=function(e){return m(),c(e+1),f.length<=e?null:f[e]}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(n,r){var a=n.getCachedData(s);if(void 0!==a.calculator)return a.calculator;if(void 0===r)throw new i.jpipExceptions.InternalErrorException('precinctPosition should be given on the first time of using QualityLayersCache on this precinct');var o=e.getTileStructure(r.tileIndex),l=o.getComponentStructure(r.component);return a.calculator=t.createPacketLengthCalculator(o,l,n,0,r),a.calculator}var s='packetLengthCalculator';this.getPacketOffsetsByCodeblockIndex=function(e,t,i){var s=n(e,i),r=s.getPacketOffsetsByCodeblockIndex(t);return r},this.getQualityLayerOffset=function(e,t,i){var s=e.getExistingRanges(),r=n(e,i),a;1>s.length||0<s[0].start?(a=0,t=0):a=s[0].start+s[0].length;for(var o=r.calculateEndOffsetOfLastFullPacket(t);a<o.endOffset;){var l=o.numQualityLayers-1;o=r.calculateEndOffsetOfLastFullPacket(l)}return o}}},function(e,t,n){'use strict';function i(){this._image=new a.JpxImage}var s=Math.max,r=Math.min,a=n(1);e.exports=i;n(0);i.prototype.start=function(e){var t=this;return new Promise(function(n){var s={left:e.offsetInRegion.offsetX,top:e.offsetInRegion.offsetY,right:e.offsetInRegion.offsetX+e.offsetInRegion.width,bottom:e.offsetInRegion.offsetY+e.offsetInRegion.height},r=t._image.parseCodestream(e.headersCodestream,0,e.headersCodestream.length,{isOnlyParseHeaders:!0});if(e.codeblocksData&&t._image.addPacketsData(r,e.codeblocksData),e.precinctCoefficients)for(var a=0,i;a<e.precinctCoefficients.length;++a)i=e.precinctCoefficients[a],t._image.setPrecinctCoefficients(r,i.coefficients,i.tileIndex,i.c,i.r,i.p);t._image.decode(r,{regionToParse:s});var o=t._copyTilesPixelsToOnePixelsArray(t._image.tiles,s,t._image.componentsCount);n(o)})},i.prototype._copyTilesPixelsToOnePixelsArray=function(e,t,n){for(var a=e[0],o=t.right-t.left,l=t.bottom-t.top,c=new ImageData(o,l),d=4,p=o*d,u=0;u<e.length;++u){var i=e[u].left+e[u].width,g=e[u].top+e[u].height,m=s(t.left,e[u].left),f=s(t.top,e[u].top),x=r(t.right,i),h=r(t.bottom,g);if(m!==e[u].left||f!==e[u].top||x-m!==e[u].width||h-f!==e[u].height)throw'Unsupported tiles to copy';var y=m-t.left,I=f-t.top;this._copyTile(c.data,e[u],y*d+I*p,p,n)}return c},i.prototype._copyTile=function(e,t,n,i,s){var r=1,a=2,o=1,l=t.pixels||t.items;switch(void 0===s&&(s=l.length/(t.width*t.height)),s){case 1:r=0,a=0;break;case 3:o=3;break;case 4:o=4;break;default:throw'Unsupported components count '+s;}for(var c=n,d=0,p=0,u;p<t.height;++p){u=c;for(var g=0;g<t.width;++g)e[c+0]=l[d+0],e[c+1]=l[d+r],e[c+2]=l[d+a],e[c+3]=255,d+=o,c+=4;c=u+i}}},function(e,t,n){'use strict';var i=Math.max,s=Math.min,r=String.fromCharCode;(function(e){function n(e){E>=I.warnings&&console.log('Warning: '+e)}function a(e){throw new Error(e)}function o(e,t){e||a(t)}function l(e){if(!e)return!1;switch(e.protocol){case'http:':case'https:':case'ftp:':case'mailto:':case'tel:':return!0;default:return!1;}}function c(e){o('string'==typeof e,'Invalid argument for stringToBytes');for(var t=e.length,n=new Uint8Array(t),s=0;s<t;++s)n[s]=255&e.charCodeAt(s);return n}function d(e){return void 0===e.length?(o(void 0!==e.byteLength),e.byteLength):e.length}function p(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}function u(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;return e?new Promise(function(i){i(e.apply(n,t))}):Promise.resolve(void 0)}function g(e){if('object'!==('undefined'==typeof e?'undefined':y(e)))return e;switch(e.name){case'AbortException':return new R(e.message);case'MissingPDFException':return new T(e.message);case'UnexpectedResponseException':return new S(e.message,e.status);default:return new C(e.message,e.details);}}function m(e){return!(e instanceof Error)||e instanceof R||e instanceof T||e instanceof S||e instanceof C?e:new C(e.message,e.toString())}function f(e,t,n){t?e.resolve():e.reject(n)}function x(e){return Promise.resolve(e).catch(function(){})}function h(e,t,n){var i=this;this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.postMessageTransfers=!0,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null);var s=this.callbacksCapabilities=Object.create(null),r=this.actionHandler=Object.create(null);this._onComObjOnMessage=function(e){var t=e.data;if(t.targetName===i.sourceName)if(t.stream)i._processStreamMessage(t);else if(t.isReply){var a=t.callbackId;if(t.callbackId in s){var o=s[a];delete s[a],'error'in t?o.reject(g(t.error)):o.resolve(t.data)}else throw new Error('Cannot resolve callback '+a)}else if(t.action in r){var l=r[t.action];if(t.callbackId){var c=i.sourceName,d=t.sourceName;Promise.resolve().then(function(){return l[0].call(l[1],t.data)}).then(function(e){n.postMessage({sourceName:c,targetName:d,isReply:!0,callbackId:t.callbackId,data:e})},function(e){n.postMessage({sourceName:c,targetName:d,isReply:!0,callbackId:t.callbackId,error:m(e)})})}else t.streamId?i._createStreamSink(t):l[0].call(l[1],t.data)}else throw new Error('Unknown action from worker: '+t.action)},n.addEventListener('message',this._onComObjOnMessage)}Object.defineProperty(t,'__esModule',{value:!0});var y='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},I={errors:0,warnings:1,infos:5},E=I.warnings,b=function(){function e(e,t){this.name='PasswordException',this.message=e,this.code=t}return e.prototype=new Error,e.constructor=e,e}(),C=function(){function e(e,t){this.name='UnknownErrorException',this.message=e,this.details=t}return e.prototype=new Error,e.constructor=e,e}(),P=function(){function e(e){this.name='InvalidPDFException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),T=function(){function e(e){this.name='MissingPDFException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),S=function(){function e(e,t){this.name='UnexpectedResponseException',this.message=e,this.status=t}return e.prototype=new Error,e.constructor=e,e}(),v=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name='NotImplementedException',e.constructor=e,e}(),L=function(){function e(e,t){this.begin=e,this.end=t,this.message='Missing data ['+e+', '+t+')'}return e.prototype=new Error,e.prototype.name='MissingDataException',e.constructor=e,e}(),O=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name='XRefParseException',e.constructor=e,e}(),k=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name='FormatError',e.constructor=e,e}(),R=function(){function e(e){this.name='AbortException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),D=/\x00/g,A=function(){function e(){}var t=['rgb(',0,',',0,',',0,')'];e.makeCssRgb=function(e,n,i){return t[1]=e,t[3]=n,t[5]=i,t.join('')},e.transform=function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},e.applyTransform=function(e,t){var n=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[n,i]},e.applyInverseTransform=function(e,t){var n=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,s=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[i,s]},e.getAxialAlignedBoundingBox=function(t,n){var r=e.applyTransform(t,n),a=e.applyTransform(t.slice(2,4),n),o=e.applyTransform([t[0],t[3]],n),l=e.applyTransform([t[2],t[1]],n);return[s(r[0],a[0],o[0],l[0]),s(r[1],a[1],o[1],l[1]),i(r[0],a[0],o[0],l[0]),i(r[1],a[1],o[1],l[1])]},e.inverseTransform=function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]},e.apply3dTransform=function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]},e.singularValueDecompose2dScale=function(e){var t=Math.sqrt,n=[e[0],e[2],e[1],e[3]],i=e[0]*n[0]+e[1]*n[2],s=e[0]*n[1]+e[1]*n[3],r=e[2]*n[0]+e[3]*n[2],a=e[2]*n[1]+e[3]*n[3],o=(i+a)/2,l=t((i+a)*(i+a)-4*(i*a-r*s))/2;return[t(o+l||1),t(o-l||1)]},e.normalizeRect=function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t},e.intersect=function(t,n){function i(e,t){return e-t}var s=[t[0],t[2],n[0],n[2]].sort(i),r=[t[1],t[3],n[1],n[3]].sort(i),a=[];if(t=e.normalizeRect(t),n=e.normalizeRect(n),s[0]===t[0]&&s[1]===n[0]||s[0]===n[0]&&s[1]===t[0])a[0]=s[1],a[2]=s[2];else return!1;if(r[0]===t[1]&&r[1]===n[1]||r[0]===n[1]&&r[1]===t[1])a[1]=r[1],a[3]=r[2];else return!1;return a};var n=['','C','CC','CCC','CD','D','DC','DCC','DCCC','CM','','X','XX','XXX','XL','L','LX','LXX','LXXX','XC','','I','II','III','IV','V','VI','VII','VIII','IX'];return e.toRoman=function(e,t){o(Number.isInteger(e)&&0<e,'The number should be a positive integer.');for(var i=[],s;1e3<=e;)e-=1e3,i.push('M');s=0|e/100,e%=100,i.push(n[s]),s=0|e/10,e%=10,i.push(n[10+s]),i.push(n[20+e]);var r=i.join('');return t?r.toLowerCase():r},e.appendToArray=function(e,t){Array.prototype.push.apply(e,t)},e.prependToArray=function(e,t){Array.prototype.unshift.apply(e,t)},e.extendObj=function(e,t){for(var n in t)e[n]=t[n]},e.getInheritableProperty=function(e,t,n){for(;e&&!e.has(t);)e=e.get('Parent');return e?n?e.getArray(t):e.get(t):null},e.inherit=function(e,t,n){for(var i in e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n)e.prototype[i]=n[i]},e.loadScript=function(e,t){var n=document.createElement('script'),i=!1;n.setAttribute('src',e),t&&(n.onload=function(){i||t(),i=!0}),document.getElementsByTagName('head')[0].appendChild(n)},e}(),_=function(){function e(e,t,n,i,s,r){var a=Math.abs;this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=i,this.offsetY=s;var o=(e[2]+e[0])/2,l=(e[3]+e[1])/2,c,d,p,u;switch(n%=360,n=0>n?n+360:n,n){case 180:c=-1,d=0,p=0,u=1;break;case 90:c=0,d=1,p=1,u=0;break;case 270:c=0,d=-1,p=-1,u=0;break;default:c=1,d=0,p=0,u=-1;}r&&(p=-p,u=-u);var g,m,f,x;0===c?(g=a(l-e[1])*t+i,m=a(o-e[0])*t+s,f=a(e[3]-e[1])*t,x=a(e[2]-e[0])*t):(g=a(o-e[0])*t+i,m=a(l-e[1])*t+s,f=a(e[2]-e[0])*t,x=a(e[3]-e[1])*t),this.transform=[c*t,d*t,p*t,u*t,g-c*t*o-p*t*l,m-d*t*o-u*t*l],this.width=f,this.height=x,this.fontScale=t}return e.prototype={clone:function(t){t=t||{};var n='scale'in t?t.scale:this.scale,i='rotation'in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),n,i,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return A.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=A.applyTransform([e[0],e[1]],this.transform),n=A.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]},convertToPdfPoint:function(e,t){return A.applyInverseTransform([e,t],this.transform)}},e}(),j=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364],N=function(e,t){if('undefined'!=typeof Blob)return new Blob([e],{type:t});throw new Error('The "Blob" constructor is not supported.')},F=function(){var e='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';return function(t,n){var s=2<arguments.length&&arguments[2]!==void 0&&arguments[2];if(!s&&URL.createObjectURL){var r=N(t,n);return URL.createObjectURL(r)}for(var a='data:'+n+';base64,',o=0,i=t.length;o<i;o+=3){var l=255&t[o],c=255&t[o+1],d=255&t[o+2],p=o+1<i?(15&c)<<2|d>>6:64,u=o+2<i?63&d:64;a+=e[l>>2]+e[(3&l)<<4|c>>4]+e[p]+e[u]}return a}}();h.prototype={on:function(e,t,n){var i=this.actionHandler;if(i[e])throw new Error('There is already an actionName called "'+e+'"');i[e]=[t,n]},send:function(e,t,n){var i={sourceName:this.sourceName,targetName:this.targetName,action:e,data:t};this.postMessage(i,n)},sendWithPromise:function(e,t,n){var i=this.callbackId++,s={sourceName:this.sourceName,targetName:this.targetName,action:e,data:t,callbackId:i},r=p();this.callbacksCapabilities[i]=r;try{this.postMessage(s,n)}catch(t){r.reject(t)}return r.promise},sendWithStream:function(e,t,n){var i=this,s=this.streamId++,r=this.sourceName,a=this.targetName;return new ReadableStream({start:function(n){var o=p();return i.streamControllers[s]={controller:n,startCall:o,isClosed:!1},i.postMessage({sourceName:r,targetName:a,action:e,streamId:s,data:t,desiredSize:n.desiredSize}),o.promise},pull:function(e){var t=p();return i.streamControllers[s].pullCall=t,i.postMessage({sourceName:r,targetName:a,stream:'pull',streamId:s,desiredSize:e.desiredSize}),t.promise},cancel:function(e){var t=p();return i.streamControllers[s].cancelCall=t,i.streamControllers[s].isClosed=!0,i.postMessage({sourceName:r,targetName:a,stream:'cancel',reason:e,streamId:s}),t.promise}},n)},_createStreamSink:function(e){var t=this,n=this,i=this.actionHandler[e.action],s=e.streamId,r=e.desiredSize,a=this.sourceName,o=e.sourceName,l=p(),c=function(e){var n=e.stream,i=e.chunk,r=e.transfers,l=e.success,c=e.reason;t.postMessage({sourceName:a,targetName:o,stream:n,streamId:s,chunk:i,success:l,reason:c},r)},d={enqueue:function(e){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,n=arguments[2];if(!this.isCancelled){var i=this.desiredSize;this.desiredSize-=t,0<i&&0>=this.desiredSize&&(this.sinkCapability=p(),this.ready=this.sinkCapability.promise),c({stream:'enqueue',chunk:e,transfers:n})}},close:function(){this.isCancelled||(this.isCancelled=!0,c({stream:'close'}),delete n.streamSinks[s])},error:function(e){this.isCancelled||(this.isCancelled=!0,c({stream:'error',reason:e}))},sinkCapability:l,onPull:null,onCancel:null,isCancelled:!1,desiredSize:r,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[s]=d,u(i[0],[e.data,d],i[1]).then(function(){c({stream:'start_complete',success:!0})},function(e){c({stream:'start_complete',success:!1,reason:e})})},_processStreamMessage:function(e){var t=this,n=this.sourceName,i=e.sourceName,s=e.streamId,r=function(e){var r=e.stream,a=e.success,o=e.reason;t.comObj.postMessage({sourceName:n,targetName:i,stream:r,success:a,streamId:s,reason:o})},a=function(){Promise.all([t.streamControllers[e.streamId].startCall,t.streamControllers[e.streamId].pullCall,t.streamControllers[e.streamId].cancelCall].map(function(e){return e&&x(e.promise)})).then(function(){delete t.streamControllers[e.streamId]})};switch(e.stream){case'start_complete':f(this.streamControllers[e.streamId].startCall,e.success,g(e.reason));break;case'pull_complete':f(this.streamControllers[e.streamId].pullCall,e.success,g(e.reason));break;case'pull':if(!this.streamSinks[e.streamId]){r({stream:'pull_complete',success:!0});break}0>=this.streamSinks[e.streamId].desiredSize&&0<e.desiredSize&&this.streamSinks[e.streamId].sinkCapability.resolve(),this.streamSinks[e.streamId].desiredSize=e.desiredSize,u(this.streamSinks[e.streamId].onPull).then(function(){r({stream:'pull_complete',success:!0})},function(e){r({stream:'pull_complete',success:!1,reason:e})});break;case'enqueue':o(this.streamControllers[e.streamId],'enqueue should have stream controller'),this.streamControllers[e.streamId].isClosed||this.streamControllers[e.streamId].controller.enqueue(e.chunk);break;case'close':if(o(this.streamControllers[e.streamId],'close should have stream controller'),this.streamControllers[e.streamId].isClosed)break;this.streamControllers[e.streamId].isClosed=!0,this.streamControllers[e.streamId].controller.close(),a();break;case'error':o(this.streamControllers[e.streamId],'error should have stream controller'),this.streamControllers[e.streamId].controller.error(g(e.reason)),a();break;case'cancel_complete':f(this.streamControllers[e.streamId].cancelCall,e.success,g(e.reason)),a();break;case'cancel':if(!this.streamSinks[e.streamId])break;u(this.streamSinks[e.streamId].onCancel,[g(e.reason)]).then(function(){r({stream:'cancel_complete',success:!0})},function(e){r({stream:'cancel_complete',success:!1,reason:e})}),this.streamSinks[e.streamId].sinkCapability.reject(g(e.reason)),this.streamSinks[e.streamId].isCancelled=!0,delete this.streamSinks[e.streamId];break;default:throw new Error('Unexpected stream case');}},postMessage:function(e,t){t&&this.postMessageTransfers?this.comObj.postMessage(e,t):this.comObj.postMessage(e)},destroy:function(){this.comObj.removeEventListener('message',this._onComObjOnMessage)}},t.FONT_IDENTITY_MATRIX=[0.001,0,0,0.001,0,0],t.IDENTITY_MATRIX=[1,0,0,1,0,0],t.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},t.VERBOSITY_LEVELS=I,t.UNSUPPORTED_FEATURES={unknown:'unknown',forms:'forms',javaScript:'javaScript',smask:'smask',shadingPattern:'shadingPattern',font:'font'},t.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},t.AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},t.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},t.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t.FontType={UNKNOWN:0,TYPE1:1,TYPE1C:2,CIDFONTTYPE0:3,CIDFONTTYPE0C:4,TRUETYPE:5,CIDFONTTYPE2:6,TYPE3:7,OPENTYPE:8,TYPE0:9,MMTYPE1:10},t.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},t.CMapCompressionType={NONE:0,BINARY:1,STREAM:2},t.AbortException=R,t.InvalidPDFException=P,t.MessageHandler=h,t.MissingDataException=L,t.MissingPDFException=T,t.NativeImageDecoding={NONE:'none',DECODE:'decode',DISPLAY:'display'},t.NotImplementedException=v,t.PageViewport=_,t.PasswordException=b,t.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},t.StreamType={UNKNOWN:0,FLATE:1,LZW:2,DCT:3,JPX:4,JBIG:5,A85:6,AHX:7,CCF:8,RL:9},t.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},t.UnexpectedResponseException=S,t.UnknownErrorException=C,t.Util=A,t.XRefParseException=O,t.FormatError=k,t.arrayByteLength=d,t.arraysToBytes=function(e){if(1===e.length&&e[0]instanceof Uint8Array)return e[0];var t=0,n=e.length,s,i,r;for(s=0;s<n;s++)i=e[s],r=d(i),t+=r;var a=0,o=new Uint8Array(t);for(s=0;s<n;s++)i=e[s],i instanceof Uint8Array||('string'==typeof i?i=c(i):i=new Uint8Array(i)),r=i.byteLength,o.set(i,a),a+=r;return o},t.assert=o,t.bytesToString=function(e){o(null!==e&&'object'===('undefined'==typeof e?'undefined':y(e))&&e.length!==void 0,'Invalid argument for bytesToString');var t=e.length,n=8192;if(t<n)return r.apply(null,e);for(var a=[],l=0;l<t;l+=n){var i=s(l+n,t),c=e.subarray(l,i);a.push(r.apply(null,c))}return a.join('')},t.createBlob=N,t.createPromiseCapability=p,t.createObjectURL=F,t.deprecated=function(e){console.log('Deprecated API usage: '+e)},t.getLookupTableFactory=function(e){var t;return function(){return e&&(t=Object.create(null),e(t),e=null),t}},t.getVerbosityLevel=function(){return E},t.info=function(e){E>=I.infos&&console.log('Info: '+e)},t.isArrayBuffer=function(e){return'object'===('undefined'==typeof e?'undefined':y(e))&&null!==e&&e.byteLength!==void 0},t.isBool=function(e){return'boolean'==typeof e},t.isEmptyObj=function(e){for(var t in e)return!1;return!0},t.isNum=function(e){return'number'==typeof e},t.isString=function(e){return'string'==typeof e},t.isSpace=function(e){return 32===e||9===e||13===e||10===e},t.isNodeJS=function(){return'object'===('undefined'==typeof e?'undefined':y(e))&&e+'[object process]'},t.isSameOrigin=function(e,t){try{var n=new URL(e);if(!n.origin||'null'===n.origin)return!1}catch(t){return!1}var i=new URL(t,n);return n.origin===i.origin},t.createValidAbsoluteUrl=function(e,t){if(!e)return null;try{var n=t?new URL(e,t):new URL(e);if(l(n))return n}catch(e){}return null},t.isLittleEndian=function(){var e=new Uint8Array(4);e[0]=1;var t=new Uint32Array(e.buffer,0,1);return 1===t[0]},t.isEvalSupported=function(){try{return new Function(''),!0}catch(t){return!1}},t.loadJpegStream=function(e,t,i){var s=new Image;s.onload=function(){i.resolve(e,s)},s.onerror=function(){i.resolve(e,null),n('Error during JPEG image loading')},s.src=t},t.log2=function(e){return 0>=e?0:Math.ceil(Math.log2(e))},t.readInt8=function(e,t){return e[t]<<24>>24},t.readUint16=function(e,t){return e[t]<<8|e[t+1]},t.readUint32=function(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0},t.removeNullCharacters=function(e){return'string'==typeof e?e.replace(D,''):(n('The argument for removeNullCharacters must be a string.'),e)},t.setVerbosityLevel=function(e){E=e},t.shadow=function(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n},t.string32=function(e){return r(255&e>>24,255&e>>16,255&e>>8,255&e)},t.stringToBytes=c,t.stringToPDFString=function(e){var t=e.length,n=[],s;if('\xFE'===e[0]&&'\xFF'===e[1])for(s=2;s<t;s+=2)n.push(r(e.charCodeAt(s)<<8|e.charCodeAt(s+1)));else for(s=0;s<t;++s){var i=j[e.charCodeAt(s)];n.push(i?r(i):e.charAt(s))}return n.join('')},t.stringToUTF8String=function(e){return decodeURIComponent(escape(e))},t.utf8StringToString=function(e){return unescape(encodeURIComponent(e))},t.warn=n,t.unreachable=a}).call(t,n(44))},function(e){function t(){throw new Error('setTimeout has not been defined')}function n(){throw new Error('clearTimeout has not been defined')}function s(e){if(d===setTimeout)return setTimeout(e,0);if((d===t||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function i(e){if(p===clearTimeout)return clearTimeout(e);if((p===n||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function r(){g&&f&&(g=!1,f.length?u=f.concat(u):m=-1,u.length&&a())}function a(){if(!g){var e=s(r);g=!0;for(var t=u.length;t;){for(f=u,u=[];++m<t;)f&&f[m].run();m=-1,t=u.length}f=null,g=!1,i(e)}}function o(e,t){this.fun=e,this.array=t}function l(){}var c=e.exports={},d,p;(function(){try{d='function'==typeof setTimeout?setTimeout:t}catch(n){d=t}try{p='function'==typeof clearTimeout?clearTimeout:n}catch(t){p=n}})();var u=[],g=!1,m=-1,f;c.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new o(e,t)),1!==u.length||g||s(a)},o.prototype.run=function(){this.fun.apply(null,this.array)},c.title='browser',c.browser=!0,c.env={},c.argv=[],c.version='',c.versions={},c.on=l,c.addListener=l,c.once=l,c.off=l,c.removeListener=l,c.removeAllListeners=l,c.emit=l,c.prependListener=l,c.prependOnceListener=l,c.listeners=function(){return[]},c.binding=function(){throw new Error('process.binding is not supported')},c.cwd=function(){return'/'},c.chdir=function(){throw new Error('process.chdir is not supported')},c.umask=function(){return 0}},function(e,t){'use strict';Object.defineProperty(t,'__esModule',{value:!0});var n=function(){function e(e,t,n){this.data=e,this.bp=t,this.dataEnd=n,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=65535&this.chigh<<7|127&this.clow>>9,this.clow=65535&this.clow<<7,this.ct-=7,this.a=32768}var t=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];return e.prototype={byteIn:function(){var e=this.data,t=this.bp;if(255===e[t]){var n=e[t+1];143<n?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t)}else t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t;65535<this.clow&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(e,n){var i=e[n]>>1,s=1&e[n],r=t[i],o=r.qe,l=this.a-o,a;if(this.chigh<o)l<o?(l=o,a=s,i=r.nmps):(l=o,a=1^s,1===r.switchFlag&&(s=a),i=r.nlps);else{if(this.chigh-=o,0!=(32768&l))return this.a=l,s;l<o?(a=1^s,1===r.switchFlag&&(s=a),i=r.nlps):(a=s,i=r.nmps)}do 0===this.ct&&this.byteIn(),l<<=1,this.chigh=65535&this.chigh<<1|1&this.clow>>15,this.clow=65535&this.clow<<1,this.ct--;while(0==(32768&l));return this.a=l,e[n]=i<<1|s,a}},e}();t.ArithmeticDecoder=n},function(e,t,n){'use strict';function i(){this._image=new a.JpxImage}var s=Math.max,r=Math.min,a=n(1);e.exports=i;n(0);i.prototype.start=function(e){var t=this;return new Promise(function(n){for(var s={left:e.offsetInRegion.offsetX,top:e.offsetInRegion.offsetY,right:e.offsetInRegion.offsetX+e.offsetInRegion.width,bottom:e.offsetInRegion.offsetY+e.offsetInRegion.height},r=t._image.parseCodestream(e.headersCodestream,0,e.headersCodestream.length,{isOnlyParseHeaders:!0}),a=e.imageTilesX,o=e.tilesBounds.maxTileXExclusive-e.tilesBounds.minTileX,l=e.tilesBounds.minTileX,c=e.tilesBounds.minTileY,d=0;d<e.precinctCoefficients.length;++d){var i=e.precinctCoefficients[d],p=i.key.tileIndex,u=Math.floor(p/a);t._image.setPrecinctCoefficients(r,i.coefficients,p%a-l+(u-c)*o,i.key.component,i.key.resolutionLevel,i.key.precinctIndexInComponentResolution)}t._image.decode(r,{regionToParse:s});var g=t._copyTilesPixelsToOnePixelsArray(t._image.tiles,s,t._image.componentsCount);n(g)})},i.prototype._copyTilesPixelsToOnePixelsArray=function(e,t,n){for(var a=e[0],o=t.right-t.left,l=t.bottom-t.top,c=new ImageData(o,l),d=4,p=o*d,u=0;u<e.length;++u){var i=e[u].left+e[u].width,g=e[u].top+e[u].height,m=s(t.left,e[u].left),f=s(t.top,e[u].top),x=r(t.right,i),h=r(t.bottom,g);if(m!==e[u].left||f!==e[u].top||x-m!==e[u].width||h-f!==e[u].height)throw'Unsupported tiles to copy';var y=m-t.left,I=f-t.top;this._copyTile(c.data,e[u],y*d+I*p,p,n)}return c},i.prototype._copyTile=function(e,t,n,i,s){var r=1,a=2,o=1,l=t.pixels||t.items;switch(void 0===s&&(s=l.length/(t.width*t.height)),s){case 1:r=0,a=0;break;case 3:o=3;break;case 4:o=4;break;default:throw'Unsupported components count '+s;}for(var c=n,d=0,p=0,u;p<t.height;++p){u=c;for(var g=0;g<t.width;++g)e[c+0]=l[d+0],e[c+1]=l[d+r],e[c+2]=l[d+a],e[c+3]=255,d+=o,c+=4;c=u+i}}},function(e,t,n){'use strict';function i(){this._image=new s.JpxImage}var s=n(1);e.exports=i;n(0);i.prototype.start=function(e,t){var n=this;return new Promise(function(s){var r=n._image.parseCodestream(e.headersCodestream,0,e.headersCodestream.length,{isOnlyParseHeaders:!0});if(e.codeblocksData&&n._image.addPacketsData(r,e.codeblocksData),e.precinctCoefficients)for(var a=0,i;a<e.precinctCoefficients.length;++a)i=e.precinctCoefficients[a],n._image.setPrecinctCoefficients(r,i.coefficients,i.tileIndex,i.c,i.r,i.p);var o=n._image.decodePrecinctCoefficients(r,0,t.component,t.resolutionLevel,t.precinctIndexInComponentResolution);s({key:t,coefficients:o,minQuality:e.minQuality})})}}]);