var webjpip=function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=4)}([function(e){'use strict';e.exports.j2kMarkers={StartOfCodestream:[255,79],ImageAndTileSize:[255,81],CodingStyleDefault:[255,82],CodingStyleComponent:[255,83],QuantizationDefault:[255,92],ProgressionOrderChange:[255,95],PackedPacketHeadersInMainHeader:[255,96],PackedPacketHeadersInTileHeader:[255,97],StartOfTile:[255,144],StartOfData:[255,147],EndOfCodestream:[255,217],Comment:[255,100]},e.exports.j2kOffsets={MARKER_SIZE:2,LENGTH_FIELD_SIZE:2,NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER:38,REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER:6},e.exports.jpipEndOfResponseReasons={IMAGE_DONE:1,WINDOW_DONE:2,WINDOW_CHANGE:3,BYTE_LIMIT:4,QUALITY_LIMIT:5,SESSION_LIMIT:6,RESPONSE_LIMIT:7,NON_SPECIFIED:8},e.exports.j2kExceptions={UnsupportedFeatureException:function(e,t){return this.description=e+' (specified in section '+t+' of part 1: Core Coding System standard) is not supported yet',this.toString=function(){return'J2k UnsupportedFeatureException: '+this.description},this},ParseException:function(e){return this.description=e,this.toString=function(){return'J2k ParseException: '+this.description},this},IllegalDataException:function(e,t){return this.description=e+' (see section '+t+' of part 9: Interactivity tools, APIs and Protocols)',this.toString=function(){return'J2k IllegalDataException: '+this.description},this}},e.exports.jpipExceptions={UnsupportedFeatureException:function(e,t){return this.description=e+' (specified in section '+t+' of part 9: Interactivity tools, APIs and Protocols) is not supported yet',this.toString=function(){return'Jpip UnsupportedFeatureException: '+this.description},this},ParseException:function(e){return this.description=e,this.toString=function(){return'Jpip ParseException: '+this.description},this},IllegalDataException:function(e,t){return this.description=e+' (see section '+t+' of part 9: Interactivity tools, APIs and Protocols)',this.toString=function(){return'Jpip IllegalDataException: '+this.description},this},IllegalOperationException:function(e){return this.description=e,this.toString=function(){return'Jpip IllegalOperationException: '+this.description},this},ArgumentException:function(e,t,n){return this.description='Argument '+e+' has invalid value '+t+(void 0===n?'':' :'+n),this.toString=function(){return'Jpip ArgumentException: '+this.description},this},WrongStreamException:function(e,t){var n='JPP (JPIP Precinct)',i='JPT (JPIP Tile-part)';if(t){var a=n;n=i,i=a}return this.description='Stream type is '+i+', but '+e+' is allowed only in '+n+' stream',this.toString=function(){return'Jpip WrongStreamException: '+this.description},this},InternalErrorException:function(e){return this.description=e,this.toString=function(){return'Jpip InternalErrorException: '+this.description},this}},e.exports.j2kExceptions.UnsupportedFeatureException.Name='j2kExceptions.UnsupportedFeatureException',e.exports.j2kExceptions.ParseException.Name='j2kExceptions.ParseException',e.exports.j2kExceptions.IllegalDataException.Name='j2kExceptions.IllegalDataException',e.exports.jpipExceptions.UnsupportedFeatureException.Name='jpipExceptions.UnsupportedFeatureException',e.exports.jpipExceptions.ParseException.Name='jpipExceptions.ParseException',e.exports.jpipExceptions.IllegalDataException.Name='jpipExceptions.IllegalDataException',e.exports.jpipExceptions.IllegalOperationException.Name='jpipExceptions.IllegalOperationException',e.exports.jpipExceptions.ArgumentException.Name='jpipExceptions.ArgumentException',e.exports.jpipExceptions.WrongStreamException.Name='jpipExceptions.WrongStreamException',e.exports.jpipExceptions.InternalErrorException.Name='jpipExceptions.InternalErrorException'},function(e,t,n){'use strict';var i=n(6),a=n(7),s=n(8),r=n(9),o=n(10),l=n(11),c=n(12),d=n(13),p=n(14),u=n(15),g=n(16),f=n(17),m=n(18),x=n(19),h=n(20),y=n(21),I=n(22),E=n(23),b=n(24),C=n(25),P=n(26),T=n(27),v=n(28),S=n(29),L=n(30),O=n(31),R=n(32),k=n(33),D=n(34),A=n(35),_=n(36),j=n(37),N=n(38),F=n(39),B=n(40),M=n(41),w=n(42),q={createChannel:function(e,t){return new o(e,t,q)},createCodestreamReconstructor:function(e,t,n){return new l(e,t,n)},createLevelCalculator:function(e){return new y(e)},createCodestreamStructure:function(e,t){return new c(e,q,t)},createComponentStructure:function(e,t){return new d(e,t)},createCompositeArray:function(e){return new p(e)},createDatabinParts:function(e,t){return new u(e,t,q)},createDatabinsSaver:function(e){return new g(e,q)},createFetcher:function(e,t){return new m(e,t,q)},createFetch:function(e,t,n){return new f(e,t,n)},createHeaderModifier:function(e,t){return new x(e,t)},createImageDataContext:function(e,t,n,i){return new h(e,t,n,i)},createMarkersParser:function(e){return new I(e,r,q)},createOffsetsCalculator:function(e,t){return new E(e,t)},createPacketsDataCollector:function(e,t){return new b(e,t,q)},createParamsCodestreamPart:function(e,t){return new C(e,t,q)},createParamsPrecinctIterator:function(e,t,n,i){return new P(e,t,n,i)},createPrecinctCodestreamPart:function(e,t,n,i,a,s,r){return new T(e,t,n,i,a,s,r)},createPrecinctsIteratorWaiter:function(e,t,n,i){return new v(e,t,n,i,q)},createQualityWaiter:function(e,t,n,i,a,s,r,o){return new S(e,t,n,i,a,s,r,o,q)},createRequestParamsModifier:function(e){return new L(e)},createRequest:function(e,t,n,i,a){return new O(e,r,t,n,i,a)},createSessionHelper:function(e,t,n,a){return new R(e,t,n,a,i)},createSession:function(e,t,n,i,a){return new k(e,t,n,i,a,setInterval,clearInterval,q)},createReconnectableRequester:function(e,t,n,i){return new D(e,t,n,i,q)},createStructureParser:function(e,t,n){return new A(e,t,r,n)},createTileStructure:function(e,t,n){return new _(e,t,q,n)},createBitstreamReader:function(e){return new j(e,a)},createTagTree:function(e,t,n){return new N(e,t,n,a)},createCodeblockLengthParser:function(e){return new F(e,a)},createSubbandLengthInPacketHeaderCalculator:function(e,t,n){return new B(e,t,n,s,a,q)},createPacketLengthCalculator:function(e,t,n,i,a){return new M(e,t,n,i,a,q)},createQualityLayersCache:function(e){return new w(e,q)}};e.exports=q},function(e,t,n){'use strict';var a=Math.floor,s=Math.ceil,o=Math.max,d=Math.min;Object.defineProperty(t,'__esModule',{value:!0}),t.JpxImage=void 0;var r=n(44),i=n(45),u=function(){function e(e){this.message='JPX error: '+e}return e.prototype=new Error,e.prototype.name='JpxError',e.constructor=e,e}(),l=function(){function e(){this.failOnCorruptedImage=!1}function t(e,t){for(var n=t.subbands,a=0,i;a<e.subbandPrecincts.length;++a){var s='LL'!==t.subbands[a].type,r=e.subbandPrecincts[a].tbxMin_,l=e.subbandPrecincts[a].tbyMin_,c=e.subbandPrecincts[a].tbxMax_,p=e.subbandPrecincts[a].tbyMax_;s&&(r=2*(r-t.subbands[a].tbx0)+t.trx0,l=2*(l-t.subbands[a].tby0)+t.try0,c=2*(c-t.subbands[a].tbx0)+t.trx0,p=2*(p-t.subbands[a].tby0)+t.try0),0===a?i={x0:r,y0:l,x1:c,y1:p}:(i.x0=d(i.x0,r),i.y0=d(i.y0,l),i.x1=o(i.x1,c),i.y1=o(i.y1,p))}return i}function n(e,t){e.x0=s(t.XOsiz/e.XRsiz),e.x1=s(t.Xsiz/e.XRsiz),e.y0=s(t.YOsiz/e.YRsiz),e.y1=s(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function l(e,t){for(var n=e.SIZ,a=[],r=s((n.Xsiz-n.XTOsiz)/n.XTsiz),l=s((n.Ysiz-n.YTOsiz)/n.YTsiz),c=0,u;c<l;c++)for(var g=0;g<r;g++)u={},u.tx0=o(n.XTOsiz+g*n.XTsiz,n.XOsiz),u.ty0=o(n.YTOsiz+c*n.YTsiz,n.YOsiz),u.tx1=d(n.XTOsiz+(g+1)*n.XTsiz,n.Xsiz),u.ty1=d(n.YTOsiz+(c+1)*n.YTsiz,n.Ysiz),u.width=u.tx1-u.tx0,u.height=u.ty1-u.ty0,u.components=[],a.push(u);e.tiles=a;for(var p=n.Csiz,f=0,i;f<p;f++){i=t[f];for(var m=0,x=a.length,h;m<x;m++)h={},u=a[m],h.tcx0=s(u.tx0/i.XRsiz),h.tcy0=s(u.ty0/i.YRsiz),h.tcx1=s(u.tx1/i.XRsiz),h.tcy1=s(u.ty1/i.YRsiz),h.width=h.tcx1-h.tcx0,h.height=h.tcy1-h.tcy0,u.components[f]=h}}function c(e,t,n){var i=t.codingStyleParameters,a={};return i.entropyCoderWithCustomPrecincts?(a.PPx=i.precinctsSizes[n].PPx,a.PPy=i.precinctsSizes[n].PPy):(a.PPx=15,a.PPy=15),a.xcb_=0<n?d(i.xcb,a.PPx-1):d(i.xcb,a.PPx),a.ycb_=0<n?d(i.ycb,a.PPy-1):d(i.ycb,a.PPy),a}function p(e,t,n){var i=1<<n.PPx,r=1<<n.PPy,o=0===t.resLevel,l=1<<n.PPx+(o?0:-1),c=1<<n.PPy+(o?0:-1),d=t.trx1>t.trx0?s(t.trx1/i)-a(t.trx0/i):0,p=t.try1>t.try0?s(t.try1/r)-a(t.try0/r):0;t.precinctParameters={precinctWidth:i,precinctHeight:r,numprecinctswide:d,numprecinctshigh:p,numprecincts:d*p,precinctWidthInSubband:l,precinctHeightInSubband:c}}function g(e,t,n,s){var r=n.xcb_,l=n.ycb_,c=1<<r,p=1<<l,u=t.tbx0>>r,g=t.tby0>>l,f=t.tbx1+c-1>>r,m=t.tby1+p-1>>l,x=t.resolution.precinctParameters,h=[],y=[],I,E,b,C;for(E=g;E<m;E++)for(I=u;I<f;I++){b={cbx:I,cby:E,tbx0:c*I,tby0:p*E,tbx1:c*(I+1),tby1:p*(E+1),parentSubband:t},b.tbx0_=o(t.tbx0,b.tbx0),b.tby0_=o(t.tby0,b.tby0),b.tbx1_=d(t.tbx1,b.tbx1),b.tby1_=d(t.tby1,b.tby1);var P=a((b.tbx0_-t.tbx0)/x.precinctWidthInSubband),T=a((b.tby0_-t.tby0)/x.precinctHeightInSubband);if(C=P+T*x.numprecinctswide,b.precinctNumber=C,b.subbandType=t.type,b.Lblock=3,!(b.tbx1_<=b.tbx0_||b.tby1_<=b.tby0_)){h.push(b);var v=y[C];void 0===v?y[C]=v={cbxMin:I,cbyMin:E,cbxMax:I,cbyMax:E,tbxMin_:b.tbx0_,tbxMax_:b.tbx1_,tbyMin_:b.tby0_,tbyMax_:b.tby1_,pixelsPrecinct:t.resolution.pixelsPrecincts[C]}:(I<v.cbxMin?(v.cbxMin=I,v.tbxMin_=b.tbx0_):I>v.cbxMax&&(v.cbxMax=I,v.tbxMax_=b.tbx1_),E<v.cbyMin?(v.cbyMin=E,v.tbyMin_=b.tby0_):E>v.cbyMax&&(v.cbyMax=E,v.tbyMax_=b.tby1_)),void 0===v.pixelsPrecinct&&(v.pixelsPrecinct={codeblocks:[],subbandPrecincts:[],hasData:!1},t.resolution.pixelsPrecincts[C]=v.pixelsPrecinct),b.precinct=v;var S=v.pixelsPrecinct;S.codeblocks.push(b),void 0===S.subbandPrecincts[s]&&(S.subbandPrecincts[s]=v)}}t.codeblockParameters={codeblockWidth:r,codeblockHeight:l,numcodeblockwide:f-u+1,numcodeblockhigh:m-g+1},t.codeblocks=h,t.subbandPrecincts=y,t.codeblocksWithData=[]}function f(e,t,n){return{layerNumber:n,codeblocks:e.pixelsPrecincts[t].codeblocks}}function m(e){for(var t=e.SIZ,n=e.currentTile.index,a=e.tiles[n],s=a.codingStyleDefaultParameters.layersCount,c=t.Csiz,d=0,p=0;p<c;p++)d=o(d,a.components[p].codingStyleParameters.decompositionLevelsCount);var g=0,l=0,r=0,i=0;this.nextPacket=function(){for(;g<s;g++){for(;l<=d;l++){for(;r<c;r++){var e=a.components[r];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[l],n=t.precinctParameters.numprecincts,o;i<n;)return o=f(t,i,g),i++,o;i=0}}r=0}l=0}throw new u('Out of packets')}}function x(e){for(var t=e.SIZ,n=e.currentTile.index,a=e.tiles[n],s=a.codingStyleDefaultParameters.layersCount,c=t.Csiz,d=0,p=0;p<c;p++)d=o(d,a.components[p].codingStyleParameters.decompositionLevelsCount);var g=0,r=0,l=0,i=0;this.nextPacket=function(){for(;g<=d;g++){for(;r<s;r++){for(;l<c;l++){var e=a.components[l];if(!(g>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[g],n=t.precinctParameters.numprecincts,o;i<n;)return o=f(t,i,r),i++,o;i=0}}l=0}r=0}throw new u('Out of packets')}}function h(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],a=i.codingStyleDefaultParameters.layersCount,s=t.Csiz,d=0,g,l,r,c;for(r=0;r<s;r++){var p=i.components[r];d=o(d,p.codingStyleParameters.decompositionLevelsCount)}var m=new Int32Array(d+1);for(l=0;l<=d;++l){var x=0;for(r=0;r<s;++r){var h=i.components[r].resolutions;l<h.length&&(x=o(x,h[l].precinctParameters.numprecincts))}m[l]=x}g=0,l=0,r=0,c=0,this.nextPacket=function(){for(;l<=d;l++){for(;c<m[l];c++){for(;r<s;r++){var e=i.components[r];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){var t=e.resolutions[l],n=t.precinctParameters.numprecincts;if(!(c>=n)){for(;g<a;){var o=f(t,c,g);return g++,o}g=0}}}r=0}c=0}throw new u('Out of packets')}}function y(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],a=i.codingStyleDefaultParameters.layersCount,s=t.Csiz,o=b(i),d=o,p=0,l=0,r=0,c=0,g=0;this.nextPacket=function(){for(;g<d.maxNumHigh;g++){for(;c<d.maxNumWide;c++){for(;r<s;r++){for(var e=i.components[r],t=e.codingStyleParameters.decompositionLevelsCount;l<=t;l++){var n=e.resolutions[l],m=o.components[r].resolutions[l],x=E(c,g,m,d,n);if(null!==x){for(;p<a;){var h=f(n,x,p);return p++,h}p=0}}l=0}r=0}c=0}throw new u('Out of packets')}}function I(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],a=i.codingStyleDefaultParameters.layersCount,s=t.Csiz,o=b(i),d=0,l=0,r=0,c=0,p=0;this.nextPacket=function(){for(;r<s;++r){for(var e=i.components[r],t=o.components[r],n=e.codingStyleParameters.decompositionLevelsCount;p<t.maxNumHigh;p++){for(;c<t.maxNumWide;c++){for(;l<=n;l++){var g=e.resolutions[l],m=t.resolutions[l],x=E(c,p,m,t,g);if(null!==x){for(;d<a;){var h=f(g,x,d);return d++,h}d=0}}l=0}c=0}p=0}throw new u('Out of packets')}}function E(e,t,n,i,a){var s=e*i.minWidth,r=t*i.minHeight;if(0!=s%n.width||0!=r%n.height)return null;var o=r/n.width*a.precinctParameters.numprecinctswide;return s/n.height+o}function b(e){for(var t=Number.MAX_VALUE,n=e.components.length,i=t,a=t,s=0,l=0,p=Array(n),u=0;u<n;u++){for(var c=e.components[u],g=c.codingStyleParameters.decompositionLevelsCount,f=Array(g+1),m=t,x=t,h=0,y=0,I=1,E=g;0<=E;--E){var r=c.resolutions[E],b=I*r.precinctParameters.precinctWidth,C=I*r.precinctParameters.precinctHeight;m=d(m,b),x=d(x,C),h=o(h,r.precinctParameters.numprecinctswide),y=o(y,r.precinctParameters.numprecinctshigh),f[E]={width:b,height:C},I<<=1}i=d(i,m),a=d(a,x),s=o(s,h),l=o(l,y),p[u]={resolutions:f,minWidth:m,minHeight:x,maxNumWide:h,maxNumHigh:y}}return{components:p,minWidth:i,minHeight:a,maxNumWide:s,maxNumHigh:l}}function C(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],a=t.Csiz,o=0;o<a;o++){for(var l=i.components[o],d=l.codingStyleParameters.decompositionLevelsCount,f=[],E=[],b=0,C=0;C<=d;C++){var r=c(e,l,C),P={},T=1<<d-C;P.trx0=s(l.tcx0/T),P.try0=s(l.tcy0/T),P.trx1=s(l.tcx1/T),P.try1=s(l.tcy1/T),P.resLevel=C,P.pixelsPrecincts=[],P.pixelsPrecinctsWithDecodedCoefficients=[],p(e,P,r),f.push(P);var v;if(0===C)v={},v.type='LL',v.tbx0=s(l.tcx0/T),v.tby0=s(l.tcy0/T),v.tbx1=s(l.tcx1/T),v.tby1=s(l.tcy1/T),v.resolution=P,v.indexInTileComponent=b++,g(e,v,r,0),E.push(v),P.subbands=[v];else{var S=1<<d-C+1,L=[];v={},v.type='HL',v.tbx0=s(l.tcx0/S-0.5),v.tby0=s(l.tcy0/S),v.tbx1=s(l.tcx1/S-0.5),v.tby1=s(l.tcy1/S),v.resolution=P,v.indexInTileComponent=b++,g(e,v,r,0),E.push(v),L.push(v),v={},v.type='LH',v.tbx0=s(l.tcx0/S),v.tby0=s(l.tcy0/S-0.5),v.tbx1=s(l.tcx1/S),v.tby1=s(l.tcy1/S-0.5),v.resolution=P,v.indexInTileComponent=b++,g(e,v,r,1),E.push(v),L.push(v),v={},v.type='HH',v.tbx0=s(l.tcx0/S-0.5),v.tby0=s(l.tcy0/S-0.5),v.tbx1=s(l.tcx1/S-0.5),v.tby1=s(l.tcy1/S-0.5),v.resolution=P,v.indexInTileComponent=b++,g(e,v,r,2),E.push(v),L.push(v),P.subbands=L}}l.resolutions=f,l.subbands=E}var O=i.codingStyleDefaultParameters.progressionOrder;switch(O){case 0:i.packetsIterator=new m(e);break;case 1:i.packetsIterator=new x(e);break;case 2:i.packetsIterator=new h(e);break;case 3:i.packetsIterator=new y(e);break;case 4:i.packetsIterator=new I(e);break;default:throw new u('Unsupported progression order '+O);}}function P(e,t,n,a){function s(e){for(;u<e;){var i=t[n+p];p++,g?(I=I<<7|i,u+=7,g=!1):(I=I<<8|i,u+=8),255===i&&(g=!0)}return u-=e,I>>>u&(1<<e)-1}function o(e){return 255===t[n+p-1]&&t[n+p]===e?(l(1),!0):255===t[n+p]&&t[n+p+1]===e&&(l(2),!0)}function l(e){p+=e}function c(){u=0,g&&(p++,g=!1)}function d(){if(0===s(1))return 1;if(0===s(1))return 2;var e=s(2);return 3>e?e+3:(e=s(5),31>e)?e+6:(e=s(7),e+37)}for(var p=0,u=0,g=!1,f=e.currentTile.index,m=e.tiles[f],x=e.COD.sopMarkerUsed,h=e.COD.ephMarkerUsed,y=m.packetsIterator,I;p<a;){c(),x&&o(145)&&l(4);var E=y.nextPacket();if(s(1)){for(var b=E.layerNumber,C=[],P=0,i=E.codeblocks.length,T;P<i;P++){T=E.codeblocks[P];var v=T.precinct,S=T.cbx-v.cbxMin,L=T.cby-v.cbyMin,O=!1,D=!1,A;if(void 0!==T.included)O=!!s(1);else{v=T.precinct;var _,j;if(void 0!==v.inclusionTree)_=v.inclusionTree;else{var N=v.cbxMax-v.cbxMin+1,F=v.cbyMax-v.cbyMin+1;_=new k(N,F,b),j=new R(N,F),v.inclusionTree=_,v.zeroBitPlanesTree=j}if(_.reset(S,L,b))for(;;)if(!s(1)){_.incrementValue(b);break}else if(A=!_.nextLevel(),A){T.included=!0,O=D=!0;break}}if(O){if(D){for(j=v.zeroBitPlanesTree,j.reset(S,L);;)if(!s(1))j.incrementValue();else if(A=!j.nextLevel(),A)break;T.zeroBitPlanes=j.value}for(var B=d();s(1);)T.Lblock++;var M=(0,r.log2)(B),w=(B<1<<M?M-1:M)+T.Lblock,q=s(w);C.push({codeblock:T,codingpasses:B,dataLength:q})}}for(c(),h&&o(146);0<C.length;){var X=C.shift();T=X.codeblock,(void 0===T.data||T.dataInvalidationId!==e.dataInvalidationId)&&(T.data=[],T.parentSubband.codeblocksWithData.push(T),T.parentSubband.dataInvalidationId=e.dataInvalidationId,T.dataInvalidationId=e.dataInvalidationId),T.data.push({data:t,start:n+p,end:n+p+X.dataLength,codingpasses:X.codingpasses}),T.precinct.pixelsPrecinct.hasData=!0,p+=X.dataLength}}}return p}function T(e,a,l,c,p,u,g,f,m){var x=f.x1-f.x0,h=f.y1-f.y0,y=new Float32Array(x*h),I={x0:0,x1:0,y0:0,y1:1},E;if(e.hasDecodedCoefficients&&e.dataInvalidationId===m){for(var b=!1,C=e.subbands,P='LL'!==C[0].type,T=e.pixelsPrecinctsWithDecodedCoefficients.length,v=0;v<T;++v){var S=e.pixelsPrecinctsWithDecodedCoefficients[v],L=t(S,e),R=o(L.x0,f.x0),k=o(L.y0,f.y0),A=d(L.x1,f.x1),_=d(L.y1,f.y1);if(!(R>=A||k>=_)&&S.dataInvalidationId===m){if(!S.decodedCoefficients){S.hasData&&(b=!0);continue}for(var N=S.decodedCoefficients,F=A-R,B=L.x1-L.x0,M=x,w=R-L.x0+(k-L.y0)*B,q=R-f.x0+(k-f.y0)*M,X=k;X<_;++X)y.set(N.subarray(w,w+F),q),w+=B,q+=M}}if(!b)return y}for(var H=0,s=e.subbands.length,Y;H<s;H++)if(Y=e.subbands[H],Y.dataInvalidationId===m){var P='LL'!==Y.type,E;P?(I.x0=(f.x0-e.trx0)/2+Y.tbx0,I.y0=(f.y0-e.try0)/2+Y.tby0,I.x1=(f.x1-e.trx0)/2+Y.tbx0,I.y1=(f.y1-e.try0)/2+Y.tby0,E=I):E=f;var U='H'===Y.type.charAt(0)?1:0,W='H'===Y.type.charAt(1)?x:0,P='LL'!==Y.type,z=P?2:1,Q=x*z,V={x0:0,y0:0,x1:0,y1:0},J,K;if(!l){J=a[0].mu;var G=Y.resolution.resLevel;K=a[0].epsilon+(0<G?1-G:0)}else{var r=Y.indexInTileComponent;J=a[r].mu,K=a[r].epsilon}for(var Z=O[Y.type],$=u?1:Math.pow(2,c+Z-K)*(1+J/2048),ee=p+K-1,te=0,ne=Y.codeblocksWithData.length,ie;te<ne;++te)if((ie=Y.codeblocksWithData[te],!(ie.precinct.pixelsPrecinct.decodedCoefficients&&ie.dataInvalidationId===m))&&(V.x0=o(ie.tbx0_,E.x0),V.y0=o(ie.tby0_,E.y0),V.x1=d(ie.tbx1_,E.x1),V.y1=d(ie.tby1_,E.y1),!(V.x0>=V.x1||V.y0>=V.y1))){var ae=(V.x0-E.x0)*z+(V.y0-E.y0)*Q+(U+W),se=ie.tbx1_-ie.tbx0_,re=ie.tby1_-ie.tby0_,oe,le;oe=new D(se,re,ie.subbandType,ie.zeroBitPlanes,ee),le=2;var ce=ie.data,de=0,pe=0,ue,j,ge;for(ue=0,j=ce.length;ue<j;ue++)ge=ce[ue],de+=ge.end-ge.start,pe+=ge.codingpasses;var fe=new Uint8Array(de),me=0;for(ue=0,j=ce.length;ue<j;ue++){ge=ce[ue];var xe=ge.data.subarray(ge.start,ge.end);fe.set(xe,me),me+=xe.length}var he=new i.ArithmeticDecoder(fe,0,de);for(oe.setDecoder(he),ue=0;ue<pe;ue++)0===le?oe.runSignificancePropagationPass():1===le?oe.runMagnitudeRefinementPass():2===le?(oe.runCleanupPass(),g&&oe.checkSegmentationSymbol()):void 0,le=(le+1)%3;for(var ye=ie.tbx0_-R+(ie.tby0_-k)*F,Ie=oe.coefficentsSign,Ee=oe.coefficentsMagnitude,be=oe.bitsDecoded,Ce=u?0:0.5,Pe=V.x0-ie.tbx0_+(V.y0-ie.tby0_)*se,Te=ae,ue=V.y0,v,ve,Se;ue<V.y1;ue++){var me=Pe,Le=Te;for(Pe+=se,Te+=Q,v=V.x0;v<V.x1;v++)ve=Ee[me],0!==ve&&(ve=(ve+Ce)*$,0!==Ie[me]&&(ve=-ve),Se=be[me],y[Le]=u&&Se>=ee?ve:ve*(1<<ee-Se)),ye++,me++,Le+=z;ye+=F-se}}}return y}function v(e,t,n){var r=t.components[n],l=r.codingStyleParameters,c=r.quantizationParameters,p=l.decompositionLevelsCount,u=c.SPqcds,g=c.scalarExpounded,f=c.guardBits,m=l.segmentationSymbolUsed,x=e.components[n].precision,h=l.reversibleTransformation,y=h?new j:new _,I;if(void 0!==e.regionToParse){var E=d(r.tcx1,e.regionToParse.right),b=d(r.tcy1,e.regionToParse.bottom);I={x0:o(0,e.regionToParse.left-r.tcx0),y0:o(0,e.regionToParse.top-r.tcy0),x1:E-r.tcx0,y1:b-r.tcy0}}for(var C=[],P={x0:0,y0:0,x1:0,y1:0},v=0;v<=p;v++){var i=r.resolutions[v],S=i.trx1-i.trx0,L=i.try1-i.try0,P;if(void 0===I)P.x0=i.trx0,P.y0=i.try0,P.x1=i.trx1,P.y1=i.try1;else{var O=1<<p-v,R=4;P.x0=s(I.x0/O)-R,P.y0=s(I.y0/O)-R,P.x1=s(I.x1/O)+R,P.y1=s(I.y1/O)+R,P.x0=2*a(P.x0/2)+i.trx0,P.y0=2*a(P.y0/2)+i.try0,P.x1=2*a(P.x1/2)+i.trx0,P.y1=2*a(P.y1/2)+i.try0,P.x0=o(P.x0,i.trx0),P.y0=o(P.y0,i.try0),P.x1=d(P.x1,i.trx1),P.y1=d(P.y1,i.try1)}var k=T(i,u,g,x,f,h,m,P,e.dataInvalidationId),D={x0:P.x0-i.trx0,y0:P.y0-i.try0,x1:P.x1-i.trx0,y1:P.y1-i.try0};C.push({width:S,height:L,items:k,relativeRegionInLevel:D})}var A=y.calculate(C,r.tcx0,r.tcy0),N=A.relativeRegionInLevel,F=N.x1-N.x0,B=!1;if(void 0!==e.regionToParse&&(B=I.x0!==N.x0||I.y0!==N.y0||I.x1!==N.x1||I.y1!==N.y1),!B){var M=N.y1-N.y0;return{left:r.tcx0,top:r.tcy0,width:F,height:M,items:A.items}}for(var S=I.x1-I.x0,L=I.y1-I.y0,w=A.items,q=new Float32Array(S*L),X=I.y0-N.y0,H=I.x0-N.x0,Y=0,U=H+F*X,v=0,W;v<L;++v)W=U+S,q.set(w.subarray(U,W),Y),U+=F,Y+=S;return{left:r.tcx0+I.x0,top:r.tcy0+I.y0,width:S,height:L,items:q}}function S(e){for(var t=e.SIZ,n=e.components,a=t.Csiz,s=[],r=0,i=e.tiles.length,o;r<i;r++)if(o=e.tiles[r],!(void 0!==e.regionToParse&&(e.regionToParse.left>=o.tx1||e.regionToParse.top>=o.ty1||e.regionToParse.right<=o.tx0||e.regionToParse.bottom<=o.ty0))){var l=[],d;for(d=0;d<a;d++)l[d]=v(e,o,d);var c=l[0],p=new Uint8ClampedArray(c.items.length*a),u={left:c.left,top:c.top,width:c.width,height:c.height,items:p},f=0,m,x,h,y,I,E,b;if(o.codingStyleDefaultParameters.multipleComponentTransform){var C=4===a,P=l[0].items,T=l[1].items,S=l[2].items,L=C?l[3].items:null;m=n[0].precision-8,x=(128<<m)+0.5;var O=o.components[0],R=a-3;if(y=P.length,!O.codingStyleParameters.reversibleTransformation)for(h=0;h<y;h++,f+=R)I=P[h]+x,E=T[h],b=S[h],p[f++]=I+1.402*b>>m,p[f++]=I-0.34413*E-0.71414*b>>m,p[f++]=I+1.772*E>>m;else for(h=0;h<y;h++,f+=R){I=P[h]+x,E=T[h],b=S[h];var k=I-(b+E>>2);p[f++]=k+b>>m,p[f++]=k>>m,p[f++]=k+E>>m}if(C)for(h=0,f=3;h<y;h++,f+=4)p[f]=L[h]+x>>m}else for(d=0;d<a;d++){var g=l[d].items;for(m=n[d].precision-8,x=(128<<m)+0.5,(f=d,h=0,y=g.length);h<y;h++)p[f]=g[h]+x>>m,f+=a}s.push(u)}return s}function L(e,t){for(var n=e.SIZ,i=n.Csiz,a=e.tiles[t],s=0;s<i;s++){var r=a.components[s],o=e.currentTile.QCC[s]===void 0?e.currentTile.QCD:e.currentTile.QCC[s];r.quantizationParameters=o;var l=e.currentTile.COC[s]===void 0?e.currentTile.COD:e.currentTile.COC[s];r.codingStyleParameters=l}a.codingStyleDefaultParameters=e.currentTile.COD}var O={LL:0,LH:1,HL:1,HH:2};e.prototype={parse:function(e){var t=(0,r.readUint16)(e,0);if(65359===t)return void this.parseCodestream(e,0,e.length);for(var n=0,i=e.length;n<i;){var a=8,s=(0,r.readUint32)(e,n),o=(0,r.readUint32)(e,n+4);if(n+=a,1===s&&(s=4294967296*(0,r.readUint32)(e,n)+(0,r.readUint32)(e,n+4),n+=8,a+=8),0===s&&(s=i-n+a),s<a)throw new u('Invalid box field size');var l=s-a,c=!0;switch(o){case 1785737832:c=!1;break;case 1668246642:var d=e[n];if(1===d){var p=(0,r.readUint32)(e,n+3);switch(p){case 16:case 17:case 18:break;default:(0,r.warn)('Unknown colorspace '+p);}}else 2===d&&(0,r.info)('ICC profile not supported');break;case 1785737827:this.parseCodestream(e,n,n+l);break;case 1783636000:218793738!==(0,r.readUint32)(e,n)&&(0,r.warn)('Invalid JP2 signature');break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:var g=String.fromCharCode(255&o>>24,255&o>>16,255&o>>8,255&o);(0,r.warn)('Unsupported header type '+o+' ('+g+')');}c&&(n+=l)}},parseImageProperties:function(e){for(var t=e.getByte();0<=t;){var n=t;t=e.getByte();var i=n<<8|t;if(65361==i){e.skip(4);var a=e.getInt32()>>>0,s=e.getInt32()>>>0,r=e.getInt32()>>>0,o=e.getInt32()>>>0;e.skip(16);var l=e.getUint16();return this.width=a-r,this.height=s-o,this.componentsCount=l,void(this.bitsPerComponent=8)}}throw new u('No size marker found in JPX stream')},parseCodestream:function(e,t,a,s){var o={};s=s||{};var c=!!s.isOnlyParseHeaders,d=s.regionToParse;if(void 0!==d&&c)throw'JPX Error: options.regionToParse is uneffective if options.isOnlyParseHeaders = true';var p=!1;try{for(var g=t,f;g+1<a;){f=(0,r.readUint16)(e,g),g+=2;var m=0,x,h,y,I,E,b;switch(f){case 65359:o.mainHeader=!0;break;case 65497:break;case 65361:m=(0,r.readUint16)(e,g);var T={};T.Xsiz=(0,r.readUint32)(e,g+4),T.Ysiz=(0,r.readUint32)(e,g+8),T.XOsiz=(0,r.readUint32)(e,g+12),T.YOsiz=(0,r.readUint32)(e,g+16),T.XTsiz=(0,r.readUint32)(e,g+20),T.YTsiz=(0,r.readUint32)(e,g+24),T.XTOsiz=(0,r.readUint32)(e,g+28),T.YTOsiz=(0,r.readUint32)(e,g+32);var v=(0,r.readUint16)(e,g+36);T.Csiz=v;var S=[],O=!0;x=g+38;for(var R=0,i;R<v;R++)i={precision:(127&e[x])+1,isSigned:!!(128&e[x]),XRsiz:e[x+1],YRsiz:e[x+2]},x+=3,n(i,T),S.push(i),void 0!==d&&(O&=1===i.XRsiz&&1===i.YRsiz);if(o.SIZ=T,o.components=S,l(o,S),o.QCC=[],o.COC=[],!O)throw new Error('JPX Error: When regionToParse is used, component size other than 1 is not supported');break;case 65372:m=(0,r.readUint16)(e,g);var k={};switch(x=g+2,h=e[x++],31&h){case 0:I=8,E=!0;break;case 1:I=16,E=!1;break;case 2:I=16,E=!0;break;default:throw new Error('Invalid SQcd value '+h);}for(k.noQuantization=8===I,k.scalarExpounded=E,k.guardBits=h>>5,y=[];x<m+g;){var D={};8===I?(D.epsilon=e[x++]>>3,D.mu=0):(D.epsilon=e[x]>>3,D.mu=(7&e[x])<<8|e[x+1],x+=2),y.push(D)}k.SPqcds=y,o.mainHeader?o.QCD=k:(o.currentTile.QCD=k,o.currentTile.QCC=[]);break;case 65373:m=(0,r.readUint16)(e,g);var A={};x=g+2;var _;switch(257>o.SIZ.Csiz?_=e[x++]:(_=(0,r.readUint16)(e,x),x+=2),h=e[x++],31&h){case 0:I=8,E=!0;break;case 1:I=16,E=!1;break;case 2:I=16,E=!0;break;default:throw new Error('Invalid SQcd value '+h);}for(A.noQuantization=8===I,A.scalarExpounded=E,A.guardBits=h>>5,y=[];x<m+g;)D={},8===I?(D.epsilon=e[x++]>>3,D.mu=0):(D.epsilon=e[x]>>3,D.mu=(7&e[x])<<8|e[x+1],x+=2),y.push(D);A.SPqcds=y,o.mainHeader?o.QCC[_]=A:o.currentTile.QCC[_]=A;break;case 65362:m=(0,r.readUint16)(e,g);var j={};x=g+2;var N=e[x++];j.entropyCoderWithCustomPrecincts=!!(1&N),j.sopMarkerUsed=!!(2&N),j.ephMarkerUsed=!!(4&N),j.progressionOrder=e[x++],j.layersCount=(0,r.readUint16)(e,x),x+=2,j.multipleComponentTransform=e[x++],j.decompositionLevelsCount=e[x++],j.xcb=(15&e[x++])+2,j.ycb=(15&e[x++])+2;var F=e[x++];if(j.selectiveArithmeticCodingBypass=!!(1&F),j.resetContextProbabilities=!!(2&F),j.terminationOnEachCodingPass=!!(4&F),j.verticallyStripe=!!(8&F),j.predictableTermination=!!(16&F),j.segmentationSymbolUsed=!!(32&F),j.reversibleTransformation=e[x++],j.entropyCoderWithCustomPrecincts){for(var B=[],M;x<m+g;)M=e[x++],B.push({PPx:15&M,PPy:M>>4});j.precinctsSizes=B}var w=[];if(j.selectiveArithmeticCodingBypass&&w.push('selectiveArithmeticCodingBypass'),j.resetContextProbabilities&&w.push('resetContextProbabilities'),j.terminationOnEachCodingPass&&w.push('terminationOnEachCodingPass'),j.verticallyStripe&&w.push('verticallyStripe'),j.predictableTermination&&w.push('predictableTermination'),0<w.length)throw p=!0,new Error('Unsupported COD options ('+w.join(', ')+')');o.mainHeader?o.COD=j:(o.currentTile.COD=j,o.currentTile.COC=[]);break;case 65424:m=(0,r.readUint16)(e,g),b={},b.index=(0,r.readUint16)(e,g+2),b.length=(0,r.readUint32)(e,g+4),b.dataEnd=b.length+g-2,b.partIndex=e[g+8],b.partsCount=e[g+9],o.mainHeader=!1,0===b.partIndex&&(b.COD=o.COD,b.COC=o.COC.slice(0),b.QCD=o.QCD,b.QCC=o.QCC.slice(0)),o.currentTile=b;break;case 65427:b=o.currentTile,0===b.partIndex&&(L(o,b.index),C(o)),m=b.dataEnd-g,c||P(o,e,g,m);break;case 65365:case 65367:case 65368:case 65380:m=(0,r.readUint16)(e,g);break;case 65363:throw new Error('Codestream code 0xFF53 (COC) is not implemented');default:throw new Error('Unknown codestream code: '+f.toString(16));}g+=m}}catch(t){if(p||this.failOnCorruptedImage)throw new u(t.message);else(0,r.warn)('JPX: Trying to recover from: '+t.message)}return c||this.decode(o,s),this.width=o.SIZ.Xsiz-o.SIZ.XOsiz,this.height=o.SIZ.Ysiz-o.SIZ.YOsiz,this.componentsCount=o.SIZ.Csiz,o},invalidateData:function(e){e.dataInvalidationId=(e.dataInvalidationId||0)+1},addPacketsData:function(e,t){for(var n=0;n<t.packetDataOffsets.length;++n){var a=t.packetDataOffsets[n],s=e.tiles[a.tileIndex],r=s.components[a.c],o=r.resolutions[a.r],l=a.p,c=o.pixelsPrecincts[l],d=c.codeblocks;c.hasData=!0;for(var p=0;p<a.codeblockOffsets.length;++p){var i=a.codeblockOffsets[p],u=i.start===i.end;if(!u){var g=d[p];if(g.dataInvalidationId!==e.dataInvalidationId){g.dataInvalidationId=e.dataInvalidationId,g.data=void 0,g.zeroBitPlanes=void 0;var f=g.parentSubband.dataInvalidationId;f!==e.dataInvalidationId&&(f=e.dataInvalidationId,g.parentSubband.dataInvalidationId=f,g.parentSubband.codeblocksWithData=[])}if(void 0===g.data&&(g.data=[],g.parentSubband.codeblocksWithData.push(g)),void 0!==i.zeroBitPlanes){if(void 0===g.zeroBitPlanes&&(g.zeroBitPlanes=i.zeroBitPlanes),g.zeroBitPlanes!==i.zeroBitPlanes)throw'JPX Error: Unmatched zero bit planes';}else if(void 0===g.zeroBitPlanes)throw'JPX Error: zeroBitPlanes is unknown';g.included=!0,g.data.push({data:t.data,start:i.start,end:i.end,codingpasses:i.codingpasses})}}}},decodePrecinctCoefficients:function(e,n,i,a,s){var r=e.tiles[n],o=r.components[i],l=o.resolutions[a],c=l.pixelsPrecincts[s],d=o.codingStyleParameters,p=o.quantizationParameters,u=p.SPqcds,g=p.scalarExpounded,f=p.guardBits,m=d.segmentationSymbolUsed,x=e.components[i].precision,h=d.reversibleTransformation,y=t(c,l),I=T(l,u,g,x,f,h,m,y,e.dataInvalidationId);return I},setPrecinctCoefficients:function(e,t,n,i,a,s){var r=e.tiles[n],o=r.components[i],l=o.resolutions[a],c=l.pixelsPrecincts[s];l.dataInvalidationId!==e.dataInvalidationId&&(l.dataInvalidationId=e.dataInvalidationId,l.pixelsPrecinctsWithDecodedCoefficients=[]),c.hasDecodedCoefficients||l.pixelsPrecinctsWithDecodedCoefficients.push(c),c.decodedCoefficients=t,l.hasDecodedCoefficients=!0,c.dataInvalidationId=e.dataInvalidationId},decode:function(e,t){if(t!==void 0&&t.regionToParse!==void 0){var n=t.regionToParse;if(n.top===void 0||n.left===void 0||n.right===void 0||n.bottom===void 0)throw new Error('JPX Error: Either left, top, right or bottom are undefined in regionToParse');e.regionToParse=n}this.tiles=S(e),e.regionToParse=void 0}};var R=function(){function e(e,t){var n=(0,r.log2)(o(e,t))+1;this.levels=[];for(var a=0,i;a<n;a++)i={width:e,height:t,items:[]},this.levels.push(i),e=s(e/2),t=s(t/2)}return e.prototype={reset:function(e,t){for(var n=0,i=0,a;n<this.levels.length;){a=this.levels[n];var s=e+t*a.width;if(void 0!==a.items[s]){i=a.items[s];break}a.index=s,e>>=1,t>>=1,n++}n--,a=this.levels[n],a.items[a.index]=i,this.currentLevel=n,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return(e--,0>e)?(this.value=n,!1):(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),k=function(){function e(e,t,n){var a=(0,r.log2)(o(e,t))+1;this.levels=[];for(var l=0,i;l<a;l++){i=new Uint8Array(e*t);for(var c=0,d=i.length;c<d;c++)i[c]=n;var p={width:e,height:t,items:i};this.levels.push(p),e=s(e/2),t=s(t/2)}}return e.prototype={reset:function(e,t,n){for(var i=0;i<this.levels.length;){var a=this.levels[i],s=e+t*a.width;a.index=s;var r=a.items[s];if(255===r)break;if(r>n)return this.currentLevel=i,this.propagateValues(),!1;e>>=1,t>>=1,i++}return this.currentLevel=i-1,!0},incrementValue:function(e){var t=this.levels[this.currentLevel];t.items[t.index]=e+1,this.propagateValues()},propagateValues:function(){for(var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];0<=--e;)t=this.levels[e],t.items[t.index]=n},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return(t.items[t.index]=255,e--,!(0>e))&&(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),D=function(){function e(e,t,n,o,l){this.width=e,this.height=t,this.contextLabelTable='HH'===n?r:'HL'===n?s:a;var c=e*t;this.neighborsSignificance=new Uint8Array(c),this.coefficentsSign=new Uint8Array(c),this.coefficentsMagnitude=14<l?new Uint32Array(c):6<l?new Uint16Array(c):new Uint8Array(c),this.processingFlags=new Uint8Array(c);var d=new Uint8Array(c);if(0!==o)for(var p=0;p<c;p++)d[p]=o;this.bitsDecoded=d,this.reset()}var t=17,n=18,a=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),s=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),r=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);return e.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[t]=92,this.contexts[n]=6},setNeighborsSignificance:function(e,t,n){var a=this.neighborsSignificance,s=this.width,r=this.height,o=0<t,l=t+1<s,c;0<e&&(c=n-s,o&&(a[c-1]+=16),l&&(a[c+1]+=16),a[c]+=4),e+1<r&&(c=n+s,o&&(a[c-1]+=16),l&&(a[c+1]+=16),a[c]+=4),o&&(a[n-1]+=1),l&&(a[n+1]+=1),a[n]|=128},runSignificancePropagationPass:function(){for(var e=this.decoder,t=this.width,n=this.height,a=this.coefficentsMagnitude,s=this.coefficentsSign,r=this.neighborsSignificance,o=this.processingFlags,l=this.contexts,c=this.contextLabelTable,d=this.bitsDecoded,p=0;p<n;p+=4)for(var u=0,g;u<t;u++){g=p*t+u;for(var f=0,m;4>f&&(m=p+f,!(m>=n));f++,g+=t)if(o[g]&=-2,!a[g]&&r[g]){var i=c[r[g]],x=e.readBit(l,i);if(x){var h=this.decodeSignBit(m,u,g);s[g]=h,a[g]=1,this.setNeighborsSignificance(m,u,g),o[g]|=2}d[g]++,o[g]|=1}}},decodeSignBit:function(e,t,n){var i=this.width,a=this.height,s=this.coefficentsMagnitude,r=this.coefficentsSign,o,l,c,d,p,u;d=0<t&&0!==s[n-1],t+1<i&&0!==s[n+1]?(c=r[n+1],d?(l=r[n-1],o=1-c-l):o=1-c-c):d?(l=r[n-1],o=1-l-l):o=0;var g=3*o;return d=0<e&&0!==s[n-i],e+1<a&&0!==s[n+i]?(c=r[n+i],d?(l=r[n-i],o=1-c-l+g):o=1-c-c+g):d?(l=r[n-i],o=1-l-l+g):o=g,0<=o?(p=9+o,u=this.decoder.readBit(this.contexts,p)):(p=9-o,u=1^this.decoder.readBit(this.contexts,p)),u},runMagnitudeRefinementPass:function(){for(var e=this.decoder,t=this.width,n=this.height,i=this.coefficentsMagnitude,a=this.neighborsSignificance,s=this.contexts,r=this.bitsDecoded,o=this.processingFlags,l=1,c=2,p=t*n,u=0,g;u<p;u=g){g=d(p,u+4*t);for(var f=0;f<t;f++)for(var m=u+f;m<g;m+=t)if(i[m]&&0==(o[m]&l)){var x=16;if(0!=(o[m]&c)){o[m]^=c;var h=127&a[m];x=0==h?15:14}var y=e.readBit(s,x);i[m]=i[m]<<1|y,r[m]++,o[m]|=l}}},runCleanupPass:function(){for(var e=this.decoder,a=this.width,s=this.height,r=this.neighborsSignificance,o=this.coefficentsMagnitude,l=this.coefficentsSign,c=this.contexts,p=this.contextLabelTable,u=this.bitsDecoded,g=this.processingFlags,f=2,m=a,x=2*a,h=3*a,y=0,I;y<s;y=I){I=d(y+4,s);for(var E=y*a,b=y+3<s,C=0;C<a;C++){var P=E+C,T=b&&0===g[P]&&0===g[P+m]&&0===g[P+x]&&0===g[P+h]&&0===r[P]&&0===r[P+m]&&0===r[P+x]&&0===r[P+h],v=0,S=P,L=y,i;if(T){var O=e.readBit(c,n);if(!O){u[P]++,u[P+m]++,u[P+x]++,u[P+h]++;continue}v=e.readBit(c,t)<<1|e.readBit(c,t),0!=v&&(L=y+v,S+=v*a),i=this.decodeSignBit(L,C,S),l[S]=i,o[S]=1,this.setNeighborsSignificance(L,C,S),g[S]|=f,S=P;for(var R=y;R<=L;R++,S+=a)u[S]++;v++}for(L=y+v;L<I;L++,S+=a)if(!(o[S]||0!=(g[S]&1))){var k=p[r[S]],D=e.readBit(c,k);1===D&&(i=this.decodeSignBit(L,C,S),l[S]=i,o[S]=1,this.setNeighborsSignificance(L,C,S),g[S]|=f),u[S]++}}}},checkSegmentationSymbol:function(){var e=this.decoder,n=this.contexts,i=e.readBit(n,t)<<3|e.readBit(n,t)<<2|e.readBit(n,t)<<1|e.readBit(n,t);if(10!=i)throw new u('Invalid segmentation symbol')}},e}(),A=function(){function e(){}return e.prototype.calculate=function(e,t,n){for(var a=e[0],s=1,i=e.length;s<i;s++)a=this.iterate(a,e[s],t,n);return a},e.prototype.extend=function(e,t,n){var i=t-1,a=t+1,s=t+n-2,r=t+n;e[i--]=e[a++],e[r++]=e[s--],e[i--]=e[a++],e[r++]=e[s--],e[i--]=e[a++],e[r++]=e[s--],e[i]=e[a],e[r]=e[s]},e.prototype.iterate=function(e,t,n,a){var s=t.relativeRegionInLevel;if(2*e.relativeRegionInLevel.x0>s.x0||2*e.relativeRegionInLevel.y0>s.y0||2*e.relativeRegionInLevel.x1<s.x1||2*e.relativeRegionInLevel.y1<s.y1)throw new Error('JPX Error: region in LL is smaller than region in higher resolution level');if(0!=s.x0%2||0!=s.y0%2)throw new Error('JPX Error: region in HL/LH/HH subbands begins in odd coefficients');var r=e.items,o=s.x1-s.x0,c=s.y1-s.y0,p=e.relativeRegionInLevel.x1-e.relativeRegionInLevel.x0,g=s.x0/2-e.relativeRegionInLevel.x0,f=s.y0/2-e.relativeRegionInLevel.y0,m=t.items,x,i,h,y,l,u;for(x=0;x<c;x+=2)for(y=x*o,h=g+f*p+p*x/2,i=0;i<o;i+=2,h++,y+=2)m[y]=r[h];r=e.items=null;var I=4,E=new Float32Array(o+2*I);if(1!=o)for(u=0,h=0;u<c;u++,h+=o)E.set(m.subarray(h,h+o),I),this.extend(E,I,o),this.filter(E,I,o),m.set(E.subarray(I,I+o),h);else if(0!=(1&n))for(u=0,h=0;u<c;u++,h+=o)m[h]*=0.5;var C=16,P=[];for(x=0;x<C;x++)P.push(new Float32Array(c+2*I));var T=0,v;if(e=I+c,1!=c)for(l=0;l<o;l++){if(0==T){for(C=d(o-l,C),h=l,y=I;y<e;h+=o,y++)for(v=0;v<C;v++)P[v][y]=m[h+v];T=C}T--;var b=P[T];if(this.extend(b,I,c),this.filter(b,I,c),0===T)for(h=l-C+1,y=I;y<e;h+=o,y++)for(v=0;v<C;v++)m[h+v]=P[v][y]}else if(0!=(1&a))for(l=0;l<o;l++)m[l]*=0.5;return{relativeRegionInLevel:s,width:o,height:c,items:m}},e}(),_=function(){function e(){A.call(this)}return e.prototype=Object.create(A.prototype),e.prototype.filter=function(e,t,i){var a=i>>1;t|=0;var s=-1.586134342059924,r=-0.052980118572961,o=0.882911075530934,l=0.443506852043971,c=1.230174104914001,d,p,n,u;for(d=t-3,p=a+4;p--;d+=2)e[d]*=1/c;for(d=t-2,n=l*e[d-1],p=a+3;p--&&(u=l*e[d+1],e[d]=c*e[d]-n-u,p--);d+=2)d+=2,n=l*e[d+1],e[d]=c*e[d]-n-u;for(d=t-1,n=o*e[d-1],p=a+2;p--&&(u=o*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=o*e[d+1],e[d]-=n+u;for(d=t,n=r*e[d-1],p=a+1;p--&&(u=r*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=r*e[d+1],e[d]-=n+u;if(0!=a)for(d=t+1,n=s*e[d-1],p=a;p--&&(u=s*e[d+1],e[d]-=n+u,p--);d+=2)d+=2,n=s*e[d+1],e[d]-=n+u},e}(),j=function(){function e(){A.call(this)}return e.prototype=Object.create(A.prototype),e.prototype.filter=function(e,t,i){var a=i>>1;t|=0;var s,r;for(s=t,r=a+1;r--;s+=2)e[s]-=e[s-1]+e[s+1]+2>>2;for(s=t+1,r=a;r--;s+=2)e[s]+=e[s-1]+e[s+1]>>1},e}();return e}();t.JpxImage=l},function(e,t,n){'use strict';function i(){this._image=new a.JpxImage,this._cachedContexts=[]}var a=n(2);e.exports=i,Object.defineProperty(i.prototype,'image',{get:function(){return this._image}}),i.prototype.getContext=function(e){var t=this._cachedContexts[e.length];t||(t=[],this._cachedContexts[e.length]=t);for(var n=0,a=!1;n<t.length&&!a;){for(var s=t[n].codestream,r=0;r<s.length&&s[r]===e[r];)++r;a=r===s.length,++n}var i;return a?(i=t[n-1].context,this._image.invalidateData(i)):(i=this._image.parseCodestream(e,0,e.length,{isOnlyParseHeaders:!0}),t.push({codestream:e,context:i})),i}},function(e,t,n){'use strict';var i=n(0);e.exports.JpipImage=n(5),e.exports.j2kExceptions=i.j2kExceptions,e.exports.jpipExceptions=i.jpipExceptions,e.exports.Internals={PdfjsJpxDecoderLegacy:n(43),PdfjsJpxPixelsDecoder:n(46),PdfjsJpxCoefficientsDecoder:n(47),jpipRuntimeFactory:n(1),jGlobals:i}},function(e,t,n){'use strict';function i(e){function t(e){function t(){f||(f=!0,g.unregister())}var n=P.modify(e.key),i=s.createParamsCodestreamPart(n.codestreamPartParams,h),a=0,r=[],l=[],d=0,u=!1,g;e.on('dependencyTaskData',function(e,t){var i=r[t.inClassIndex];if(!l[i]){if(e.minQuality!==n.progressiveness[0].minNumQualityLayers)throw'jpip error: Unexpected quality as min quality data';l[i]=e,++d}g.precinctQualityLayerReached(t.inClassIndex,e.minQuality)});var f=!1;e.on('statusUpdated',function(e){if(!f&&!e.isWaitingForWorkerResult&&e.terminatedDependsTasks===e.dependsTasks)throw'jpip error: Unexpected unended task without pending depend tasks'}),e.on('custom',function(e){'aborting'===e&&t()}),g=s.createQualityWaiter(i,n.progressiveness,e.key.maxQuality,function(){if(null==m&&(m=E.createHeadersCodestream(i),x=c(i,n.codestreamPartParams),y=h.getNumTilesX(),I=i.tilesBounds),!u){if(d<l.length)throw'webjpip error: Min quality layer data missing';u=!0,e.dataReady({headersCodestream:m,offsetInRegion:x,imageTilesX:y,tilesBounds:I,precinctCoefficients:l},o,!1)}1<g.getProgressiveStagesFinished()&&e.dataReady({headersCodestream:m,offsetInRegion:x,imageTilesX:y,tilesBounds:I,precinctCoefficients:e.dependTaskResults},o,!0),g.isDone()&&(t(),e.terminate())},h,p,function(t,i,s,o,l){r[o]=a++;var c=l.precinctPositionToIndexInComponentResolution(s);e.registerTaskDependency({taskType:'COEFFS',tileIndex:s.tileIndex,resolutionLevel:s.resolutionLevel,precinctX:s.precinctX,precinctY:s.precinctY,component:s.component,maxQuality:n.codestreamPartParams.quality,inClassIndex:o,precinctIndexInComponentResolution:c,progressiveness:n.progressiveness})}),g.register();var m=null,x=null,y,I}function n(e){function t(t){if(a!==t)throw'webjpip error: Unexpected context in data event';r=!0;var i=a.getProgressiveStagesFinished();if(!o){o=!0;var s=a.getFetchedData(e.key.progressiveness[0].minNumQualityLayers);e.dataReady(s,l,!1)}if(1<i){var c=a.getFetchedData();e.dataReady(c,l,!0)}if(a.isDone()){if(!r)throw'webjpip error: Coefficients task without data';n(),e.terminate()}}function n(){c||(c=!0,a.dispose())}var i=s.createPrecinctCodestreamPart(d(),h.getTileStructure(e.key.tileIndex),e.key.tileIndex,e.key.component,e.key.resolutionLevel,e.key.precinctX,e.key.precinctY);e.on('custom',function(e){'aborting'===e&&n()});var a=s.createImageDataContext(C,i,e.key.maxQuality,e.key.progressiveness),r=!1,o=!1,c=!1;a.on('data',t),0<a.getProgressiveStagesFinished()&&t(a)}function c(e,t){if(t){var n=e.getTileIterator();if(!n.tryAdvance())throw new r.jpipExceptions.InternalErrorException('Empty codestreamPart in JpipImageDataContext');var i=n.tileIndex,a=h.getTileLeft(i,e.level),s=h.getTileTop(i,e.level);return{offsetX:t.minX-a,offsetY:t.minY-s,width:t.maxXExclusive-t.minX,height:t.maxYExclusive-t.minY}}return{offsetX:0,offsetY:0,width:h.getImageWidth(),height:h.getImageHeight()}}function d(){return null==v&&(v=s.createLevelCalculator(T)),v}var p=s.createDatabinsSaver(!1),u=p.getMainHeaderDatabin(),g=s.createMarkersParser(u),f=s.createOffsetsCalculator(u,g),m=s.createStructureParser(p,g,f),x='RPCL',h=s.createCodestreamStructure(m,x),y=s.createQualityLayersCache(h),I=s.createHeaderModifier(f,x),E=s.createCodestreamReconstructor(p,I,y),b=s.createPacketsDataCollector(p,y),C={reconstructor:E,packetsDataCollector:b,qualityLayersCache:y,codestreamStructure:h,databinsSaver:p,jpipFactory:s},P=s.createRequestParamsModifier(h),T=null,v=null,S=s.createFetcher(p,e);this.opened=function(e){T=e.getImageParams()},this.getLevelCalculator=d,this.getDecoderWorkersInputRetreiver=function(){return this},this.getFetcher=function(){return S},this.getWorkerTypeOptions=function(e){switch(e){case o:return{ctorName:'webjpip.Internals.PdfjsJpxPixelsDecoder',ctorArgs:[],scriptsToImport:[a(new Error)],pathToTransferablesInPromiseResult:[[0,'data','buffer']]};case l:return{ctorName:'webjpip.Internals.PdfjsJpxCoefficientsDecoder',ctorArgs:[],scriptsToImport:[a(new Error)],transferables:[[0,'headersCodestream','buffer'],[0,'codeblocksData','data','buffer']],pathToTransferablesInPromiseResult:[[0,'coefficients','buffer']]};default:throw'webjpip error: Unexpected worker type in getWorkerTypeOptions '+e;}},this.getKeyAsString=function(e){if('COEFFS'===e.taskType)return'C:'+e.inClassIndex;var t=P.modify(e),n=t.codestreamPartParams;return'P:xmin'+n.minX+'ymin'+n.minY+'xmax'+n.maxXExclusive+'ymax'+n.maxYExclusive+'r'+n.level+'q'+n.quality},this.taskStarted=function(e){'COEFFS'===e.key.taskType?n(e):t(e)};i.useLegacy&&(this.getWorkerTypeOptions=function(){return{ctorName:'webjpip.Internals.PdfjsJpxDecoderLegacy',ctorArgs:[],scriptsToImport:[a(new Error)],transferables:[[0,'headersCodestream','buffer'],[0,'codeblocksData','data','buffer']],pathToTransferablesInPromiseResult:[[]]}},this.getKeyAsString=function(e){return JSON.stringify(e)},this.taskStarted=function(e){function t(t){if(a!==t)throw'webjpip error: Unexpected context in data event';var n=a.getFetchedData();n.offsetInRegion=r,e.dataReady(n,!0),a.isDone()&&(e.terminate(),a.dispose())}var n=P.modify(e.key),i=s.createParamsCodestreamPart(n.codestreamPartParams,h),a=s.createImageDataContext(C,i,n.codestreamPartParams.quality,n.progressiveness),r=c(i,n.codestreamPartParams);a.on('data',t),a.hasData()&&t(a)})}function a(e){var t=e.stack.trim(),n=c.exec(t);if(n&&''!==n[2])return n[2];if(n=d.exec(t),n&&''!==n[1])return n[1];if(n=p.exec(t),n&&''!==n[1])return n[1];if(void 0!==e.fileName)return e.fileName;throw'webjpip.js: Could not get current script URL'}var s=n(1),r=n(0);e.exports=i;var o=1,l=2;i.toggleLegacy=function(){i.useLegacy=!i.useLegacy};var c=/at (|[^ ]+ \()([^ ]+):\d+:\d+/,d=new RegExp(/.+@(.*?):\d+:\d+/),p=new RegExp(/.+\/(.*?):\d+(:\d+)*$/)},function(e,t,n){'use strict';var i=n(0);e.exports={request:function(e,t,n,a){function s(){if(!l){if(4!==r.readyState){if(void 0===a||null===r.response||3>r.readyState)return;var e=r.response.byteLength,i=e-c;if(i<a)return;c=e}else if(l=!0,200!==r.status||null===r.response)return void n(r);o||t(r,l)}}var r=new XMLHttpRequest,o=void 0===t,l=!1,c=0;if(r.open('GET',e,!o),r.onreadystatechange=s,o||(r.mozResponseType=r.responseType='arraybuffer'),void 0!==a&&(r.setRequestHeader('X-Content-Type-Options','nosniff'),r.onprogress=s),r.send(null),o&&!l)throw new i.jpipExceptions.InternalErrorException('synchronous ajax call was not finished synchronously');return r}}},function(e,t,n){'use strict';var i=n(0);e.exports={createTransaction:function(){function e(e){if(!n.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot terminate an already terminated transaction');t=e?2:3}var t=1,n={get isAborted(){return 3==t},get isActive(){return 1==t},commit:function(){e(!0)},abort:function(){e(!1)}};return n},createTransactionalObject:function(e,t){function n(e){if(!e.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot use terminated transaction to access objects');if(e!==r&&r.isActive)throw new i.jpipExceptions.InternalErrorException('Cannot simultanously access transactional object from two active transactions')}var a=null,s=e,r={isActive:!1,isAborted:!0},o=t?function(e){return e}:function(e){var t=JSON.parse(JSON.stringify(e));return t};return{getValue:function(e){return(n(e),r===e)?a:(r.isAborted?a=o(s):s=o(a),r=e,a)},setValue:function(e,t){return n(e),r===e?void(a=t):void(!r.isAborted&&(s=o(a)),r=e,a=t)}}}}},function(e){'use strict';e.exports=function(){var e=function(){var e=Array(17);return e[0]=0,e[1]=0,e[2]=1,e[3]=0,e[4]=4,e[5]=3,e[6]=2,e[7]=1,e[8]=0,e[9]=6,e[10]=5,e[11]=4,e[12]=3,e[13]=2,e[14]=1,e[15]=0,e[16]=0,e}(),t=function(){var e=Array(17);return e[0]=1,e[1]=2,e[2]=3,e[3]=5,e[4]=6,e[5]=22,e[6]=30,e[7]=34,e[8]=36,e[9]=37,e[10]=101,e[11]=133,e[12]=149,e[13]=157,e[14]=161,e[15]=163,e[16]=164,e}();return{parse:function(n){var i=n.countOnesAndShiftUntilFirstZeroBit(16);if(null===i)return null;var a=e[i],s=n.shiftBits(a);if(null===s)return null;var r=t[i];return s+r}}}()},function(e,t,n){'use strict';var i=n(0),a={LSB_MASK:1,BIT_4_MASK:16,BITS_56_MASK:96,MSB_MASK:128,LSB_7_MASK:127,parseNumberInVbas:function(e,t,n){var i=a,s=t,r;if(n){r=e[s]&(1<<n)-1}else r=e[s]&i.LSB_7_MASK;for(;!!(e[s]&i.MSB_MASK);)++s,r<<=7,r|=e[s]&i.LSB_7_MASK;return{endOffset:s+1,number:r}},parseMessageHeader:function(e,t,n){var s=a,r=(e[t]&s.BITS_56_MASK)>>>5;if(0==r)throw new i.jpipExceptions.ParseException('Failed parsing message header (A.2.1): prohibited existance class and csn bits 00');var o=!!(e[t]&s.BIT_4_MASK),l=s.parseNumberInVbas(e,t,4),c=l.number,d=l.endOffset,p=0;if(!!(2&r)){var u=s.parseNumberInVbas(e,d);p=u.number,d=u.endOffset}else n&&(p=n.classId);var g=0;if(3==r){var f=s.parseNumberInVbas(e,d);g=f.number,d=f.endOffset}else n&&(g=n.codestreamIndex);var m=s.parseNumberInVbas(e,d),x=m.number;d=m.endOffset;var h=s.parseNumberInVbas(e,d),y=h.number;d=h.endOffset;var I=!!(p&s.LSB_MASK),E;if(I){var b=s.parseNumberInVbas(e,d);E=b.number,d=b.endOffset}var C={isLastByteInDatabin:o,inClassId:c,bodyStart:d,classId:p,codestreamIndex:g,messageOffsetFromDatabinStart:x,messageBodyLength:y};return I&&(C.aux=E),C},getInt32:function(e,t){var n=16777216*e[t],i=e[t+1]<<16,a=e[t+2]<<8,s=e[t+3];return n+i+a+s},getInt16:function(e,t){var n=e[t]<<8,i=e[t+1];return n+i}};e.exports=a},function(e,t,n){'use strict';var a=n(0);e.exports=function(e,t,n){function i(){var e=p.length+d.length;return e}function s(e){var n=t.getDataRequestUrl(),i=t.getTargetId();'0'!==i&&(n+='&tid='+i);var a=null!==l;if(a){var s=u&&e;n+=s?'&wait=no':'&wait=yes'}return n}function r(e,n){var i=s(!0),a=t.getCodestreamStructure(),r=a.getLevelWidth(e.level),o=a.getLevelHeight(e.level),l=e.maxXExclusive-e.minX,c=e.maxYExclusive-e.minY;return i+='&fsiz='+r+','+o+',closest&rsiz='+l+','+c+'&roff='+e.minX+','+e.minY,'max'!==n&&(i+='&layers='+n),i}var o=this,l=null,c=0,d=[],p=[],u=!1;this.requestData=function(s,c,g,f){if(!u){var m=i();if(m>=e)throw new a.jpipExceptions.InternalErrorException('Channel has too many requests not responded yet')}var x=r(s,f),h=n.createRequest(t,o,x,c,g);return null!=l||0===p.length?(p.push(h),h.startRequest()):u?d=[h]:d.push(h),h},this.sendMinimalRequest=function(e){if(null==l&&0<p.length)throw new a.jpipExceptions.InternalErrorException('Minimal requests should be used for first request or keep alive message. Keep alive requires an already initialized channel, and first request requires to not have any previous request');var i=s(),r=n.createRequest(t,o,i,e);p.push(r),r.startRequest()},this.getIsDedicatedForMovableRequest=function(){return u},this.dedicateForMovableRequest=function(){if(u)throw new a.jpipExceptions.InternalErrorException('Channel already dedicated for movable request');u=!0},this.getChannelId=function(){return l},this.setChannelId=function(e){if(null!==e){l=e;var t=d;d=[];for(var n=0;n<t.length;++n)p.push(t[n]),t[n].startRequest()}},this.nextRequestId=function(){return++c},this.getRequestsWaitingForResponse=function(){return p},this.getAllQueuedRequestCount=i,this.requestEnded=function(e,n){for(var s=p,r=!1,c=0;c<s.length;++c)if(s[c]===n){s[c]=s[s.length-1],s.length-=1,r=!0;break}if(!r)throw new a.jpipExceptions.InternalErrorException('channel.requestsWaitingForResponse inconsistency');if(t.requestEnded(e,o),null===l&&0<d.length){var i=d.shift();p.push(i),i.startRequest()}},this.isAllOldRequestsEnded=function(e){for(var t=0;t<p.length;++t)if(p[t].lastRequestId<=e)return!1;return!0}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function a(e,t,n,a){var r=s(g,e,t,n,a);if(null===r)return null;var o=new Uint8Array(r),l=s(o,e,t,n,a);if(l===r)return o;if(null===l)return null;throw new i.jpipExceptions.InternalErrorException('JpipCodestreamReconstructor: Unmatched actualLength '+l+' and calculatedLength '+r)}function s(e,n,a,s,l){var c=r(e,n.level);if(null===c)return null;for(var d=0,u=n.getTileIterator();u.tryAdvance();){var g=u.tileIndex,f=o(e,c,d++,u,n.level,a,s,l);if(c+=f,null===f)return null}var m=p(e,c,i.j2kMarkers.EndOfCodestream);return c+=m,t.modifyImageSize(e,n.fullTilesSize),null===e?null:c}function r(n,a){if(e.getIsJpipTilePartStream())throw new i.jpipExceptions.UnsupportedFeatureException('reconstruction of codestream from JPT (Jpip Tile-part) stream','A.3.4');var s=e.getMainHeaderDatabin(),r=s.copyBytes(n,0,{forceCopyAllRange:!0});if(null===r)return null;var o=t.modifyMainOrTileHeader(n,s,0,a);return r+=o,o=d(n,r),r+=o,r}function o(n,i,a,s,r,o,d,p){var u=s.tileIndex,g=i,f=e.getTileHeaderDatabin(u),m=l(n,i,f,a,r);if(null===m)return null;if(i=m.endTileHeaderOffset,!p){var x=c(n,i,s,o,d);if(i+=x,null===x)return null}var h=i,y=h-m.startOfTileHeaderOffset;t.modifyInt32(n,m.headerAndDataLengthPlaceholderOffset,y);return h-g}function l(e,n,a,s,r){var o=n,l=p(e,n,i.j2kMarkers.StartOfTile);n+=l;l=p(e,n,[0,10]),n+=l;l=p(e,n,[s>>>8,255&s]),n+=l;var c=n;l=p(e,n,[0,0,0,0]),n+=l;l=p(e,n,[0]),n+=l;l=p(e,n,[1]),n+=l;var d=n;if(l=a.copyBytes(e,n,{forceCopyAllRange:!0}),n+=l,null===l)return null;var u=[,,],g=a.getDatabinLengthIfKnown();a.copyBytes(u,0,{databinStartOffset:g-2});var f=u[0]===i.j2kMarkers.StartOfData[0]&&u[1]===i.j2kMarkers.StartOfData[1];f||(l=p(e,n,i.j2kMarkers.StartOfData),n+=l);var m=t.modifyMainOrTileHeader(e,a,d,r);n+=m;var x={startOfTileHeaderOffset:o,headerAndDataLengthPlaceholderOffset:c,endTileHeaderOffset:n};return x}function c(t,a,s,r,o){var l=s.tileStructure.getNumQualityLayers(),c=0;'max'===r&&(r=l);for(var d=s.createPrecinctIterator(!0);d.tryAdvance();){var p=l;if(d.isInCodestreamPart){var u=s.tileStructure.precinctPositionToInClassIndex(d),g=e.getPrecinctDatabin(u),f=n.getQualityLayerOffset(g,o,d),m=f.endOffset;if(p=l-f.numQualityLayers,f.numQualityLayers<r)return null;var x=g.copyBytes(t,a,{forceCopyAllRange:!0,maxLengthToCopy:m});null===x&&(x=0,p=l),c+=x,a+=x}if(!t.isDummyBufferForLengthCalculation)for(var h=0;h<p;++h)t[a++]=0;c+=p}return c}function d(e,t){var n=t;u(e,t++,255),u(e,t++,100),u(e,t++,0),u(e,t++,9),u(e,t++,77),u(e,t++,97),u(e,t++,109),u(e,t++,97),u(e,t++,122),u(e,t++,97),u(e,t++,118);var i=t-n;return i}function p(e,t,n){if(!e.isDummyBufferForLengthCalculation)for(var a=0;a<n.length;++a)e[a+t]=n[a];return n.length}function u(e,t,n){e.isDummyBufferForLengthCalculation||(e[t]=n)}var g={isDummyBufferForLengthCalculation:!0};this.createCodestream=function(e,t,n){return a(e,t,n)},this.createHeadersCodestream=function(e){var t=1;return a(e,t,t,!0)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function a(e,t,n){if(0>t||t>=n)throw new i.jpipExceptions.ArgumentException(e,t,e+' is expected to be between 0 and '+n-1)}function s(t){if(!u){var n=e.parseDefaultTileParams();u=[,,,];for(var i=0;3>i;++i){u[i]=[,,,];for(var a=0,s;3>a;++a)s={horizontalEdgeType:i,verticalEdgeType:a},u[i][a]=r(n,s)}}var o=u[t.horizontalEdgeType],l=o[t.verticalEdgeType];return l}function r(e,a){o();var s=JSON.parse(JSON.stringify(e));s.tileSize=p.getTileSize(a),s.defaultComponentParams.scaleX=1,s.defaultComponentParams.scaleY=1;for(var r=0;r<s.paramsPerComponent.length;++r)s.paramsPerComponent[r].scaleX=d.componentsScaleX[r],s.paramsPerComponent[r].scaleY=d.componentsScaleY[r];var i=t.createTileStructure(s,l,n);return i}function o(){d||(d=e.parseCodestreamStructure(),p=t.createLevelCalculator(d))}var l=this,c=[],d,p,u;return this.getSizesParams=function(){return o(),d},this.getNumTilesX=function(){o();var e=p.getNumTilesX();return e},this.getNumTilesY=function(){o();var e=p.getNumTilesY();return e},this.getNumComponents=function(){return o(),d.numComponents},this.getImageWidth=function(){o();var e=p.getLevelWidth();return e},this.getImageHeight=function(){o();var e=p.getLevelHeight();return e},this.getLevelWidth=function(e){o();var t=p.getLevelWidth(e);return t},this.getLevelHeight=function(e){o();var t=p.getLevelHeight(e);return t},this.getTileWidth=function(e){o();var t=p.getTileWidth(e);return t},this.getTileHeight=function(e){o();var t=p.getTileHeight(e);return t},this.getFirstTileOffsetX=function(){o();var e=p.getFirstTileOffsetX();return e},this.getFirstTileOffsetY=function(){o();var e=p.getFirstTileOffsetY();return e},this.getTileLeft=function(e,t){o();var n=e%p.getNumTilesX();if(0==n)return 0;var i=(n-1)*p.getTileWidth(t)+p.getFirstTileWidth(t);return i},this.getTileTop=function(e,t){o();var n=Math.floor(e/p.getNumTilesX());if(0===n)return 0;var i=(n-1)*p.getTileHeight(t)+p.getFirstTileHeight(t);return i},this.getDefaultTileStructure=function(){o();var e=s({horizontalEdgeType:p.EDGE_TYPE_NO_EDGE,verticalEdgeType:p.EDGE_TYPE_NO_EDGE});return e},this.getTileStructure=function(t){o();var n=p.getNumTilesX()*p.getNumTilesY()-1;if(0>t||t>n)throw new i.jpipExceptions.ArgumentException('tileId',t,'Expected value between 0 and '+n);var a=p.isEdgeTileId(t);if(void 0===c[t]){var l=e.parseOverridenTileParams(t);c[t]=l?r(l,a):null}if(c[t])return c[t];var d=s(a);return d},this.tilePositionToInClassIndex=function(e){o();var t=p.getNumTilesX(),n=p.getNumTilesY();a('tilePosition.tileX',e.tileX,t),a('tilePosition.tileY',e.tileY,n);var i=e.tileX+e.tileY*t;return i},this.tileInClassIndexToPosition=function(e){o();var t=p.getNumTilesX(),n=p.getNumTilesY();a('inClassIndex',e,t*n);var i=e%t;return{tileX:i,tileY:(e-i)/t}},this.getTilesFromPixels=function(e){return o(),p.getTilesFromPixels(e)},this.getSizeOfTiles=function(e){o();var t=p.getSizeOfTiles(e);return t},this}},function(e,t,n){'use strict';var i=Math.floor,a=Math.ceil,s=n(0);e.exports=function(e,t){function n(e,t,n){var i=o(n),s=t[n],r=a(e/i/s);return r}function r(e,t,n,i,s){var r=o(e.resolutionLevel),l=a(s/r),c=t*i[e.resolutionLevel],d=Math.min(i[e.resolutionLevel],l-c),p=0===e.resolutionLevel?1:2,u=a(d/p),g=p*a(u/n);return 1==d%n&&0<e.resolutionLevel&&--g,g}function o(t){var n=e.numResolutionLevels-t-1;return 1<<n}var l,c;(function(){if(1!==e.scaleX||1!==e.scaleY)throw new s.j2kExceptions.UnsupportedFeatureException('Non 1 component scale','A.5.1');l=i(t.getTileWidth()/e.scaleX),c=i(t.getTileHeight()/e.scaleY)})(),this.getComponentScaleX=function(){return e.scaleX},this.getComponentScaleY=function(){return e.scaleY},this.getNumResolutionLevels=function(){return e.numResolutionLevels},this.getPrecinctWidth=function(t){var n=e.precinctWidthPerLevel[t];return n},this.getPrecinctHeight=function(t){var n=e.precinctHeightPerLevel[t];return n},this.getMaxCodeblockWidth=function(){var t=e.maxCodeblockWidth;return t},this.getMaxCodeblockHeight=function(){var t=e.maxCodeblockHeight;return t},this.getNumCodeblocksXInPrecinct=function(t){var n=r(t,t.precinctX,e.maxCodeblockWidth,e.precinctWidthPerLevel,l);return n},this.getNumCodeblocksYInPrecinct=function(t){var n=r(t,t.precinctY,e.maxCodeblockHeight,e.precinctHeightPerLevel,c);return n},this.getNumPrecinctsX=function(t){var i=n(l,e.precinctWidthPerLevel,t);return i},this.getNumPrecinctsY=function(t){var i=n(c,e.precinctHeightPerLevel,t);return i}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e){function t(t,n){if(t===void 0||n===void 0)throw new i.jpipExceptions.InternalErrorException('minOffset or maxOffset is undefined for CompositeArray.copyToArray');if(t<e)throw new i.jpipExceptions.InternalErrorException('minOffset ('+t+') must be smaller than CompositeArray offset ('+e+')');if(n>e+r)throw new i.jpipExceptions.InternalErrorException('maxOffset ('+n+') must be larger than CompositeArray end offset ('+e+r+')')}function n(t,n){var s=Math.max(e,t),o=e+r;if(void 0!==n&&(o=Math.min(o,n)),s>=o){return{internalIteratorData:{isEndOfRange:!0}}}var l={subArray:null,offset:-1,internalIteratorData:{end:o,currentSubArray:null,currentInternalPartOffset:null,nextInternalPartOffset:e,currentInternalPartIndex:-1,isEndOfRange:!1}},c=!1;do{if(c)throw new i.jpipExceptions.InternalErrorException('Iterator reached to the end although no data has been iterated');c=!a(l)}while(s>=l.internalIteratorData.nextInternalPartOffset);var d=s-l.internalIteratorData.currentInternalPartOffset;return l.internalIteratorData.currentSubArray=l.internalIteratorData.currentSubArray.subarray(d),l.internalIteratorData.currentInternalPartOffset=s,l}function a(e){var t=e.internalIteratorData;if(t.isEndOfRange)return!1;if(e.subArray=t.currentSubArray,e.offset=t.currentInternalPartOffset,++t.currentInternalPartIndex,t.nextInternalPartOffset>=t.end)return t.isEndOfRange=!0,!0;s(t.currentInternalPartIndex),t.currentSubArray=o[t.currentInternalPartIndex],t.currentInternalPartOffset=t.nextInternalPartOffset;var n=o[t.currentInternalPartIndex].length;t.nextInternalPartOffset=t.currentInternalPartOffset+n;var i=t.end-t.currentInternalPartOffset,a=i<t.currentSubArray.length;return a&&(t.currentSubArray=t.currentSubArray.subarray(0,i)),!0}function s(e){if(e>=o.length)throw new i.jpipExceptions.InternalErrorException('CompositeArray: end of part has reached. Check end calculation')}var r=0,o=[];this.getLength=function(){return r},this.getOffset=function(){return e},this.pushSubArray=function(e){o.push(e),r+=e.length},this.copyToOtherAtTheEnd=function(e,i,s){t(i,s);for(var r=n(i,s);a(r);)e.pushSubArray(r.subArray)},this.copyToTypedArray=function(e,i,s,r){t(s,r);for(var o=n(s,r);a(o);){var l=o.offset-i;e.set(o.subArray,l)}},this.copyToArray=function(e,i,s,r){t(s,r);for(var o=n(s,r);a(o);)for(var l=o.offset-i,c=0;c<o.subArray.length;++c)e[l++]=o.subArray[c]},this.copyToOther=function(t){if(t.getOffset()>e)throw new i.jpipExceptions.InternalErrorException('CompositeArray: Trying to copy part into a latter part');var s=t.getOffset()+t.getLength(),o=e+r<=s;if(!o){var l=s,c=n(l);if(!a(c))throw new i.jpipExceptions.InternalErrorException('CompositeArray: Could not merge parts');var d=l;do{if(c.offset!==d)throw new i.jpipExceptions.InternalErrorException('CompositeArray: Non-continuous value of rangeToCopy.offset. Expected: '+d+', Actual: '+c.offset);t.pushSubArray(c.subArray),d+=c.subArray.length}while(a(c))}}}},function(e){'use strict';var t=Math.min;e.exports=function(e,n,a){function i(e,t){var n=!1,i=0,a;if(void 0!==t&&(n=!!t.forceCopyAllRange,i=t.databinStartOffset,a=t.maxLengthToCopy,void 0===i&&(i=0)),void 0===e&&(e=0),0===a)return{resultWithoutCopy:0};if(null!==d&&i>=d)return{resultWithoutCopy:!!a&&n?null:0};var r=o(i);if(r===c.length)return{resultWithoutCopy:n?null:0};if(n){var l=s(i,a,r);if(!l)return{resultWithoutCopy:null}}var p={databinStartOffset:i,maxLengthToCopy:a,resultStartOffset:e};return p}function s(e,t,n){if(c[n].getOffset()>e)return!1;if(t){var i=e-c[n].getOffset(),a=c[n].getLength()-i;return a>=t}if(null===d||n<c.length-1)return!1;var s=c[c.length-1],r=s.getOffset()+s.getLength(),o=r===d;return o}function r(e,n,a){var s;if(void 0!==n)s=e+n;else{var r=c[c.length-1];s=r.getOffset()+r.getLength()}for(var o=null,l=0;l<c.length&&!(c[l].getOffset()>=s);++l){var i=Math.max(e,c[l].getOffset()),d=t(s,c[l].getOffset()+c[l].getLength());a(c[l],i,d),o=c[l]}if(null===o)return 0;var p=t(o.getOffset()+o.getLength(),s);return p-e}function o(e){var t;for(t=0;t<c.length&&!(c[t].getOffset()+c[t].getLength()>e);++t);return t}var l=this,c=[],d=null,p=0,u=[];return this.getDatabinLengthIfKnown=function(){return d},this.getLoadedBytes=function(){return p},this.isAllDatabinLoaded=function(){var e;switch(c.length){case 0:e=0===d;break;case 1:e=0===c[0].getOffset()&&c[0].getLength()===d;break;default:e=!1;}return e},this.getCachedData=function(e){var t=u[e];return void 0===t&&(t={},u[e]=t),t},this.getClassId=function(){return e},this.getInClassId=function(){return n},this.copyToCompositeArray=function(e,t){var n=i(0,t);if(void 0!==n.resultWithoutCopy)return n.resultWithoutCopy;var a=r(n.databinStartOffset,n.maxLengthToCopy,function(t,n,i){t.copyToOtherAtTheEnd(e,n,i)});return a},this.copyBytes=function(e,t,n){var a=i(t,n);if(void 0!==a.resultWithoutCopy)return a.resultWithoutCopy;var s=a.databinStartOffset-a.resultStartOffset,o=e.isDummyBufferForLengthCalculation?function(){}:function(t,n,i){t.copyToArray(e,s,n,i)},l=r(a.databinStartOffset,a.maxLengthToCopy,o);return l},this.getExistingRanges=function(){for(var e=Array(c.length),t=0;t<c.length;++t)e[t]={start:c[t].getOffset(),length:c[t].getLength()};return e},this.addData=function(e,t){if(e.isLastByteInDatabin&&(d=e.messageOffsetFromDatabinStart+e.messageBodyLength),0!==e.messageBodyLength){var n=a.createCompositeArray(e.messageOffsetFromDatabinStart),s=e.bodyStart+e.messageBodyLength;n.pushSubArray(t.subarray(e.bodyStart,s));var r=o(e.messageOffsetFromDatabinStart),l=r;if(0<r){var u=c[r-1],g=u.getOffset()+u.getLength();g===e.messageOffsetFromDatabinStart&&--l}if(l>=c.length)return c.push(n),void(p+=e.messageBodyLength);var f=c[l],m=e.messageOffsetFromDatabinStart+e.messageBodyLength;if(f.getOffset()>m){for(var x=c.length;x>l;--x)c[x]=c[x-1];return c[l]=n,void(p+=e.messageBodyLength)}var i=f.getLength(),h=f.getOffset()>e.messageOffsetFromDatabinStart;h&&(c[l]=n,n=f,f=c[l]),n.copyToOther(f);var y=f.getOffset()+f.getLength(),I;for(I=l;I<c.length-1&&!(y<c[I+1].getOffset());++I)i+=c[I+1].getLength();var E=I-l;if(0<E){c[I].copyToOther(f);for(var b=l+1;b<c.length-E;++b)c[b]=c[b+E];c.length-=E}p+=f.getLength()-i}},this}},function(e,t,n){'use strict';var a=n(0);e.exports=function(e,t){function n(e,t){if(0!==e.inClassId)throw new a.jpipExceptions.IllegalDataException('Main header data-bin with in-class index other than zero is not valid','A.3.5');var n=h.getLoadedBytes();h.addData(e,t);var i=h.getLoadedBytes()-n;m+=i,x+=i}function s(){}function r(n,i,s,r,o){if(r!==e)throw new a.jpipExceptions.WrongStreamException('databin of type '+o,e);var l=n.databins[s];return l||(l=t.createDatabinParts(i,s),n.databins[s]=l),l}function i(){return{databins:[],listeners:[],databinsWithListeners:[]}}var o=0,l=1,c=2,d=4,p=5,u=[],g=[],f=[],m=0,x=0;u[c]=i(),u[o]=i(),u[l]=u[o],f[c]=!0,f[o]=!0,f[l]=!0,u[d]=i(),u[p]=u[d],g[d]=!0,g[p]=!0;var h=t.createDatabinParts(6,0);return this.getIsJpipTilePartStream=function(){return e},this.getLoadedBytes=function(){return m},this.getMainHeaderDatabin=function(){return h},this.getTileHeaderDatabin=function(e){var t=r(u[c],c,e,!1,'tileHeader');return t},this.getPrecinctDatabin=function(e){var t=r(u[o],o,e,!1,'precinct');return t},this.getTileDatabin=function(e){var t=r(u[d],d,e,!0,'tilePart');return t},this.addEventListener=function(e,t,n,i){if('dataArrived'!==t)throw new a.jpipExceptions.InternalErrorException('Unsupported event: '+t);var s=e.getClassId(),r=e.getInClassId(),o=u[s];if(e!==o.databins[r])throw new a.jpipExceptions.InternalErrorException('Unmatched databin with class-ID='+s+' and in-class-ID='+r);void 0===o.listeners[r]&&(o.listeners[r]=[]),0===o.listeners[r].length&&(x+=e.getLoadedBytes());var l={listener:n,listenerThis:i,databin:e,isRegistered:!0,index:o.listeners[r].length};return o.listeners[r].push(l),o.databinsWithListeners[r]=e,l},this.removeEventListener=function(e){var t=e.databin.getClassId(),n=e.databin.getInClassId(),i=u[t],s=i.listeners[n];if(e.databin!==i.databins[n]||e.databin!==i.databinsWithListeners[n])throw new a.jpipExceptions.InternalErrorException('Unmatched databin with class-ID='+t+' and in-class-ID='+n);if(e!==s[e.index])throw new a.jpipExceptions.InternalErrorException('Incosnsitency in databin listeners indices');s[e.index].isRegistered=!1,s[e.index]=s[s.length-1],s[s.length-1].index=e.index,s.length-=1,0===s.length&&(delete i.databinsWithListeners[n],x-=e.databin.getLoadedBytes())},this.cleanupUnregisteredDatabins=function(){for(var e=0;e<u.length;++e)if(void 0!==u[e]){var t=u[e].databinsWithListeners;u[e].databins=t.slice()}m=x},this.saveData=function(e,t){if(0!==e.codestreamIndex)throw new a.jpipExceptions.UnsupportedFeatureException('Non zero Csn (Code Stream Index)','A.2.2');switch(e.classId){case 6:n(e,t);break;case 8:s(e,t);break;default:var o=u[e.classId];if(void 0===o)break;var l=!!g[e.classId],c=r(o,e.classId,e.inClassId,l,'<class ID '+e.classId+'>'),d=c.getLoadedBytes();c.addData(e,t);var p=c.getLoadedBytes()-d;m+=p;var f=o.listeners,h=f[e.inClassId];if(void 0!==h&&0<h.length){x+=p;for(var y=h.slice(),I=0,i;I<y.length;++I)i=y[I],i.isRegistered&&i.listener.call(i.listenerThis,c)}}},this}},function(e,t,n){'use strict';e.exports=function(e,t,n){function a(){if(g>=n.length)throw new i.jpipExceptions.IllegalOperationException('Unexpected requestData() after fetch done');if(null!=c&&null===l)throw new i.jpipExceptions.IllegalOperationException('Cannot resume already-active-fetch');if(d)throw new i.jpipExceptions.IllegalOperationException('Cannot resume already-terminated-fetch');setTimeout(function(){g>=n.length||null!=c||d||(u=p?g:n.length-1,c=t.requestData(o,s,r,n[u].minNumQualityLayers,l))})}function s(t,i){c=null;i&&(g=u,g>=n.length&&e.done())}function r(){}var o=null,l=null,c=null,d=!1,p=!1,u=0,g=0;this.setDedicatedChannelHandle=function(e){l=e},this.move=function(e){if(null===l&&null!=o)throw new i.jpipExceptions.IllegalOperationException('Cannot move non movable fetch');o=e,a()},this.resume=function(){a()},this.stop=function(){if(null==c){if(d)throw new i.jpipExceptions.IllegalOperationException('Cannot stop already terminated fetch');throw new i.jpipExceptions.IllegalOperationException('Cannot stop already stopped fetch')}return l||(t.stopRequestAsync(c),c=null),e.stopped()},this.terminate=function(){if(l)throw new i.jpipExceptions.IllegalOperationException('Unexpected terminate event on movable fetch');if(d)throw new i.jpipExceptions.IllegalOperationException('Double terminate event');c=null,d=!0},this.isProgressiveChanged=function(e){p=e,l&&null!=c&&(c=null,a())}};var i=n(0)},function(e,t,n){'use strict';n(0);e.exports=function(e,t,n){function i(e,t){var i=n.createFetch(e,g,t);return e.on('isProgressiveChanged',i.isProgressiveChanged),e.on('terminate',i.terminate),e.on('stop',i.stop),e.on('resume',i.resum),i}t=t||{};var a=null,s=null,r=t.maxChannelsInSession||1,o=t.maxRequestsWaitingForResponseInChannel||1,l=e.getMainHeaderDatabin(),c=n.createMarkersParser(l),d=n.createOffsetsCalculator(l,c),p=n.createStructureParser(e,c,d),u=n.createCodestreamStructure(p,'RPCL'),g=n.createReconnectableRequester(r,o,u,e),f=n.createRequestParamsModifier(u);return g.setStatusCallback(function(e){var t=null;null!==e.exception&&(t=e.exception.toString());var n={isReady:e.isReady,exception:t};if(!a||!n.isReady&&!n.exception){if(n.exception)try{console.error('JpipFetcher.requesterStatusCallback got unexpected exception: '+n.exception)}catch(t){}return}var i=a,r=s;if(a=null,s=null,!n.isReady)return void r(n.exception);var o=u.getSizesParams(),l=JSON.parse(JSON.stringify(o)),c=u.getDefaultTileStructure(),d=c.getDefaultComponentStructure();l.imageLevel=0,l.lowestQuality=1,l.highestQuality=c.getNumQualityLayers(),l.numResolutionLevelsForLimittedViewer=d.getNumResolutionLevels(),i(l)}),this.open=function(e){return new Promise(function(t,n){a=t,s=n,g.open(e)})},this.close=function(){return new Promise(function(e){g.close(e)})},this.on=function(){},this.startFetch=function(e,t){var n=f.modify(t),a=i(e,n.progressiveness);a.move(n.codestreamPartParams)},this.startMovableFetch=function(e,t){var n=f.modify(t),a=i(e,n.progressiveness),s=g.dedicateChannelForMovableRequest();a.setDedicatedChannelHandle(s),e.on('move',a.move),a.move(n.codestreamPartParams)},this.reconnect=function(){g.reconnect()},this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(t,n,i){var a=e.getCodingStyleOffset(n);if(null!==a){t[i+a+5]=r}}function a(e,t,n){if(0===t.length)return 0;if(!e.isDummyBufferForLengthCalculation)for(var a=0;a<t.length;++a){var i=n+t[a].markerSegmentLengthOffset,s=(e[i]<<8)+e[i+1],r=s-t[a].length;e[i]=r>>>8,e[i+1]=255&r}for(var o=n+t[0].start,l=o,c=0;c<t.length;++c){l+=t[c].length;for(var d=c+1<t.length?n+t[c+1].start:e.length;l<d;++l)e[o]=e[l],++o}var p=l-o;return p}function s(e,t,n){e.isDummyBufferForLengthCalculation||(e[t++]=n>>>24,e[t++]=255&n>>>16,e[t++]=255&n>>>8,e[t++]=255&n)}var r=function(e){switch(e){case'LRCP':return 0;case'RLCP':return 1;case'RPCL':return 2;case'PCRL':return 3;case'CPRL':return 4;default:throw new i.j2kExceptions.IllegalDataException('Progression order of '+e,'A.6.1, table A.16');}}(t);this.modifyMainOrTileHeader=function(t,i,s,r){if(t.isDummyBufferForLengthCalculation||n(t,i,s),void 0===r)return 0;var o=e.getRangesOfBestResolutionLevelsData(i,r);if(null!==o.numDecompositionLevelsOffset&&!t.isDummyBufferForLengthCalculation){var l=s+o.numDecompositionLevelsOffset;t[l]-=r}var c=a(t,o.ranges,s);return-c},this.modifyImageSize=function(t,n){if(!t.isDummyBufferForLengthCalculation){var a=e.getImageAndTileSizeOffset(),r=a+i.j2kOffsets.REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER,o=r+8,l=r+16,c=r+24;s(t,r,n.regionWidth),s(t,r+4,n.regionHeight),s(t,l,n.tileWidth),s(t,l+4,n.tileHeight),s(t,o,0),s(t,o+4,0),s(t,c,0),s(t,c+4,0)}},this.modifyInt32=s}},function(e,t,n){'use strict';function i(e,t,n,i){this._codestreamPart=t,this._maxQuality=n,this._reconstructor=e.reconstructor,this._packetsDataCollector=e.packetsDataCollector,this._qualityLayersCache=e.qualityLayersCache,this._codestreamStructure=e.codestreamStructure,this._databinsSaver=e.databinsSaver,this._jpipFactory=e.jpipFactory,this._maxQualityPerPrecinct=[],this._registeredPrecinctDatabins=[],this._dataListeners=[],this._isDisposed=!1,this._isProgressive=!0,this._listener=this._jpipFactory.createQualityWaiter(this._codestreamPart,i,this._maxQuality,this._qualityLayerReachedCallback,this._codestreamStructure,this._databinsSaver,this._startTrackPrecinct,this),this._listener.register()}var a=n(0);e.exports=i,i.prototype.getProgressiveStagesFinished=function(){return this._ensureNotDisposed(),this._listener.getProgressiveStagesFinished()},i.prototype.getFetchedData=function(e){if(this._ensureNotDisposed(),0===this.getProgressiveStagesFinished())throw'JpipImageDataContext error: cannot call getFetchedData before getProgressiveStagesFinished() > 0';var t=this._listener.getQualityReached();if(e){if(e>t)throw'JpipImageDataContext error: getFetchedData called with quality higher than already reached';t=e}var n=this._packetsDataCollector.getAllCodeblocksData(this._codestreamPart,t,e),i=this._getCodestream(!0);if(null===n.codeblocksData)throw new a.jpipExceptions.InternalErrorException('Could not collect codeblocks although progressiveness stage has been reached');if(null===i)throw new a.jpipExceptions.InternalErrorException('Could not reconstruct codestream although progressiveness stage has been reached');return{headersCodestream:i,codeblocksData:n.codeblocksData,minQuality:t}},i.prototype.getFetchedDataAsCodestream=function(){return this._getCodestream(!1)},i.prototype.on=function(e,t){if(this._ensureNotDisposed(),'data'!==e)throw'JpipImageDataContext error: Unexpected event '+e;this._dataListeners.push(t)},i.prototype.isDone=function(){return this._ensureNotDisposed(),this._listener.isDone()},i.prototype.dispose=function(){this._ensureNotDisposed(),this._isDisposed=!0,this._listener.unregister(),this._listener=null;for(var e=0,t;e<this._registeredPrecinctDatabins.length;++e)t=this._registeredPrecinctDatabins[e],this._databinsSaver.removeEventListener(t)},i.prototype.setIsProgressive=function(e){this._ensureNotDisposed();var t=this._isProgressive;if(this._isProgressive=e,!t&&e&&0<this.getProgressiveStagesFinished())for(var n=0;n<this._dataListeners.length;++n)this._dataListeners[n](this)},i.prototype._getCodestream=function(e){this._ensureNotDisposed();var t=this._listener.getQualityReached(),n;if(n=e?this._reconstructor.createHeadersCodestream(this._codestreamPart):this._reconstructor.createCodestream(this._codestreamPart,t,this._maxQuality),null===n)throw new a.jpipExceptions.InternalErrorException('Could not reconstruct codestream although progressiveness stage has been reached');return n},i.prototype._startTrackPrecinct=function(e,t,n){var i=e.getInClassId();this._maxQualityPerPrecinct[i]=t;var a=this._databinsSaver.addEventListener(e,'dataArrived',this._precinctDataArrived,this);this._registeredPrecinctDatabins.push(a),this._precinctDataArrived(e,n)},i.prototype._precinctDataArrived=function(e,t){var n=e.getInClassId(),i=this._maxQualityPerPrecinct[n],a=this._qualityLayersCache.getQualityLayerOffset(e,i,t);this._listener.precinctQualityLayerReached(n,a.numQualityLayers)},i.prototype._qualityLayerReachedCallback=function(){if(this._isProgressive||this._listener.isDone())for(var e=0;e<this._dataListeners.length;++e)this._dataListeners[e](this)},i.prototype._ensureNotDisposed=function(){if(this._isDisposed)throw new a.jpipExceptions.IllegalOperationException('Cannot use ImageDataContext after disposed')}},function(e,t,n){'use strict';var i=Math.floor,a=Math.ceil,s=Math.max,r=Math.min,o=n(0),l=0.6931471805599453;e.exports=function(e){function t(e){var t=e.level,i=m(t),a=x(t),s=e.minTileX+e.minTileY*p(),r=e.maxTileXExclusive-1+(e.maxTileYExclusive-1)*p(),o=d(s),l=d(r),c=n(o,t),u=n(l,t),g=c.width,f=c.height,h=e.maxTileXExclusive-e.minTileX,y=e.maxTileYExclusive-e.minTileY;return 1<h&&(g+=u.width,g+=i*(h-2)),1<y&&(f+=u.height,f+=a*(y-2)),{regionWidth:g,regionHeight:f,tileWidth:i,tileHeight:a}}function n(e,t){var n=c(e.horizontalEdgeType,I,g,m),i=c(e.verticalEdgeType,E,f,x);if(void 0!==t){var s=1<<t;n=a(n/s),i=a(i/s)}return{width:n,height:i}}function c(e,t,n,i){var a;switch(e){case C:a=t();break;case P:var s=i(),r=n()-t();a=r%s,0===a&&(a=s);break;case b:a=i();break;default:throw new o.jpipExceptions.InternalErrorException('Unexpected edge type: '+e);}return a}function d(e){var t=p(),n=u(),a=e%t,s=i(e/t);if(s>n||0>a||0>s)throw new o.jpipExceptions.InternalErrorException('Tile index '+e+' is not in range');var r=0==a?C:a==t-1?P:b,l=0===s?C:s===n-1?P:b;return{horizontalEdgeType:r,verticalEdgeType:l}}function p(){var t=a(e.imageWidth/e.tileWidth);return t}function u(){var t=a(e.imageHeight/e.tileHeight);return t}function g(n){if(void 0===n)return e.imageWidth;var i=t({minTileX:0,maxTileXExclusive:p(),minTileY:0,maxTileYExclusive:1,level:n});return i.regionWidth}function f(n){if(void 0===n)return e.imageHeight;var i=t({minTileX:0,maxTileXExclusive:1,minTileY:0,maxTileYExclusive:u(),level:n});return i.regionHeight}function m(t){if(void 0===t)return e.tileWidth;var n=a(e.tileWidth/(1<<t));return n}function x(t){if(void 0===t)return e.tileHeight;var n=a(e.tileHeight/(1<<t));return n}function h(){return e.firstTileOffsetX}function y(){return e.firstTileOffsetY}function I(e){var t=m()-h(),n=g();t>n&&(t=n);var i=a(t/(1<<e));return i}function E(e){var t=x()-y(),n=f();t>n&&(t=n);var i=a(t/(1<<e));return i}var b=0,C=1,P=2;return this.EDGE_TYPE_NO_EDGE=b,this.EDGE_TYPE_FIRST=C,this.EDGE_TYPE_LAST=P,this.getTilesFromPixels=function(e){var t=e.level,n=m(t),o=x(t),l=I(t),c=E(t),d=e.minX,g=e.minY,f=e.maxXExclusive,h=e.maxYExclusive,y=s(0,1+(d-l)/n),b=s(0,1+(g-c)/o),C=r(p(),1+(f-l)/n),P=r(u(),1+(h-c)/o),T={level:t,minTileX:i(y),minTileY:i(b),maxTileXExclusive:a(C),maxTileYExclusive:a(P)};return T},this.getNumTilesX=p,this.getNumTilesY=u,this.getTileWidth=m,this.getTileHeight=x,this.getFirstTileOffsetX=h,this.getFirstTileOffsetY=y,this.getFirstTileWidth=I,this.getFirstTileHeight=E,this.isEdgeTileId=d,this.getTileSize=n,this.getLevelWidth=g,this.getLevelHeight=f,this.getImageLevel=function(){return 0},this.getLevel=function(t){var n=Math.log;if(void 0===e.numResolutionLevelsForLimittedViewer)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';var i=n((t.maxXExclusive-t.minX)/t.screenWidth)/l,o=n((t.maxYExclusive-t.minY)/t.screenHeight)/l,c=a(s(i,o));return c=s(0,r(e.numResolutionLevelsForLimittedViewer-1,c)),c},this.getNumResolutionLevelsForLimittedViewer=function(){if(void 0===e.numResolutionLevelsForLimittedViewer)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';return e.numResolutionLevelsForLimittedViewer},this.getLowestQuality=function(){return 1},this.getHighestQuality=function(){if(void 0===e.highestQuality)throw'This method is available only when jpipSizesCalculator is created from params returned by jpipCodestreamClient. It shall be used for JPIP API purposes only';return e.highestQuality},this.getSizeOfTiles=t,this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(e,t,n){var i=e[n]===t[0]&&e[n+1]===t[1];return i}function a(e,t){var n=s(e,!0),i=l(t,'Predefined marker in jGlobals.j2kMarkers'),a=n.markerToOffset[i];return void 0===a?null:a}function s(t,a){var s=t.getCachedData(c);if(void 0===s.markerToOffset&&(s.isParsedAllMarkers=!1,s.lastOffsetParsed=0,s.markerToOffset={},s.databin=t),s.isParsedAllMarkers)return s;var l=[],d=!0;if(t===e&&0===s.lastOffsetParsed){var p=t.copyBytes(l,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE});if(null===p)d=!1;else if(!n(l,i.j2kMarkers.StartOfCodestream,0))throw new i.j2kExceptions.IllegalDataException('SOC (Start Of Codestream) is not found where expected to be','A.4.1');s.lastOffsetParsed=2}return d&&r(s),o(s,a),s}function r(e){for(var n=e.lastOffsetParsed,a=[],s=e.databin.copyBytes(a,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE+i.j2kOffsets.LENGTH_FIELD_SIZE,databinStartOffset:n});null!==s;){var r=l(a,'offset '+n+' of databin with class ID = '+e.databin.getClassId()+' and in class ID = '+e.databin.getInClassId());e.markerToOffset[r.toString()]=n;var o=t.getInt16(a,i.j2kOffsets.MARKER_SIZE);n+=o+i.j2kOffsets.MARKER_SIZE,s=e.databin.copyBytes(a,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE+i.j2kOffsets.LENGTH_FIELD_SIZE,databinStartOffset:n})}e.lastOffsetParsed=n}function o(t,a){var s=t.databin.getDatabinLengthIfKnown();if(t.isParsedAllMarkers=t.lastOffsetParsed===s,!t.isParsedAllMarkers&&t.databin!==e){var r=[],o=t.databin.copyBytes(r,0,{forceCopyAllRange:!0,maxLengthToCopy:i.j2kOffsets.MARKER_SIZE,databinStartOffset:t.lastOffsetParsed});null!==o&&n(r,0,i.j2kMarkers.StartOfData)&&(t.lastOffsetParsed+=i.j2kOffsets.MARKER_SIZE,t.isParsedAllMarkers=!0)}if(a&&!t.isParsedAllMarkers)throw new i.jpipExceptions.InternalErrorException('data-bin with class ID = '+t.databin.getClassId()+' and in class ID = '+t.databin.getInClassId()+' was not recieved yet')}function l(e,t){if(255!==e[0])throw new i.j2kExceptions.IllegalDataException('Expected marker in '+t,'A');var n=e[1].toString(16);return n}var c='markers';this.getMandatoryMarkerOffsetInDatabin=function(e,t,n,s){var r=a(e,t);if(null===r)throw new i.j2kExceptions.IllegalDataException(n+' is not found where expected to be',s);return r},this.checkSupportedMarkers=function(e,t,n){n=!!n;for(var a=s(e,!0),r={},o=0,c;o<t.length;++o)c=l(t[o],'jpipMarkersParser.supportedMarkers['+o+']'),r[c]=!0;for(var d in a.markerToOffset){var p=!!r[d];if(p!==n)throw new i.j2kExceptions.UnsupportedFeatureException('Unsupported marker found: '+d,'unknown')}},this.getMarkerOffsetInDatabin=a,this.isMarker=n}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(e,t){var n=l(e,t);if(null===n)return null;var a=n+i.j2kOffsets.MARKER_SIZE,s=c(e,8,a),r=s[2],o=!(1&r),d=7,p=s[d],u=o?null:n+14;return{codingStyleDefaultOffset:n,isDefaultPrecinctSize:o,isStartOfPacketMarkerAllowed:!!(2&r),isEndPacketHeaderMarkerAllowed:!!(4&r),numResolutionLevels:p+1,precinctSizesOffset:u,numDecompositionLevelsOffset:a+d}}function a(e,t,n){if(!(null===t||t.isDefaultPrecinctSize)){var a=t.numResolutionLevels-n,s=t.precinctSizesOffset+a,r=t.codingStyleDefaultOffset+i.j2kOffsets.MARKER_SIZE;e.push({markerSegmentLengthOffset:r,start:s,length:n})}}function s(e,t){var n=c(e,1,t+4),a=31&n[0],s;switch(a){case 0:s=1;break;case 1:s=0;break;case 2:s=2;break;default:throw new i.j2kExceptions.IllegalDataException('Quantization style of '+a,'A.6.4');}return s}function r(e,n,a,r){var o=t.getMarkerOffsetInDatabin(n,i.j2kMarkers.QuantizationDefault);if(null!==o){var l=s(n,o);if(0!==l){var c=a.numResolutionLevels-r,d=o+i.j2kOffsets.MARKER_SIZE;e.push({markerSegmentLengthOffset:d,start:o+5+(1+3*(c-1))*l,length:3*r*l})}}}function o(e){var n=t.getMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleComponent);if(null!==n)throw new i.j2kExceptions.UnsupportedFeatureException('COC Marker (Coding Style Component)','A.6.2')}function l(e,n){o(e);var a;return a=n?t.getMandatoryMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleDefault,'COD (Coding style Default)','A.6.1'):t.getMarkerOffsetInDatabin(e,i.j2kMarkers.CodingStyleDefault),a}function c(e,t,n){var a=[],s=e.copyBytes(a,0,{forceCopyAllRange:!0,maxLengthToCopy:t,databinStartOffset:n});if(null===s)throw new i.jpipExceptions.InternalErrorException('Header data-bin has not yet recieved '+t+' bytes starting from offset '+n);return a}var d=[i.j2kMarkers.ImageAndTileSize,i.j2kMarkers.CodingStyleDefault,i.j2kMarkers.QuantizationDefault,i.j2kMarkers.Comment];this.getCodingStyleOffset=l,this.getCodingStyleBaseParams=n,this.getImageAndTileSizeOffset=function(){var n=t.getMandatoryMarkerOffsetInDatabin(e,i.j2kMarkers.ImageAndTileSize,'Image and Tile Size (SIZ)','A.5.1');return n},this.getRangesOfBestResolutionLevelsData=function(s,o){t.checkSupportedMarkers(s,d,!0);var l=null,c=n(s,!1),p=c;null===c?p=n(e,!0):l=c.numDecompositionLevelsOffset;var u=p.numResolutionLevels;if(u<=o)throw new i.jpipExceptions.InternalErrorException('numResolutionLevels ('+o+') <= COD.numResolutionLevels ('+u+')');var g=[];a(g,c,o),r(g,s,p,o);var f={ranges:g,numDecompositionLevelsOffset:l};return f}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function a(t,a,r,o){for(var l=0,c=t.getTileIterator(),d={packetDataOffsets:[],data:n.createCompositeArray(0),allRelevantBytesLoaded:0};c.tryAdvance();){var p=c.createPrecinctIterator(),u=c.tileStructure.getNumQualityLayers();if(void 0!==r&&'max'!==r&&(u=Math.min(u,r)),'max'===a)t.minNumQualityLayers=u;else if(a>u)throw new i.jpipExceptions.InternalErrorException('minQuality is larger than quality');for(;p.tryAdvance();){if(!p.isInCodestreamPart)throw new i.jpipExceptions.InternalErrorException('Unexpected precinct not in codestream part');var g=c.tileStructure.precinctPositionToInClassIndex(p),f=e.getPrecinctDatabin(g),m=o[g];void 0===m&&(m={layerPerCodeblock:[]},o[g]=m);var x=s(d,l,c.tileStructure,p,f,m,u);if(x<a)return null}++l}var h=new Uint8Array(d.data.getLength());return d.data.copyToTypedArray(h,0,0,d.data.getLength()),d.data=h,d}function s(e,n,a,s,r,o,l){var c,d;for(c=0;c<l;++c){var p=t.getPacketOffsetsByCodeblockIndex(r,c,s);if(null===p)break;d=p.headerStartOffset+p.headerLength;for(var u=p.codeblockBodyLengthByIndex.length,g=Array(u),f=!1,m=0,i;m<u;++m){if(i=o.layerPerCodeblock[m],void 0===i)i={layer:-1},o.layerPerCodeblock[m]=i;else if(i.layer>=c)continue;var x=p.codeblockBodyLengthByIndex[m],h=e.data.getLength(),y=r.copyToCompositeArray(e.data,{databinStartOffset:d,maxLengthToCopy:x.codeblockBodyLengthBytes,forceCopyAllRange:!0});if(y!==x.codeblockBodyLengthBytes){g.length=m,f=!0;break}i.layer=c,g[m]={start:h,end:h+x.codeblockBodyLengthBytes,codingpasses:x.codingPasses,zeroBitPlanes:x.zeroBitPlanes},d+=x.codeblockBodyLengthBytes}var I=a.precinctPositionToIndexInComponentResolution(s),E={tileIndex:n,r:s.resolutionLevel,p:I,c:s.component,l:c,codeblockOffsets:g};if(e.packetDataOffsets.push(E),f)break}return e.allRelevantBytesLoaded+=d,c}this.getAllCodeblocksData=function(e,t,n){var i=[],s=a(e,t,n,i);return{codeblocksData:s,alreadyReturnedCodeblocks:i}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n){function a(e){if(!e.isStarted)return s(),e.isStarted=!0,e.currentX=r.minTileX,e.currentY=r.minTileY,!0;if(e.currentY>=r.maxTileYExclusive)throw new i.jpipExceptions.InternalErrorException('Cannot advance tile iterator after end');if(++e.currentX,e.currentX<r.maxTileXExclusive)return!0;e.currentX=r.minTileX,++e.currentY;var t=e.currentY<r.maxTileYExclusive;return t}function s(){null!=r||(e?r=t.getTilesFromPixels(e):r={level:0,minTileX:0,minTileY:0,maxTileXExclusive:t.getNumTilesX(),maxTileYExclusive:t.getNumTilesY()})}var r=null,o=null;Object.defineProperty(this,'level',{get:function(){return e?e.level:0}}),Object.defineProperty(this,'fullTilesSize',{get:function(){return null==o&&(s(),o=t.getSizeOfTiles(r)),o}}),Object.defineProperty(this,'tilesBounds',{get:function(){return s(),r}}),this.getTileIterator=function(){var s={isStarted:!1,currentX:-1,currentY:-1},r={get tileIndex(){if(!s.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var e=t.getNumTilesX(),n=s.currentY*e,a=n+s.currentX;return a},get tileStructure(){if(!s.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var e=r.tileIndex,n=t.getTileStructure(e);return n},createPrecinctIterator:function(a){if(!s.isStarted)throw new i.jpipExceptions.InternalErrorException('iterator.tileIndex accessed before tryAdvance()');var o=r.tileIndex;return n.createParamsPrecinctIterator(t,o,e,a)},tryAdvance:function(){var e=a(s);return e}};return r}}},function(e,t,n){'use strict';var i=Math.floor,a=Math.ceil,s=Math.max,r=Math.min,o=n(0);e.exports=function(e,t,n,l){function c(){if(C=e.getTileStructure(t),!!n&&void 0!==n.level){var i=C.getMinNumResolutionLevelsOverComponents();if(i<=n.level)throw new o.jpipExceptions.InternalErrorException('Cannot advance resolution: level='+n.level+' but should be smaller than '+i)}if(E=d(),!l&&null!==E){var a=E[0][0];f=a.minPrecinctX,m=a.minPrecinctY}b=C.getProgressionOrder()}function d(){if(!n)return null;for(var o=e.getNumComponents(),l=Array(o),c=n.level||0,d=e.getTileLeft(t,c),p=e.getTileTop(t,c),u=n.minX-d,g=n.minY-p,f=n.maxXExclusive-d,m=n.maxYExclusive-p,x=0;x<o;++x){for(var h=C.getComponentStructure(x),y=h.getNumResolutionLevels(),I=y-c,E=h.getNumResolutionLevels(),b=Array(y),P=0;P<I;++P){var T=h.getComponentScaleX(),v=h.getComponentScaleY(),S=I-P-1,L=T<<S,O=v<<S,R=4,k=i(u/L)-R,D=i(g/O)-R,A=a(f/L)+R,_=a(m/O)+R,j=h.getPrecinctWidth(P)*T,N=h.getPrecinctHeight(P)*v,F=i(k/j),B=i(D/N),M=a(A/j),w=a(_/N),q=h.getNumPrecinctsX(P),X=h.getNumPrecinctsY(P);b[P]={minPrecinctX:s(0,F),minPrecinctY:s(0,B),maxPrecinctXExclusive:r(M,q),maxPrecinctYExclusive:r(w,X)}}l[x]=b}return l}function p(t,i){var a=C.getComponentStructure(g);switch(b[t]){case'R':var s=a.getNumResolutionLevels();return!!n&&n.level&&(s-=n.level),++x,x%=s,x;case'C':return++g,g%=e.getNumComponents(),g;case'P':var r,l,c,d;if(null!==i){var p=i[g],u=p[x];r=u.minPrecinctX,l=u.minPrecinctY,c=u.maxPrecinctXExclusive,d=u.maxPrecinctYExclusive}else r=0,l=0,c=a.getNumPrecinctsX(x),d=a.getNumPrecinctsY(x);return(f-=r-1,f%=c-r,f+=r,f!=r)?f-r:(m-=l-1,m%=d-l,m+=l,m-l);case'L':throw new o.jpipExceptions.InternalErrorException('Advancing L is not supported in JPIP');default:throw new o.jpipExceptions.InternalErrorException('Unexpected letter in progression order: '+b[t]);}}var u=!1,g=0,f=f,m=m,x=0,h=!0,y=-1,I=-1,E=null,b,C;return Object.defineProperty(this,'tileIndex',{get:function(){return t}}),Object.defineProperty(this,'component',{get:function(){return g}}),Object.defineProperty(this,'precinctX',{get:function(){return f}}),Object.defineProperty(this,'precinctY',{get:function(){return m}}),Object.defineProperty(this,'resolutionLevel',{get:function(){return x}}),Object.defineProperty(this,'isInCodestreamPart',{get:function(){return h}}),this.tryAdvance=function(){if(!u)return c(),u=!0,!0;var e=!0,t=l?null:E,n=!1;y=-1,I=-1;for(var a=2,i;0<=a&&(i=p(a,t),e=0===i,!!e);--a)'P'!==b[a]||l||(n=!0);if(e)return!1;if(null==E)return h=!0,!0;var s=E[g],r=s[x];return n&&(f=r.minPrecinctX,m=r.minPrecinctY),h=f>=r.minPrecinctX&&m>=r.minPrecinctY&&f<r.maxPrecinctXExclusive&&m<r.maxPrecinctYExclusive,!0},this}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,a,s,r,o){function l(e,t){if(0===t)throw new i.jpipExceptions.InternalErrorException('Cannot use '+e+' iterator before started');else if(1<t)throw new i.jpipExceptions.InternalErrorException('Cannot use '+e+' iterator after ended')}var c=null,d=null,p=function(){var e=t.getComponentStructure(a),n=e.getNumResolutionLevels();return n-s-1}();Object.defineProperty(this,'level',{get:function(){return p}}),Object.defineProperty(this,'fullTilesSize',{get:function(){if(null==c){var t=this.tilesBounds;c=e.getSizeOfTiles(t)}return c}}),Object.defineProperty(this,'tilesBounds',{get:function(){if(null==d){var t=e.getNumTilesX(),i=n%t,a=Math.floor(n/t);d={level:p,minTileX:i,minTileY:a,maxTileXExclusive:i+1,maxTileYExclusive:a+1}}return d}}),this.getTileIterator=function(){var e=0;return{get tileIndex(){return l('tile',e),n},get tileStructure(){return l('tile',e),t},tryAdvance:function(){if(2<e)throw new i.jpipExceptions.InternalErrorException('Cannot advance tile iterator after ended');return++e,2>e},createPrecinctIterator:function(t){if(l('tile',e),t)throw new i.jpipExceptions.InternalErrorException('Precinct iterator of single precinct part cannot iterate precincts out of part');var c=0;return{get tileIndex(){return l('precinct',c),n},get component(){return l('precinct',c),a},get precinctX(){return l('precinct',c),r},get precinctY(){return l('precinct',c),o},get resolutionLevel(){return l('precinct',c),s},get isInCodestreamPart(){return l('precinct',c),!0},tryAdvance:function(){if(1<c)throw new i.jpipExceptions.InternalErrorException('Cannot advance precinct iterator after ended');return++c,2>c}}}}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,a){function s(e){if(e.isAllDatabinLoaded()){var n=e.getInClassId(),s=d[n];if(!s.isAlreadyLoaded){s.isAlreadyLoaded=!0,--r;for(var o=t.getTileStructure(n),l=s.precinctIterator;l.tryAdvance();){if(!l.isInCodestreamPart)throw new i.jpipExceptions.InternalErrorException('Unexpected precinct not in codestream part');a(l,o)}}}}var r=0,o=!1,l=!1,c=[],d=[];this.isAllTileHeadersLoaded=function(){return 0==r},this.register=function(){if(o)throw new i.jpipExceptions.InternalErrorException('JpipQualityWaiter already registered');o=!0,++r;for(var t=e.getTileIterator();t.tryAdvance();){var a=t.tileIndex,l=n.getTileHeaderDatabin(a),p=l.getInClassId();d[p]={precinctIterator:t.createPrecinctIterator(),isAlreadyLoaded:!1};var u=n.addEventListener(l,'dataArrived',s);c.push(u),++r,s(l)}--r},this.unregister=function(){if(!o)throw new i.jpipExceptions.InternalErrorException('JpipQualityWaiter not registered');if(!l){l=!0;for(var e=0;e<c.length;++e)n.removeEventListener(c[e])}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,a,s,r,o,l,c){function d(e,t){var n=x[e];n?(--h[n.qualityReached],n.isUpdated=n.qualityReached!==t,n.qualityReached=t):(n={qualityReached:t,isUpdated:0<t},x[e]=n);var i=h[t]||0;return h[t]=i+1,n}function p(){if(!(0<h[u]||'max'===u||g>=t.length||!y.isAllTileHeadersLoaded())){if(m)throw new i.jpipExceptions.InternalErrorException('Request already done but callback is called');var e=h.length,n;do{if(++u,u>=e){u='max';break}n=0<h[u]}while(!n);var s=t[g].minNumQualityLayers;if(!(u<s)){for('max'===u&&(g=t.length);g<t.length;){var r=t[g].minNumQualityLayers;if('max'===r||r>u)break;++g}m=g===t.length,a.call(l)}}}var u=0,g=0,f=!1,m=!1,x=[],h=[],y=c.createPrecinctsIteratorWaiter(e,s,r,function(e,t){var n=t.precinctPositionToInClassIndex(e),a=r.getPrecinctDatabin(n),s=d(n,0);if(s.qualityInTile!==void 0)throw new i.jpipExceptions.InternalErrorException('Precinct was iterated twice in codestream part');var c=t.getNumQualityLayers();s.qualityInTile=c,o.call(l,a,c,e,n,t),f&&p()});this.register=function(){y.register(),f=!0,p()},this.unregister=function(){y.unregister()},this.precinctQualityLayerReached=function(e,t){var n=d(e,t);n.isUpdated&&(n.isUpdated=!1,p())},this.getProgressiveStagesFinished=function(){return g},this.isDone=function(){return m},this.getQualityReached=function(){if(0==g)throw new i.jpipExceptions.IllegalOperationException('Cannot create codestream before first progressiveness stage has been reached');var e=t[g-1].minNumQualityLayers;return e}}},function(e,t,n){'use strict';var a=n(0);e.exports=function(e){function t(e,t,n){for(var r=Array(e.length),o=0,i;o<e.length;++o){if(i=e[o].minNumQualityLayers,'max'!==i){if(void 0!==t&&i>t)throw new a.jpipExceptions.ArgumentException('progressiveness['+o+'].minNumQualityLayers',i,'minNumQualityLayers is bigger than fetchParams.quality');i=s(i,n,'progressiveness['+o+'].minNumQualityLayers')}r[o]={minNumQualityLayers:i}}return r}function n(t){var n=[],a=e.getDefaultTileStructure(),s=a.getNumQualityLayers(),r='max';void 0!==t&&(s=Math.min(s,t),r=s);for(var o=4>s?s-1:3,l=1;l<o;++l)n.push({minNumQualityLayers:l});var c=Math.round(s/2);return c>o&&('max'===r||c<r)&&n.push({minNumQualityLayers:c}),n.push({minNumQualityLayers:r}),n}function i(t){var n=s(t.level,'level',void 0,!0),i=s(t.quality,'quality',void 0,!0),r=s(t.minX,'minX'),o=s(t.minY,'minY'),l=s(t.maxXExclusive,'maxXExclusive'),c=s(t.maxYExclusive,'maxYExclusive'),d=e.getLevelWidth(n),p=e.getLevelHeight(n);if(0>r||l>d||0>o||c>p||r>=l||o>=c)throw new a.jpipExceptions.ArgumentException('codestreamPartParams',t);return{minX:r,minY:o,maxXExclusive:l,maxYExclusive:c,level:n,quality:i}}function s(e,t,n,i){if(e===void 0&&(n!==void 0||i))return n;var s=+e;if(isNaN(s)||s!==Math.floor(s))throw new a.jpipExceptions.ArgumentException(t,e);return s}this.modify=function(e,s){var r=i(e);s=s||{};var o=s.useCachedDataOnly,l=s.disableProgressiveness,c;if(s.progressiveness!==void 0){if(o||l)throw new a.jpipExceptions.ArgumentException('options.progressiveness',s.progressiveness,'options contradiction: cannot accept both progressivenessand useCachedDataOnly/disableProgressiveness options');c=t(s.progressiveness,r.quality,'quality')}else if(o)c=[{minNumQualityLayers:0}];else if(l){var d=r.quality,p=d===void 0?'max':d;c=[{minNumQualityLayers:p}]}else c=n(r.quality);return{codestreamPartParams:r,progressiveness:c}}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(t,e,n,a,s,r){function o(e,i){var a=!1;try{var s=c(e,i);if(s===m)return;a=s===f}catch(n){a=!0,t.onException(n)}try{a||t.waitForConcurrentRequestsToEnd(x),n.requestEnded(e,x),a&&!y&&r!==void 0&&r(),t.checkConcurrentRequestsFinished()}catch(n){t.onException(n)}}function l(e){n.requestEnded(e,x),t.checkConcurrentRequestsFinished(),r!==void 0&&r()}function c(e,a){if(!a)throw new i.jpipExceptions.InternalErrorException('AJAX callback called although response is not done yet and chunked encoding is not enabled');var s=t.getCreatedChannelId(e);null===s?null===n.getChannelId()&&t.onException(new i.jpipExceptions.IllegalDataException('Cannot extract cid from cnew response','D.2.3')):null===n.getChannelId()?n.setChannelId(s):t.onException(new i.jpipExceptions.IllegalDataException('Channel created although was not requested','D.2.3'));var r=u(e);if(null===r)return f;var o=p(e,r);return o}function d(){E=n.nextRequestId();var e=a+'&len='+I+'&qid='+E;I*=2;var i=null===n.getChannelId();if(i){e+='&cnew=http';var s=t.getFirstChannel();null!==s&&(e+='&cid='+s.getChannelId())}else e+='&cid='+n.getChannelId();t.sendAjax(e,o,l)}function p(e,n){var a=f,s=new Uint8Array(e.response);if(n>s.length-2||0!==s[n])throw new i.jpipExceptions.IllegalDataException('Could not find End Of Response (EOR) code at the end of response','D.3');switch(s[n+1]){case i.jpipEndOfResponseReasons.IMAGE_DONE:case i.jpipEndOfResponseReasons.WINDOW_DONE:case i.jpipEndOfResponseReasons.QUALITY_LIMIT:a=g;break;case i.jpipEndOfResponseReasons.WINDOW_CHANGE:if(!y)throw new i.jpipExceptions.IllegalOperationException('Server response was terminated due to newer request issued on same channel. That may be an internal webjpip.js error - Check that movable requests are well maintained');break;case i.jpipEndOfResponseReasons.BYTE_LIMIT:case i.jpipEndOfResponseReasons.RESPONSE_LIMIT:y||(d(),a=m);break;case i.jpipEndOfResponseReasons.SESSION_LIMIT:t.onException(new i.jpipExceptions.IllegalOperationException('Server resources associated with the session is limitted, no further requests should be issued to this session'));break;case i.jpipEndOfResponseReasons.NON_SPECIFIED:t.onException(new i.jpipExceptions.IllegalOperationException('Server error terminated response with no reason specified'));break;default:t.onException(new i.jpipExceptions.IllegalDataException('Server responded with illegal End Of Response (EOR) code: '+s[n+1]));}return a}function u(n){try{for(var i=new Uint8Array(n.response),a=0,s;a<i.length&&!(0===i[a]);){var r=e.parseMessageHeader(i,a,s);if(r.bodyStart+r.messageBodyLength>i.length)return a;t.getDatabinsSaver().saveData(r,i),a=r.bodyStart+r.messageBodyLength,s=r}return a}catch(n){return t.onException(n),null}}var g=1,f=2,m=3,x=this,h=!1,y=!1,I=10*1024,E;this.startRequest=function(){if(h)throw new i.jpipExceptions.InternalErrorException('startRequest called twice');else if(y)throw new i.jpipExceptions.InternalErrorException('request was already stopped');h=!0,t.requestStarted(),d()},this.stopRequestAsync=function(){y=!0},this.getLastRequestId=function(){if(!h)throw new i.jpipExceptions.InternalErrorException('Unexpected call to getLastRequestId on inactive request');return E},this.callCallbackAfterConcurrentRequestsFinished=function(){s(x,!0)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,a,s){function r(e){var t=new i.jpipExceptions.InternalErrorException('Bad jpip server response (status = '+e.status+')');o(t)}function o(e){e===void 0&&(e=null),null!==l&&l({isReady:f,exception:e})}var l=null,c=null,d=[],p=null,u=0,g=[],f=!1,m=t||'0';this.onException=function(e){o(e)},this.getIsReady=function(){return f},this.setIsReady=function(e){f=e,o()},this.getCodestreamStructure=function(){return n},this.getDatabinsSaver=function(){return a},this.getDataRequestUrl=function(){return e},this.getTargetId=function(){return m},this.getFirstChannel=function(){return p},this.setStatusCallback=function(e){l=e},this.setRequestEndedCallback=function(e){c=e},this.requestStarted=function(){++u},this.requestEnded=function(e,t){--u;var n=e.getResponseHeader('JPIP-tid');if(''!==n&&null!==n)if('0'===m)m=n;else if(m!==n)throw new i.jpipExceptions.IllegalDataException('Server returned unmatched target ID');null==p&&(p=t);var a=t.getIsDedicatedForMovableRequest()?null:t;null!==c&&c(a)},this.getActiveRequestsCount=function(){return u},this.channelCreated=function(e){d.push(e)},this.getCreatedChannelId=function(e){var t=e.getResponseHeader('JPIP-cnew');if(!t)return null;for(var n=t.split(','),a=0,i;a<n.length;++a)if(i=n[a].split('='),'cid'===i[0])return i[1];return null},this.waitForConcurrentRequestsToEnd=function(e){for(var t=[],n=0;n<d.length;++n){var i=d[n].getRequestsWaitingForResponse(),a=i.length;if(0!==a){for(var s=i[0].getLastRequestId(),r=1;r<i.length;++r)s=Math.max(s,i[r].getLastRequestId());t.push({channel:d[n],requestId:s})}}g.push({request:e,concurrentRequests:t})},this.checkConcurrentRequestsFinished=function(){for(var e=g.length-1;0<=e;--e){for(var t=g[e].concurrentRequests,n=t.length-1,i;0<=n;--n)i=t[n],i.channel.isAllOldRequestsEnded(i.requestId)&&(t[n]=t[t.length-1],t.length-=1);if(!(0<t.length)){var a=g[e].request,s=a.callback;g[e]=g[g.length-1],g.length-=1,a.callCallbackAfterConcurrentRequestsFinished()}}},this.sendAjax=function(e,t,n){var i;i=n?function(e){r(e),n(e)}:r,s.request(e,t,i)}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,a,s,r,o,l){function c(){null!=P&&o(P),y.setIsReady(!1),y.sendAjax(S,h)}function d(e){++C;var n=l.createChannel(t,y);return y.channelCreated(n),e||b.push(n),n}function p(e,t){for(var n=null,a=e+1,s=0,i,r;s<b.length&&(r=b[s].getAllQueuedRequestCount(),r<a&&(n=b[s],i=s,a=r),0!==r);++s);return t&&null!==n?(b[i]=b[b.length-1],b.length-=1,n):n}function u(){var e=s.getMainHeaderDatabin();if(!e.isAllDatabinLoaded())throw new i.jpipExceptions.IllegalDataException('Main header was not loaded on session creation');var t=y.getFirstChannel(),n=t.getChannelId();return S=T+'&cclose=*&cid='+n,x?void c():void(null===n||(P=r(g,m),y.setIsReady(!0)))}function g(){if(!(0<y.getActiveRequestsCount())){var e=y.getFirstChannel();e.sendMinimalRequest(function(){})}}function f(){if(null===y||!y.getIsReady())throw new i.jpipExceptions.InternalErrorException('Cannot perform this operation when the session is not ready')}var m=30*1e3,x=!1,h=null,y=null,I=null,E=null,b=[],C=0,P=null,T,v,S;this.open=function(e){if(null!=y)throw new i.jpipExceptions.InternalErrorException('session.open() should be called only once');var t=0>e.indexOf('?')?'?':'&';T=e+t+'type='+(s.getIsJpipTilePartStream()?'jpt-stream':'jpp-stream'),v=T+'&stream=0',y=l.createSessionHelper(v,n,a,s),null!=I&&y.setStatusCallback(I),null!=E&&y.setRequestEndedCallback(E);var r=d();r.sendMinimalRequest(u)},this.getTargetId=function(){return f(),y.getTargetId()},this.getIsReady=function(){var e=null!==y&&y.getIsReady();return e},this.setStatusCallback=function(e){I=e,null!==y&&y.setStatusCallback(e)},this.setRequestEndedCallback=function(e){E=e,null!==y&&y.setRequestEndedCallback(e)},this.hasActiveRequests=function(){f();var e=0<y.getActiveRequestsCount();return e},this.tryGetChannel=function(n){f();var i=C<e,a=i||n?0:t-1,s=p(a,n);return null===s&&i&&(s=d(n)),n&&null!==s&&s.dedicateForMovableRequest(),s},this.close=function(e){if(0==C)throw new i.jpipExceptions.InternalErrorException('Cannot close session before open');if(x)throw new i.jpipExceptions.InternalErrorException('Cannot close session twice');x=!0,h=e,S!=void 0&&c()}}},function(e,t,n){'use strict';var a=n(0);e.exports=function(e,t,n,i,s,r){function o(){if(null!==v)throw new a.jpipExceptions.IllegalOperationException('Previous session still not established');return null==y?void(i.cleanupUnregisteredDatabins(),l()):void(null!==P&&P({isReady:!0,exception:'Previous session that should be closed still alive.Maybe old requestContexts have not beed closed. Reconnect will not be done'}))}function l(){var a;null!=h&&(a=h.getTargetId()),v=s.createSession(e,t,a,n,i),v.setStatusCallback(d),v.open(I)}function c(e){var t=h.tryGetChannel(!0);if(null===t)throw new a.jpipExceptions.IllegalOperationException('Too many concurrent requests. Limit the use of dedicated (movable) requests, enlarge maxChannelsInSession or wait for requests to finish and avoid create new ones');if(!t.getIsDedicatedForMovableRequest())throw new a.jpipExceptions.InternalErrorException('getIsDedicatedForMovableRequest inconsistency');e.internalDedicatedChannel=t}function d(e){if(null===v||e.isReady!==v.getIsReady())throw new a.jpipExceptions.InternalErrorException('Unexpected statusCallback when not registered to session or inconsistent isReady');if(e.isReady){if(null!=y)throw new a.jpipExceptions.InternalErrorException('sessionWaitingForDisconnect should be null');y=h,h=v,v=null,null!=y&&(y.setStatusCallback(null),!m()&&y.setRequestEndedCallback(m)),h.setStatusCallback(P),h.setRequestEndedCallback(f);for(var t=0;t<C.length;++t)c(C[t])}null!==P&&P(e)}function p(e){null!==e&&(++E,e.close(u))}function u(){--E,0==E&&T!==void 0&&T()}function g(){if(null===h)throw new a.jpipExceptions.InternalErrorException('This operation is forbidden when session is not ready')}function f(e){var t=null;if(i.getLoadedBytes()>x&&o(),null!==e){if(e.getIsDedicatedForMovableRequest())throw new a.jpipExceptions.InternalErrorException('Expected non-movable channel as channelFreed');do{if(0===b.length){t=null;break}if(t=b.shift(),null!==t.internalRequest)throw new a.jpipExceptions.InternalErrorException('Request was already sent but still in queue')}while(t.isEnded);null!==t&&(t.internalRequest=e.requestData(t.codestreamPartParams,t.callback,t.failureCallback,t.numQualityLayers))}}function m(){var e=!y.hasActiveRequests();return e&&(y.close(),y=null),e}var x=r||10*1048576,h=null,y=null,I=null,E=0,b=[],C=[],P=null,T=null,v;this.getIsReady=function(){return null!=h&&h.getIsReady()},this.open=function(e){if(e===void 0||null===e)throw new a.jpipExceptions.ArgumentException('baseUrl',e);if(null!=I)throw new a.jpipExceptions.IllegalOperationException('Image was already opened');I=e,l()},this.close=function(e){if(null!=T)throw new a.jpipExceptions.IllegalOperationException('closed twice');T=e,E=1,p(h),p(v),p(y),u()},this.setStatusCallback=function(e){P=e,null!=h&&h.setStatusCallback(e)},this.dedicateChannelForMovableRequest=function(){g();var e={internalDedicatedChannel:null};return C.push(e),c(e),e},this.requestData=function(e,t,n,i,s){g();var r={isEnded:!1,internalRequest:null,codestreamPartParams:e,callback:t,failureCallback:n,numQualityLayers:i},o=!!s,l;if(o)l=s.internalDedicatedChannel;else{if(l=h.tryGetChannel(),null===l)return b.push(r),r;if(l.getIsDedicatedForMovableRequest())throw new a.jpipExceptions.InternalErrorException('Expected non-movable channel')}if(l.getIsDedicatedForMovableRequest()!==o)throw new a.jpipExceptions.InternalErrorException('getIsDedicatedForMovableRequest inconsistency');return r.internalRequest=l.requestData(e,t,n,i),r},this.stopRequestAsync=function(e){e.isEnded=!0,null!==e.internalRequest&&e.internalRequest.stopRequestAsync()},this.reconnect=o}},function(e,t,n){'use strict';var a=Math.pow,s=n(0);e.exports=function(e,t,n,r){function i(c,d){var p=r.getCodingStyleBaseParams(c,d);if(null===p)return null;var u=e.getMainHeaderDatabin(),g=r.getImageAndTileSizeOffset(),f=g+s.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER,m=l(u,2,f),x=n.getInt16(m,0),h=t.getMarkerOffsetInDatabin(c,s.j2kMarkers.PackedPacketHeadersInTileHeader),y=t.getMarkerOffsetInDatabin(u,s.j2kMarkers.PackedPacketHeadersInMainHeader),I=p.codingStyleDefaultOffset+6,E=l(c,6,I),b=n.getInt16(E,0),C=o(E,4),P=o(E,5),T=Array(p.numResolutionLevels),v=Array(p.numResolutionLevels),S=null;if(!p.isDefaultPrecinctSize){var L=p.numResolutionLevels;S=l(c,L,p.precinctSizesOffset)}for(var O=32768,R=0;R<p.numResolutionLevels;++R){if(p.isDefaultPrecinctSize){T[R]=O,v[R]=O;continue}var i=R,k=S[i];T[R]=1*a(2,15&k),v[R]=1*a(2,k>>>4)}for(var D=Array(x),A=0;A<x;++A)D[A]={maxCodeblockWidth:C,maxCodeblockHeight:P,numResolutionLevels:p.numResolutionLevels,precinctWidthPerLevel:T,precinctHeightPerLevel:v};var _={maxCodeblockWidth:C,maxCodeblockHeight:P,numResolutionLevels:p.numResolutionLevels,precinctWidthPerLevel:T,precinctHeightPerLevel:v},j={numQualityLayers:b,isPacketHeadersNearData:null===h&&null===y,isStartOfPacketMarkerAllowed:p.isStartOfPacketMarkerAllowed,isEndPacketHeaderMarkerAllowed:p.isEndPacketHeaderMarkerAllowed,paramsPerComponent:D,defaultComponentParams:_};return j}function o(e,t){var n=e[t],i=2+(15&n);if(10<i)throw new s.j2kExceptions.IllegalDataException('Illegal codeblock width exponent '+i,'A.6.1, Table A.18');return 1<<i}function l(e,t,n){var i=[],a=e.copyBytes(i,0,{forceCopyAllRange:!0,maxLengthToCopy:t,databinStartOffset:n});if(null===a)throw new s.jpipExceptions.InternalErrorException('Header data-bin has not yet recieved '+t+' bytes starting from offset '+n);return i}this.parseCodestreamStructure=function(){for(var t=e.getMainHeaderDatabin(),a=r.getImageAndTileSizeOffset(),o=l(t,38,a+s.j2kOffsets.MARKER_SIZE+s.j2kOffsets.LENGTH_FIELD_SIZE),c=s.j2kOffsets.REFERENCE_GRID_SIZE_OFFSET_AFTER_SIZ_MARKER-(s.j2kOffsets.MARKER_SIZE+s.j2kOffsets.LENGTH_FIELD_SIZE),d=s.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER-(s.j2kOffsets.MARKER_SIZE+s.j2kOffsets.LENGTH_FIELD_SIZE),p=n.getInt32(o,c),u=n.getInt32(o,c+4),g=n.getInt32(o,10),f=n.getInt32(o,14),m=n.getInt32(o,18),x=n.getInt32(o,22),h=n.getInt32(o,26),y=n.getInt32(o,30),I=n.getInt16(o,d),E=a+s.j2kOffsets.NUM_COMPONENTS_OFFSET_AFTER_SIZ_MARKER+2,b=l(t,3*I,E),C=Array(I),P=Array(I),T=0;T<I;++T)C[T]=b[3*T+1],P[T]=b[3*T+2];return{numComponents:I,componentsScaleX:C,componentsScaleY:P,imageWidth:p-h,imageHeight:u-y,tileWidth:m,tileHeight:x,firstTileOffsetX:h,firstTileOffsetY:y}},this.parseDefaultTileParams=function(){var t=e.getMainHeaderDatabin(),n=i(t,!0);return n},this.parseOverridenTileParams=function(t){var n=e.getTileHeaderDatabin(t),a=i(n,!1);return a}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,a){function s(e,t,n){if(0>t||t>=n)throw new i.jpipExceptions.ArgumentException(e,t,e+' is expected to be between 0 and '+n-1)}function o(e,t,n,i,a){var s=n(e),r=i(e),o=a(e);if(s>=r||o>=r)return!0;return 0==s%o||0==o%s}var r,l,d,p;this.getProgressionOrder=function(){return a},this.getDefaultComponentStructure=function(){return r},this.getComponentStructure=function(e){return l[e]},this.getTileWidth=function(){return e.tileSize.width},this.getTileHeight=function(){return e.tileSize.height},this.getNumQualityLayers=function(){return e.numQualityLayers},this.getIsPacketHeaderNearData=function(){return e.isPacketHeadersNearData},this.getIsStartOfPacketMarkerAllowed=function(){return e.isStartOfPacketMarkerAllowed},this.getIsEndPacketHeaderMarkerAllowed=function(){return e.isEndPacketHeaderMarkerAllowed},this.getMinNumResolutionLevelsOverComponents=function(){return p},this.precinctInClassIndexToPosition=function(e){if(0>e)throw new i.jpipExceptions.ArgumentException('inClassIndex',e,'Invalid negative in-class index of precinct');var n=t.getNumTilesX()*t.getNumTilesY(),a=t.getNumComponents(),s=e%n,r=(e-s)/n,o=r%a,c=l[o],p=c.getNumResolutionLevels(),u=(r-o)/a,g=0,f;for(f=1;f<p;++f){var m=d[o][f];if(m>u)break;g=m}--f;var x=u-g,h=c.getNumPrecinctsX(f),y=c.getNumPrecinctsY(f),I=x%h,E=(x-I)/h;if(E>=y)throw new i.jpipExceptions.ArgumentException('inClassIndex',e,'Invalid in-class index of precinct');var b={tileIndex:s,component:o,precinctX:I,precinctY:E,resolutionLevel:f};return b},this.precinctPositionToInClassIndex=function(e){var n=t.getNumComponents();s('precinctPosition.component',e.component,n);var i=l[e.component],a=i.getNumResolutionLevels();s('precinctPosition.resolutionLevel',e.resolutionLevel,a);var r=t.getNumTilesX()*t.getNumTilesY(),o=i.getNumPrecinctsX(e.resolutionLevel),c=i.getNumPrecinctsY(e.resolutionLevel);s('precinctPosition.precinctX',e.precinctX,o),s('precinctPosition.precinctY',e.precinctY,c),s('precinctPosition.tileIndex',e.tileIndex,r);var p=e.precinctX+e.precinctY*o,u=d[e.component][e.resolutionLevel],g=e.component+(p+u)*t.getNumComponents(),f=e.tileIndex+g*t.getNumTilesX()*t.getNumTilesY();return f},this.precinctPositionToIndexInComponentResolution=function(e){var t=l[e.component],n=t.getNumPrecinctsX(e.resolutionLevel),i=e.precinctX+e.precinctY*n;return i},r=n.createComponentStructure(e.defaultComponentParams,this),l=Array(t.getNumComponents());for(var c=0;c<t.getNumComponents();++c)l[c]=n.createComponentStructure(e.paramsPerComponent[c],this);return function(){d=Array(n);var n=t.getNumComponents(),a=e.defaultComponentParams;p=a.numResolutionLevels;for(var s=!0,u=!0,g=0,c;g<n;++g){c=e.paramsPerComponent[g],p=Math.min(p,c.numResolutionLevels),d[g]=Array(c.numResolutionLevels);for(var f=l[g],m=0,x=f.getNumPrecinctsX(g),h=f.getNumPrecinctsY(g),y=0;y<c.numResolutionLevels;++y){d[g][y]=m;var r=f.getNumPrecinctsX(y),I=f.getNumPrecinctsY(y);m+=r*I,(a.precinctWidthPerLevel[y]!==c.precinctWidthPerLevel[y]||a.precinctHeightPerLevel[y]!==c.precinctHeightPerLevel[y])&&(s=!1);var E=o(y,c.numResolutionLevels,f.getPrecinctWidth,t.getLevelWidth,t.getTileWidth),b=o(y,c.numResolutionLevels,f.getPrecinctWidth,t.getLevelWidth,t.getTileWidth);u&=E&&b}}if(!s)throw new i.j2kExceptions.UnsupportedFeatureException('Special Coding Style for Component (COC)','A.6.2');if(!u)throw new i.j2kExceptions.UnsupportedFeatureException('Precinct TopLeft which is not matched to tile TopLeft','B.6')}(),function(e){if(4!==e.length)throw new i.j2kExceptions.IllegalDataException('Illegal progression order '+e+': unexpected length');if('L'!==e[3])throw new i.jpipExceptions.IllegalDataException('Illegal target progression order of '+e,'A.3.2.1');var t=0<=e.indexOf('P'),n=0<=e.indexOf('C'),a=0<=e.indexOf('R');if(!t||!n||!a)throw new i.j2kExceptions.IllegalDataException('Illegal progression order '+e+': missing letter');if('RPCL'!==e)throw new i.j2kExceptions.UnsupportedFeatureException('Progression order of '+e,'A.6.1')}(a),this}},function(e,t,n){'use strict';var i=Math.min,a=n(0);e.exports=function(){function e(e,a,r,o){var l=0,c=o,d;do{if(!n(e,a))return null;var p=r?~a.currentByte:a.currentByte,u=i(s[p],a.validBitsInCurrentByte+1),g=u-1;if(c!==void 0){if(u>c){t(a,c),l+=c;break}c-=g}l+=g,d=u<=a.validBitsInCurrentByte,d?t(a,u):a.validBitsInCurrentByte=0}while(!d);return l}function t(e,t){e.validBitsInCurrentByte-=t,0<e.validBitsInCurrentByte&&(e.currentByte=255&e.currentByte<<t)}function n(e,t){if(0<t.validBitsInCurrentByte)return!0;var n=t.isSkipNextByte?2:1,i=[],s=e.copyBytes(i,0,{forceCopyAllRange:!0,databinStartOffset:t.nextOffsetToParse,maxLengthToCopy:n});if(s!==n)return!1;var r=t.originalByteWithoutShift;if(t.currentByte=i[n-1],t.validBitsInCurrentByte=8,t.originalByteWithoutShift=t.currentByte,255===r){if(0!=(128&i[0]))throw new a.j2kExceptions.IllegalDataException('Expected 0 bit after 0xFF byte','B.10.1');t.isSkipNextByte||(t.currentByte<<=1,t.validBitsInCurrentByte=7)}return t.isSkipNextByte=!1,t.nextOffsetToParse+=n,!0}var s=function(){var e=Array(255);e[0]=9,e[1]=8,e[2]=7,e[3]=7;var t;for(t=4;7>=t;++t)e[t]=6;for(t=8;15>=t;++t)e[t]=5;for(t=16;31>=t;++t)e[t]=4;for(t=32;63>=t;++t)e[t]=3;for(t=64;127>=t;++t)e[t]=2;for(t=128;255>=t;++t)e[t]=1;for(t=0;255>=t;++t)e[t-256]=e[t];return e}();return function(s,r){var o=r.createTransactionalObject({nextOffsetToParse:0,validBitsInCurrentByte:0,originalByteWithoutShift:null,currentByte:null,isSkipNextByte:!1}),l=null;Object.defineProperty(this,'activeTransaction',{get:function(){if(null==l||!l.isActive)throw new a.jpipExceptions.InternalErrorException('No active transaction in bitstreamReader');return l}}),Object.defineProperty(this,'bitsCounter',{get:function(){var e=o.getValue(l);if(n(s,e),e.isSkipNextByte)throw new a.jpipExceptions.InternalErrorException('Unexpected state of bitstreamReader: When 0xFF encountered, tryValidateCurrentByte should skip the whole byte  after shiftRemainingBitsInByte and clear isSkipNextByte. However the flag is still set');var t=8*e.nextOffsetToParse-e.validBitsInCurrentByte;return t}}),Object.defineProperty(this,'databinOffset',{get:function(){var e=o.getValue(l);if(e.isSkipNextByte)return e.nextOffsetToParse+1;if(0!=e.validBitsInCurrentByte%8||255===e.originalByteWithoutShift)throw new a.jpipExceptions.InternalErrorException('Cannot calculate databin offset when bitstreamReader  is in the middle of the byte');return e.nextOffsetToParse-e.validBitsInCurrentByte/8},set:function(e){var t=o.getValue(l);t.validBitsInCurrentByte=0,t.isSkipNextByte=!1,t.originalByteWithoutShift=null,t.nextOffsetToParse=e}}),this.startNewTransaction=function(){if(null!=l&&l.isActive)throw new a.jpipExceptions.InternalErrorException('Cannot start new transaction in bitstreamReader while another transaction is active');l=r.createTransaction()},this.shiftRemainingBitsInByte=function(){var e=o.getValue(l);e.isSkipNextByte=255===e.originalByteWithoutShift,e.validBitsInCurrentByte=Math.floor(e.validBitsInCurrentByte/8)},this.shiftBit=function(){var t=o.getValue(l);if(!n(s,t))return null;var i=e(s,t,!0,1);return i},this.countZerosAndShiftUntilFirstOneBit=function(t){var n=o.getValue(l),i=e(s,n,!1,t);return i},this.countOnesAndShiftUntilFirstZeroBit=function(t){var n=o.getValue(l),i=e(s,n,!0,t);return i},this.shiftBits=function(e){for(var a=0,r=o.getValue(l),c=e;0<c;){if(!n(s,r))return null;var d=i(r.validBitsInCurrentByte,c),p=r.currentByte>>8-d;a=(a<<d)+p,t(r,d),c-=d}return a}}}()},function(e,t,n){'use strict';var i=Math.floor,a=Math.ceil,s=n(0);e.exports=function(e,t,n,r){function o(t,n){var a=0,r=null;return function(){if(null===a)throw new s.jpipExceptions.InternalErrorException('Iterated too deep in tag tree');if(a===u.length)return a=null,null;var o=u.length-a-1,c=i(t>>o),d=i(n>>o),p=u[a].width*d+c,g=u[a].content[p];void 0===g&&(g=l(a,p));var f=g.getValue(e.activeTransaction);return null!=r&&r.minimalPossibleValue>f.minimalPossibleValue&&(f.minimalPossibleValue=r.minimalPossibleValue),r=f,++a,f}}function l(e,t){var n=r.createTransactionalObject({minimalPossibleValue:0,isFinalValue:!1});return u[e].content[t]=n,n}function c(){var t=p.getValue(e.activeTransaction);return t}function d(){p.setValue(e.activeTransaction,!0)}var p=r.createTransactionalObject(!1,!0),u;(function(){u=[];for(var e=t,i=n;1<=e||1<=i;){e=a(e),i=a(i);var s=e*i;u.unshift({width:e,height:i,content:Array(s)}),e/=2,i/=2}l(0,0)})(),this.setMinimalValueIfNotReadBits=function(t){if(!c()){var n=u[0].content[0],i=n.getValue(e.activeTransaction);i.minimalPossibleValue=t}},this.isSmallerThanOrEqualsTo=function(t,n,i){d();for(var a=o(t,n),r=a(),l;null!==r;){if(r.minimalPossibleValue>i)return!1;if(!r.isFinalValue){var c=i-r.minimalPossibleValue+1,p=e.countZerosAndShiftUntilFirstOneBit(c);if(null===p)return null;r.minimalPossibleValue+=p,p<c&&(r.isFinalValue=!0)}l=r,r=a()}var u=l.minimalPossibleValue<=i;if(u&&!l.isFinalValue)throw new s.jpipExceptions.InternalErrorException('Wrong parsing in TagTree.isSmallerThanOrEqualsTo: not sure if value is smaller than asked');return u},this.getValue=function(t,n){var i=o(t,n),a=i(),s;for(d();null!==a;){if(!a.isFinalValue){var r=e.countZerosAndShiftUntilFirstOneBit();if(null===r)return null;a.minimalPossibleValue+=r,a.isFinalValue=!0}s=a,a=i()}return s.minimalPossibleValue}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(){var e=function(){for(var e=164,t=Array(e),n=1,a=2,s=0;n<=e;){for(var r=n;r<a;++r)t[r]=s;n*=2,a*=2,++s}return t}();return function(t,n){var a=n.createTransactionalObject({lBlockValue:3});this.parse=function(n){var s=t.countOnesAndShiftUntilFirstZeroBit();if(null===s)return null;var r=a.getValue(t.activeTransaction);r.lBlockValue+=s;var o=e[n];if(o===void 0)throw new i.jpipExceptions.InternalErrorException('Unexpected value of coding passes '+n+'. Expected positive integer <= 164');var l=r.lBlockValue+o,c=t.shiftBits(l);return c}}}()},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t,n,a,s,r){function o(t){var n=u.getValue(e.activeTransaction);if(n>=t+1)throw new i.jpipExceptions.InternalErrorException('Unexpected quality layer to parse')}function l(){if(null==d){d=Array(t),p=Array(t);for(var i=0;i<t;++i){d[i]=Array(n),p[i]=Array(n);for(var a=0;a<n;++a)d[i][a]=r.createCodeblockLengthParser(e,s),p[i][a]=s.createTransactionalObject({isIncluded:!1})}}}function c(t,n,i){var s=p[t][n].getValue(e.activeTransaction),r;if(r=s.isIncluded?e.shiftBit():g.isSmallerThanOrEqualsTo(t,n,i),null===r)return null;if(!r)return{codeblockBodyLengthBytes:0,codingPasses:0};var o=null;if(!s.isIncluded&&(o=f.getValue(t,n),null===o))return null;var l=a.parse(e);if(null===l)return null;var c=d[t][n],u=c.parse(l);if(null===u)return null;s.isIncluded=!0;var m={codeblockBodyLengthBytes:u,codingPasses:l};return null!==o&&(m.zeroBitPlanes=o),m}var d=null,p=null,u=s.createTransactionalObject(0,!0),g=r.createTagTree(e,t,n),f=r.createTagTree(e,t,n);this.calculateSubbandLength=function(i){o(i),l(),g.setMinimalValueIfNotReadBits(i);for(var a=0,s=0,r=Array(t*n),d=0;d<n;++d)for(var p=0,f;p<t;++p){if(f=c(p,d,i),null===f)return null;r[s++]=f,a+=f.codeblockBodyLengthBytes}return u.setValue(e.activeTransaction,i+1),{codeblockBodyLengthByIndex:r,overallBodyLengthBytes:a}}}},function(e,t,n){'use strict';var a=Math.floor,s=Math.ceil,i=n(0);e.exports=function(e,t,n,r,o,l){function c(e){for(;m.length<e;){x.startNewTransaction();var t=d(m.length);if(null===t)return void x.activeTransaction.abort();m.push(t),x.activeTransaction.commit()}}function d(e){var t;if(0<e){var n=m[e-1];t=n.headerStartOffset+n.headerLength+n.overallBodyLengthBytes}else t=r;if(x.databinOffset=t,E&&b){var i=g(145);if(null===i)return null;if(i){x.databinOffset+=6}}var a=x.shiftBit();if(null===a)return null;if(!a)return x.shiftRemainingBitsInByte(),{headerStartOffset:t,headerLength:1,codeblockBodyLengthByIndex:[],overallBodyLengthBytes:0};var s=p(e);if(null===s)return null;var o=x.databinOffset;return s.headerLength=o-t,s.headerStartOffset=t,s}function p(e){for(var t=0,n=null,i=0;i<P.length;++i){var a=P[i],s=a.calculateSubbandLength(e);if(null===s)return null;n=null==n?s.codeblockBodyLengthByIndex:n.concat(s.codeblockBodyLengthByIndex),t+=s.overallBodyLengthBytes}if(x.shiftRemainingBitsInByte(),C){var r=g(146);if(null===r)return null;if(r){x.databinOffset+=2}}return{codeblockBodyLengthByIndex:n,overallBodyLengthBytes:t}}function u(e){var t=Math.min(e,m.length);if(0===t)return{endOffset:r,numQualityLayers:0};var n=m[t-1],i=n.headerStartOffset+n.headerLength+n.overallBodyLengthBytes;return{endOffset:i,numQualityLayers:t}}function g(e){var t=[,,],i=n.copyBytes(t,0,{databinStartOffset:x.databinOffset,maxLengthToCopy:2,forceCopyAllRange:!1});switch(i){case 2:var a=255===t[0]&&t[1]===e;return a;case 1:return!(255!==t[0])&&null;default:return null;}}function f(){if(!E)throw new i.jpipExceptions.UnsupportedFeatureException('PPM or PPT','A.7.4 and A.7.5')}var m=[],x=l.createBitstreamReader(n),h=t.getNumCodeblocksXInPrecinct(o),y=t.getNumCodeblocksYInPrecinct(o),I=e.getNumQualityLayers(),E=e.getIsPacketHeaderNearData(),b=e.getIsStartOfPacketMarkerAllowed(),C=e.getIsEndPacketHeaderMarkerAllowed(),P=function(){for(var e=0===o.resolutionLevel?1:3,t=[],n=0;n<e;++n){var i,r;(0===o.resolutionLevel?(i=h,r=y):(i=1===n?s(h/2):a(h/2),r=0===n?s(y/2):a(y/2)),0!==i&&0!==r)&&t.push(l.createSubbandLengthInPacketHeaderCalculator(x,i,r))}return t}();this.calculateEndOffsetOfLastFullPacket=function(e){var t;if(!(e===void 0||e>=I))t=e;else if(!n.isAllDatabinLoaded())t=I;else{var i=n.getDatabinLengthIfKnown();return{endOffset:i,numQualityLayers:I}}f(),c(t);var a=u(t);return a},this.getPacketOffsetsByCodeblockIndex=function(e){return f(),c(e+1),m.length<=e?null:m[e]}}},function(e,t,n){'use strict';var i=n(0);e.exports=function(e,t){function n(n,s){var r=n.getCachedData(a);if(void 0!==r.calculator)return r.calculator;if(void 0===s)throw new i.jpipExceptions.InternalErrorException('precinctPosition should be given on the first time of using QualityLayersCache on this precinct');var o=e.getTileStructure(s.tileIndex),l=o.getComponentStructure(s.component);return r.calculator=t.createPacketLengthCalculator(o,l,n,0,s),r.calculator}var a='packetLengthCalculator';this.getPacketOffsetsByCodeblockIndex=function(e,t,i){var a=n(e,i),s=a.getPacketOffsetsByCodeblockIndex(t);return s},this.getQualityLayerOffset=function(e,t,i){var a=e.getExistingRanges(),s=n(e,i),r;1>a.length||0<a[0].start?(r=0,t=0):r=a[0].start+a[0].length;for(var o=s.calculateEndOffsetOfLastFullPacket(t);r<o.endOffset;){var l=o.numQualityLayers-1;o=s.calculateEndOffsetOfLastFullPacket(l)}return o}}},function(e,t,n){'use strict';function i(){this._image=new r.JpxImage}var a=Math.max,s=Math.min,r=n(2);e.exports=i;n(0);i.prototype.start=function(e){var t=this;return new Promise(function(n){var a={left:e.offsetInRegion.offsetX,top:e.offsetInRegion.offsetY,right:e.offsetInRegion.offsetX+e.offsetInRegion.width,bottom:e.offsetInRegion.offsetY+e.offsetInRegion.height},s=t._image.parseCodestream(e.headersCodestream,0,e.headersCodestream.length,{isOnlyParseHeaders:!0});if(e.codeblocksData&&t._image.addPacketsData(s,e.codeblocksData),e.precinctCoefficients)for(var r=0,i;r<e.precinctCoefficients.length;++r)i=e.precinctCoefficients[r],t._image.setPrecinctCoefficients(s,i.coefficients,i.tileIndex,i.c,i.r,i.p);t._image.decode(s,{regionToParse:a});var o=t._copyTilesPixelsToOnePixelsArray(t._image.tiles,a,t._image.componentsCount);n(o)})},i.prototype._copyTilesPixelsToOnePixelsArray=function(e,t,n){for(var r=e[0],o=t.right-t.left,l=t.bottom-t.top,c=new ImageData(o,l),d=4,p=o*d,u=0;u<e.length;++u){var i=e[u].left+e[u].width,g=e[u].top+e[u].height,f=a(t.left,e[u].left),m=a(t.top,e[u].top),x=s(t.right,i),h=s(t.bottom,g);if(f!==e[u].left||m!==e[u].top||x-f!==e[u].width||h-m!==e[u].height)throw'Unsupported tiles to copy';var y=f-t.left,I=m-t.top;this._copyTile(c.data,e[u],y*d+I*p,p,n)}return c},i.prototype._copyTile=function(e,t,n,i,a){var s=1,r=2,o=1,l=t.pixels||t.items;switch(void 0===a&&(a=l.length/(t.width*t.height)),a){case 1:s=0,r=0;break;case 3:o=3;break;case 4:o=4;break;default:throw'Unsupported components count '+a;}for(var c=n,d=0,p=0,u;p<t.height;++p){u=c;for(var g=0;g<t.width;++g)e[c+0]=l[d+0],e[c+1]=l[d+s],e[c+2]=l[d+r],e[c+3]=255,d+=o,c+=4;c=u+i}}},function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function i(e){m>=f.WARNINGS&&console.log('Warning: '+e)}function a(e){throw new Error(e)}function s(e,t){e||a(t)}function r(e){if(!e)return!1;switch(e.protocol){case'http:':case'https:':case'ftp:':case'mailto:':case'tel:':return!0;default:return!1;}}function o(e){s('string'==typeof e,'Invalid argument for stringToBytes');for(var t=e.length,n=new Uint8Array(t),a=0;a<t;++a)n[a]=255&e.charCodeAt(a);return n}function l(e){return void 0===e.length?(s(void 0!==e.byteLength),e.byteLength):e.length}var c=Math.max,d=Math.min,p=String.fromCharCode;Object.defineProperty(t,'__esModule',{value:!0});var u=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),g='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},f={ERRORS:0,WARNINGS:1,INFOS:5},m=f.WARNINGS,x=function(){function e(e,t){this.name='PasswordException',this.message=e,this.code=t}return e.prototype=new Error,e.constructor=e,e}(),h=function(){function e(e,t){this.name='UnknownErrorException',this.message=e,this.details=t}return e.prototype=new Error,e.constructor=e,e}(),y=function(){function e(e){this.name='InvalidPDFException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),I=function(){function e(e){this.name='MissingPDFException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),E=function(){function e(e,t){this.name='UnexpectedResponseException',this.message=e,this.status=t}return e.prototype=new Error,e.constructor=e,e}(),b=function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name='FormatError',e.constructor=e,e}(),C=function(){function e(e){this.name='AbortException',this.message=e}return e.prototype=new Error,e.constructor=e,e}(),P=/\x00/g,T=['rgb(',0,',',0,',',0,')'],v=function(){function e(){n(this,e)}return u(e,null,[{key:'makeCssRgb',value:function(e,t,n){return T[1]=e,T[3]=t,T[5]=n,T.join('')}},{key:'transform',value:function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}},{key:'applyTransform',value:function(e,t){var n=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[n,i]}},{key:'applyInverseTransform',value:function(e,t){var n=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,a=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[i,a]}},{key:'getAxialAlignedBoundingBox',value:function(t,n){var i=e.applyTransform(t,n),a=e.applyTransform(t.slice(2,4),n),s=e.applyTransform([t[0],t[3]],n),r=e.applyTransform([t[2],t[1]],n);return[d(i[0],a[0],s[0],r[0]),d(i[1],a[1],s[1],r[1]),c(i[0],a[0],s[0],r[0]),c(i[1],a[1],s[1],r[1])]}},{key:'inverseTransform',value:function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}},{key:'apply3dTransform',value:function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]}},{key:'singularValueDecompose2dScale',value:function(e){var t=Math.sqrt,n=[e[0],e[2],e[1],e[3]],i=e[0]*n[0]+e[1]*n[2],a=e[0]*n[1]+e[1]*n[3],s=e[2]*n[0]+e[3]*n[2],r=e[2]*n[1]+e[3]*n[3],o=(i+r)/2,l=t((i+r)*(i+r)-4*(i*r-s*a))/2;return[t(o+l||1),t(o-l||1)]}},{key:'normalizeRect',value:function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}},{key:'intersect',value:function(t,n){function i(e,t){return e-t}var a=[t[0],t[2],n[0],n[2]].sort(i),s=[t[1],t[3],n[1],n[3]].sort(i),r=[];if(t=e.normalizeRect(t),n=e.normalizeRect(n),a[0]===t[0]&&a[1]===n[0]||a[0]===n[0]&&a[1]===t[0])r[0]=a[1],r[2]=a[2];else return null;if(s[0]===t[1]&&s[1]===n[1]||s[0]===n[1]&&s[1]===t[1])r[1]=s[1],r[3]=s[2];else return null;return r}}]),e}(),S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364],L=function(){var e='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';return function(t,n){var a=2<arguments.length&&arguments[2]!==void 0&&arguments[2];if(!a&&URL.createObjectURL){var s=new Blob([t],{type:n});return URL.createObjectURL(s)}for(var r='data:'+n+';base64,',o=0,i=t.length;o<i;o+=3){var l=255&t[o],c=255&t[o+1],d=255&t[o+2],p=o+1<i?(15&c)<<2|d>>6:64,u=o+2<i?63&d:64;r+=e[l>>2]+e[(3&l)<<4|c>>4]+e[p]+e[u]}return r}}();t.FONT_IDENTITY_MATRIX=[0.001,0,0,0.001,0,0],t.IDENTITY_MATRIX=[1,0,0,1,0,0],t.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},t.VerbosityLevel=f,t.UNSUPPORTED_FEATURES={unknown:'unknown',forms:'forms',javaScript:'javaScript',smask:'smask',shadingPattern:'shadingPattern',font:'font'},t.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},t.AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},t.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},t.AnnotationMarkedState={MARKED:'Marked',UNMARKED:'Unmarked'},t.AnnotationReplyType={GROUP:'Group',REPLY:'R'},t.AnnotationReviewState={ACCEPTED:'Accepted',REJECTED:'Rejected',CANCELLED:'Cancelled',COMPLETED:'Completed',NONE:'None'},t.AnnotationStateModelType={MARKED:'Marked',REVIEW:'Review'},t.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t.FontType={UNKNOWN:'UNKNOWN',TYPE1:'TYPE1',TYPE1C:'TYPE1C',CIDFONTTYPE0:'CIDFONTTYPE0',CIDFONTTYPE0C:'CIDFONTTYPE0C',TRUETYPE:'TRUETYPE',CIDFONTTYPE2:'CIDFONTTYPE2',TYPE3:'TYPE3',OPENTYPE:'OPENTYPE',TYPE0:'TYPE0',MMTYPE1:'MMTYPE1'},t.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},t.CMapCompressionType={NONE:0,BINARY:1,STREAM:2},t.AbortException=C,t.InvalidPDFException=y,t.MissingPDFException=I,t.NativeImageDecoding={NONE:'none',DECODE:'decode',DISPLAY:'display'},t.PasswordException=x,t.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},t.PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},t.StreamType={UNKNOWN:'UNKNOWN',FLATE:'FLATE',LZW:'LZW',DCT:'DCT',JPX:'JPX',JBIG:'JBIG',A85:'A85',AHX:'AHX',CCF:'CCF',RLX:'RLX'},t.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},t.UnexpectedResponseException=E,t.UnknownErrorException=h,t.Util=v,t.FormatError=b,t.arrayByteLength=l,t.arraysToBytes=function(e){var t=e.length;if(1===t&&e[0]instanceof Uint8Array)return e[0];for(var n=0,a=0;a<t;a++)n+=l(e[a]);for(var i=0,s=new Uint8Array(n),r=0,c;r<t;r++){c=e[r],c instanceof Uint8Array||('string'==typeof c?c=o(c):c=new Uint8Array(c));var d=c.byteLength;s.set(c,i),i+=d}return s},t.assert=s,t.bytesToString=function(e){s(null!==e&&'object'===('undefined'==typeof e?'undefined':g(e))&&e.length!==void 0,'Invalid argument for bytesToString');var t=e.length,n=8192;if(t<n)return p.apply(null,e);for(var a=[],r=0;r<t;r+=n){var i=d(r+n,t),o=e.subarray(r,i);a.push(p.apply(null,o))}return a.join('')},t.createPromiseCapability=function(){var e=Object.create(null),t=!1;return Object.defineProperty(e,'settled',{get:function(){return t}}),e.promise=new Promise(function(n,i){e.resolve=function(e){t=!0,n(e)},e.reject=function(e){t=!0,i(e)}}),e},t.createObjectURL=L,t.getVerbosityLevel=function(){return m},t.info=function(e){m>=f.INFOS&&console.log('Info: '+e)},t.isArrayBuffer=function(e){return'object'===('undefined'==typeof e?'undefined':g(e))&&null!==e&&e.byteLength!==void 0},t.isArrayEqual=function(e,t){return!(e.length!==t.length)&&e.every(function(e,n){return e===t[n]})},t.isBool=function(e){return'boolean'==typeof e},t.isEmptyObj=function(e){for(var t in e)return!1;return!0},t.isNum=function(e){return'number'==typeof e},t.isString=function(e){return'string'==typeof e},t.isSpace=function(e){return 32===e||9===e||13===e||10===e},t.isSameOrigin=function(e,t){var n;try{if(n=new URL(e),!n.origin||'null'===n.origin)return!1}catch(t){return!1}var i=new URL(t,n);return n.origin===i.origin},t.createValidAbsoluteUrl=function(e,t){if(!e)return null;try{var n=t?new URL(e,t):new URL(e);if(r(n))return n}catch(e){}return null},t.isLittleEndian=function(){var e=new Uint8Array(4);e[0]=1;var t=new Uint32Array(e.buffer,0,1);return 1===t[0]},t.isEvalSupported=function(){try{return new Function(''),!0}catch(t){return!1}},t.log2=function(e){return 0>=e?0:Math.ceil(Math.log2(e))},t.readInt8=function(e,t){return e[t]<<24>>24},t.readUint16=function(e,t){return e[t]<<8|e[t+1]},t.readUint32=function(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0},t.removeNullCharacters=function(e){return'string'==typeof e?e.replace(P,''):(i('The argument for removeNullCharacters must be a string.'),e)},t.ReadableStream=ReadableStream,t.URL=URL,t.setVerbosityLevel=function(e){Number.isInteger(e)&&(m=e)},t.shadow=function(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n},t.string32=function(e){return p(255&e>>24,255&e>>16,255&e>>8,255&e)},t.stringToBytes=o,t.stringToPDFString=function(e){var t=e.length,n=[];if('\xFE'===e[0]&&'\xFF'===e[1])for(var a=2;a<t;a+=2)n.push(p(e.charCodeAt(a)<<8|e.charCodeAt(a+1)));else for(var i=0,s;i<t;++i)s=S[e.charCodeAt(i)],n.push(s?p(s):e.charAt(i));return n.join('')},t.stringToUTF8String=function(e){return decodeURIComponent(escape(e))},t.utf8StringToString=function(e){return unescape(encodeURIComponent(e))},t.warn=i,t.unreachable=a},function(e,t){'use strict';function n(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(t,'__esModule',{value:!0});var i=function(){function e(e,t){for(var n=0,i;n<t.length;n++)i=t[n],i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}],a=function(){function e(t,i,a){n(this,e),this.data=t,this.bp=i,this.dataEnd=a,this.chigh=t[i],this.clow=0,this.byteIn(),this.chigh=65535&this.chigh<<7|127&this.clow>>9,this.clow=65535&this.clow<<7,this.ct-=7,this.a=32768}return i(e,[{key:'byteIn',value:function(){var e=this.data,t=this.bp;255===e[t]?143<e[t+1]?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t):(t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t),65535<this.clow&&(this.chigh+=this.clow>>16,this.clow&=65535)}},{key:'readBit',value:function(e,t){var n=e[t]>>1,i=1&e[t],r=s[n],o=r.qe,l=this.a-o,a;if(this.chigh<o)l<o?(l=o,a=i,n=r.nmps):(l=o,a=1^i,1===r.switchFlag&&(i=a),n=r.nlps);else{if(this.chigh-=o,0!=(32768&l))return this.a=l,i;l<o?(a=1^i,1===r.switchFlag&&(i=a),n=r.nlps):(a=i,n=r.nmps)}do 0===this.ct&&this.byteIn(),l<<=1,this.chigh=65535&this.chigh<<1|1&this.clow>>15,this.clow=65535&this.clow<<1,this.ct--;while(0==(32768&l));return this.a=l,e[t]=n<<1|i,a}}]),e}();t.ArithmeticDecoder=a},function(e,t,n){'use strict';function i(){this._contextPool=new r}var a=Math.max,s=Math.min;e.exports=i;var r=n(3);i.prototype.start=function(e){var t=this;return new Promise(function(n){for(var a=t._contextPool.image,s=t._contextPool.getContext(e.headersCodestream),r={left:e.offsetInRegion.offsetX,top:e.offsetInRegion.offsetY,right:e.offsetInRegion.offsetX+e.offsetInRegion.width,bottom:e.offsetInRegion.offsetY+e.offsetInRegion.height},o=e.imageTilesX,l=e.tilesBounds.maxTileXExclusive-e.tilesBounds.minTileX,c=e.tilesBounds.minTileX,d=e.tilesBounds.minTileY,p=0;p<e.precinctCoefficients.length;++p){var i=e.precinctCoefficients[p],u=i.key.tileIndex,g=Math.floor(u/o);a.setPrecinctCoefficients(s,i.coefficients,u%o-c+(g-d)*l,i.key.component,i.key.resolutionLevel,i.key.precinctIndexInComponentResolution)}a.decode(s,{regionToParse:r});var f=t._copyTilesPixelsToOnePixelsArray(a.tiles,r,a.componentsCount);n(f)})},i.prototype._copyTilesPixelsToOnePixelsArray=function(e,t,n){for(var r=e[0],o=t.right-t.left,l=t.bottom-t.top,c=new ImageData(o,l),d=4,p=o*d,u=0;u<e.length;++u){var i=e[u].left+e[u].width,g=e[u].top+e[u].height,f=a(t.left,e[u].left),m=a(t.top,e[u].top),x=s(t.right,i),h=s(t.bottom,g);if(f!==e[u].left||m!==e[u].top||x-f!==e[u].width||h-m!==e[u].height)throw'Unsupported tiles to copy';var y=f-t.left,I=m-t.top;this._copyTile(c.data,e[u],y*d+I*p,p,n)}return c},i.prototype._copyTile=function(e,t,n,i,a){var s=1,r=2,o=1,l=t.pixels||t.items;switch(void 0===a&&(a=l.length/(t.width*t.height)),a){case 1:s=0,r=0;break;case 3:o=3;break;case 4:o=4;break;default:throw'Unsupported components count '+a;}for(var c=n,d=0,p=0,u;p<t.height;++p){u=c;for(var g=0;g<t.width;++g)e[c+0]=l[d+0],e[c+1]=l[d+s],e[c+2]=l[d+r],e[c+3]=255,d+=o,c+=4;c=u+i}}},function(e,t,n){'use strict';function i(){this._contextPool=new a}e.exports=i;var a=n(3);i.prototype.start=function(e,t){var n=this;return new Promise(function(i){var a=n._contextPool.image,s=n._contextPool.getContext(e.headersCodestream);if(e.codeblocksData&&a.addPacketsData(s,e.codeblocksData),e.precinctCoefficients)for(var r=0,o;r<e.precinctCoefficients.length;++r)o=e.precinctCoefficients[r],a.setPrecinctCoefficients(s,o.coefficients,o.tileIndex,o.c,o.r,o.p);var l=a.decodePrecinctCoefficients(s,0,t.component,t.resolutionLevel,t.precinctIndexInComponentResolution);i({key:t,coefficients:l,minQuality:e.minQuality})})}}]);